{"version":3,"file":"core.53ba7cd1.js","mappings":"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","sources":["webpack:///./src/bootstrap.ts","webpack:///../../src/ExecutionContext.ts","webpack:///../../src/traverse.ts","webpack:///../../src/context-free.ts","webpack:///../../src/sanitize.ts","webpack:///../../src/cook.ts","webpack:///../../src/AnalysisContext.ts","webpack:///../../src/precook.ts","webpack:///../../src/hasOwnProperty.ts","webpack:///../../src/precookFunction.ts","webpack:///../../src/parse.ts","webpack:///../../src/preevaluate.ts","webpack:///../../src/fetch.ts","webpack:///../../src/errors.ts","webpack:///../../src/InterceptorManager.ts","webpack:///../../src/http.ts","webpack:///../../src/init.ts","webpack:///../../src/text.ts","webpack:///../../src/index.ts","webpack:///../../src/interfaces.ts","webpack:///../../src/lexical.ts","webpack:///../../src/compile.ts","webpack:///../../src/syntax.ts","webpack:///../../src/loadScript.ts","webpack:///../../src/stableLoadBricks.ts","webpack:///../../src/loadSharedModule.ts","webpack:///../../src/getBasePath.ts","webpack:///../../../src/internal/matchStoryboard.ts","webpack:///../../src/history.ts","webpack:///../../../src/internal/historyExtended.ts","webpack:///../../../src/internal/Runtime.ts","webpack:///../../src/CustomProcessors.ts","webpack:///../../../src/internal/registerAppI18n.ts","webpack:///../../../../src/internal/compute/WidgetI18n.ts","webpack:///../../../../src/internal/compute/images.ts","webpack:///../../../src/internal/devtools.ts","webpack:///../../../src/internal/proxyFactories.ts","webpack:///../../src/themeAndMode.ts","webpack:///../../../../src/internal/compute/getGeneralGlobals.ts","webpack:///../../src/StoryboardFunctionRegistry.ts","webpack:///../../../../src/internal/compute/StoryboardFunctions.ts","webpack:///../../../src/internal/mediaQuery.ts","webpack:///../../../../src/internal/compute/getStorageItem.ts","webpack:///../../src/isStrictMode.ts","webpack:///../../src/CustomTemplates.ts","webpack:///../../../../src/internal/CustomTemplates/utils.ts","webpack:///../../../../src/internal/compute/WidgetFunctions.ts","webpack:///../../../src/internal/hasInstalledApp.ts","webpack:///../../../../src/internal/FormRenderer/utils.ts","webpack:///../../../../src/internal/data/getProviderBrick.ts","webpack:///../../../../src/internal/data/resolveData.ts","webpack:///../../../../src/internal/compute/evaluate.ts","webpack:///../../../../src/internal/compute/getNextStateOfUseBrick.ts","webpack:///../../../../src/internal/compute/markAsComputed.ts","webpack:///../../../../src/internal/compute/computeRealValue.ts","webpack:///../../../../src/internal/compute/checkIf.ts","webpack:///../../../../src/internal/compute/getTracks.ts","webpack:///../../../../src/internal/compute/computeRealProperties.ts","webpack:///../../../../src/internal/compute/setRealProperties.ts","webpack:///../../../../src/internal/compute/setProperties.ts","webpack:///../../../src/internal/matchPath.ts","webpack:///../../../src/internal/matchRoutes.ts","webpack:///../../../../src/internal/CustomTemplates/constants.ts","webpack:///../../src/Dialog.ts","webpack:///../../../src/internal/poll.ts","webpack:///../../../src/internal/i18n.ts","webpack:///../../src/handleHttpError.ts","webpack:///../../src/Notification.ts","webpack:///../../../src/internal/bindListeners.ts","webpack:///../../../../src/internal/data/DataStore.ts","webpack:///../../../../src/internal/data/resolveDataStore.ts","webpack:///../../../../src/internal/CustomTemplates/setupTemplateProxy.ts","webpack:///../../../../src/internal/CustomTemplates/setupUseBrickInTemplate.ts","webpack:///../../../../src/internal/CustomTemplates/expandCustomTemplate.ts","webpack:///../../../src/internal/enums.ts","webpack:///../../../../src/internal/FormRenderer/constants.ts","webpack:///../../../../src/internal/FormRenderer/expandFormRenderer.ts","webpack:///../../../../src/internal/FormRenderer/getDefaultProperties.ts","webpack:///../../../src/internal/Renderer.ts","webpack:///../../../../src/internal/compute/listenOnTrackingContext.ts","webpack:///../../../../src/internal/CustomTemplates/bindTemplateProxy.ts","webpack:///../../../src/internal/mount.ts","webpack:///../../../src/internal/RendererContext.ts","webpack:///../../src/getPageInfo.ts","webpack:///../../../src/internal/abortController.ts","webpack:///../../../src/internal/registerCustomTemplates.ts","webpack:///../../../src/internal/fulfilStoryboard.ts","webpack:///../../../src/internal/Router.ts","webpack:///../../../src/internal/insertPreviewRoutes.ts","webpack:///../../../src/internal/injected.ts","webpack:///../../src/auth.ts","webpack:///../../src/fetchByProvider.ts","webpack:///../../src/createRoot.ts","webpack:///../../../src/internal/secret_internals.ts","webpack:///../../../src/general/createProviderClass.ts","webpack:///../../../src/general/deepFreeze.ts","webpack:///../../../src/general/hasOwnProperty.ts","webpack:///../../../src/general/isObject.ts","webpack:///../../../src/general/JsonStorage.ts","webpack:///../../../src/general/unwrapProvider.ts","webpack:///../../../../src/storyboard/expressions/beforeVisitGlobalMember.ts","webpack:///../../../../src/storyboard/expressions/collectMemberCallUsage.ts","webpack:///../../../../src/storyboard/expressions/traverse.ts","webpack:///../../../../src/storyboard/expressions/collectMemberUsage.ts","webpack:///../../../../src/storyboard/expressions/track.ts","webpack:///../../../../src/storyboard/functions/traverse.ts","webpack:///../../../../src/storyboard/functions/collectMemberUsageInFunction.ts","webpack:///../../../src/storyboard/permissions.ts"],"sourcesContent":["import {\n  createRuntime,\n  applyTheme,\n  unstable_createRoot,\n} from \"@next-core/runtime\";\nimport { http, HttpError, HttpResponse } from \"@next-core/http\";\nimport type { BootstrapData, CustomTemplate } from \"@next-core/types\";\nimport { safeLoad, JSON_SCHEMA } from \"js-yaml\";\nimport \"@next-core/theme\";\nimport type {\n  RenderType,\n  Sources,\n  RenderOptions,\n  PreviewWindow,\n} from \"../types.d.ts\";\n\ninterface RenderRequest {\n  type: RenderType;\n  sources: Sources;\n  options?: RenderOptions;\n}\n\nhttp.interceptors.request.use((config) => {\n  if (!config.options?.interceptorParams?.ignoreLoadingBar) {\n    window.dispatchEvent(new Event(\"request.start\"));\n  }\n  return config;\n});\n\nhttp.interceptors.response.use(\n  function (response: HttpResponse) {\n    window.dispatchEvent(new Event(\"request.end\"));\n    return response;\n  },\n  function (error: HttpError) {\n    window.dispatchEvent(new Event(\"request.end\"));\n    return Promise.reject(error);\n  }\n);\n\nconst loadingBar = document.querySelector(\"#global-loading-bar\");\nloadingBar.classList.add(\"rendered\");\n\nlet loading = false;\nlet count = 0;\nfunction updateLoadingStatus() {\n  const hasRemainingRequests = count > 0;\n  if (hasRemainingRequests !== loading) {\n    loading = hasRemainingRequests;\n    loadingBar.classList[hasRemainingRequests ? \"add\" : \"remove\"](\"loading\");\n  }\n}\nconst requestStart = (): void => {\n  count++;\n  updateLoadingStatus();\n};\nconst requestEnd = (): void => {\n  // 兼容 loading bar 在某些请求开始和结束之间初始化时，`count` 可能小于 0 的情况\n  if (count > 0) {\n    count--;\n    updateLoadingStatus();\n  }\n};\nwindow.addEventListener(\"request.start\", requestStart);\nwindow.addEventListener(\"request.end\", requestEnd);\n\nconst runtime = createRuntime();\n\nconst container = document.querySelector(\"#preview-root\") as HTMLElement;\nconst portal = document.querySelector(\"#portal-mount-point\") as HTMLElement;\nconst root = unstable_createRoot(container, {\n  portal,\n  scope: \"page\",\n  unknownBricks: \"silent\",\n});\n\nconst bootstrap = http\n  .get<BootstrapData>(window.BOOTSTRAP_FILE, {\n    responseType: \"json\",\n  })\n  .then((data) => {\n    runtime.initialize(data);\n  });\n\nlet rendering = false;\nlet nextRequest: RenderRequest;\n\n(window as unknown as PreviewWindow)._preview_only_render = (\n  type,\n  sources,\n  options\n) => {\n  if (rendering) {\n    nextRequest = { type, sources, options };\n  } else {\n    queuedRender({ type, sources, options });\n  }\n};\n\nasync function queuedRender(request: RenderRequest) {\n  rendering = true;\n  try {\n    const { type, sources, options } = request;\n    // Assert: `render()` will not throw\n    await render(type, sources, options);\n  } finally {\n    rendering = false;\n    if (nextRequest) {\n      const req = nextRequest;\n      nextRequest = undefined;\n      queuedRender(req);\n    }\n  }\n}\n\nlet initialized = false;\n\nasync function render(\n  type: \"html\" | \"yaml\",\n  { yaml, html }: Sources,\n  {\n    theme,\n    context,\n    functions,\n    templates,\n    i18n,\n    styleText,\n    templatesAreArrayOfYaml,\n  }: RenderOptions = {}\n): Promise<void> {\n  try {\n    if (!initialized) {\n      initialized = true;\n      document.body.classList.add(\"bootstrap-ready\");\n      applyTheme(theme === \"light\" ? theme : \"dark-v2\");\n    }\n    document.body.classList.remove(\"bootstrap-error\");\n    if (type === \"html\") {\n      applyTheme(theme === \"light\" ? theme : \"dark-v2\");\n      // Note: if use DOMParser, script tags will not be executed, while using\n      const parser = new DOMParser();\n      const dom = parser.parseFromString(html, \"text/html\");\n      const bricks = new Set<string>();\n      for (const node of dom.body.querySelectorAll(\"*\")) {\n        if (node.tagName.includes(\"-\")) {\n          const lowerTagName = node.tagName.toLowerCase();\n          bricks.add(lowerTagName);\n        }\n      }\n\n      await bootstrap;\n\n      await runtime.loadBricks(bricks);\n      container.replaceChildren();\n      portal.replaceChildren();\n      const scripts: HTMLScriptElement[] = [];\n      const scriptTags = dom.querySelectorAll(\"script\");\n      for (const scriptTag of scriptTags) {\n        const newScriptTag = document.createElement(\"script\");\n        newScriptTag.text = scriptTag.text;\n        newScriptTag.type = \"module\";\n        scripts.push(newScriptTag);\n        scriptTag.remove();\n      }\n      container.append(...dom.body.childNodes, ...scripts);\n    } else {\n      const parsed = yaml\n        ? (safeLoad(yaml, { schema: JSON_SCHEMA, json: true }) as any)\n        : null;\n      const bricks = [].concat(parsed ?? []);\n      if (styleText) {\n        bricks.push({\n          brick: \"style\",\n          portal: true,\n          properties: {\n            textContent: styleText,\n          },\n        });\n      }\n\n      const parsedContext = loadYaml(context) as any[];\n      const parsedFunctions = loadYaml(functions) as any[];\n      const parsedTemplates = loadYaml(\n        templates,\n        templatesAreArrayOfYaml\n      ) as any[];\n      const parsedI18n = loadYaml(i18n) as any;\n\n      await bootstrap;\n      await root.render(bricks, {\n        theme: theme === \"light\" ? theme : \"dark-v2\",\n        context: parsedContext,\n        functions: parsedFunctions,\n        templates: parsedTemplates,\n        i18n: parsedI18n,\n      });\n    }\n  } catch (e) {\n    // eslint-disable-next-line no-console\n    console.error(\"Render failed:\", e);\n\n    // `.bootstrap-error` makes loading-bar invisible.\n    document.body.classList.add(\"bootstrap-error\");\n\n    portal.textContent = \"\";\n    container.textContent = `Render failed: ${String(e)}`;\n  }\n}\n\ninterface YamlTemplate {\n  name: string;\n  yaml: string;\n}\n\nfunction loadYaml(content: unknown, templatesAreArrayOfYaml?: boolean) {\n  return typeof content === \"string\"\n    ? safeLoad(content, { schema: JSON_SCHEMA, json: true })\n    : templatesAreArrayOfYaml\n    ? (content as YamlTemplate[]).map((item) =>\n        typeof item.yaml === \"string\"\n          ? {\n              ...(safeLoad(item.yaml, {\n                schema: JSON_SCHEMA,\n                json: true,\n              }) as CustomTemplate),\n              name: item.name,\n            }\n          : item\n      )\n    : content;\n}\n","import {\n  ArrowFunctionExpression,\n  Expression,\n  FunctionDeclaration,\n  FunctionExpression,\n  Statement,\n} from \"@babel/types\";\n\n// https://tc39.es/ecma262/#sec-execution-contexts\nexport class ExecutionContext {\n  VariableEnvironment?: EnvironmentRecord;\n  LexicalEnvironment?: EnvironmentRecord;\n  Function?: FunctionObject;\n}\n\nexport type EnvironmentRecordType = \"function\" | \"declarative\";\n\n// https://tc39.es/ecma262/#sec-environment-records\nexport class EnvironmentRecord {\n  readonly OuterEnv: EnvironmentRecord | null | undefined;\n  private readonly bindingMap = new Map<string, BindingState>();\n\n  constructor(outer: EnvironmentRecord | null | undefined) {\n    this.OuterEnv = outer;\n  }\n\n  HasBinding(name: string): boolean {\n    return this.bindingMap.has(name);\n  }\n\n  CreateMutableBinding(name: string, deletable: boolean): CompletionRecord {\n    // Assert: binding does not exist.\n    this.bindingMap.set(name, {\n      mutable: true,\n      deletable,\n    });\n    return NormalCompletion(undefined);\n  }\n\n  /**\n   * Create an immutable binding.\n   *\n   * @param name - The binding name.\n   * @param strict - For named function expressions, strict is false, otherwise it's true.\n   * @returns CompletionRecord.\n   */\n  CreateImmutableBinding(name: string, strict: boolean): CompletionRecord {\n    // Assert: binding does not exist.\n    this.bindingMap.set(name, {\n      strict,\n    });\n    return NormalCompletion(undefined);\n  }\n\n  InitializeBinding(name: string, value: unknown): CompletionRecord {\n    const binding = this.bindingMap.get(name) as BindingState;\n    // Assert: binding exists and uninitialized.\n    Object.assign<BindingState, Partial<BindingState>>(binding, {\n      initialized: true,\n      value,\n    });\n    return NormalCompletion(undefined);\n  }\n\n  /**\n   * Update a mutable binding value, including function declarations.\n   *\n   * @param name - The binding name.\n   * @param value - The binding value.\n   * @param strict - For functions, strict is always false, otherwise it depends on strict-mode.\n   * @returns\n   */\n  SetMutableBinding(\n    name: string,\n    value: unknown,\n    strict?: boolean\n  ): CompletionRecord {\n    const binding = this.bindingMap.get(name) as BindingState;\n    // Assert: binding exists.\n    if (!binding.initialized) {\n      throw new ReferenceError(`${name} is not initialized`);\n    } else if (binding.mutable) {\n      binding.value = value;\n    } else {\n      throw new TypeError(`Assignment to constant variable`);\n    }\n    return NormalCompletion(undefined);\n  }\n\n  GetBindingValue(name: string, strict?: boolean): unknown {\n    const binding = this.bindingMap.get(name) as BindingState;\n    // Assert: binding exists.\n    if (!binding.initialized) {\n      throw new ReferenceError(`${name} is not initialized`);\n    }\n    return binding.value;\n  }\n}\n\nexport class DeclarativeEnvironment extends EnvironmentRecord {}\n\nexport class FunctionEnvironment extends EnvironmentRecord {}\n\nexport interface BindingState {\n  initialized?: boolean;\n  value?: unknown;\n  mutable?: boolean;\n\n  /** This is used for mutable bindings only. */\n  deletable?: boolean;\n\n  /**\n   * This is used for immutable bindings only.\n   * For named function expressions, `strict` is false,\n   * otherwise it's true.\n   */\n  strict?: boolean;\n}\n\nexport const SourceNode = Symbol.for(\"SourceNode\");\nexport const FormalParameters = Symbol.for(\"FormalParameters\");\nexport const ECMAScriptCode = Symbol.for(\"ECMAScriptCode\");\nexport const Environment = Symbol.for(\"Environment\");\nexport const IsConstructor = Symbol.for(\"IsConstructor\");\n\nexport interface FunctionObject {\n  (...args: unknown[]): unknown;\n  [SourceNode]:\n    | FunctionDeclaration\n    | FunctionExpression\n    | ArrowFunctionExpression;\n  [FormalParameters]: FunctionDeclaration[\"params\"];\n  [ECMAScriptCode]: Statement[] | Expression;\n  [Environment]: EnvironmentRecord;\n  [IsConstructor]: boolean;\n}\n\n// https://tc39.es/ecma262/#sec-reference-record-specification-type\nexport class ReferenceRecord {\n  readonly Base:\n    | Record<PropertyKey, unknown>\n    | EnvironmentRecord\n    | \"unresolvable\";\n  readonly ReferenceName: PropertyKey;\n  /** Whether the reference is in strict mode. */\n  readonly Strict?: boolean;\n\n  constructor(\n    base: Record<PropertyKey, unknown> | EnvironmentRecord | \"unresolvable\",\n    referenceName: PropertyKey,\n    strict: boolean\n  ) {\n    this.Base = base;\n    this.ReferenceName = referenceName;\n    this.Strict = strict;\n  }\n}\n\n// https://tc39.es/ecma262/#sec-completion-record-specification-type\nexport class CompletionRecord {\n  readonly Type: CompletionRecordType;\n  readonly Value: unknown;\n\n  constructor(type: CompletionRecordType, value: unknown) {\n    this.Type = type;\n    this.Value = value;\n  }\n}\n\nexport type CompletionRecordType =\n  | \"normal\"\n  | \"break\"\n  | \"continue\"\n  | \"return\"\n  | \"throw\";\n\n// https://tc39.es/ecma262/#sec-normalcompletion\nexport function NormalCompletion(value: unknown): CompletionRecord {\n  return new CompletionRecord(\"normal\", value);\n}\n\nexport const Empty = Symbol(\"empty completion\");\n\nexport interface OptionalChainRef {\n  skipped?: boolean;\n}\n","import { FunctionDeclaration, VariableDeclaration } from \"@babel/types\";\nimport { EstreeNode, NodeWithBoundNames } from \"./interfaces.js\";\n\ntype InternalCollect<T = void, O = unknown> = (\n  node: EstreeNode | null | undefined | (EstreeNode | null)[],\n  options?: O\n) => T;\ntype InternalCollectWithOptions<T = void, O = unknown> = (\n  node: EstreeNode | null | undefined | (EstreeNode | null)[],\n  options: O\n) => T;\n\nexport function collectBoundNames(\n  root: NodeWithBoundNames | NodeWithBoundNames[] | null | undefined\n): string[] {\n  const names = new Set<string>();\n  const collect: InternalCollect = (node) => {\n    if (Array.isArray(node)) {\n      for (const n of node) {\n        collect(n);\n      }\n    } else if (node) {\n      // `node` maybe `null` in some cases.\n      switch (node.type) {\n        case \"Identifier\":\n          names.add(node.name);\n          return;\n        case \"VariableDeclaration\":\n          return collect(node.declarations);\n        case \"VariableDeclarator\":\n          return collect(node.id);\n        case \"ArrayPattern\":\n          return collect(node.elements);\n        case \"AssignmentPattern\":\n          return collect(node.left);\n        case \"ObjectPattern\":\n          return collect(node.properties);\n        case \"Property\":\n          return collect(node.value);\n        case \"RestElement\":\n          return collect(node.argument);\n        case \"FunctionDeclaration\":\n          return collect(node.id);\n      }\n    }\n  };\n  collect(root);\n  return Array.from(names);\n}\n\nexport function containsExpression(\n  root: EstreeNode | EstreeNode[]\n): boolean | undefined {\n  const collect: InternalCollect<boolean | undefined> = (node) => {\n    if (Array.isArray(node)) {\n      return node.some(collect);\n    } else if (node) {\n      // `node` maybe `null` in some cases.\n      switch (node.type) {\n        case \"ArrayPattern\":\n          return collect(node.elements);\n        case \"AssignmentPattern\":\n          return true;\n        case \"ObjectPattern\":\n          return collect(node.properties);\n        case \"Property\":\n          return node.computed || collect(node.value);\n        case \"RestElement\":\n          return collect(node.argument);\n      }\n    }\n  };\n  return collect(root);\n}\n\ninterface ScopedDeclarationOptions {\n  var?: boolean;\n  topLevel?: boolean;\n}\n\ntype ScopedDeclaration = VariableDeclaration | FunctionDeclaration;\n\nexport function collectScopedDeclarations(\n  root: EstreeNode | EstreeNode[],\n  options: ScopedDeclarationOptions\n): ScopedDeclaration[] {\n  const declarations: ScopedDeclaration[] = [];\n  const nextOptions = { var: options.var };\n  const collect: InternalCollectWithOptions<void, ScopedDeclarationOptions> = (\n    node,\n    options\n  ): void => {\n    if (Array.isArray(node)) {\n      for (const n of node) {\n        collect(n, options);\n      }\n    } else if (node) {\n      // `node` maybe `null` in some cases.\n      switch (node.type) {\n        case \"FunctionDeclaration\":\n          // At the top level of a function, or script, function declarations are\n          // treated like var declarations rather than like lexical declarations.\n          // See https://tc39.es/ecma262/#sec-static-semantics-toplevellexicallydeclarednames\n          if (Number(!options.var) ^ Number(options.topLevel)) {\n            declarations.push(node);\n          }\n          return;\n        case \"VariableDeclaration\":\n          if (Number(!options.var) ^ Number(node.kind === \"var\")) {\n            declarations.push(node);\n          }\n          return;\n        case \"SwitchCase\":\n          collect(node.consequent, nextOptions);\n          return;\n        case \"CatchClause\":\n          collect(node.body, nextOptions);\n          return;\n      }\n      if (options.var) {\n        switch (node.type) {\n          case \"BlockStatement\":\n            collect(node.body, nextOptions);\n            return;\n          case \"IfStatement\":\n            collect(node.consequent, nextOptions);\n            collect(node.alternate, nextOptions);\n            return;\n          case \"DoWhileStatement\":\n          case \"WhileStatement\":\n            collect(node.body, nextOptions);\n            return;\n          case \"ForStatement\":\n            collect(node.init, nextOptions);\n            collect(node.body, nextOptions);\n            return;\n          case \"ForInStatement\":\n          case \"ForOfStatement\":\n            collect(node.left, nextOptions);\n            collect(node.body, nextOptions);\n            return;\n          case \"SwitchStatement\":\n            collect(node.cases, nextOptions);\n            return;\n          case \"TryStatement\":\n            collect(node.block, nextOptions);\n            collect(node.handler, nextOptions);\n            collect(node.finalizer, nextOptions);\n            return;\n        }\n      }\n    }\n  };\n  collect(root, options);\n  return declarations;\n}\n","import {\n  BinaryExpression,\n  UnaryExpression,\n  VariableDeclaration,\n} from \"@babel/types\";\nimport {\n  CompletionRecord,\n  Empty,\n  EnvironmentRecord,\n  NormalCompletion,\n  ReferenceRecord,\n} from \"./ExecutionContext.js\";\nimport { collectBoundNames } from \"./traverse.js\";\n\n// https://tc39.es/ecma262/#sec-ispropertyreference\nexport function IsPropertyReference(V: ReferenceRecord): boolean {\n  return V.Base !== \"unresolvable\" && !(V.Base instanceof EnvironmentRecord);\n}\n\n// https://tc39.es/ecma262/#sec-initializereferencedbinding\nexport function InitializeReferencedBinding(\n  V: ReferenceRecord,\n  W: unknown\n): CompletionRecord {\n  const base = V.Base as EnvironmentRecord;\n  return base.InitializeBinding(V.ReferenceName as string, W);\n}\n\n// https://tc39.es/ecma262/#sec-copydataproperties\nexport function CopyDataProperties(\n  target: Record<PropertyKey, unknown>,\n  source: unknown,\n  excludedItems: Set<PropertyKey>\n): Record<PropertyKey, unknown> {\n  if (source === undefined || source === null) {\n    return target;\n  }\n  const keys = (Object.getOwnPropertyNames(source) as PropertyKey[]).concat(\n    Object.getOwnPropertySymbols(source)\n  );\n  for (const nextKey of keys) {\n    if (!excludedItems.has(nextKey)) {\n      const desc = Object.getOwnPropertyDescriptor(source, nextKey);\n      if (desc?.enumerable) {\n        target[nextKey] = (source as Record<PropertyKey, unknown>)[nextKey];\n      }\n    }\n  }\n  return target;\n}\n\n// https://tc39.es/ecma262/#sec-runtime-semantics-fordeclarationbindinginstantiation\nexport function ForDeclarationBindingInstantiation(\n  forDeclaration: VariableDeclaration,\n  env: EnvironmentRecord\n): void {\n  const isConst = forDeclaration.kind === \"const\";\n  for (const name of collectBoundNames(forDeclaration)) {\n    if (isConst) {\n      env.CreateImmutableBinding(name, true);\n    } else {\n      env.CreateMutableBinding(name, false);\n    }\n  }\n}\n\n// https://tc39.es/ecma262/#sec-loopcontinues\nexport function LoopContinues(completion: CompletionRecord): boolean {\n  return completion.Type === \"normal\" || completion.Type == \"continue\";\n}\n\n// https://tc39.es/ecma262/#sec-updateempty\nexport function UpdateEmpty(\n  completion: CompletionRecord,\n  value: unknown\n): CompletionRecord {\n  if (completion.Value !== Empty) {\n    return completion;\n  }\n  return new CompletionRecord(completion.Type, value);\n}\n\n// https://tc39.es/ecma262/#sec-getvalue\nexport function GetValue(V: unknown): unknown {\n  if (V instanceof CompletionRecord) {\n    // Assert: V.Type is normal.\n    V = V.Value;\n  }\n  if (!(V instanceof ReferenceRecord)) {\n    return V;\n  }\n  if (V.Base === \"unresolvable\") {\n    throw new ReferenceError(`${V.ReferenceName as string} is not defined`);\n  }\n  if (V.Base instanceof EnvironmentRecord) {\n    const base = V.Base as EnvironmentRecord;\n    return base.GetBindingValue(V.ReferenceName as string, V.Strict);\n  }\n  return V.Base[V.ReferenceName];\n}\n\n// https://tc39.es/ecma262/#sec-topropertykey\nexport function ToPropertyKey(arg: unknown): string | symbol {\n  if (typeof arg === \"symbol\") {\n    return arg;\n  }\n  return String(arg);\n}\n\n// https://tc39.es/ecma262/#sec-getv\nexport function GetV(V: unknown, P: PropertyKey): unknown {\n  return (V as Record<PropertyKey, unknown>)[P];\n}\n\n// https://tc39.es/ecma262/#sec-putvalue\nexport function PutValue(V: ReferenceRecord, W: unknown): CompletionRecord {\n  // Assert: V is a ReferenceRecord.\n  if (V.Base === \"unresolvable\") {\n    throw new ReferenceError(`${V.ReferenceName as string} is not defined`);\n  }\n  if (V.Base instanceof EnvironmentRecord) {\n    return V.Base.SetMutableBinding(V.ReferenceName as string, W, V.Strict);\n  }\n  V.Base[V.ReferenceName] = W;\n  return NormalCompletion(undefined);\n}\n\n// https://tc39.es/ecma262/#sec-createlistiteratorRecord\nexport function CreateListIteratorRecord(\n  args: Iterable<unknown>\n): Iterator<unknown> {\n  if (!isIterable(args)) {\n    throw new TypeError(`${typeof args} is not iterable`);\n  }\n  return args[Symbol.iterator]();\n}\n\n// https://tc39.es/ecma262/#sec-requireobjectcoercible\nexport function RequireObjectCoercible(arg: unknown): void {\n  if (arg === null || arg === undefined) {\n    throw new TypeError(\"Cannot destructure properties of undefined or null\");\n  }\n}\n\n// https://tc39.es/ecma262/#sec-getidentifierreference\nexport function GetIdentifierReference(\n  env: EnvironmentRecord | null | undefined,\n  name: string,\n  strict: boolean\n): ReferenceRecord {\n  if (!env) {\n    return new ReferenceRecord(\"unresolvable\", name, strict);\n  }\n  if (env.HasBinding(name)) {\n    return new ReferenceRecord(env, name, strict);\n  }\n  return GetIdentifierReference(env.OuterEnv, name, strict);\n}\n\n// https://tc39.es/ecma262/#sec-applystringornumericbinaryoperator\nexport function ApplyStringOrNumericBinaryOperator(\n  leftValue: number,\n  operator: BinaryExpression[\"operator\"] | \"|>\",\n  rightValue: number\n): unknown {\n  switch (operator) {\n    case \"+\":\n      return leftValue + rightValue;\n    case \"-\":\n      return leftValue - rightValue;\n    case \"/\":\n      return leftValue / rightValue;\n    case \"%\":\n      return leftValue % rightValue;\n    case \"*\":\n      return leftValue * rightValue;\n    case \"**\":\n      return leftValue ** rightValue;\n    case \"==\":\n      return leftValue == rightValue;\n    case \"===\":\n      return leftValue === rightValue;\n    case \"!=\":\n      return leftValue != rightValue;\n    case \"!==\":\n      return leftValue !== rightValue;\n    case \">\":\n      return leftValue > rightValue;\n    case \"<\":\n      return leftValue < rightValue;\n    case \">=\":\n      return leftValue >= rightValue;\n    case \"<=\":\n      return leftValue <= rightValue;\n  }\n  throw new SyntaxError(`Unsupported binary operator \\`${operator}\\``);\n}\n\n// https://tc39.es/ecma262/#sec-assignment-operators\nexport function ApplyStringOrNumericAssignment(\n  leftValue: string | number,\n  operator: string,\n  rightValue: string | number\n): unknown {\n  switch (operator) {\n    case \"+=\":\n    case \"-=\":\n    case \"*=\":\n    case \"/=\":\n    case \"%=\":\n    case \"**=\":\n      return ApplyStringOrNumericBinaryOperator(\n        leftValue as number,\n        operator.substr(0, operator.length - 1) as BinaryExpression[\"operator\"],\n        rightValue as number\n      );\n  }\n\n  throw new SyntaxError(`Unsupported assignment operator \\`${operator}\\``);\n}\n\n// https://tc39.es/ecma262/#sec-unary-operators\nexport function ApplyUnaryOperator(\n  target: unknown,\n  operator: UnaryExpression[\"operator\"]\n): unknown {\n  switch (operator) {\n    case \"!\":\n      return !target;\n    case \"+\":\n      return +(target as string | number);\n    case \"-\":\n      return -(target as string | number);\n    case \"void\":\n      return undefined;\n  }\n  throw new SyntaxError(`Unsupported unary operator \\`${operator}\\``);\n}\n\nexport function isIterable(cooked: unknown): boolean {\n  if (Array.isArray(cooked)) {\n    return true;\n  }\n  if (cooked === null || cooked === undefined) {\n    return false;\n  }\n  return typeof (cooked as Iterable<unknown>)[Symbol.iterator] === \"function\";\n}\n","// Ref https://github.com/tc39/proposal-global\n// In addition, the es6-shim had to switch from Function('return this')()\n// due to CSP concerns, such that the current check to handle browsers,\n// node, web workers, and frames is:\n// istanbul ignore next\n// eslint-disable-next-line @typescript-eslint/ban-types\nfunction getGlobal(): object {\n  // the only reliable means to get the global object is\n  // `Function('return this')()`\n  // However, this causes CSP violations in Chrome apps.\n  if (typeof self !== \"undefined\") {\n    return self;\n  }\n  if (typeof window !== \"undefined\") {\n    return window;\n  }\n  if (typeof global !== \"undefined\") {\n    return global;\n  }\n  throw new Error(\"unable to locate global object\");\n}\n\n/**\n * There are chances to construct a `Function` from a string, etc.\n * ```\n * ((a,b)=>a[b])(()=>1, 'constructor')('console.log(`yo`)')()\n * ```\n */\nconst reservedObjects = new WeakSet([\n  // `Function(\"...\")` is considered *extremely vulnerable*.\n  Function,\n  // `Object.assign()` is considered vulnerable.\n  Object,\n  // `prototype` is considered vulnerable.\n  Function.prototype,\n  Object.prototype,\n  // Global `window` is considered vulnerable, too.\n  getGlobal(),\n]);\n\nexport function sanitize(cooked: unknown): void {\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  if (reservedObjects.has(cooked as object)) {\n    throw new TypeError(\"Cannot access reserved objects such as `Function`.\");\n  }\n}\n\nconst allowedConstructors = new WeakSet([\n  Array,\n  Map,\n  Set,\n  URLSearchParams,\n  WeakMap,\n  WeakSet,\n  RegExp,\n]);\n\nexport function isAllowedConstructor(constructor: unknown): boolean {\n  // `Date` maybe mocked when running tests for storyboard functions.\n  return (\n    allowedConstructors.has(constructor as ArrayConstructor) ||\n    constructor === Date\n  );\n}\n","import {\n  ArrayPattern,\n  ArrowFunctionExpression,\n  CallExpression,\n  CatchClause,\n  DoWhileStatement,\n  Expression,\n  ForInStatement,\n  ForOfStatement,\n  ForStatement,\n  FunctionDeclaration,\n  FunctionExpression,\n  Identifier,\n  LVal,\n  NewExpression,\n  ObjectPattern,\n  PatternLike,\n  RestElement,\n  Statement,\n  SwitchCase,\n  TemplateLiteral,\n  VariableDeclaration,\n  WhileStatement,\n} from \"@babel/types\";\nimport {\n  ApplyStringOrNumericAssignment,\n  CreateListIteratorRecord,\n  ApplyStringOrNumericBinaryOperator,\n  GetV,\n  GetValue,\n  InitializeReferencedBinding,\n  IsPropertyReference,\n  LoopContinues,\n  PutValue,\n  RequireObjectCoercible,\n  ToPropertyKey,\n  UpdateEmpty,\n  ApplyUnaryOperator,\n  GetIdentifierReference,\n  ForDeclarationBindingInstantiation,\n  CopyDataProperties,\n} from \"./context-free.js\";\nimport {\n  CompletionRecord,\n  DeclarativeEnvironment,\n  ECMAScriptCode,\n  Empty,\n  Environment,\n  EnvironmentRecord,\n  ExecutionContext,\n  FormalParameters,\n  FunctionEnvironment,\n  FunctionObject,\n  IsConstructor,\n  NormalCompletion,\n  OptionalChainRef,\n  ReferenceRecord,\n  SourceNode,\n} from \"./ExecutionContext.js\";\nimport {\n  EstreeLVal,\n  EstreeNode,\n  EstreeObjectExpression,\n  EstreeObjectPattern,\n  EstreeProperty,\n  CookRules,\n} from \"./interfaces.js\";\nimport { sanitize, isAllowedConstructor } from \"./sanitize.js\";\nimport {\n  collectBoundNames,\n  collectScopedDeclarations,\n  containsExpression,\n} from \"./traverse.js\";\n\nexport interface CookOptions {\n  rules?: CookRules;\n  globalVariables?: Record<string, unknown>;\n  hooks?: CookHooks;\n}\n\nexport interface CookHooks {\n  beforeEvaluate?(node: EstreeNode): void;\n  beforeCall?(node: EstreeNode): void;\n  beforeBranch?(node: EstreeNode, branch: \"if\" | \"else\"): void;\n}\n\n/** For next-core internal usage only. */\nexport function cook(\n  rootAst: FunctionDeclaration | Expression,\n  codeSource: string,\n  { rules, globalVariables = {}, hooks = {} }: CookOptions = {}\n): unknown {\n  const expressionOnly = rootAst.type !== \"FunctionDeclaration\";\n\n  const rootEnv = new DeclarativeEnvironment(null);\n  const rootContext = new ExecutionContext();\n  rootContext.VariableEnvironment = rootEnv;\n  rootContext.LexicalEnvironment = rootEnv;\n  const executionContextStack = [rootContext];\n\n  for (const [key, value] of Object.entries(globalVariables)) {\n    rootEnv.CreateImmutableBinding(key, true);\n    rootEnv.InitializeBinding(key, value);\n  }\n\n  const TemplateMap = new WeakMap<TemplateLiteral, string[]>();\n\n  // https://tc39.es/ecma262/#sec-gettemplateobject\n  function GetTemplateObject(templateLiteral: TemplateLiteral): string[] {\n    const memo = TemplateMap.get(templateLiteral);\n    if (memo) {\n      return memo;\n    }\n    const rawObj = templateLiteral.quasis.map((quasi) => quasi.value.raw);\n    const template = templateLiteral.quasis.map((quasi) => quasi.value.cooked!);\n    Object.freeze(rawObj);\n    Object.defineProperty(template, \"raw\", {\n      value: rawObj,\n      writable: false,\n      enumerable: false,\n      configurable: false,\n    });\n    Object.freeze(template);\n    TemplateMap.set(templateLiteral, template);\n    return template;\n  }\n\n  function Evaluate(\n    node: EstreeNode,\n    optionalChainRef?: OptionalChainRef\n  ): CompletionRecord {\n    hooks.beforeEvaluate?.(node);\n    // Expressions:\n    switch (node.type) {\n      case \"ArrayExpression\": {\n        // https://tc39.es/ecma262/#sec-array-initializer\n        const array = [];\n        for (const element of node.elements) {\n          if (!element) {\n            array.length += 1;\n          } else if (element.type === \"SpreadElement\") {\n            const spreadValues = GetValue(\n              Evaluate(element.argument)\n            ) as unknown[];\n            array.push(...spreadValues);\n          } else {\n            array.push(GetValue(Evaluate(element)));\n          }\n        }\n        return NormalCompletion(array);\n      }\n      case \"ArrowFunctionExpression\": {\n        // https://tc39.es/ecma262/#sec-arrow-function-definitions\n        ThrowIfFunctionIsInvalid(node);\n        const closure = InstantiateArrowFunctionExpression(node);\n        return NormalCompletion(closure);\n      }\n      case \"BinaryExpression\": {\n        const leftRef = Evaluate(node.left);\n        const leftValue = GetValue(leftRef);\n        const rightRef = Evaluate(node.right).Value;\n        const rightValue = GetValue(rightRef);\n        if (expressionOnly && (node.operator as unknown) === \"|>\") {\n          // Minimal pipeline operator is supported only in expression-only mode.\n          // See https://tc39.es/proposal-pipeline-operator\n          // and https://github.com/tc39/proposal-pipeline-operator\n          if (typeof rightValue !== \"function\") {\n            const funcName = codeSource.substring(\n              node.right.start!,\n              node.right.end!\n            );\n            throw new TypeError(`${funcName} is not a function`);\n          }\n          let thisValue;\n          if (rightRef instanceof ReferenceRecord) {\n            if (IsPropertyReference(rightRef)) {\n              thisValue = rightRef.Base;\n            }\n          }\n          return NormalCompletion(\n            (rightValue as unknown as Function).call(thisValue, leftValue)\n          );\n        }\n        // https://tc39.es/ecma262/#sec-additive-operators\n        const result = ApplyStringOrNumericBinaryOperator(\n          leftValue as number,\n          node.operator,\n          rightValue as number\n        );\n        return NormalCompletion(result);\n      }\n      case \"CallExpression\": {\n        // https://tc39.es/ecma262/#sec-function-calls\n        const ref = Evaluate(node.callee, optionalChainRef)\n          .Value as ReferenceRecord;\n        const func = GetValue(ref) as Function;\n        if (\n          (func === undefined || func === null) &&\n          (node.optional || optionalChainRef?.skipped)\n        ) {\n          optionalChainRef!.skipped = true;\n          return NormalCompletion(undefined);\n        }\n        sanitize(func);\n        return EvaluateCall(func, ref, node.arguments, node.callee);\n      }\n      case \"ChainExpression\":\n        // https://tc39.es/ecma262/#sec-optional-chains\n        return Evaluate(node.expression, {});\n      case \"ConditionalExpression\":\n        // https://tc39.es/ecma262/#sec-conditional-operator\n        return NormalCompletion(\n          GetValue(\n            Evaluate(\n              GetValue(Evaluate(node.test)) ? node.consequent : node.alternate\n            )\n          )\n        );\n      case \"Identifier\":\n        // https://tc39.es/ecma262/#sec-identifiers\n        return NormalCompletion(ResolveBinding(node.name));\n      case \"Literal\": {\n        // https://tc39.es/ecma262/#sec-primary-expression-literals\n        if (node.regex) {\n          if (node.value === null) {\n            // Invalid regular expression fails silently in @babel/parser.\n            throw new SyntaxError(`Invalid regular expression: ${node.raw}`);\n          }\n          if (node.regex.flags.includes(\"u\")) {\n            // Currently unicode flag is not fully supported across major browsers.\n            throw new SyntaxError(\n              `Unsupported unicode flag in regular expression: ${node.raw}`\n            );\n          }\n        }\n        return NormalCompletion(node.value);\n      }\n      case \"LogicalExpression\": {\n        // https://tc39.es/ecma262/#sec-binary-logical-operators\n        const leftValue = GetValue(Evaluate(node.left));\n        switch (node.operator) {\n          case \"&&\":\n            return NormalCompletion(\n              leftValue && GetValue(Evaluate(node.right))\n            );\n          case \"||\":\n            return NormalCompletion(\n              leftValue || GetValue(Evaluate(node.right))\n            );\n          case \"??\":\n            return NormalCompletion(\n              leftValue ?? GetValue(Evaluate(node.right))\n            );\n          // istanbul ignore next\n          default:\n            throw new SyntaxError(\n              // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n              // @ts-ignore never reach here.\n              `Unsupported logical operator '${node.operator}'`\n            );\n        }\n      }\n      case \"MemberExpression\": {\n        // https://tc39.es/ecma262/#sec-property-accessors\n        const baseReference = Evaluate(node.object, optionalChainRef)\n          .Value as ReferenceRecord;\n        const baseValue = GetValue(baseReference) as Record<\n          PropertyKey,\n          unknown\n        >;\n        if (\n          (baseValue === undefined || baseValue === null) &&\n          (node.optional || optionalChainRef?.skipped)\n        ) {\n          optionalChainRef!.skipped = true;\n          return NormalCompletion(undefined);\n        }\n        sanitize(baseValue);\n        const result = node.computed\n          ? EvaluatePropertyAccessWithExpressionKey(\n              baseValue,\n              node.property as Expression,\n              true\n            )\n          : EvaluatePropertyAccessWithIdentifierKey(\n              baseValue,\n              node.property as Identifier,\n              true\n            );\n        sanitize(result);\n        return NormalCompletion(result);\n      }\n      case \"NewExpression\":\n        // https://tc39.es/ecma262/#sec-new-operator\n        return EvaluateNew(node.callee, node.arguments);\n      case \"ObjectExpression\": {\n        // https://tc39.es/ecma262/#sec-object-initializer\n        const object: Record<PropertyKey, unknown> = {};\n        for (const prop of (node as EstreeObjectExpression).properties) {\n          if (prop.type === \"SpreadElement\") {\n            const fromValue = GetValue(Evaluate(prop.argument));\n            CopyDataProperties(object, fromValue, new Set());\n          } else {\n            if (prop.kind !== \"init\") {\n              throw new SyntaxError(\"Unsupported object getter/setter\");\n            }\n            const propName =\n              !prop.computed && prop.key.type === \"Identifier\"\n                ? prop.key.name\n                : EvaluateComputedPropertyName(prop.key as Expression);\n            if (propName === \"__proto__\") {\n              throw new TypeError(\n                \"Setting '__proto__' property is not allowed\"\n              );\n            }\n            object[propName] = GetValue(Evaluate(prop.value));\n          }\n        }\n        return NormalCompletion(object);\n      }\n      case \"SequenceExpression\": {\n        // https://tc39.es/ecma262/#sec-comma-operator\n        let result: CompletionRecord | undefined;\n        for (const expr of node.expressions) {\n          result = NormalCompletion(GetValue(Evaluate(expr)));\n        }\n        return result!;\n      }\n      case \"TemplateLiteral\": {\n        // https://tc39.es/ecma262/#sec-template-literals\n        const chunks: string[] = [node.quasis[0].value.cooked!];\n        let index = 0;\n        for (const expr of node.expressions) {\n          const val = GetValue(Evaluate(expr));\n          chunks.push(String(val));\n          chunks.push(node.quasis[(index += 1)].value.cooked!);\n        }\n        return NormalCompletion(chunks.join(\"\"));\n      }\n      case \"TaggedTemplateExpression\": {\n        // https://tc39.es/ecma262/#sec-tagged-templates\n        const tagRef = Evaluate(node.tag).Value as ReferenceRecord;\n        const tagFunc = GetValue(tagRef) as Function;\n        sanitize(tagFunc);\n        return EvaluateCall(tagFunc, tagRef, node.quasi, node.tag);\n      }\n      case \"UnaryExpression\": {\n        // https://tc39.es/ecma262/#sec-unary-operators\n        const ref = Evaluate(node.argument).Value as ReferenceRecord;\n        if (!expressionOnly && node.operator === \"delete\") {\n          // Delete operator is supported only in function mode.\n          if (!(ref instanceof ReferenceRecord)) {\n            return NormalCompletion(true);\n          }\n          // istanbul ignore else\n          if (IsPropertyReference(ref)) {\n            const deleteStatus = delete (\n              ref.Base as Record<PropertyKey, unknown>\n            )[ref.ReferenceName];\n            return NormalCompletion(deleteStatus);\n          }\n          // Should never reach here in strict mode.\n        }\n        if (node.operator === \"typeof\") {\n          if (ref instanceof ReferenceRecord && ref.Base === \"unresolvable\") {\n            return NormalCompletion(\"undefined\");\n          }\n          return NormalCompletion(typeof GetValue(ref));\n        }\n        return NormalCompletion(\n          ApplyUnaryOperator(GetValue(ref), node.operator)\n        );\n      }\n    }\n    if (!expressionOnly) {\n      // Statements and assignments:\n      switch (node.type) {\n        case \"AssignmentExpression\": {\n          // https://tc39.es/ecma262/#sec-assignment-operators\n          if (node.operator === \"=\") {\n            if (\n              !(\n                node.left.type === \"ArrayPattern\" ||\n                node.left.type === \"ObjectPattern\"\n              )\n            ) {\n              const lref = Evaluate(node.left).Value as ReferenceRecord;\n              // Todo: IsAnonymousFunctionDefinition(lref)\n              const rref = Evaluate(node.right);\n              const rval = GetValue(rref);\n\n              PutValue(lref, rval);\n              return NormalCompletion(rval);\n            }\n            const rref = Evaluate(node.right);\n            const rval = GetValue(rref) as string | number;\n            DestructuringAssignmentEvaluation(node.left, rval);\n            return NormalCompletion(rval);\n          }\n          // Operators other than `=`.\n          const lref = Evaluate(node.left).Value as ReferenceRecord;\n          const lval = GetValue(lref) as string | number;\n          const rref = Evaluate(node.right);\n          const rval = GetValue(rref) as string | number;\n          const r = ApplyStringOrNumericAssignment(lval, node.operator, rval);\n          PutValue(lref, r);\n          return NormalCompletion(r);\n        }\n        case \"BlockStatement\": {\n          // https://tc39.es/ecma262/#sec-block\n          if (!node.body.length) {\n            return NormalCompletion(Empty);\n          }\n          const oldEnv = getRunningContext().LexicalEnvironment;\n          const blockEnv = new DeclarativeEnvironment(oldEnv);\n          BlockDeclarationInstantiation(node.body, blockEnv);\n          getRunningContext().LexicalEnvironment = blockEnv;\n          const blockValue = EvaluateStatementList(node.body);\n          getRunningContext().LexicalEnvironment = oldEnv;\n          return blockValue;\n        }\n        case \"BreakStatement\":\n          // https://tc39.es/ecma262/#sec-break-statement\n          return new CompletionRecord(\"break\", Empty);\n        case \"ContinueStatement\":\n          // https://tc39.es/ecma262/#sec-continue-statement\n          return new CompletionRecord(\"continue\", Empty);\n        case \"EmptyStatement\":\n          // https://tc39.es/ecma262/#sec-empty-statement\n          return NormalCompletion(Empty);\n        case \"DoWhileStatement\":\n          // https://tc39.es/ecma262/#sec-do-while-statement\n          return EvaluateBreakableStatement(DoWhileLoopEvaluation(node));\n        case \"ExpressionStatement\":\n        case \"TSAsExpression\":\n          // https://tc39.es/ecma262/#sec-expression-statement\n          return Evaluate(node.expression);\n        case \"ForInStatement\":\n        case \"ForOfStatement\":\n          // https://tc39.es/ecma262/#sec-for-in-and-for-of-statements\n          return EvaluateBreakableStatement(ForInOfLoopEvaluation(node));\n        case \"ForStatement\":\n          // https://tc39.es/ecma262/#sec-for-statement\n          return EvaluateBreakableStatement(ForLoopEvaluation(node));\n        case \"FunctionDeclaration\":\n          // https://tc39.es/ecma262/#sec-function-definitions\n          return NormalCompletion(Empty);\n        case \"FunctionExpression\":\n          // https://tc39.es/ecma262/#sec-function-defining-expressions\n          ThrowIfFunctionIsInvalid(node);\n          return NormalCompletion(InstantiateOrdinaryFunctionExpression(node));\n        case \"IfStatement\":\n          // https://tc39.es/ecma262/#sec-if-statement\n          return GetValue(Evaluate(node.test))\n            ? (hooks.beforeBranch?.(node, \"if\"),\n              UpdateEmpty(Evaluate(node.consequent), undefined))\n            : (hooks.beforeBranch?.(node, \"else\"), node.alternate)\n            ? UpdateEmpty(Evaluate(node.alternate), undefined)\n            : NormalCompletion(undefined);\n        case \"ReturnStatement\": {\n          // https://tc39.es/ecma262/#sec-return-statement\n          let v: unknown;\n          if (node.argument) {\n            const exprRef = Evaluate(node.argument);\n            v = GetValue(exprRef);\n          }\n          return new CompletionRecord(\"return\", v);\n        }\n        case \"ThrowStatement\":\n          // https://tc39.es/ecma262/#sec-throw-statement\n          throw GetValue(Evaluate(node.argument));\n        case \"UpdateExpression\": {\n          // https://tc39.es/ecma262/#sec-update-expressions\n          const lhs = Evaluate(node.argument).Value as ReferenceRecord;\n          const oldValue = Number(GetValue(lhs));\n          const newValue = node.operator === \"++\" ? oldValue + 1 : oldValue - 1;\n          PutValue(lhs, newValue);\n          return NormalCompletion(node.prefix ? newValue : oldValue);\n        }\n        case \"SwitchCase\":\n          return EvaluateStatementList(node.consequent);\n        case \"SwitchStatement\": {\n          // https://tc39.es/ecma262/#sec-switch-statement\n          const exprRef = Evaluate(node.discriminant);\n          const switchValue = GetValue(exprRef);\n          const oldEnv = getRunningContext().LexicalEnvironment;\n          const blockEnv = new DeclarativeEnvironment(oldEnv);\n          BlockDeclarationInstantiation(node.cases, blockEnv);\n          getRunningContext().LexicalEnvironment = blockEnv;\n          const R = CaseBlockEvaluation(node.cases, switchValue);\n          getRunningContext().LexicalEnvironment = oldEnv;\n          return EvaluateBreakableStatement(R);\n        }\n        case \"TryStatement\": {\n          // https://tc39.es/ecma262/#sec-try-statement\n          let R: CompletionRecord;\n          try {\n            R = Evaluate(node.block);\n          } catch (error) {\n            if (node.handler) {\n              hooks.beforeEvaluate?.(node.handler);\n              R = CatchClauseEvaluation(node.handler, error);\n            } else {\n              throw error;\n            }\n          } finally {\n            if (node.finalizer) {\n              const F = Evaluate(node.finalizer);\n              if (F.Type !== \"normal\") {\n                R = F;\n              }\n            }\n          }\n          return R;\n        }\n        case \"VariableDeclaration\": {\n          // https://tc39.es/ecma262/#sec-declarations-and-the-variable-statement\n          let result: CompletionRecord | undefined;\n          for (const declarator of node.declarations) {\n            if (!declarator.init) {\n              // Assert: a declarator without init is always an identifier.\n              if (node.kind === \"var\") {\n                result = NormalCompletion(Empty);\n              } else {\n                const lhs = ResolveBinding((declarator.id as Identifier).name);\n                result = InitializeReferencedBinding(lhs, undefined);\n              }\n            } else if (declarator.id.type === \"Identifier\") {\n              const bindingId = declarator.id.name;\n              const lhs = ResolveBinding(bindingId);\n              // Todo: IsAnonymousFunctionDefinition(Initializer)\n              const rhs = Evaluate(declarator.init);\n              const value = GetValue(rhs);\n              result =\n                node.kind === \"var\"\n                  ? PutValue(lhs, value)\n                  : InitializeReferencedBinding(lhs, value);\n            } else {\n              const rhs = Evaluate(declarator.init);\n              const rval = GetValue(rhs);\n              result = BindingInitialization(\n                declarator.id,\n                rval,\n                node.kind === \"var\"\n                  ? undefined\n                  : getRunningContext().LexicalEnvironment\n              );\n            }\n          }\n          return result!;\n        }\n        case \"WhileStatement\":\n          // https://tc39.es/ecma262/#sec-while-statement\n          return EvaluateBreakableStatement(WhileLoopEvaluation(node));\n      }\n    }\n    // eslint-disable-next-line no-console\n    throw new SyntaxError(`Unsupported node type \\`${node.type}\\``);\n  }\n\n  // https://tc39.es/ecma262/#sec-execution-contexts\n  function getRunningContext(): ExecutionContext {\n    return executionContextStack[executionContextStack.length - 1];\n  }\n\n  // https://tc39.es/ecma262/#sec-resolvebinding\n  function ResolveBinding(\n    name: string,\n    env?: EnvironmentRecord\n  ): ReferenceRecord {\n    if (!env) {\n      env = getRunningContext().LexicalEnvironment;\n    }\n    return GetIdentifierReference(env, name, true);\n  }\n\n  // Try statements.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-catchclauseevaluation\n  function CatchClauseEvaluation(\n    node: CatchClause,\n    thrownValue: unknown\n  ): CompletionRecord {\n    if (!node.param) {\n      return Evaluate(node.body);\n    }\n    const oldEnv = getRunningContext().LexicalEnvironment;\n    const catchEnv = new DeclarativeEnvironment(oldEnv);\n    for (const argName of collectBoundNames(node.param)) {\n      catchEnv.CreateMutableBinding(argName, false);\n    }\n    getRunningContext().LexicalEnvironment = catchEnv;\n    BindingInitialization(node.param, thrownValue, catchEnv);\n    const B = Evaluate(node.body);\n    getRunningContext().LexicalEnvironment = oldEnv;\n    return B;\n  }\n\n  // Iteration statements and switch statements.\n  // https://tc39.es/ecma262/#prod-BreakableStatement\n  function EvaluateBreakableStatement(\n    stmtResult: CompletionRecord\n  ): CompletionRecord {\n    return stmtResult.Type === \"break\"\n      ? stmtResult.Value === Empty\n        ? NormalCompletion(undefined)\n        : NormalCompletion(stmtResult.Value)\n      : stmtResult;\n  }\n\n  // Switch statements.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-caseblockevaluation\n  function CaseBlockEvaluation(\n    cases: SwitchCase[],\n    input: unknown\n  ): CompletionRecord {\n    let V: unknown;\n\n    const defaultCaseIndex = cases.findIndex((switchCase) => !switchCase.test);\n    const hasDefaultCase = defaultCaseIndex >= 0;\n    const A = hasDefaultCase ? cases.slice(0, defaultCaseIndex) : cases;\n    let found = false;\n    for (const C of A) {\n      if (!found) {\n        found = CaseClauseIsSelected(C, input);\n      }\n      if (found) {\n        const R = Evaluate(C);\n        if (R.Value !== Empty) {\n          V = R.Value;\n        }\n        if (R.Type !== \"normal\") {\n          return UpdateEmpty(R, V);\n        }\n      }\n    }\n\n    if (!hasDefaultCase) {\n      return NormalCompletion(V);\n    }\n\n    let foundInB = false;\n    const B = cases.slice(defaultCaseIndex + 1);\n    if (!found) {\n      for (const C of B) {\n        if (!foundInB) {\n          foundInB = CaseClauseIsSelected(C, input);\n        }\n        if (foundInB) {\n          const R = Evaluate(C);\n          if (R.Value !== Empty) {\n            V = R.Value;\n          }\n          if (R.Type !== \"normal\") {\n            return UpdateEmpty(R, V);\n          }\n        }\n      }\n    }\n\n    if (foundInB) {\n      return NormalCompletion(V);\n    }\n    const R = Evaluate(cases[defaultCaseIndex]);\n    if (R.Value !== Empty) {\n      V = R.Value;\n    }\n    if (R.Type !== \"normal\") {\n      return UpdateEmpty(R, V);\n    }\n\n    // NOTE: The following is another complete iteration of the second CaseClauses.\n    for (const C of B) {\n      const R = Evaluate(C);\n      if (R.Value !== Empty) {\n        V = R.Value;\n      }\n      if (R.Type !== \"normal\") {\n        return UpdateEmpty(R, V);\n      }\n    }\n    return NormalCompletion(V);\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-caseclauseisselected\n  function CaseClauseIsSelected(C: SwitchCase, input: unknown): boolean {\n    const clauseSelector = GetValue(Evaluate(C.test!));\n    return input === clauseSelector;\n  }\n\n  // While statements.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-whileloopevaluation\n  function WhileLoopEvaluation(node: WhileStatement): CompletionRecord {\n    let V: unknown;\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      const exprValue = GetValue(Evaluate(node.test));\n      if (!exprValue) {\n        return NormalCompletion(V);\n      }\n      const stmtResult = Evaluate(node.body);\n      if (!LoopContinues(stmtResult)) {\n        return UpdateEmpty(stmtResult, V);\n      }\n      if (stmtResult.Value !== Empty) {\n        V = stmtResult.Value;\n      }\n    }\n  }\n\n  // Do-while Statements.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-dowhileloopevaluation\n  function DoWhileLoopEvaluation(node: DoWhileStatement): CompletionRecord {\n    let V: unknown;\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      const stmtResult = Evaluate(node.body);\n      if (!LoopContinues(stmtResult)) {\n        return UpdateEmpty(stmtResult, V);\n      }\n      if (stmtResult.Value !== Empty) {\n        V = stmtResult.Value;\n      }\n      const exprValue = GetValue(Evaluate(node.test));\n      if (!exprValue) {\n        return NormalCompletion(V);\n      }\n    }\n  }\n\n  // For in/of statements.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-forinofloopevaluation\n  function ForInOfLoopEvaluation(\n    node: ForInStatement | ForOfStatement\n  ): CompletionRecord {\n    const lhs = node.left;\n    const isVariableDeclaration = lhs.type === \"VariableDeclaration\";\n    const lhsKind = isVariableDeclaration\n      ? lhs.kind === \"var\"\n        ? \"varBinding\"\n        : \"lexicalBinding\"\n      : \"assignment\";\n    const uninitializedBoundNames =\n      lhsKind === \"lexicalBinding\" ? collectBoundNames(lhs) : [];\n    const iterationKind =\n      node.type === \"ForInStatement\" ? \"enumerate\" : \"iterate\";\n    const keyResult = ForInOfHeadEvaluation(\n      uninitializedBoundNames,\n      node.right,\n      iterationKind\n    );\n    if (keyResult.Type !== \"normal\") {\n      // When enumerate, if the target is nil, a break completion will be returned.\n      return keyResult;\n    }\n    return ForInOfBodyEvaluation(\n      lhs,\n      node.body,\n      keyResult.Value as Iterator<unknown>,\n      iterationKind,\n      lhsKind\n    );\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-forinofheadevaluation\n  function ForInOfHeadEvaluation(\n    uninitializedBoundNames: string[],\n    expr: Expression,\n    iterationKind: \"enumerate\" | \"iterate\"\n  ): CompletionRecord {\n    const runningContext = getRunningContext();\n    const oldEnv = runningContext.LexicalEnvironment;\n    if (uninitializedBoundNames.length > 0) {\n      const newEnv = new DeclarativeEnvironment(oldEnv);\n      for (const name of uninitializedBoundNames) {\n        newEnv.CreateMutableBinding(name, false);\n      }\n      runningContext.LexicalEnvironment = newEnv;\n    }\n    const exprRef = Evaluate(expr);\n    runningContext.LexicalEnvironment = oldEnv;\n    const exprValue = GetValue(exprRef);\n    if (iterationKind === \"enumerate\") {\n      if (exprValue === null || exprValue === undefined) {\n        return new CompletionRecord(\"break\", Empty);\n      }\n      const iterator = EnumerateObjectProperties(exprValue);\n      return NormalCompletion(iterator);\n    }\n    const iterator = CreateListIteratorRecord(exprValue as Iterable<unknown>);\n    return NormalCompletion(iterator);\n  }\n\n  function ForInOfBodyEvaluation(\n    node: VariableDeclaration | EstreeLVal,\n    stmt: Statement,\n    iteratorRecord: Iterator<unknown>,\n    iterationKind: \"enumerate\" | \"iterate\",\n    lhsKind: \"varBinding\" | \"lexicalBinding\" | \"assignment\"\n  ): CompletionRecord {\n    const lhs =\n      lhsKind === \"assignment\"\n        ? (node as EstreeLVal)\n        : (node as VariableDeclaration).declarations[0].id;\n    const oldEnv = getRunningContext().LexicalEnvironment;\n    let V: unknown;\n    // When `destructuring` is false,\n    // For `node` whose `kind` is assignment:\n    //   `lhs` is an `Identifier` or a `MemberExpression`,\n    // Otherwise:\n    //   `lhs` is an `Identifier`.\n    const destructuring =\n      lhs.type === \"ObjectPattern\" || lhs.type === \"ArrayPattern\";\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      const { done, value: nextValue } = iteratorRecord.next();\n      if (done) {\n        return NormalCompletion(V);\n      }\n      let lhsRef: ReferenceRecord | undefined;\n      let iterationEnv: DeclarativeEnvironment | undefined;\n      if (lhsKind === \"lexicalBinding\") {\n        iterationEnv = new DeclarativeEnvironment(oldEnv);\n        ForDeclarationBindingInstantiation(\n          node as VariableDeclaration,\n          iterationEnv\n        );\n        getRunningContext().LexicalEnvironment = iterationEnv;\n        if (!destructuring) {\n          const [lhsName] = collectBoundNames(lhs);\n          lhsRef = ResolveBinding(lhsName);\n        }\n      } else if (!destructuring) {\n        lhsRef = Evaluate(lhs).Value as ReferenceRecord;\n      }\n      destructuring\n        ? lhsKind === \"assignment\"\n          ? DestructuringAssignmentEvaluation(lhs, nextValue)\n          : lhsKind === \"varBinding\"\n          ? BindingInitialization(lhs, nextValue, undefined)\n          : BindingInitialization(lhs, nextValue, iterationEnv)\n        : lhsKind === \"lexicalBinding\"\n        ? InitializeReferencedBinding(lhsRef!, nextValue)\n        : PutValue(lhsRef!, nextValue);\n\n      const result = Evaluate(stmt);\n      getRunningContext().LexicalEnvironment = oldEnv;\n      if (!LoopContinues(result)) {\n        const status = UpdateEmpty(result, V);\n        if (\n          !(\n            iterationKind === \"enumerate\" || iteratorRecord.return === undefined\n          )\n        ) {\n          // Perform *IteratorClose*\n          // https://tc39.es/ecma262/#sec-iteratorclose\n          const innerResult = iteratorRecord.return();\n          if (\n            !innerResult ||\n            ![\"object\", \"function\"].includes(typeof innerResult)\n          ) {\n            throw new TypeError(`Iterator result is not an object`);\n          }\n        }\n        return status;\n      }\n      if (result.Value !== Empty) {\n        V = result.Value;\n      }\n    }\n  }\n\n  // https://tc39.es/ecma262/#sec-enumerate-object-properties\n  function* EnumerateObjectProperties(value: any): Iterator<PropertyKey> {\n    for (const key in value) {\n      yield key;\n    }\n  }\n\n  // For statements.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-forloopevaluation\n  function ForLoopEvaluation(node: ForStatement): CompletionRecord {\n    if (node.init?.type === \"VariableDeclaration\") {\n      // `for (var … ; … ; … ) …`\n      if (node.init.kind === \"var\") {\n        Evaluate(node.init);\n        return ForBodyEvaluation(node.test, node.update, node.body, []);\n      }\n      // `for (let/const … ; … ; … ) …`\n      const oldEnv = getRunningContext().LexicalEnvironment;\n      const loopEnv = new DeclarativeEnvironment(oldEnv);\n      const isConst = node.init.kind === \"const\";\n      const boundNames = collectBoundNames(node.init);\n      for (const dn of boundNames) {\n        if (isConst) {\n          loopEnv.CreateImmutableBinding(dn, true);\n        } else {\n          loopEnv.CreateMutableBinding(dn, false);\n        }\n      }\n      getRunningContext().LexicalEnvironment = loopEnv;\n      Evaluate(node.init);\n      const perIterationLets = isConst ? [] : Array.from(boundNames);\n      const bodyResult = ForBodyEvaluation(\n        node.test,\n        node.update,\n        node.body,\n        perIterationLets\n      );\n      getRunningContext().LexicalEnvironment = oldEnv;\n      return bodyResult;\n    }\n    // `for ( … ; … ; … ) …`\n    if (node.init) {\n      const exprRef = Evaluate(node.init);\n      GetValue(exprRef);\n    }\n    return ForBodyEvaluation(node.test, node.update, node.body, []);\n  }\n\n  // https://tc39.es/ecma262/#sec-forbodyevaluation\n  function ForBodyEvaluation(\n    test: Expression | null | undefined,\n    increment: Expression | null | undefined,\n    stmt: Statement,\n    perIterationBindings: string[]\n  ): CompletionRecord {\n    CreatePerIterationEnvironment(perIterationBindings);\n    let V: unknown;\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      if (test) {\n        const testRef = Evaluate(test);\n        const testValue = GetValue(testRef);\n        if (!testValue) {\n          return NormalCompletion(V);\n        }\n      }\n      const result = Evaluate(stmt) as CompletionRecord;\n      if (!LoopContinues(result)) {\n        return UpdateEmpty(result, V);\n      }\n      if (result.Value) {\n        V = result.Value;\n      }\n      CreatePerIterationEnvironment(perIterationBindings);\n      if (increment) {\n        const incRef = Evaluate(increment);\n        GetValue(incRef);\n      }\n    }\n  }\n\n  // https://tc39.es/ecma262/#sec-createperiterationenvironment\n  function CreatePerIterationEnvironment(\n    perIterationBindings: string[]\n  ): unknown {\n    if (perIterationBindings.length === 0) {\n      return;\n    }\n    const lastIterationEnv = getRunningContext().LexicalEnvironment!;\n    const outer = lastIterationEnv.OuterEnv;\n    const thisIterationEnv = new DeclarativeEnvironment(outer);\n    for (const bn of perIterationBindings) {\n      thisIterationEnv.CreateMutableBinding(bn, false);\n      const lastValue = lastIterationEnv.GetBindingValue(bn, false);\n      thisIterationEnv.InitializeBinding(bn, lastValue);\n    }\n    getRunningContext().LexicalEnvironment = thisIterationEnv;\n  }\n\n  // Destructuring assignments.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-destructuringassignmentevaluation\n  function DestructuringAssignmentEvaluation(\n    pattern: ObjectPattern | EstreeObjectPattern | ArrayPattern,\n    value: unknown\n  ): CompletionRecord {\n    if (pattern.type === \"ObjectPattern\") {\n      RequireObjectCoercible(value);\n      if (pattern.properties.length > 0) {\n        PropertyDestructuringAssignmentEvaluation(\n          (pattern as EstreeObjectPattern).properties,\n          value\n        );\n      }\n      return NormalCompletion(Empty);\n    }\n    const iteratorRecord = CreateListIteratorRecord(value as Iterable<unknown>);\n    return IteratorDestructuringAssignmentEvaluation(\n      pattern.elements,\n      iteratorRecord\n    );\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-propertydestructuringassignmentevaluation\n  function PropertyDestructuringAssignmentEvaluation(\n    properties: (EstreeProperty | RestElement)[],\n    value: unknown\n  ): void {\n    const excludedNames = new Set<PropertyKey>();\n    for (const prop of properties) {\n      if (prop.type === \"Property\") {\n        const propName =\n          !prop.computed && prop.key.type === \"Identifier\"\n            ? prop.key.name\n            : (EvaluateComputedPropertyName(prop.key as Expression) as string);\n        const valueTarget =\n          prop.value.type === \"AssignmentPattern\"\n            ? prop.value.left\n            : prop.value;\n        if (valueTarget.type === \"Identifier\") {\n          const lref = ResolveBinding(valueTarget.name);\n          let v = GetV(value, propName);\n          if (prop.value.type === \"AssignmentPattern\" && v === undefined) {\n            // Todo(steve): check IsAnonymousFunctionDefinition(Initializer)\n            const defaultValue = Evaluate(prop.value.right);\n            v = GetValue(defaultValue);\n          }\n          PutValue(lref, v);\n          excludedNames.add(propName);\n        } else {\n          KeyedDestructuringAssignmentEvaluation(prop.value, value, propName);\n          excludedNames.add(propName);\n        }\n      } else {\n        RestDestructuringAssignmentEvaluation(prop, value, excludedNames);\n      }\n    }\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-keyeddestructuringassignmentevaluation\n  function KeyedDestructuringAssignmentEvaluation(\n    node: EstreeNode,\n    value: unknown,\n    propertyName: PropertyKey\n  ): CompletionRecord {\n    const assignmentTarget =\n      node.type === \"AssignmentPattern\" ? node.left : node;\n    const isObjectOrArray =\n      assignmentTarget.type === \"ArrayPattern\" ||\n      assignmentTarget.type === \"ObjectPattern\";\n    let lref: ReferenceRecord | undefined;\n    if (!isObjectOrArray) {\n      lref = Evaluate(assignmentTarget).Value as ReferenceRecord;\n    }\n    const v = GetV(value, propertyName);\n    let rhsValue;\n    if (node.type === \"AssignmentPattern\" && v === undefined) {\n      // Todo(steve): check IsAnonymousFunctionDefinition(Initializer)\n      const defaultValue = Evaluate(node.right);\n      rhsValue = GetValue(defaultValue);\n    } else {\n      rhsValue = v;\n    }\n    if (isObjectOrArray) {\n      return DestructuringAssignmentEvaluation(assignmentTarget, rhsValue);\n    }\n    return PutValue(lref!, rhsValue);\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-restdestructuringassignmentevaluation\n  function RestDestructuringAssignmentEvaluation(\n    restProperty: RestElement,\n    value: unknown,\n    excludedNames: Set<PropertyKey>\n  ): CompletionRecord {\n    const lref = Evaluate(restProperty.argument).Value as ReferenceRecord;\n    const restObj = CopyDataProperties({}, value, excludedNames);\n    return PutValue(lref, restObj);\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-iteratordestructuringassignmentevaluation\n  function IteratorDestructuringAssignmentEvaluation(\n    elements: (PatternLike | LVal | null)[],\n    iteratorRecord: Iterator<unknown>\n  ): CompletionRecord {\n    let status = NormalCompletion(Empty);\n    for (const element of elements) {\n      if (!element) {\n        iteratorRecord.next();\n        status = NormalCompletion(Empty);\n        continue;\n      }\n      const assignmentTarget =\n        element.type === \"RestElement\"\n          ? element.argument\n          : element.type === \"AssignmentPattern\"\n          ? element.left\n          : element;\n      const isObjectOrArray =\n        assignmentTarget.type === \"ArrayPattern\" ||\n        assignmentTarget.type === \"ObjectPattern\";\n      let lref: ReferenceRecord | undefined;\n      if (!isObjectOrArray) {\n        lref = Evaluate(assignmentTarget).Value as ReferenceRecord;\n      }\n      let v: unknown;\n      if (element.type !== \"RestElement\") {\n        const { done, value: nextValue } = iteratorRecord.next();\n        const value = done ? undefined : nextValue;\n        if (element.type === \"AssignmentPattern\" && value === undefined) {\n          // Todo(steve): check IsAnonymousFunctionDefinition(Initializer)\n          const defaultValue = Evaluate(element.right);\n          v = GetValue(defaultValue);\n        } else {\n          v = value;\n        }\n      } else {\n        // RestElement\n        v = [];\n        let n = 0;\n        // eslint-disable-next-line no-constant-condition\n        while (true) {\n          const { done, value: nextValue } = iteratorRecord.next();\n          if (done) {\n            break;\n          }\n          (v as unknown[])[n] = nextValue;\n          n++;\n        }\n      }\n      if (isObjectOrArray) {\n        status = DestructuringAssignmentEvaluation(assignmentTarget, v);\n      } else {\n        status = PutValue(lref!, v);\n      }\n    }\n    return status;\n  }\n\n  // Object expressions.\n  // https://tc39.es/ecma262/#sec-evaluate-property-access-with-expression-key\n  function EvaluatePropertyAccessWithExpressionKey(\n    baseValue: Record<PropertyKey, unknown>,\n    expression: Expression,\n    strict: boolean\n  ): ReferenceRecord {\n    const propertyNameReference = Evaluate(expression);\n    const propertyNameValue = GetValue(propertyNameReference);\n    const propertyKey = ToPropertyKey(propertyNameValue);\n    return new ReferenceRecord(baseValue, propertyKey, strict);\n  }\n\n  // https://tc39.es/ecma262/#sec-evaluate-property-access-with-identifier-key\n  function EvaluatePropertyAccessWithIdentifierKey(\n    baseValue: Record<PropertyKey, unknown>,\n    identifier: Identifier,\n    strict: boolean\n  ): ReferenceRecord {\n    const propertyNameString = identifier.name;\n    return new ReferenceRecord(baseValue, propertyNameString, strict);\n  }\n\n  // Block statements.\n  // https://tc39.es/ecma262/#sec-blockdeclarationinstantiation\n  function BlockDeclarationInstantiation(\n    code: Statement[] | SwitchCase[],\n    env: EnvironmentRecord\n  ): void {\n    const declarations = collectScopedDeclarations(code, {\n      var: false,\n      topLevel: false,\n    });\n    for (const d of declarations) {\n      const IsConstantDeclaration =\n        d.type === \"VariableDeclaration\" && d.kind === \"const\";\n      for (const dn of collectBoundNames(d)) {\n        if (IsConstantDeclaration) {\n          env.CreateImmutableBinding(dn, true);\n        } else {\n          env.CreateMutableBinding(dn, false);\n        }\n      }\n      if (d.type === \"FunctionDeclaration\") {\n        const [fn] = collectBoundNames(d);\n        const fo = InstantiateFunctionObject(d, env);\n        env.InitializeBinding(fn, fo);\n      }\n    }\n  }\n\n  // Function declarations and expressions.\n  // https://tc39.es/ecma262/#sec-evaluatecall\n  function EvaluateCall(\n    func: Function,\n    ref: ReferenceRecord,\n    args: CallExpression[\"arguments\"] | TemplateLiteral,\n    callee: CallExpression[\"callee\"]\n  ): CompletionRecord {\n    let thisValue;\n    if (ref instanceof ReferenceRecord) {\n      if (IsPropertyReference(ref)) {\n        thisValue = ref.Base;\n      }\n    }\n    const argList = ArgumentListEvaluation(args);\n    if (typeof func !== \"function\") {\n      const funcName = codeSource.substring(callee.start!, callee.end!);\n      throw new TypeError(`${funcName} is not a function`);\n    }\n    const result = func.apply(thisValue, argList);\n    sanitize(result);\n    return NormalCompletion(result);\n  }\n\n  // https://tc39.es/ecma262/#sec-evaluatenew\n  function EvaluateNew(\n    constructExpr: CallExpression[\"callee\"],\n    args: NewExpression[\"arguments\"]\n  ): CompletionRecord {\n    const ref = Evaluate(constructExpr);\n    const constructor = GetValue(ref) as new (...args: unknown[]) => unknown;\n    const argList = ArgumentListEvaluation(args);\n    if (\n      typeof constructor !== \"function\" ||\n      (constructor as unknown as FunctionObject)[IsConstructor] === false\n    ) {\n      const constructorName = codeSource.substring(\n        constructExpr.start!,\n        constructExpr.end!\n      );\n      throw new TypeError(`${constructorName} is not a constructor`);\n    }\n    if (!isAllowedConstructor(constructor)) {\n      const constructorName = codeSource.substring(\n        constructExpr.start!,\n        constructExpr.end!\n      );\n      throw new TypeError(`${constructorName} is not an allowed constructor`);\n    }\n    return NormalCompletion(new constructor(...argList));\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-argumentlistevaluation\n  function ArgumentListEvaluation(\n    args: CallExpression[\"arguments\"] | TemplateLiteral\n  ): unknown[] {\n    const array: unknown[] = [];\n    if (Array.isArray(args)) {\n      for (const arg of args) {\n        if (arg.type === \"SpreadElement\") {\n          const spreadValues = GetValue(Evaluate(arg.argument)) as unknown[];\n          array.push(...spreadValues);\n        } else {\n          array.push(GetValue(Evaluate(arg)));\n        }\n      }\n    } else {\n      array.push(GetTemplateObject(args));\n      for (const expr of args.expressions) {\n        array.push(GetValue(Evaluate(expr)));\n      }\n    }\n    return array;\n  }\n\n  // https://tc39.es/ecma262/#sec-ecmascript-function-objects-call-thisargument-argumentslist\n  function CallFunction(\n    closure: FunctionObject,\n    args: Iterable<unknown>\n  ): unknown {\n    hooks.beforeCall?.(closure[SourceNode]);\n    PrepareForOrdinaryCall(closure);\n    const result = OrdinaryCallEvaluateBody(closure, args);\n    executionContextStack.pop();\n    if (result.Type === \"return\") {\n      return result.Value;\n    }\n    return undefined;\n  }\n\n  // https://tc39.es/ecma262/#sec-prepareforordinarycall\n  function PrepareForOrdinaryCall(F: FunctionObject): ExecutionContext {\n    const calleeContext = new ExecutionContext();\n    calleeContext.Function = F;\n    const localEnv = new FunctionEnvironment(F[Environment]);\n    calleeContext.VariableEnvironment = localEnv;\n    calleeContext.LexicalEnvironment = localEnv;\n    executionContextStack.push(calleeContext);\n    return calleeContext;\n  }\n\n  // https://tc39.es/ecma262/#sec-ordinarycallevaluatebody\n  function OrdinaryCallEvaluateBody(\n    F: FunctionObject,\n    args: Iterable<unknown>\n  ): CompletionRecord {\n    return EvaluateFunctionBody(F[ECMAScriptCode], F, args);\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-evaluatefunctionbody\n  function EvaluateFunctionBody(\n    body: Statement[] | Expression,\n    F: FunctionObject,\n    args: Iterable<unknown>\n  ): CompletionRecord {\n    FunctionDeclarationInstantiation(F, args);\n    if (Array.isArray(body)) {\n      return EvaluateStatementList(body);\n    }\n    return new CompletionRecord(\"return\", GetValue(Evaluate(body)));\n  }\n\n  // https://tc39.es/ecma262/#sec-block-runtime-semantics-evaluation\n  function EvaluateStatementList(statements: Statement[]): CompletionRecord {\n    let result = NormalCompletion(Empty);\n    for (const stmt of statements) {\n      const s = Evaluate(stmt);\n      if (s.Type !== \"normal\") {\n        return s;\n      }\n      result = UpdateEmpty(result, s.Value);\n    }\n    return result;\n  }\n\n  // https://tc39.es/ecma262/#sec-functiondeclarationinstantiation\n  function FunctionDeclarationInstantiation(\n    func: FunctionObject,\n    args: Iterable<unknown>\n  ): void {\n    const calleeContext = getRunningContext();\n    const code = func[ECMAScriptCode];\n    const formals = func[FormalParameters] as FunctionDeclaration[\"params\"];\n    const parameterNames = collectBoundNames(formals);\n    const hasParameterExpressions = containsExpression(formals);\n    const varDeclarations = collectScopedDeclarations(code, {\n      var: true,\n      topLevel: true,\n    });\n    const varNames = collectBoundNames(varDeclarations);\n\n    // `functionNames` ∈ `varNames`\n    // `functionsToInitialize` ≈ `functionNames`\n    const functionNames: string[] = [];\n    const functionsToInitialize: FunctionDeclaration[] = [];\n    for (let i = varDeclarations.length - 1; i >= 0; i--) {\n      const d = varDeclarations[i];\n      if (d.type === \"FunctionDeclaration\") {\n        ThrowIfFunctionIsInvalid(d);\n        const [fn] = collectBoundNames(d);\n        if (!functionNames.includes(fn)) {\n          functionNames.unshift(fn);\n          functionsToInitialize.unshift(d);\n        }\n      } else if (rules?.noVar) {\n        throw new SyntaxError(\n          \"Var declaration is not recommended, use `let` or `const` instead\"\n        );\n      }\n    }\n\n    const env = calleeContext.LexicalEnvironment!;\n    for (const paramName of parameterNames) {\n      // In strict mode, it's guaranteed no duplicate params exist.\n      env.CreateMutableBinding(paramName, false);\n    }\n\n    const iteratorRecord = CreateListIteratorRecord(args);\n    IteratorBindingInitialization(formals, iteratorRecord, env);\n\n    let varEnv: EnvironmentRecord;\n    if (!hasParameterExpressions) {\n      // NOTE: Only a single Environment Record is needed for the parameters\n      // and top-level vars.\n      // `varNames` are unique.\n      for (const n of varNames) {\n        if (!parameterNames.includes(n)) {\n          env.CreateMutableBinding(n, false);\n          env.InitializeBinding(n, undefined);\n        }\n      }\n      varEnv = env;\n    } else {\n      // NOTE: A separate Environment Record is needed to ensure that closures\n      // created by expressions in the formal parameter list do not have\n      // visibility of declarations in the function body.\n      varEnv = new DeclarativeEnvironment(env);\n      calleeContext.VariableEnvironment = varEnv;\n      // `varNames` are unique.\n      for (const n of varNames) {\n        varEnv.CreateMutableBinding(n, false);\n        let initialValue: unknown;\n        if (parameterNames.includes(n) && !functionNames.includes(n)) {\n          initialValue = env.GetBindingValue(n, false);\n        }\n        varEnv.InitializeBinding(n, initialValue);\n        // NOTE: A var with the same name as a formal parameter initially has\n        // the same value as the corresponding initialized parameter.\n      }\n    }\n    const lexEnv = varEnv;\n    calleeContext.LexicalEnvironment = lexEnv;\n\n    const lexDeclarations = collectScopedDeclarations(code, {\n      var: false,\n      topLevel: true,\n    });\n    for (const d of lexDeclarations) {\n      for (const dn of collectBoundNames(d)) {\n        // Only lexical VariableDeclaration here in top-level.\n        if ((d as VariableDeclaration).kind === \"const\") {\n          lexEnv.CreateImmutableBinding(dn, true);\n        } else {\n          lexEnv.CreateMutableBinding(dn, false);\n        }\n      }\n    }\n\n    for (const f of functionsToInitialize) {\n      const [fn] = collectBoundNames(f);\n      const fo = InstantiateFunctionObject(f, lexEnv);\n      varEnv.SetMutableBinding(fn, fo, false);\n    }\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-instantiatefunctionobject\n  function InstantiateFunctionObject(\n    func: FunctionDeclaration,\n    scope: EnvironmentRecord\n  ): FunctionObject {\n    return OrdinaryFunctionCreate(func, scope, true);\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-instantiateordinaryfunctionexpression\n  function InstantiateOrdinaryFunctionExpression(\n    functionExpression: FunctionExpression\n  ): FunctionObject {\n    const scope = getRunningContext().LexicalEnvironment!;\n    if (functionExpression.id) {\n      const name = functionExpression.id.name;\n      const funcEnv = new DeclarativeEnvironment(scope);\n      funcEnv.CreateImmutableBinding(name, false);\n      const closure = OrdinaryFunctionCreate(functionExpression, funcEnv, true);\n      funcEnv.InitializeBinding(name, closure);\n      return closure;\n    } else {\n      const closure = OrdinaryFunctionCreate(functionExpression, scope, true);\n      return closure;\n    }\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-instantiatearrowfunctionexpression\n  function InstantiateArrowFunctionExpression(\n    arrowFunction: ArrowFunctionExpression\n  ): FunctionObject {\n    const scope = getRunningContext().LexicalEnvironment!;\n    const closure = OrdinaryFunctionCreate(arrowFunction, scope, false);\n    return closure;\n  }\n\n  // https://tc39.es/ecma262/#sec-ordinaryfunctioncreate\n  function OrdinaryFunctionCreate(\n    sourceNode:\n      | FunctionDeclaration\n      | FunctionExpression\n      | ArrowFunctionExpression,\n    scope: EnvironmentRecord,\n    isConstructor: boolean\n  ): FunctionObject {\n    const F = function () {\n      // eslint-disable-next-line prefer-rest-params\n      return CallFunction(F, arguments);\n    } as FunctionObject;\n    Object.defineProperties(F, {\n      [SourceNode]: {\n        value: sourceNode,\n      },\n      [FormalParameters]: {\n        value: sourceNode.params,\n      },\n      [ECMAScriptCode]: {\n        value:\n          sourceNode.body.type === \"BlockStatement\"\n            ? sourceNode.body.body\n            : sourceNode.body,\n      },\n      [Environment]: {\n        value: scope,\n      },\n      [IsConstructor]: {\n        value: isConstructor,\n      },\n    });\n    return F;\n  }\n\n  // Patterns initialization.\n  // https://tc39.es/ecma262/#sec-runtime-semantics-bindinginitialization\n  function BindingInitialization(\n    node: EstreeLVal,\n    value: unknown,\n    environment?: EnvironmentRecord\n  ): CompletionRecord | undefined {\n    switch (node.type) {\n      case \"Identifier\":\n        return InitializeBoundName(node.name, value, environment);\n      case \"ObjectPattern\":\n        RequireObjectCoercible(value);\n        return PropertyBindingInitialization(\n          (node as EstreeObjectPattern).properties,\n          value,\n          environment\n        );\n      case \"ArrayPattern\": {\n        const iteratorRecord = CreateListIteratorRecord(\n          value as Iterable<unknown>\n        );\n        return IteratorBindingInitialization(\n          node.elements,\n          iteratorRecord,\n          environment\n        );\n      }\n    }\n  }\n\n  // https://tc39.es/ecma262/#sec-destructuring-binding-patterns-runtime-semantics-propertybindinginitialization\n  function PropertyBindingInitialization(\n    properties: (EstreeProperty | RestElement)[],\n    value: unknown,\n    environment?: EnvironmentRecord\n  ): CompletionRecord {\n    const excludedNames = new Set<PropertyKey>();\n    for (const prop of properties) {\n      if (prop.type === \"RestElement\") {\n        return RestBindingInitialization(\n          prop,\n          value,\n          environment,\n          excludedNames\n        );\n      }\n      if (!prop.computed && prop.key.type === \"Identifier\") {\n        KeyedBindingInitialization(\n          prop.value as EstreeLVal,\n          value,\n          environment,\n          prop.key.name\n        );\n        excludedNames.add(prop.key.name);\n      } else {\n        const P = EvaluateComputedPropertyName(prop.key as Expression);\n        KeyedBindingInitialization(\n          prop.value as EstreeLVal,\n          value,\n          environment,\n          P\n        );\n        excludedNames.add(P);\n      }\n    }\n    return NormalCompletion(Empty);\n  }\n\n  // https://tc39.es/ecma262/#prod-ComputedPropertyName\n  function EvaluateComputedPropertyName(node: Expression): PropertyKey {\n    const propName = GetValue(Evaluate(node));\n    return ToPropertyKey(propName);\n  }\n\n  // https://tc39.es/ecma262/#sec-destructuring-binding-patterns-runtime-semantics-restbindinginitialization\n  function RestBindingInitialization(\n    restProperty: RestElement,\n    value: unknown,\n    environment: EnvironmentRecord | undefined,\n    excludedNames: Set<PropertyKey>\n  ): CompletionRecord {\n    const lhs = ResolveBinding(\n      (restProperty.argument as Identifier).name,\n      environment\n    );\n    const restObj = CopyDataProperties({}, value, excludedNames);\n    if (!environment) {\n      return PutValue(lhs, restObj);\n    }\n    return InitializeReferencedBinding(lhs, restObj);\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-iteratorbindinginitialization\n  function IteratorBindingInitialization(\n    elements: (PatternLike | LVal | null)[],\n    iteratorRecord: Iterator<unknown>,\n    environment?: EnvironmentRecord\n  ): CompletionRecord | undefined {\n    if (elements.length === 0) {\n      return NormalCompletion(Empty);\n    }\n    let result;\n    for (const node of elements) {\n      if (!node) {\n        // Elision element.\n        iteratorRecord.next();\n        result = NormalCompletion(Empty);\n      } else if (node.type === \"RestElement\") {\n        // Rest element.\n        if (node.argument.type === \"Identifier\") {\n          const lhs = ResolveBinding(node.argument.name, environment);\n          const A: unknown[] = [];\n          let n = 0;\n          // eslint-disable-next-line no-constant-condition\n          while (true) {\n            const { done, value } = iteratorRecord.next();\n            if (done) {\n              result = environment\n                ? InitializeReferencedBinding(lhs, A)\n                : PutValue(lhs, A);\n              break;\n            }\n            A[n] = value;\n            n++;\n          }\n        } else {\n          const A: unknown[] = [];\n          let n = 0;\n          // eslint-disable-next-line no-constant-condition\n          while (true) {\n            const { done, value } = iteratorRecord.next();\n            if (done) {\n              result = BindingInitialization(node.argument, A, environment);\n              break;\n            }\n            A[n] = value;\n            n++;\n          }\n        }\n      } else {\n        // Normal element.\n        const bindingElement =\n          node.type === \"AssignmentPattern\" ? node.left : node;\n        switch (bindingElement.type) {\n          case \"ObjectPattern\":\n          case \"ArrayPattern\": {\n            let v: unknown;\n            const { done, value } = iteratorRecord.next();\n            if (!done) {\n              v = value;\n            }\n            if (node.type === \"AssignmentPattern\" && v === undefined) {\n              const defaultValue = Evaluate(node.right);\n              v = GetValue(defaultValue);\n            }\n            result = BindingInitialization(bindingElement, v, environment);\n            break;\n          }\n          case \"Identifier\": {\n            const bindingId = bindingElement.name;\n            const lhs = ResolveBinding(bindingId, environment);\n            let v: unknown;\n            const { done, value } = iteratorRecord.next();\n            if (!done) {\n              v = value;\n            }\n            if (node.type === \"AssignmentPattern\" && v === undefined) {\n              // IsAnonymousFunctionDefinition(Initializer)\n              const defaultValue = Evaluate(node.right);\n              v = GetValue(defaultValue);\n            }\n            result = environment\n              ? InitializeReferencedBinding(lhs, v)\n              : PutValue(lhs, v);\n            break;\n          }\n        }\n      }\n    }\n    return result;\n  }\n\n  // https://tc39.es/ecma262/#sec-runtime-semantics-keyedbindinginitialization\n  function KeyedBindingInitialization(\n    node: EstreeLVal,\n    value: unknown,\n    environment: EnvironmentRecord | undefined,\n    propertyName: PropertyKey\n  ): CompletionRecord | undefined {\n    const isIdentifier =\n      node.type === \"Identifier\" ||\n      (node.type === \"AssignmentPattern\" && node.left.type === \"Identifier\");\n    if (isIdentifier) {\n      const bindingId =\n        node.type === \"Identifier\" ? node.name : (node.left as Identifier).name;\n      const lhs = ResolveBinding(bindingId, environment);\n      let v = GetV(value, propertyName);\n      if (node.type === \"AssignmentPattern\" && v === undefined) {\n        // If IsAnonymousFunctionDefinition(Initializer)\n        const defaultValue = Evaluate(node.right);\n        v = GetValue(defaultValue);\n      }\n      if (!environment) {\n        return PutValue(lhs, v);\n      }\n      return InitializeReferencedBinding(lhs, v);\n    }\n\n    let v = GetV(value, propertyName);\n    if (node.type === \"AssignmentPattern\" && v === undefined) {\n      const defaultValue = Evaluate(node.right);\n      v = GetValue(defaultValue);\n    }\n    return BindingInitialization(\n      node.type === \"AssignmentPattern\" ? node.left : node,\n      v,\n      environment\n    );\n  }\n\n  // https://tc39.es/ecma262/#sec-initializeboundname\n  function InitializeBoundName(\n    name: string,\n    value: unknown,\n    environment?: EnvironmentRecord\n  ): CompletionRecord {\n    // Assert: environment is always present.\n    environment!.InitializeBinding(name, value);\n    return NormalCompletion(Empty);\n  }\n\n  function ThrowIfFunctionIsInvalid(\n    func: FunctionDeclaration | FunctionExpression | ArrowFunctionExpression\n  ): void {\n    if (func.async || func.generator) {\n      throw new SyntaxError(\n        `${func.async ? \"Async\" : \"Generator\"} function is not allowed`\n      );\n    }\n    if (expressionOnly && !(func as ArrowFunctionExpression).expression) {\n      throw new SyntaxError(\n        \"Only an `Expression` is allowed in `ArrowFunctionExpression`'s body\"\n      );\n    }\n  }\n\n  if (expressionOnly) {\n    return GetValue(Evaluate(rootAst));\n  }\n\n  hooks.beforeEvaluate?.(rootAst);\n  ThrowIfFunctionIsInvalid(rootAst);\n  const [fn] = collectBoundNames(rootAst);\n  // Create an immutable binding for the root function.\n  rootEnv.CreateImmutableBinding(fn, true);\n  const fo = InstantiateFunctionObject(rootAst, rootEnv);\n  rootEnv.InitializeBinding(fn, fo);\n  return fo;\n}\n","import {\n  ArrowFunctionExpression,\n  Expression,\n  FunctionDeclaration,\n  FunctionExpression,\n  Statement,\n} from \"@babel/types\";\n\n// https://tc39.es/ecma262/#sec-execution-contexts\nexport class AnalysisContext {\n  VariableEnvironment?: AnalysisEnvironment;\n  LexicalEnvironment?: AnalysisEnvironment;\n}\n\n// https://tc39.es/ecma262/#sec-environment-records\nexport class AnalysisEnvironment {\n  readonly OuterEnv: AnalysisEnvironment | null | undefined;\n  private readonly bindingSet = new Set<string>();\n\n  constructor(outer: AnalysisEnvironment | null | undefined) {\n    this.OuterEnv = outer;\n  }\n\n  HasBinding(name: string): boolean {\n    return this.bindingSet.has(name);\n  }\n\n  CreateBinding(name: string): void {\n    this.bindingSet.add(name);\n  }\n}\n\nexport interface AnalysisFunctionObject {\n  Function: FunctionDeclaration | FunctionExpression | ArrowFunctionExpression;\n  FormalParameters: FunctionDeclaration[\"params\"];\n  ECMAScriptCode: Statement[] | Expression;\n  Environment?: AnalysisEnvironment;\n}\n","import {\n  ArrowFunctionExpression,\n  Expression,\n  FunctionDeclaration,\n  FunctionExpression,\n  Identifier,\n  Statement,\n  SwitchCase,\n  VariableDeclaration,\n} from \"@babel/types\";\nimport { hasOwnProperty } from \"./hasOwnProperty.js\";\nimport {\n  AnalysisContext,\n  AnalysisEnvironment,\n  AnalysisFunctionObject,\n} from \"./AnalysisContext.js\";\nimport {\n  EstreeNode,\n  EstreeVisitors,\n  NodeWithBoundNames,\n} from \"./interfaces.js\";\nimport {\n  collectBoundNames,\n  collectScopedDeclarations,\n  containsExpression,\n} from \"./traverse.js\";\n\nexport interface PrecookOptions {\n  expressionOnly?: boolean;\n  /** @deprecated Use hooks instead. */\n  visitors?: EstreeVisitors;\n  hooks?: PrecookHooks;\n  withParent?: boolean;\n}\n\nexport type EstreeParent = EstreeParentItem[];\n\nexport interface EstreeParentItem {\n  node: EstreeNode;\n  key: string;\n  index?: number;\n}\n\nexport interface PrecookHooks {\n  beforeVisit?(node: EstreeNode, parent?: EstreeParent): void;\n  beforeVisitGlobal?(node: Identifier, parent?: EstreeParent): void;\n  /** Return true if want to silent warnings for unknown nodes. */\n  beforeVisitUnknown?(node: EstreeNode, parent?: EstreeParent): boolean | void;\n}\n\n/**\n * Analysis an AST of a storyboard function or an evaluation expression.\n *\n * @param rootAst - The root AST.\n * @param options - Analysis options.\n * @returns A set of global variables the root AST attempts to access.\n */\nexport function precook(\n  rootAst: Expression | FunctionDeclaration,\n  { expressionOnly, visitors, withParent, hooks = {} }: PrecookOptions = {}\n): Set<string> {\n  const attemptToVisitGlobals = new Set<string>();\n  const analysisContextStack: AnalysisContext[] = [];\n  const rootEnv = new AnalysisEnvironment(null);\n  const rootContext = new AnalysisContext();\n  rootContext.VariableEnvironment = rootEnv;\n  rootContext.LexicalEnvironment = rootEnv;\n  analysisContextStack.push(rootContext);\n\n  function getRunningContext(): AnalysisContext {\n    return analysisContextStack[analysisContextStack.length - 1];\n  }\n\n  function visit(node: EstreeNode): void {\n    if (visitors && hasOwnProperty(visitors, node.type)) {\n      visitors[node.type](node);\n    }\n  }\n\n  function EvaluateChildren<T extends EstreeNode>(\n    node: T,\n    keys: (keyof T)[],\n    parent?: EstreeParent\n  ): void {\n    for (const key of keys) {\n      Evaluate(\n        node[key] as unknown as EstreeNode | EstreeNode[],\n        parent?.concat({ node, key } as EstreeParentItem)\n      );\n    }\n  }\n\n  function Evaluate(\n    node: EstreeNode | EstreeNode[],\n    parent?: EstreeParent\n  ): void {\n    if (Array.isArray(node)) {\n      node.forEach((n, index) => {\n        Evaluate(\n          n,\n          parent\n            ? parent.slice(0, -1).concat({\n                ...parent[parent.length - 1],\n                index,\n              })\n            : parent\n        );\n      });\n    } else if (node) {\n      // `node` maybe `null` in some cases.\n      hooks.beforeVisit?.(node, parent);\n      visit(node);\n      // Expressions:\n      switch (node.type) {\n        case \"Identifier\":\n          if (!ResolveBinding(node.name)) {\n            hooks.beforeVisitGlobal?.(node, parent);\n            attemptToVisitGlobals.add(node.name);\n          }\n          return;\n        case \"ArrayExpression\":\n        case \"ArrayPattern\":\n          EvaluateChildren(node, [\"elements\"], parent);\n          return;\n        case \"ArrowFunctionExpression\": {\n          const env = getRunningContext().LexicalEnvironment;\n          const closure = OrdinaryFunctionCreate(node, env);\n          CallFunction(closure, parent);\n          return;\n        }\n        case \"AssignmentPattern\":\n        case \"BinaryExpression\":\n        case \"LogicalExpression\":\n          EvaluateChildren(node, [\"left\", \"right\"], parent);\n          return;\n        case \"CallExpression\":\n        case \"NewExpression\":\n          EvaluateChildren(node, [\"callee\", \"arguments\"], parent);\n          return;\n        case \"ChainExpression\":\n          EvaluateChildren(node, [\"expression\"], parent);\n          return;\n        case \"ConditionalExpression\":\n          EvaluateChildren(node, [\"test\", \"consequent\", \"alternate\"], parent);\n          return;\n        case \"MemberExpression\":\n          EvaluateChildren(node, [\"object\"], parent);\n          if (node.computed) {\n            EvaluateChildren(node, [\"property\"], parent);\n          }\n          return;\n        case \"ObjectExpression\":\n        case \"ObjectPattern\":\n          EvaluateChildren(node, [\"properties\"], parent);\n          return;\n        case \"Property\":\n          if (node.computed) {\n            EvaluateChildren(node, [\"key\"], parent);\n          }\n          EvaluateChildren(node, [\"value\"], parent);\n          return;\n        case \"RestElement\":\n        case \"SpreadElement\":\n        case \"UnaryExpression\":\n          EvaluateChildren(node, [\"argument\"], parent);\n          return;\n        case \"SequenceExpression\":\n        case \"TemplateLiteral\":\n          EvaluateChildren(node, [\"expressions\"], parent);\n          return;\n        case \"TaggedTemplateExpression\":\n          EvaluateChildren(node, [\"tag\", \"quasi\"], parent);\n          return;\n        case \"Literal\":\n          return;\n      }\n      if (!expressionOnly) {\n        // Statements and assignments:\n        switch (node.type) {\n          case \"AssignmentExpression\":\n            EvaluateChildren(node, [\"right\", \"left\"], parent);\n            return;\n          case \"BlockStatement\": {\n            if (!node.body.length) {\n              return;\n            }\n            const runningContext = getRunningContext();\n            const oldEnv = runningContext.LexicalEnvironment;\n            const blockEnv = new AnalysisEnvironment(oldEnv);\n            BlockDeclarationInstantiation(node.body, blockEnv);\n            runningContext.LexicalEnvironment = blockEnv;\n            EvaluateChildren(node, [\"body\"], parent);\n            runningContext.LexicalEnvironment = oldEnv;\n            return;\n          }\n          case \"BreakStatement\":\n          case \"ContinueStatement\":\n          case \"EmptyStatement\":\n            return;\n          case \"CatchClause\": {\n            const runningContext = getRunningContext();\n            const oldEnv = runningContext.LexicalEnvironment;\n            const catchEnv = new AnalysisEnvironment(oldEnv);\n            BoundNamesInstantiation(node.param, catchEnv);\n            runningContext.LexicalEnvironment = catchEnv;\n            EvaluateChildren(node, [\"param\", \"body\"], parent);\n            runningContext.LexicalEnvironment = oldEnv;\n            return;\n          }\n          case \"DoWhileStatement\":\n            EvaluateChildren(node, [\"body\", \"test\"], parent);\n            return;\n          case \"ExpressionStatement\":\n          case \"TSAsExpression\":\n            EvaluateChildren(node, [\"expression\"], parent);\n            return;\n          case \"ForInStatement\":\n          case \"ForOfStatement\": {\n            // ForIn/OfHeadEvaluation\n            const lexicalBinding =\n              node.left.type === \"VariableDeclaration\" &&\n              node.left.kind !== \"var\";\n            const runningContext = getRunningContext();\n            const oldEnv = runningContext.LexicalEnvironment;\n            if (lexicalBinding) {\n              const newEnv = new AnalysisEnvironment(oldEnv);\n              BoundNamesInstantiation(node.left, newEnv);\n              runningContext.LexicalEnvironment = newEnv;\n            }\n            EvaluateChildren(node, [\"right\"], parent);\n            runningContext.LexicalEnvironment = oldEnv;\n\n            // ForIn/OfBodyEvaluation\n            if (lexicalBinding) {\n              const iterationEnv = new AnalysisEnvironment(oldEnv);\n              BoundNamesInstantiation(node.left, iterationEnv);\n              runningContext.LexicalEnvironment = iterationEnv;\n            }\n            EvaluateChildren(node, [\"left\", \"body\"], parent);\n            runningContext.LexicalEnvironment = oldEnv;\n            return;\n          }\n          case \"ForStatement\": {\n            const lexicalBinding =\n              node.init?.type === \"VariableDeclaration\" &&\n              node.init.kind !== \"var\";\n            const runningContext = getRunningContext();\n            const oldEnv = runningContext.LexicalEnvironment;\n            if (lexicalBinding) {\n              const loopEnv = new AnalysisEnvironment(oldEnv);\n              BoundNamesInstantiation(\n                node.init as VariableDeclaration,\n                loopEnv\n              );\n              runningContext.LexicalEnvironment = loopEnv;\n            }\n            EvaluateChildren(node, [\"init\", \"test\", \"body\", \"update\"], parent);\n            runningContext.LexicalEnvironment = oldEnv;\n            return;\n          }\n          case \"FunctionDeclaration\": {\n            const [fn] = collectBoundNames(node);\n            const env = getRunningContext().LexicalEnvironment!;\n            const fo = OrdinaryFunctionCreate(node, env);\n            env.CreateBinding(fn);\n            CallFunction(fo, parent);\n            return;\n          }\n          case \"FunctionExpression\": {\n            const closure = InstantiateOrdinaryFunctionExpression(node);\n            CallFunction(closure, parent);\n            return;\n          }\n          case \"IfStatement\":\n            EvaluateChildren(node, [\"test\", \"consequent\", \"alternate\"], parent);\n            return;\n          case \"ReturnStatement\":\n          case \"ThrowStatement\":\n          case \"UpdateExpression\":\n            EvaluateChildren(node, [\"argument\"], parent);\n            return;\n          case \"SwitchCase\":\n            EvaluateChildren(node, [\"test\", \"consequent\"], parent);\n            return;\n          case \"SwitchStatement\": {\n            EvaluateChildren(node, [\"discriminant\"], parent);\n            const runningContext = getRunningContext();\n            const oldEnv = runningContext.LexicalEnvironment;\n            const blockEnv = new AnalysisEnvironment(oldEnv);\n            BlockDeclarationInstantiation(node.cases, blockEnv);\n            runningContext.LexicalEnvironment = blockEnv;\n            EvaluateChildren(node, [\"cases\"], parent);\n            runningContext.LexicalEnvironment = oldEnv;\n            return;\n          }\n          case \"TryStatement\":\n            EvaluateChildren(node, [\"block\", \"handler\", \"finalizer\"], parent);\n            return;\n          case \"VariableDeclaration\":\n            EvaluateChildren(node, [\"declarations\"], parent);\n            return;\n          case \"VariableDeclarator\":\n            EvaluateChildren(node, [\"id\", \"init\"], parent);\n            return;\n          case \"WhileStatement\":\n            EvaluateChildren(node, [\"test\", \"body\"], parent);\n            return;\n        }\n      }\n      const silent = hooks.beforeVisitUnknown?.(node, parent);\n      if (!silent) {\n        // eslint-disable-next-line no-console\n        console.warn(`Unsupported node type \\`${node.type}\\``);\n      }\n    }\n  }\n\n  function BoundNamesInstantiation(\n    declarations: NodeWithBoundNames | NodeWithBoundNames[] | null | undefined,\n    env: AnalysisEnvironment\n  ): void {\n    for (const name of collectBoundNames(declarations)) {\n      env.CreateBinding(name);\n    }\n  }\n\n  function ResolveBinding(name: string): boolean {\n    const env = getRunningContext().LexicalEnvironment;\n    return GetIdentifierReference(env, name);\n  }\n\n  function GetIdentifierReference(\n    env: AnalysisEnvironment | null | undefined,\n    name: string\n  ): boolean {\n    return (\n      !!env &&\n      (env.HasBinding(name) || GetIdentifierReference(env.OuterEnv, name))\n    );\n  }\n\n  function BlockDeclarationInstantiation(\n    code: Statement[] | SwitchCase[],\n    env: AnalysisEnvironment\n  ): void {\n    const declarations = collectScopedDeclarations(code, {\n      var: false,\n      topLevel: false,\n    });\n    BoundNamesInstantiation(declarations, env);\n  }\n\n  function CallFunction(\n    closure: AnalysisFunctionObject,\n    parent?: EstreeParent\n  ): void {\n    PrepareOrdinaryCall(closure);\n    FunctionDeclarationInstantiation(closure, parent);\n    Evaluate(\n      closure.ECMAScriptCode,\n      parent\n        ?.concat({\n          node: closure.Function,\n          key: \"body\",\n        })\n        .concat(\n          closure.Function.body.type === \"BlockStatement\"\n            ? {\n                node: closure.Function.body,\n                key: \"body\",\n              }\n            : []\n        )\n    );\n    analysisContextStack.pop();\n  }\n\n  function PrepareOrdinaryCall(F: AnalysisFunctionObject): void {\n    const calleeContext = new AnalysisContext();\n    const localEnv = new AnalysisEnvironment(F.Environment);\n    calleeContext.VariableEnvironment = localEnv;\n    calleeContext.LexicalEnvironment = localEnv;\n    analysisContextStack.push(calleeContext);\n  }\n\n  function FunctionDeclarationInstantiation(\n    func: AnalysisFunctionObject,\n    parent?: EstreeParent\n  ): void {\n    const calleeContext = getRunningContext();\n    const code = func.ECMAScriptCode;\n    const formals = func.FormalParameters;\n    const hasParameterExpressions = containsExpression(formals);\n    const varDeclarations = collectScopedDeclarations(code, {\n      var: true,\n      topLevel: true,\n    });\n    const varNames = collectBoundNames(varDeclarations);\n\n    const env = calleeContext.LexicalEnvironment!;\n    BoundNamesInstantiation(formals, env);\n\n    Evaluate(formals, parent?.concat({ node: func.Function, key: \"params\" }));\n\n    let varEnv: AnalysisEnvironment;\n    if (!hasParameterExpressions) {\n      // NOTE: Only a single Environment Record is needed for the parameters\n      // and top-level vars.\n      for (const n of varNames) {\n        env.CreateBinding(n);\n      }\n      varEnv = env;\n    } else {\n      // NOTE: A separate Environment Record is needed to ensure that closures\n      // created by expressions in the formal parameter list do not have\n      // visibility of declarations in the function body.\n      varEnv = new AnalysisEnvironment(env);\n      calleeContext.VariableEnvironment = varEnv;\n      for (const n of varNames) {\n        varEnv.CreateBinding(n);\n      }\n    }\n    const lexEnv = varEnv;\n    calleeContext.LexicalEnvironment = lexEnv;\n\n    const lexDeclarations = collectScopedDeclarations(code, {\n      var: false,\n      topLevel: true,\n    });\n    BoundNamesInstantiation(lexDeclarations, lexEnv);\n  }\n\n  function InstantiateOrdinaryFunctionExpression(\n    functionExpression: FunctionExpression\n  ): AnalysisFunctionObject {\n    const scope = getRunningContext().LexicalEnvironment;\n    if (!functionExpression.id) {\n      return OrdinaryFunctionCreate(functionExpression, scope);\n    }\n    const name = functionExpression.id.name;\n    const funcEnv = new AnalysisEnvironment(scope);\n    funcEnv.CreateBinding(name);\n    return OrdinaryFunctionCreate(functionExpression, funcEnv);\n  }\n\n  function OrdinaryFunctionCreate(\n    func: FunctionDeclaration | FunctionExpression | ArrowFunctionExpression,\n    scope?: AnalysisEnvironment\n  ): AnalysisFunctionObject {\n    return {\n      Function: func,\n      FormalParameters: func.params,\n      ECMAScriptCode:\n        func.body.type === \"BlockStatement\" ? func.body.body : func.body,\n      Environment: scope,\n    };\n  }\n\n  Evaluate(rootAst, withParent ? [] : undefined);\n\n  return attemptToVisitGlobals;\n}\n","export function hasOwnProperty(\n  object: unknown,\n  property: string | number | symbol\n): boolean {\n  return Object.prototype.hasOwnProperty.call(object, property);\n}\n","import { FunctionDeclaration } from \"@babel/types\";\nimport { parseAsEstree } from \"./parse.js\";\nimport { precook, PrecookOptions } from \"./precook.js\";\n\nexport interface PrecookFunctionOptions extends PrecookOptions {\n  typescript?: boolean;\n}\n\nexport interface PrecookFunctionResult {\n  function: FunctionDeclaration;\n  attemptToVisitGlobals: Set<string>;\n}\n\nexport function precookFunction(\n  source: string,\n  { typescript, ...restOptions }: PrecookFunctionOptions = {}\n): PrecookFunctionResult {\n  const func = parseAsEstree(source, { typescript });\n  const attemptToVisitGlobals = precook(func, restOptions);\n  return {\n    function: func,\n    attemptToVisitGlobals,\n  };\n}\n","import { parse, parseExpression, type ParserPlugin } from \"@babel/parser\";\nimport type { Expression, FunctionDeclaration, Statement } from \"@babel/types\";\n\nexport function parseAsEstreeExpression(source: string): Expression {\n  return parseExpression(source, {\n    plugins: [\"estree\", [\"pipelineOperator\", { proposal: \"minimal\" }]],\n    attachComment: false,\n  });\n}\n\nexport interface ParseEstreeOptions {\n  typescript?: boolean;\n}\n\nexport function parseAsEstree(\n  source: string,\n  { typescript }: ParseEstreeOptions = {}\n): FunctionDeclaration {\n  const file = parse(source, {\n    plugins: [\"estree\", typescript && \"typescript\"].filter(\n      Boolean\n    ) as ParserPlugin[],\n    strictMode: true,\n    attachComment: false,\n  });\n  const body = file.program.body;\n  const jsNodes: Statement[] = typescript ? [] : body;\n  if (typescript) {\n    for (const node of body) {\n      if (node.type.startsWith(\"TS\")) {\n        if (/Enum|Import|Export/.test(node.type)) {\n          throw new SyntaxError(`Unsupported TypeScript syntax: ${node.type}`);\n        }\n      } else {\n        jsNodes.push(node);\n      }\n    }\n  }\n  if (jsNodes.length === 0) {\n    throw new SyntaxError(\"Function declaration not found\");\n  }\n  if (jsNodes.length > 1 || jsNodes[0].type !== \"FunctionDeclaration\") {\n    throw new SyntaxError(\n      `Expect a single function declaration at top level, but received: ${jsNodes\n        .map((node) => `\"${node.type}\"`)\n        .join(\", \")}`\n    );\n  }\n  return jsNodes[0] as FunctionDeclaration;\n}\n","import { Expression } from \"@babel/types\";\nimport { parseAsEstreeExpression } from \"./parse.js\";\nimport { precook, PrecookOptions } from \"./precook.js\";\n\nexport type PreevaluateOptions = Omit<PrecookOptions, \"expressionOnly\">;\n\nexport interface PreevaluateResult {\n  expression: Expression;\n  attemptToVisitGlobals: Set<string>;\n  source: string;\n  prefix: string;\n  suffix: string;\n}\n\n// `raw` should always be asserted by `isEvaluable`.\nexport function preevaluate(\n  raw: string,\n  options?: PreevaluateOptions\n): PreevaluateResult {\n  const fixes: string[] = [];\n  const source = raw.replace(/^\\s*<%[~=]?\\s|\\s%>\\s*$/g, (m) => {\n    fixes.push(m);\n    return \"\";\n  });\n  const expression = parseAsEstreeExpression(source);\n  const attemptToVisitGlobals = precook(expression, {\n    ...options,\n    expressionOnly: true,\n  });\n  return {\n    expression,\n    attemptToVisitGlobals,\n    source,\n    prefix: fixes[0],\n    suffix: fixes[1],\n  };\n}\n\nexport function isEvaluable(raw: string): boolean {\n  return /^\\s*<%[~=]?\\s/.test(raw) && /\\s%>\\s*$/.test(raw);\n}\n\nexport function shouldAllowRecursiveEvaluations(raw: string): boolean {\n  return /^\\s*<%~\\s/.test(raw);\n}\n\nexport function isTrackAll(raw: string): boolean {\n  return /^\\s*<%=\\s/.test(raw) && /\\s%>\\s*$/.test(raw);\n}\n","export const fetch = (\n  input: RequestInfo,\n  init?: RequestInit\n): Promise<Response> => {\n  // Support older browsers which default credentials is \"omit\".\n  // Ref https://github.com/whatwg/fetch/pull/585\n  const req = new Request(\n    input,\n    Object.assign<RequestInit, RequestInit | undefined>(\n      {\n        credentials: \"same-origin\",\n      },\n      init\n    )\n  );\n\n  return self.fetch(req);\n};\n","export class HttpFetchError extends Error {\n  constructor(message: string) {\n    // Pass remaining arguments (including vendor specific ones) to parent constructor\n    super(message);\n\n    this.name = \"HttpFetchError\";\n\n    // Maintains proper stack trace for where our error was thrown (only available on V8)\n    // istanbul ignore else\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, HttpFetchError);\n    }\n  }\n}\n\nexport class HttpResponseError extends Error {\n  response: Response;\n  responseJson: any;\n\n  constructor(response: Response, responseJson?: any) {\n    // Pass remaining arguments (including vendor specific ones) to parent constructor\n    super(response.statusText);\n\n    this.name = \"HttpResponseError\";\n\n    // Maintains proper stack trace for where our error was thrown (only available on V8)\n    // istanbul ignore else\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, HttpResponseError);\n    }\n\n    this.response = response;\n    this.responseJson = responseJson;\n  }\n}\n\nexport class HttpParseError extends Error {\n  response: Response;\n\n  constructor(response: Response) {\n    // Pass remaining arguments (including vendor specific ones) to parent constructor\n    super(response.statusText);\n\n    this.name = \"HttpParseError\";\n\n    // Maintains proper stack trace for where our error was thrown (only available on V8)\n    // istanbul ignore else\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, HttpParseError);\n    }\n\n    this.response = response;\n  }\n}\n\nexport class HttpAbortError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.name = \"HttpAbortError\";\n  }\n}\n","import type { HttpError } from \"./http.js\";\n\nexport interface InterceptorHandlers<T> {\n  fulfilled?: (config: T) => void;\n  rejected?: (error: HttpError) => void;\n}\n\nexport default class InterceptorManager<T> {\n  handlers: (InterceptorHandlers<T> | null)[] = [];\n\n  use(\n    onFulfilled?: (value: T) => T | Promise<T>,\n    onRejected?: (error: HttpError) => HttpError | Promise<HttpError>\n  ): number {\n    this.handlers.push({\n      fulfilled: onFulfilled,\n      rejected: onRejected,\n    });\n\n    return this.handlers.length - 1;\n  }\n\n  eject(id: number): void {\n    // istanbul ignore else\n    if (this.handlers[id]) {\n      this.handlers[id] = null;\n    }\n  }\n\n  forEach(fn: (h: InterceptorHandlers<T>) => void): void {\n    this.handlers.forEach((handler) => {\n      // istanbul ignore else\n      if (handler !== null) {\n        fn(handler);\n      }\n    });\n  }\n}\n","import { fetch } from \"./fetch.js\";\nimport {\n  HttpAbortError,\n  HttpFetchError,\n  HttpParseError,\n  HttpResponseError,\n} from \"./errors.js\";\nimport InterceptorManager from \"./InterceptorManager.js\";\n\nexport interface HttpRequestConfig {\n  url: string;\n  method: string;\n  data?: unknown;\n  meta?: unknown;\n  options?: HttpOptions;\n}\n\nexport interface HttpResponse<T = unknown> {\n  data: T;\n  status: number;\n  statusText: string;\n  headers: Headers;\n  config: HttpRequestConfig;\n}\n\nexport interface HttpError {\n  config: HttpRequestConfig;\n  error: HttpFetchError | HttpResponseError | HttpParseError | HttpAbortError;\n}\n\nexport interface HttpAdapter {\n  (config: HttpRequestConfig): Promise<HttpResponse<unknown>>;\n}\n\nexport interface HttpConstructorOptions {\n  adapter?: HttpAdapter;\n}\n\n// type NotNil<T> = T extends null ? never : T;\n\nfunction isNil(value: unknown): value is null | undefined {\n  return value === undefined || value === null;\n}\n\nconst base = document.querySelector(\"base\");\nconst fullBaseHref = base ? base.href : location.origin + \"/\";\n\nexport type HttpParams = URLSearchParams | object;\n\nexport interface RequestCustomOptions {\n  observe?: \"data\" | \"response\";\n  responseType?: \"json\" | \"blob\" | \"arrayBuffer\" | \"text\";\n  interceptorParams?: {\n    ignoreLoadingBar?: boolean;\n  };\n  noAbortOnRouteChange?: boolean;\n  useCache?: boolean;\n}\n\nexport type HttpCustomOptions = RequestCustomOptions & {\n  params?: HttpParams;\n};\n\nexport type HttpOptions = HttpCustomOptions & RequestInit;\n\n// https://developer.mozilla.org/en-US/docs/Web/API/DOMException\nexport const isHttpAbortError = (error: any) =>\n  error instanceof DOMException && error.code === 20;\n\nconst createError = (\n  error: HttpFetchError | HttpResponseError | HttpParseError | HttpAbortError,\n  config: HttpRequestConfig\n): HttpError => {\n  return {\n    error,\n    config,\n  };\n};\n\nconst request = async <T>(\n  url: string,\n  init: RequestInit,\n  config: HttpRequestConfig\n): Promise<HttpResponse<T>> => {\n  // eslint-disable-next-line no-async-promise-executor\n  return new Promise(async (resolve, reject) => {\n    let response: Response;\n    config.url = url;\n\n    let { responseType } = config.options || {};\n\n    if (!responseType) {\n      // Defaults to `json`\n      responseType = \"json\";\n    }\n\n    try {\n      response = await fetch(url, init);\n    } catch (e: any) {\n      reject(\n        createError(\n          isHttpAbortError(e)\n            ? new HttpAbortError(e.toString())\n            : new HttpFetchError(e.toString()),\n          config\n        )\n      );\n      return;\n    }\n\n    if (!response.ok) {\n      let responseJson;\n      try {\n        responseJson = await response.json();\n      } catch (e) {\n        // Do nothing.\n      }\n      reject(\n        createError(new HttpResponseError(response, responseJson), config)\n      );\n      return;\n    }\n\n    let data: T;\n    try {\n      data = await response[responseType]();\n    } catch (e: any) {\n      reject(\n        createError(\n          isHttpAbortError(e)\n            ? new HttpAbortError(e.toString())\n            : new HttpParseError(response),\n          config\n        )\n      );\n      return;\n    }\n\n    const res: HttpResponse<T> = {\n      config,\n      status: response.status,\n      statusText: response.statusText,\n      headers: response.headers,\n      data,\n    };\n\n    resolve(res);\n  });\n};\n\nexport const getUrlWithParams = (url: string, params?: HttpParams): string => {\n  if (params) {\n    const parsedUrl = new URL(url, fullBaseHref);\n    if (params instanceof URLSearchParams) {\n      params.forEach(function (value, key) {\n        parsedUrl.searchParams.append(key, value);\n      });\n    } else {\n      Object.entries(params).forEach(([key, value]) => {\n        if (Array.isArray(value)) {\n          value.forEach((v) => {\n            parsedUrl.searchParams.append(key, isNil(v) ? \"\" : v);\n          });\n        } else {\n          parsedUrl.searchParams.append(key, isNil(value) ? \"\" : value);\n        }\n      });\n    }\n    const { href } = parsedUrl;\n    if (href.startsWith(fullBaseHref)) {\n      return href.substr(fullBaseHref.length);\n    }\n    return href;\n  }\n  return url;\n};\n\nconst getBodyAndHeaders = (\n  data: unknown,\n  headers?: HeadersInit\n): { body?: BodyInit; headers?: HeadersInit } => {\n  if (data !== undefined) {\n    // `new Headers(undefined)` will throw a TypeError in older browsers (chrome 58).\n    // https://bugs.chromium.org/p/chromium/issues/detail?id=335871\n    const parsedHeaders = new Headers(headers || {});\n    const contentTypeHeader = \"Content-Type\";\n    let body = data as BodyInit | undefined;\n    // If `Content-Type` already provided, ignore detecting content type.\n    if (!parsedHeaders.has(contentTypeHeader)) {\n      if (typeof data === \"string\") {\n        parsedHeaders.set(\n          contentTypeHeader,\n          \"application/x-www-form-urlencoded\"\n        );\n      } else if (data instanceof FormData) {\n        // Do nothing\n      } else {\n        parsedHeaders.set(contentTypeHeader, \"application/json\");\n        body = JSON.stringify(data);\n      }\n    }\n    return {\n      body,\n      headers: parsedHeaders,\n    };\n  }\n  return { headers };\n};\n\nconst simpleRequest = <T = unknown>(\n  method: string,\n  url: string,\n  config: HttpRequestConfig\n): Promise<HttpResponse<T>> => {\n  const {\n    params,\n    responseType,\n    interceptorParams,\n    observe,\n    noAbortOnRouteChange,\n    useCache,\n    ...requestInit\n  } = config.options || {};\n  return request<T>(\n    getUrlWithParams(url, params),\n    {\n      ...requestInit,\n      method,\n    },\n    config\n  );\n};\n\nconst requestWithBody = <T = unknown>(\n  method: string,\n  url: string,\n  data: unknown,\n  config: HttpRequestConfig\n): Promise<HttpResponse<T>> => {\n  const {\n    params,\n    responseType,\n    interceptorParams,\n    observe,\n    noAbortOnRouteChange,\n    useCache,\n    headers,\n    ...requestInit\n  } = config.options || {};\n  return request<T>(\n    getUrlWithParams(url, params),\n    {\n      ...requestInit,\n      method,\n      ...getBodyAndHeaders(data, headers),\n    },\n    config\n  );\n};\n\nconst defaultAdapter: HttpAdapter = <T>(config: HttpRequestConfig) => {\n  const { url, method, data } = config;\n\n  // \"DELETE\", \"GET\", \"HEAD\" methods.\n  if ([\"DELETE\", \"GET\", \"HEAD\"].includes(config.method)) {\n    return simpleRequest<T>(method, url, config);\n  }\n\n  // \"POST\", \"PUT\" , \"PATCH\" methods.\n  return requestWithBody<T>(method, url, data, config);\n};\n\nclass Http {\n  public readonly interceptors: {\n    request: InterceptorManager<HttpRequestConfig>;\n    response: InterceptorManager<HttpResponse>;\n  };\n\n  #adapter: HttpAdapter = defaultAdapter;\n\n  constructor(config?: HttpConstructorOptions) {\n    this.interceptors = {\n      request: new InterceptorManager(),\n      response: new InterceptorManager(),\n    };\n\n    if (config?.adapter) {\n      this.#adapter = config.adapter;\n    }\n  }\n\n  request = async <T = unknown>(\n    url: string,\n    init?: RequestInit,\n    options?: RequestCustomOptions\n  ): Promise<T> => {\n    const { body, method, ...requestInit } = init || {};\n    return this.#fetch<T>({\n      url,\n      data: body,\n      method: method || \"GET\",\n      options: { ...(options || {}), ...requestInit },\n    });\n  };\n\n  simpleRequest = <T = unknown>(\n    method: string,\n    url: string,\n    options: HttpOptions = {}\n  ): Promise<T> => {\n    return this.#fetch<T>({ url, method, options });\n  };\n\n  requestWithBody = <T = unknown>(\n    method: string,\n    url: string,\n    data?: unknown,\n    options: HttpOptions = {}\n  ): Promise<T> => {\n    return this.#fetch<T>({ url, method, data, options });\n  };\n\n  #fetch<T>(config: HttpRequestConfig): Promise<T> {\n    const chain: any[] = [];\n    let promise: Promise<any> = Promise.resolve(config);\n\n    this.interceptors.request.forEach((interceptor) => {\n      chain.push(interceptor.fulfilled, interceptor.rejected);\n    });\n\n    chain.push((config: HttpRequestConfig) => this.#adapter(config), undefined);\n\n    this.interceptors.response.forEach((interceptor) => {\n      chain.push(interceptor.fulfilled, interceptor.rejected);\n    });\n\n    chain.push(\n      (response: HttpResponse) => {\n        return response.config.options?.observe === \"response\"\n          ? response\n          : response.data;\n      },\n      (error: HttpError) => {\n        return Promise.reject(error.error);\n      }\n    );\n\n    while (chain.length) {\n      promise = promise.then(chain.shift(), chain.shift());\n    }\n\n    return promise;\n  }\n\n  getUrlWithParams(url: string, params?: HttpParams): string {\n    return getUrlWithParams(url, params);\n  }\n\n  getBodyAndHeaders(\n    data: unknown,\n    headers: HeadersInit\n  ): { body?: BodyInit; headers?: HeadersInit } {\n    return getBodyAndHeaders(data, headers);\n  }\n\n  get<T>(url: string, options?: HttpOptions): Promise<T> {\n    return this.#fetch({ url, method: \"GET\", options });\n  }\n\n  delete<T>(url: string, options?: HttpOptions): Promise<T> {\n    return this.#fetch({ url, method: \"DELETE\", options });\n  }\n\n  head<T>(url: string, options?: HttpOptions): Promise<T> {\n    return this.#fetch({ url, method: \"HEAD\", options });\n  }\n\n  post<T>(url: string, data?: unknown, options?: HttpOptions): Promise<T> {\n    return this.#fetch({ url, method: \"POST\", data, options });\n  }\n\n  put<T>(url: string, data?: unknown, options?: HttpOptions): Promise<T> {\n    return this.#fetch({ url, method: \"PUT\", data, options });\n  }\n\n  patch<T>(url: string, data?: unknown, options?: HttpOptions): Promise<T> {\n    return this.#fetch({\n      url,\n      method: \"PATCH\",\n      data,\n      options,\n    });\n  }\n}\n\nlet http = new Http();\nfunction createHttpInstance(config?: HttpConstructorOptions): void {\n  http = new Http(config);\n}\nexport { http, createHttpInstance, defaultAdapter };\n","import { i18n } from \"@next-core/i18n\";\nimport LanguageDetector from \"i18next-browser-languagedetector\";\n\nlet initialized = false;\nconst initializedNamespaces = new Set<string>();\n\nexport type Locales = Record<string, Record<string, string>>;\n\nexport function initializeI18n(): void;\nexport function initializeI18n(NS: string, locales: Locales): void;\nexport function initializeI18n(NS?: string, locales?: Locales) {\n  if (!initialized) {\n    initialized = true;\n    i18n\n      // learn more: https://github.com/i18next/i18next-xhr-backend\n      // .use(Backend)\n      // learn more: https://github.com/i18next/i18next-browser-languageDetector\n      .use(\n        process.env.NODE_ENV === \"test\"\n          ? (LanguageDetector as unknown as LanguageDetector.default)\n          : /* istanbul ignore next */ LanguageDetector.default\n      )\n      // for all options read: https://www.i18next.com/overview/configuration-options\n      .init({\n        fallbackLng: \"zh\",\n        debug: process.env.NODE_ENV === \"development\",\n        supportedLngs: [\"zh\", \"en\"],\n        nonExplicitSupportedLngs: true,\n        interpolation: {\n          escapeValue: false, // not needed for react as it escapes by default\n        },\n        react: {\n          useSuspense: false,\n        },\n        compatibilityJSON: \"v3\",\n        resources: {},\n      });\n  }\n\n  if (!NS || !locales || initializedNamespaces.has(NS)) {\n    return;\n  }\n  initializedNamespaces.add(NS);\n  for (const [lang, resources] of Object.entries(locales)) {\n    i18n.addResourceBundle(lang, NS, resources);\n  }\n}\n","import { i18n } from \"@next-core/i18n\";\nimport { hasOwnProperty } from \"@next-core/utils/general\";\nimport { I18nData } from \"@next-core/types\";\n\nexport function i18nText(\n  data: I18nData | null | undefined\n): string | undefined {\n  if (!data) {\n    return;\n  }\n  const language = i18n.language ?? \"zh-CN\";\n  // First, make a perfect match.\n  if (hasOwnProperty(data, language)) {\n    return data[language];\n  }\n  // https://en.wikipedia.org/wiki/IETF_language_tag\n  const primaryLanguage = language.split(\"-\")[0];\n  if (primaryLanguage !== language) {\n    // Then, match the primary language (which omits other subtags).\n    // E.g., match `zh` if the current language is `zh-CN`.\n    return hasOwnProperty(data, primaryLanguage)\n      ? data[primaryLanguage]\n      : undefined;\n  }\n  // At last, match the first key which starts with the primary language,\n  // if the current language contains primary subtag only.\n  // E.g., match `zh-CN` if the current language is `zh`.\n  const prefix = `${primaryLanguage}-`;\n  for (const key of Object.keys(data)) {\n    if (key.startsWith(prefix)) {\n      return data[key];\n    }\n  }\n}\n","export * from \"./cook.js\";\nexport * from \"./precook.js\";\nexport * from \"./precookFunction.js\";\nexport * from \"./preevaluate.js\";\nexport * from \"./interfaces.js\";\n// export { tokTypes } from \"@babel/parser\";\n","import { Node, SourceLocation, PipeCall } from \"@next-core/pipes\";\n\nexport enum LexicalStatus {\n  Initial,\n  ExpectField,\n  ExpectOptionalBeginDefault,\n  ExpectDefaultValue,\n  ExpectOptionalBeginPipe,\n  ExpectPipeIdentifier,\n  ExpectOptionalBeginPipeParameter,\n  ExpectPipeParameter,\n  ExpectPlaceholderEnd,\n}\n\nexport enum TokenType {\n  Raw = \"Raw\",\n  BeginPlaceHolder = \"BeginPlaceHolder\",\n  Field = \"Field\",\n  BeginDefault = \"BeginDefault\",\n  LiteralString = \"LiteralString\",\n  BeginPipe = \"BeginPipe\",\n  PipeIdentifier = \"PipeIdentifier\",\n  BeginPipeParameter = \"BeginPipeParameter\",\n  EndPlaceHolder = \"EndPlaceHolder\",\n  JsonValue = \"JsonValue\",\n}\n\nexport enum JsonValueType {\n  Array,\n  Object,\n  String,\n  Others,\n}\n\nexport interface LexicalContext {\n  beginPlaceholder: RegExp;\n  raw: string;\n  cursor: number;\n  status: LexicalStatus;\n  tokens: Token[];\n}\n\nexport interface Token {\n  type: TokenType;\n  value?: any;\n  loc?: SourceLocation;\n}\n\nexport interface InjectableString extends Node {\n  type: \"InjectableString\";\n  elements: (RawString | Placeholder)[];\n}\n\nexport interface RawString extends Node {\n  type: \"RawString\";\n  value: string;\n}\n\nexport interface Placeholder extends Node {\n  type: \"Placeholder\";\n  symbol: string;\n  field: string;\n  defaultValue: any;\n  pipes: PipeCall[];\n}\n","import { escapeRegExp } from \"lodash\";\nimport {\n  LexicalContext,\n  LexicalStatus,\n  Token,\n  TokenType,\n  JsonValueType,\n} from \"./interfaces.js\";\n\nexport function getRegExpOfPlaceholder(symbols: string | string[]): RegExp {\n  return new RegExp(\n    `(${([] as string[])\n      .concat(symbols)\n      .map((symbol) => escapeRegExp(symbol))\n      .join(\"|\")})\\\\{`\n  );\n}\n\nexport function tokenize(raw: string, symbols: string | string[]): Token[] {\n  const context: LexicalContext = {\n    beginPlaceholder: getRegExpOfPlaceholder(symbols),\n    raw,\n    cursor: 0,\n    status: LexicalStatus.Initial,\n    tokens: [],\n  };\n  while (context.cursor < raw.length) {\n    switch (context.status) {\n      case LexicalStatus.Initial:\n        eatOptionalRawAndOptionalPlaceholderBegin(context);\n        break;\n      case LexicalStatus.ExpectField:\n        eatWhitespace(context);\n        eatField(context);\n        break;\n      case LexicalStatus.ExpectOptionalBeginDefault:\n        eatWhitespace(context);\n        eatOptionalDefault(context);\n        break;\n      case LexicalStatus.ExpectDefaultValue:\n        eatWhitespace(context);\n        eatDefaultValue(context);\n        break;\n      case LexicalStatus.ExpectOptionalBeginPipe:\n        eatWhitespace(context);\n        eatOptionalBeginPipe(context);\n        break;\n      case LexicalStatus.ExpectPipeIdentifier:\n        eatWhitespace(context);\n        eatPipeIdentifier(context);\n        break;\n      case LexicalStatus.ExpectOptionalBeginPipeParameter:\n        eatWhitespace(context);\n        eatOptionalBeginPipeParameter(context);\n        break;\n      case LexicalStatus.ExpectPipeParameter:\n        eatWhitespace(context);\n        eatPipeParameter(context);\n        break;\n      case LexicalStatus.ExpectPlaceholderEnd:\n        eatWhitespace(context);\n        eatPlaceholderEnd(context);\n        break;\n    }\n  }\n  if (context.status !== LexicalStatus.Initial) {\n    throw new Error(\"Expected a placeholder end '}' at the end\");\n  }\n  return context.tokens;\n}\n\nfunction eatOptionalRawAndOptionalPlaceholderBegin(\n  context: LexicalContext\n): void {\n  const subRaw = getSubRaw(context);\n  const matchedPlaceholder = subRaw.match(context.beginPlaceholder)?.[0];\n  const subCursor = matchedPlaceholder\n    ? subRaw.indexOf(matchedPlaceholder)\n    : -1;\n  if (\n    subCursor >= 0 &&\n    matchedPlaceholder &&\n    subRaw.charAt(subCursor + matchedPlaceholder.length) !== \"{\"\n  ) {\n    const nextCursor = context.cursor + subCursor;\n    if (subCursor > 0) {\n      context.tokens.push({\n        type: TokenType.Raw,\n        value: subRaw.substring(0, subCursor),\n      });\n    }\n    context.tokens.push({\n      type: TokenType.BeginPlaceHolder,\n      loc: {\n        start: nextCursor,\n        end: nextCursor + matchedPlaceholder.length,\n      },\n      value: matchedPlaceholder.substring(0, matchedPlaceholder.length - 1),\n    });\n    context.cursor += subCursor + matchedPlaceholder.length;\n    context.status = LexicalStatus.ExpectField;\n  } else {\n    context.tokens.push({\n      type: TokenType.Raw,\n      value: subRaw,\n    });\n    context.cursor = context.raw.length;\n  }\n}\n\nfunction eatWhitespace(context: LexicalContext): void {\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  context.cursor += getSubRaw(context).match(/^[ \\r\\n\\t]*/)![0].length;\n}\n\nfunction eatField(context: LexicalContext): void {\n  // Only allow alphanumeric, `_`, `.`, `*`, `[`, `]`, `-` and other non-ascii.\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const [value] = getSubRaw(context).match(/^[\\w.*[\\]\\-\\u{80}-\\u{10FFFF}]*/u)!;\n  context.tokens.push({\n    type: TokenType.Field,\n    value,\n  });\n  context.cursor += value.length;\n  context.status = LexicalStatus.ExpectOptionalBeginDefault;\n}\n\nfunction eatOptionalDefault(context: LexicalContext): void {\n  if (getSubRaw(context).charAt(0) === \"=\") {\n    context.tokens.push({\n      type: TokenType.BeginDefault,\n    });\n    context.cursor += 1;\n    context.status = LexicalStatus.ExpectDefaultValue;\n  } else {\n    context.status = LexicalStatus.ExpectOptionalBeginPipe;\n  }\n}\n\nfunction eatDefaultValue(context: LexicalContext): void {\n  eatJsonValueOrLiteralString(context, LexicalStatus.ExpectOptionalBeginPipe);\n}\n\nfunction eatOptionalBeginPipe(context: LexicalContext): void {\n  if (getSubRaw(context).charAt(0) === \"|\") {\n    context.tokens.push({\n      type: TokenType.BeginPipe,\n    });\n    context.cursor += 1;\n    context.status = LexicalStatus.ExpectPipeIdentifier;\n  } else {\n    context.status = LexicalStatus.ExpectPlaceholderEnd;\n  }\n}\n\nfunction eatPipeIdentifier(context: LexicalContext): void {\n  const matches = getSubRaw(context).match(/^[a-zA-Z]\\w*/);\n  if (!matches) {\n    throw new Error(\n      `Expected a pipe identifier at index ${\n        context.cursor\n      } near: ${JSON.stringify(context.raw.substring(context.cursor))}`\n    );\n  }\n  const value = matches[0];\n  context.tokens.push({\n    type: TokenType.PipeIdentifier,\n    value,\n  });\n  context.cursor += value.length;\n  context.status = LexicalStatus.ExpectOptionalBeginPipeParameter;\n}\n\nfunction eatOptionalBeginPipeParameter(context: LexicalContext): void {\n  if (getSubRaw(context).charAt(0) === \":\") {\n    context.tokens.push({\n      type: TokenType.BeginPipeParameter,\n    });\n    context.cursor += 1;\n    context.status = LexicalStatus.ExpectPipeParameter;\n  } else {\n    context.status = LexicalStatus.ExpectOptionalBeginPipe;\n  }\n}\n\nfunction eatPipeParameter(context: LexicalContext): void {\n  eatJsonValueOrLiteralString(\n    context,\n    LexicalStatus.ExpectOptionalBeginPipeParameter\n  );\n}\n\nfunction eatPlaceholderEnd(context: LexicalContext): void {\n  if (getSubRaw(context).charAt(0) === \"}\") {\n    context.tokens.push({\n      type: TokenType.EndPlaceHolder,\n      loc: {\n        start: context.cursor,\n        end: context.cursor + 1,\n      },\n    });\n    context.cursor += 1;\n    context.status = LexicalStatus.Initial;\n  } else {\n    throw new Error(\n      `Expected a placeholder end '}' at index ${\n        context.cursor\n      } near: ${JSON.stringify(context.raw.substring(context.cursor))}`\n    );\n  }\n}\n\nconst jsonLiteralMap = new Map([\n  [\"false\", false],\n  [\"null\", null],\n  [\"true\", true],\n]);\n\nfunction eatJsonValueOrLiteralString(\n  context: LexicalContext,\n  nextStatus: LexicalStatus\n): void {\n  const subRaw = getSubRaw(context);\n  if (\n    /[0-9[{\"]/.test(subRaw.charAt(0)) ||\n    /-[0-9]/.test(subRaw.substring(0, 2))\n  ) {\n    eatJsonValue(context, nextStatus);\n  } else {\n    // Accept any characters except controls and whitespace.\n    // Only allow alphanumeric, `_`, `-` and other non-ascii.\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const [value] = getSubRaw(context).match(/^[\\w\\-\\u{80}-\\u{10FFFF}]*/u)!;\n\n    if (jsonLiteralMap.has(value)) {\n      context.tokens.push({\n        type: TokenType.JsonValue,\n        value: jsonLiteralMap.get(value),\n      });\n    } else {\n      context.tokens.push({\n        type: TokenType.LiteralString,\n        value,\n      });\n    }\n\n    context.cursor += value.length;\n    context.status = nextStatus;\n  }\n}\n\n// 我们不需要非常精确地在一段字符串中匹配出一段*完整合法的* JSON value，\n// 而只需要找到一段*可能是完整合法的* JSON value 即可，解析的工作交给 `JSON.parse()`。\n// 由于 JSON 中 object/array/string 的镜像起止符特性，我们尝试去完成这些符号匹配即可。\nfunction eatJsonValue(\n  context: LexicalContext,\n  nextStatus: LexicalStatus\n): void {\n  const subRaw = getSubRaw(context);\n  const firstChar = subRaw.charAt(0);\n  const valueType: JsonValueType =\n    firstChar === \"[\"\n      ? JsonValueType.Array\n      : firstChar === \"{\"\n      ? JsonValueType.Object\n      : firstChar === '\"'\n      ? JsonValueType.String\n      : JsonValueType.Others;\n\n  let subCursor = 0;\n  let objectBracesToMatch = 0;\n  let arrayBracketsToMatch = 0;\n  let stringQuotesToClose = false;\n  let stringBackslashToEscape = false;\n  let matched = false;\n\n  while (subCursor < subRaw.length) {\n    const char = subRaw.charAt(subCursor);\n    if (stringBackslashToEscape) {\n      stringBackslashToEscape = false;\n    } else if (stringQuotesToClose) {\n      if (char === '\"') {\n        stringQuotesToClose = false;\n      } else if (char === \"\\\\\") {\n        stringBackslashToEscape = true;\n      }\n    } else {\n      switch (char) {\n        case \"[\":\n          arrayBracketsToMatch += 1;\n          break;\n        case \"{\":\n          objectBracesToMatch += 1;\n          break;\n        case \"]\":\n          arrayBracketsToMatch -= 1;\n          break;\n        case \"}\":\n          objectBracesToMatch -= 1;\n          break;\n        case '\"':\n          stringQuotesToClose = true;\n          break;\n      }\n    }\n\n    subCursor += 1;\n\n    switch (valueType) {\n      case JsonValueType.Array:\n        matched = !arrayBracketsToMatch;\n        break;\n      case JsonValueType.Object:\n        matched = !objectBracesToMatch;\n        break;\n      case JsonValueType.String:\n        matched = !stringQuotesToClose;\n        break;\n      default:\n        // 对于其它类型，如果下一个字符不再是这些值类型可能的字符时，我们认为 JSON value 完成匹配。\n        // 其它可能的值类型：number/boolean/null/undefined。\n        matched =\n          subCursor < subRaw.length &&\n          /[^a-z0-9E.+-]/.test(subRaw.charAt(subCursor));\n    }\n\n    if (matched) {\n      break;\n    }\n  }\n\n  if (!matched) {\n    throw new Error(\n      `Failed to match a JSON value at index ${\n        context.cursor\n      } near: ${JSON.stringify(context.raw.substring(context.cursor))}`\n    );\n  }\n\n  context.tokens.push({\n    type: TokenType.JsonValue,\n    value: JSON.parse(subRaw.substring(0, subCursor)),\n  });\n  context.cursor += subCursor;\n  context.status = nextStatus;\n}\n\nfunction getSubRaw(context: LexicalContext): string {\n  return context.raw.substring(context.cursor);\n}\n","import { get } from \"lodash\";\nimport type { Location } from \"history\";\nimport type { FeatureFlags, MicroApp } from \"@next-core/types\";\nimport { processPipes } from \"@next-core/pipes\";\nimport { parseInjectableString } from \"./syntax.js\";\nimport type { Placeholder } from \"./interfaces.js\";\nimport { getRegExpOfPlaceholder } from \"./lexical.js\";\n\nexport interface LegacyCompatibleRuntimeContext {\n  app: MicroApp;\n  overrideApp?: MicroApp;\n  location: Location;\n  query: URLSearchParams;\n  /** {@inheritDoc FeatureFlags} */\n  flags: FeatureFlags;\n  /** 系统运行时信息，包括登录信息和页面信息。 */\n  sys: Record<string, unknown>;\n  match?: {\n    path: string;\n    url: string;\n    isExact: boolean;\n    params: Record<string, string>;\n  };\n  event?: Event;\n  data?: unknown;\n}\n\nexport function transform(\n  raw: string,\n  context: LegacyCompatibleRuntimeContext\n): unknown {\n  return compile(raw, \"@\", context);\n}\n\nexport function inject(\n  raw: string,\n  context: LegacyCompatibleRuntimeContext\n): unknown {\n  return compile(raw, \"$\", context);\n}\n\nexport function transformAndInject(\n  raw: string,\n  context: LegacyCompatibleRuntimeContext\n): unknown {\n  return compile(raw, [\"@\", \"$\"], context);\n}\n\ntype CompileNode = (node: Placeholder) => unknown;\n\nfunction compile(\n  raw: string,\n  symbols: string | string[],\n  context: LegacyCompatibleRuntimeContext\n): unknown {\n  // const symbols = [\"@\", \"$\"];\n  if (!isInjectable(raw, symbols)) {\n    return raw;\n  }\n\n  const transformNode = transformNodeFactory(context.data);\n  const injectNode = injectNodeFactory(context, raw);\n\n  const tree = parseInjectableString(raw, symbols);\n  const values = tree.elements.map((node) =>\n    node.type === \"RawString\"\n      ? node.value\n      : node.symbol === \"$\"\n      ? injectNode(node)\n      : transformNode(node)\n  );\n\n  return reduceCompiledValues(values);\n}\n\nfunction reduceCompiledValues(values: unknown[]): unknown {\n  // If the whole string is a placeholder, we should keep the original value.\n  if (values.length === 1) {\n    return values[0];\n  }\n\n  // If an element is `undefined`, `null` or an empty array `[]`, it is converted to an empty string.\n  // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join#Description\n  return values.join(\"\");\n}\n\nfunction isInjectable(raw: string, symbols?: string | string[]): boolean {\n  return getRegExpOfPlaceholder(symbols).test(raw);\n}\n\nfunction transformNodeFactory(data: unknown): CompileNode {\n  return function transformNode(node: Placeholder): unknown {\n    // If meet `@{}`, return `data`.\n    let result = node.field ? get(data, node.field) : data;\n\n    if (result === undefined) {\n      result = node.defaultValue;\n    }\n\n    return processPipes(result, node.pipes);\n  };\n}\n\nfunction injectNodeFactory(\n  context: LegacyCompatibleRuntimeContext,\n  raw: string\n): CompileNode {\n  return function injectNode(node: Placeholder): unknown {\n    const matches = node.field.match(\n      /^(?:(QUERY(?:_ARRAY)?|EVENT|query|event|APP|HASH|ANCHOR|SYS|FLAGS|CTX)\\.)?(.+)$/\n    );\n    if (!matches) {\n      // Keep the original raw partial when meet a unknown namespace.\n      return raw.substring(node.loc.start, node.loc.end);\n    }\n    let [, namespace, subField] = matches;\n\n    // Support namespace with no subfield such as `${ANCHOR}`.\n    // But distinguish with match params. E.g. `${query}` is a match param.\n    if (!namespace && /^[A-Z_]+$/.test(subField)) {\n      namespace = subField;\n      subField = \"*\";\n    }\n\n    let result: unknown;\n    const SimpleContextMap: Record<string, \"sys\" | \"flags\"> = {\n      SYS: \"sys\",\n      FLAGS: \"flags\",\n    };\n\n    switch (namespace) {\n      case \"QUERY\":\n      case \"query\":\n        if (subField === \"*\") {\n          result = context.query;\n        } else {\n          result = context.query.has(subField)\n            ? context.query.get(subField)\n            : undefined;\n        }\n        break;\n      case \"QUERY_ARRAY\":\n        result = context.query.has(subField)\n          ? context.query.getAll(subField)\n          : undefined;\n        break;\n      case \"EVENT\":\n      case \"event\":\n        if (context.event === undefined) {\n          // Keep the original raw partial when meet a `${EVENT}` in non-event context.\n          return raw.substring(node.loc.start, node.loc.end);\n        }\n        result =\n          subField === \"*\" ? context.event : get(context.event, subField);\n        break;\n      case \"APP\":\n        result =\n          subField === \"*\"\n            ? context.overrideApp ?? context.app\n            : get(context.overrideApp ?? context.app, subField);\n        break;\n      case \"HASH\":\n        result = context.location.hash;\n        break;\n      case \"SYS\":\n      case \"FLAGS\":\n        result =\n          subField === \"*\"\n            ? context[SimpleContextMap[namespace]]\n            : get(context[SimpleContextMap[namespace]], subField);\n        break;\n      case \"ANCHOR\": {\n        const anchor = context.location.hash\n          ? context.location.hash.substr(1)\n          : null;\n        result = subField === \"*\" ? anchor : get(anchor, subField);\n        break;\n      }\n      case \"CTX\": {\n        const original = raw.substring(node.loc.start, node.loc.end);\n        // eslint-disable-next-line no-console\n        console.error(\n          `CTX is not supported in placeholder any more: \"${original}\"`\n        );\n        return original;\n      }\n      default:\n        if (context.match) {\n          result = context.match.params[subField];\n        } else {\n          // If the context is empty, return the original raw partial.\n          return raw.substring(node.loc.start, node.loc.end);\n        }\n    }\n\n    if (result === undefined) {\n      result = node.defaultValue;\n    }\n\n    return processPipes(result, node.pipes);\n  };\n}\n","import { PipeCall } from \"@next-core/pipes\";\nimport { tokenize } from \"./lexical.js\";\nimport {\n  Token,\n  TokenType,\n  InjectableString,\n  Placeholder,\n} from \"./interfaces.js\";\n\nexport function parseInjectableString(\n  raw: string,\n  symbols: string | string[]\n): InjectableString {\n  return parseTokens(tokenize(raw, symbols));\n}\n\nfunction parseTokens(tokens: Token[]): InjectableString {\n  const tree: InjectableString = {\n    type: \"InjectableString\",\n    elements: [],\n  };\n\n  let token: Token | undefined;\n\n  function optionalToken(type: TokenType): boolean {\n    if (type === tokens[0].type) {\n      token = tokens.shift();\n      return true;\n    }\n    return false;\n  }\n\n  function acceptToken(type: TokenType | TokenType[]): void {\n    token = tokens.shift() as Token;\n    if (\n      Array.isArray(type) ? !type.includes(token.type) : type !== token.type\n    ) {\n      throw new Error(`Expected token: ${type}, received token: ${token.type}`);\n    }\n  }\n\n  while (tokens.length > 0) {\n    if (optionalToken(TokenType.Raw)) {\n      tree.elements.push({\n        type: \"RawString\",\n        value: token.value,\n      });\n    } else {\n      acceptToken(TokenType.BeginPlaceHolder);\n      const start = token.loc.start;\n      const symbol = token.value;\n      acceptToken(TokenType.Field);\n\n      const placeholder: Placeholder = {\n        type: \"Placeholder\",\n        symbol,\n        field: token.value,\n        defaultValue: undefined,\n        pipes: [],\n        loc: {\n          start,\n          end: start,\n        },\n      };\n      tree.elements.push(placeholder);\n\n      if (optionalToken(TokenType.BeginDefault)) {\n        acceptToken([TokenType.JsonValue, TokenType.LiteralString]);\n        placeholder.defaultValue = token.value;\n      }\n\n      while (optionalToken(TokenType.BeginPipe)) {\n        acceptToken(TokenType.PipeIdentifier);\n        const pipe: PipeCall = {\n          type: \"PipeCall\",\n          identifier: token.value,\n          parameters: [],\n        };\n        placeholder.pipes.push(pipe);\n\n        while (optionalToken(TokenType.BeginPipeParameter)) {\n          acceptToken([TokenType.JsonValue, TokenType.LiteralString]);\n          pipe.parameters.push(token.value);\n        }\n      }\n\n      acceptToken(TokenType.EndPlaceHolder);\n      placeholder.loc.end = token.loc.end;\n    }\n  }\n\n  return tree;\n}\n","const cache = new Map<string, Promise<string>>();\n\nexport default function loadScript(\n  src: string,\n  prefix?: string\n): Promise<string>;\nexport default function loadScript(\n  src: string[],\n  prefix?: string\n): Promise<string[]>;\nexport default function loadScript(\n  src: string | string[],\n  prefix?: string\n): Promise<string | string[]> {\n  if (Array.isArray(src)) {\n    return Promise.all(\n      src.map<Promise<string>>((item) => loadScript(item, prefix))\n    );\n  }\n  const fixedSrc = prefix ? `${prefix}${src}` : src;\n  const cachedPromise = cache.get(fixedSrc);\n  if (cachedPromise) {\n    return cachedPromise;\n  }\n  const promise = new Promise<string>((resolve, reject) => {\n    const end = (): void => {\n      window.dispatchEvent(new Event(\"request.end\"));\n    };\n    const script = document.createElement(\"script\");\n    script.src = fixedSrc;\n    script.type = \"text/javascript\";\n    script.async = true;\n    script.onload = () => {\n      resolve(fixedSrc);\n      end();\n    };\n    script.onerror = (e) => {\n      reject(e);\n      end();\n    };\n    const firstScript =\n      document.currentScript || document.getElementsByTagName(\"script\")[0];\n    (firstScript.parentNode as Node).insertBefore(script, firstScript);\n    window.dispatchEvent(new Event(\"request.start\"));\n  });\n  cache.set(fixedSrc, promise);\n  return promise;\n}\n","import loadScript from \"./loadScript.js\";\nimport loadSharedModule from \"./loadSharedModule.js\";\n\ninterface BrickPackage {\n  id: string;\n  filePath: string;\n  elements?: string[];\n  dependencies?: Record<string, string[]>;\n}\n\nlet resolveBasicPkg: () => void;\nlet basicPkgWillBeResolved = false;\nconst waitBasicPkg = new Promise<void>((resolve) => {\n  resolveBasicPkg = resolve;\n});\n\nexport function flushStableLoadBricks(): void {\n  if (!basicPkgWillBeResolved) {\n    resolveBasicPkg();\n  }\n}\n\n/**\n * When loading bundles with webpack module federation concurrently, if\n * these bundles share some modules, webpack will load a singleton module\n * if versions are matched. Webpack will use the first bundle who started\n * to init the shared scope. Generally which bundle to use for a specific\n * module, does not matter. However, it may cause flaky result since the\n * shared module may from different bundles which maybe not exactly the\n * same, especially developers declare dependencies incorrectly sometimes.\n * So in order to make it less flaky, we try to make a BASIC package takes\n * precedence over others. We will always load the shared modules from the\n * basic package bundle if it contains the shared modules.\n */\nexport function enqueueStableLoadBricks(\n  bricks: string[] | Set<string>,\n  brickPackages: BrickPackage[]\n): Promise<void> {\n  const promise = enqueueStableLoad(\"bricks\", bricks, brickPackages);\n  return dispatchRequestStatus(promise);\n}\n\nexport function enqueueStableLoadProcessors(\n  processors: string[] | Set<string>,\n  brickPackages: BrickPackage[]\n): Promise<void> {\n  const promise = enqueueStableLoad(\"processors\", processors, brickPackages);\n  return dispatchRequestStatus(promise);\n}\n\nexport async function loadBricksImperatively(\n  bricks: string[] | Set<string>,\n  brickPackages: BrickPackage[]\n): Promise<void> {\n  const promise = enqueueStableLoad(\"bricks\", bricks, brickPackages);\n  flushStableLoadBricks();\n  return dispatchRequestStatus(promise);\n}\n\nexport function loadProcessorsImperatively(\n  processors: string[] | Set<string>,\n  brickPackages: BrickPackage[]\n): Promise<void> {\n  const promise = enqueueStableLoad(\"processors\", processors, brickPackages);\n  flushStableLoadBricks();\n  return dispatchRequestStatus(promise);\n}\n\ninterface V2AdapterBrick {\n  resolve(\n    adapterPkgFilePath: string,\n    brickPkgFilePath: string,\n    bricks: string[],\n    dlls: string[] | undefined,\n    brickPackages: BrickPackage[]\n  ): Promise<void>;\n}\n\nlet v2AdapterPromise: Promise<V2AdapterBrick> | undefined;\nconst V2_ADAPTER_LOAD_BRICKS = \"v2-adapter.load-bricks\";\n\n// Get brick/processor items including their dependencies\nfunction getItemsByPkg(\n  type: \"bricks\" | \"processors\",\n  list: string[] | Set<string>,\n  brickPackagesMap: Map<string, BrickPackage>\n) {\n  const itemsByPkg = new Map<BrickPackage, string[]>();\n  const listToLoad = new Set<string>();\n  const add = (item: string) => {\n    if (listToLoad.has(item)) {\n      return;\n    }\n    listToLoad.add(item);\n    let pkg: BrickPackage | undefined;\n    let namespace: string;\n    let itemName: string | undefined;\n    if (type === \"processors\" || item.includes(\".\")) {\n      [namespace, itemName] = item.split(\".\");\n      const pkgId = `bricks/${\n        type === \"processors\" ? getProcessorPackageName(namespace) : namespace\n      }`;\n      pkg = brickPackagesMap.get(pkgId);\n    } else {\n      itemName = item;\n      for (const p of brickPackagesMap.values()) {\n        if (p.elements?.some((e) => e === itemName)) {\n          pkg = p;\n          break;\n        }\n      }\n    }\n\n    if (!pkg) {\n      throw new Error(`Package for ${item} not found.`);\n    }\n\n    let groupItems = itemsByPkg.get(pkg);\n    if (!groupItems) {\n      groupItems = [];\n      itemsByPkg.set(pkg, groupItems);\n    }\n    groupItems.push(itemName!);\n\n    // Load their dependencies too\n    const deps = pkg.dependencies?.[item];\n    if (deps) {\n      for (const dep of deps) {\n        add(dep);\n      }\n    }\n  };\n  for (const item of list) {\n    add(item);\n  }\n  return itemsByPkg;\n}\n\nasync function loadBrickModule(\n  type: \"bricks\" | \"processors\",\n  pkgId: string,\n  itemName: string\n) {\n  const moduleName = `${\n    type === \"processors\" ? \"./processors/\" : \"./\"\n  }${itemName}`;\n  try {\n    await loadSharedModule(pkgId, moduleName);\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error(error);\n    throw new Error(\n      `Load ${type} of \"${pkgId.split(\"/\").pop()}.${moduleName\n        .split(\"/\")\n        .pop()}\" failed`\n    );\n  }\n}\n\nfunction loadRestBricks(\n  type: \"bricks\" | \"processors\",\n  pkgs: BrickPackage[],\n  itemsMap: Map<BrickPackage, string[]>\n) {\n  return pkgs.map(async (pkg) => {\n    await loadScript(pkg.filePath, window.PUBLIC_ROOT ?? \"\");\n    await waitBasicPkg;\n    return Promise.all(\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      itemsMap\n        .get(pkg)!\n        .map((itemName) => loadBrickModule(type, pkg.id, itemName))\n    );\n  });\n}\n\nasync function enqueueStableLoad(\n  type: \"bricks\" | \"processors\",\n  list: string[] | Set<string>,\n  brickPackages: BrickPackage[]\n): Promise<void> {\n  const brickPackagesMap = new Map<string, BrickPackage>();\n  for (const pkg of brickPackages) {\n    const pkgId = pkg.id ?? getPkgIdByFilePath(pkg.filePath);\n    brickPackagesMap.set(pkgId, pkg);\n  }\n\n  const itemsByPkg = getItemsByPkg(type, list, brickPackagesMap);\n\n  let foundBasicPkg: BrickPackage | undefined;\n  const v2Packages: BrickPackage[] = [];\n  const v3PackagesOtherThanBasic: BrickPackage[] = [];\n  let maybeV2Adapter: BrickPackage | undefined;\n  for (const pkg of itemsByPkg.keys()) {\n    if (pkg.id) {\n      if (pkg.id === \"bricks/basic\") {\n        foundBasicPkg = pkg;\n      } else {\n        v3PackagesOtherThanBasic.push(pkg);\n      }\n    } else {\n      // Brick packages of v2 has no `id`\n      v2Packages.push(pkg);\n      maybeV2Adapter = brickPackagesMap.get(\"bricks/v2-adapter\");\n      if (!maybeV2Adapter) {\n        // eslint-disable-next-line no-console\n        console.error(\"Using v2 bricks, but v2-adapter not found\");\n      }\n    }\n  }\n  const v2Adapter = maybeV2Adapter;\n\n  let basicPkgPromise: Promise<unknown> | undefined;\n  const basicPkg = foundBasicPkg;\n  if (basicPkg) {\n    const tempPromise = loadScript(basicPkg.filePath, window.PUBLIC_ROOT ?? \"\");\n    // Packages other than BASIC will wait for an extra micro-task tick.\n    if (!basicPkgWillBeResolved) {\n      basicPkgWillBeResolved = true;\n      tempPromise.then(() => Promise.resolve()).then(resolveBasicPkg);\n    }\n    basicPkgPromise = tempPromise.then(() =>\n      Promise.all(\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        itemsByPkg\n          .get(basicPkg)!\n          .map((itemName) => loadBrickModule(type, basicPkg.id, itemName))\n      )\n    );\n  }\n\n  const pkgPromises = [basicPkgPromise].concat(\n    loadRestBricks(type, v3PackagesOtherThanBasic, itemsByPkg)\n  );\n\n  if (v2Adapter && v2Packages.length > 0) {\n    if (!v2AdapterPromise) {\n      // Load `v2-adapter.load-bricks` and its dependencies\n      const v2AdapterItemsByPkg = getItemsByPkg(\n        \"bricks\",\n        [V2_ADAPTER_LOAD_BRICKS],\n        brickPackagesMap\n      );\n      const v2AdapterPackages = [...v2AdapterItemsByPkg.keys()];\n\n      const loadV2Adapter = async () => {\n        await Promise.all(\n          loadRestBricks(\"bricks\", v2AdapterPackages, v2AdapterItemsByPkg)\n        );\n        return document.createElement(\n          V2_ADAPTER_LOAD_BRICKS\n        ) as unknown as V2AdapterBrick;\n      };\n      v2AdapterPromise = loadV2Adapter();\n    }\n\n    pkgPromises.push(\n      v2AdapterPromise.then((adapter) =>\n        Promise.all(\n          v2Packages.map((pkg) => {\n            const pkgId = getPkgIdByFilePath(pkg.filePath);\n            const pkgNamespace = pkgId.split(\"/\")[1];\n            return adapter.resolve(\n              v2Adapter.filePath,\n              pkg.filePath,\n              type === \"bricks\"\n                ? // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                  itemsByPkg\n                    .get(pkg)!\n                    .map((itemName) => `${pkgNamespace}.${itemName}`)\n                : [],\n              (pkg as { dll?: string[] }).dll,\n              // Todo: remove `brickPackages` as an argument\n              brickPackages\n            );\n          })\n        )\n      )\n    );\n  }\n\n  await Promise.all(pkgPromises);\n}\n\nasync function dispatchRequestStatus(promise: Promise<unknown>) {\n  window.dispatchEvent(new Event(\"request.start\"));\n  try {\n    await promise;\n  } finally {\n    window.dispatchEvent(new Event(\"request.end\"));\n  }\n}\n\nfunction getProcessorPackageName(camelPackageName: string): string {\n  return camelPackageName\n    .replace(/[A-Z]/g, (match) => `-${match[0].toLocaleLowerCase()}`)\n    .replace(/_[0-9]/g, (match) => `-${match[1]}`);\n}\n\nfunction getPkgIdByFilePath(filePath: string) {\n  return filePath.split(\"/\").slice(0, 2).join(\"/\");\n}\n","declare const __webpack_init_sharing__: (scope: string) => Promise<unknown>;\ndeclare const __webpack_share_scopes__: Record<string, unknown>;\n\ninterface WebpackRuntimeContainer {\n  init(arg: unknown): Promise<unknown>;\n  get(module: string): Promise<Function>;\n}\n\n// https://github.com/module-federation/module-federation-examples/blob/eda9493f3991a423479fd834cfb1d7b241d9d1f0/advanced-api/dynamic-remotes/app1/src/App.js\nexport default async function loadSharedModule(scope: string, module: string) {\n  // Initializes the share scope. This fills it with known provided modules from this build and all remotes\n  await __webpack_init_sharing__(\"default\");\n  const container = (window as unknown as Record<string, unknown>)[\n    scope\n  ] as WebpackRuntimeContainer; // or get the container somewhere else\n  // Initialize the container, it may provide shared modules\n  await container.init(__webpack_share_scopes__.default);\n  const factory = await container.get(module);\n  return factory();\n}\n","/**\n * Get site's base path, generally will be `/next/` or `/`.\n */\nexport function getBasePath(): string {\n  const base = document.querySelector(\"base\");\n  const basePath = base ? (base.getAttribute(\"href\") as string) : \"/\";\n  return basePath;\n}\n","import type { RuntimeStoryboard } from \"@next-core/types\";\nimport { orderBy } from \"lodash\";\nimport { getRuntime } from \"./Runtime.js\";\n\nexport function matchStoryboard(\n  storyboards: RuntimeStoryboard[],\n  pathname: string\n): RuntimeStoryboard | undefined {\n  // Put apps with longer homepage before shorter ones.\n  // E.g., `/legacy/tool` will match first before `/legacy`.\n  // This enables two apps with relationship of parent-child of homepage.\n  const sortedStoryboards = orderBy(\n    storyboards,\n    (storyboard) => storyboard.app?.homepage?.length ?? 0,\n    \"desc\"\n  );\n  for (const storyboard of sortedStoryboards) {\n    const homepage = storyboard.app.homepage;\n    if (typeof homepage === \"string\" && homepage[0] === \"/\") {\n      if (\n        homepage === \"/\"\n          ? pathname === homepage\n          : `${pathname.replace(/\\/+$/, \"\")}/`.startsWith(\n              `${homepage.replace(/\\/+$/, \"\")}/`\n            )\n      ) {\n        return storyboard;\n      }\n    }\n  }\n}\n\n/**\n * We say it's an outside app when at least one of the below conditions are true:\n *   - target app is not found.\n *   - target app is not the current app.\n *   - current app is non-standalone mode and target app is standalone mode.\n *\n * Note: when current app is standalone mode, other apps will not be found.\n */\nexport function isOutsideApp(\n  storyboard: RuntimeStoryboard | undefined\n): boolean | undefined {\n  if (process.env.NODE_ENV === \"test\") {\n    return false;\n  }\n  return (\n    !storyboard ||\n    // Sometimes `storyboard.app.standaloneMode` is incorrect.\n    (getRuntime().getCurrentApp()?.id !== storyboard.app.id &&\n      !window.STANDALONE_MICRO_APPS &&\n      storyboard.app.standaloneMode)\n  );\n}\n","import { History, Location, createBrowserHistory } from \"history\";\nimport { getBasePath } from \"./getBasePath.js\";\nimport {\n  type ExtendedHistory,\n  getUserConfirmation,\n  historyExtended,\n  NextHistoryState,\n} from \"./internal/historyExtended.js\";\n\nexport type NextHistory = History<NextHistoryState> & ExtendedHistory;\n\nlet history: NextHistory;\n\nexport function createHistory(): NextHistory {\n  if (!history) {\n    // https://github.com/remix-run/history/issues/810\n    const browserHistory = createBrowserHistory<NextHistoryState>({\n      basename: getBasePath().replace(/\\/$/, \"\"),\n      getUserConfirmation,\n    });\n    Object.assign(browserHistory, historyExtended(browserHistory));\n    history = browserHistory as NextHistory;\n  }\n  return history;\n}\n\nexport function getHistory(): NextHistory {\n  return history;\n}\n\nexport type NextLocation = Location<NextHistoryState>;\n\nexport type { NextHistoryState };\n","import {\n  History,\n  LocationDescriptor,\n  LocationDescriptorObject,\n  parsePath,\n} from \"history\";\nimport { getBasePath } from \"../getBasePath.js\";\nimport { _internalApiMatchStoryboard } from \"./Runtime.js\";\nimport { isOutsideApp } from \"./matchStoryboard.js\";\n\nlet blocked = false;\nexport function getUserConfirmation(\n  message: string,\n  callback: (result: boolean) => void\n): void {\n  blocked = !confirm(message);\n  callback(!blocked);\n}\n\nexport function historyExtended(\n  browserHistory: History<NextHistoryState>\n): ExtendedHistory {\n  const { push: originalPush, replace: originalReplace } = browserHistory;\n\n  function push(\n    location: LocationDescriptor<NextHistoryState>,\n    state?: NextHistoryState,\n    callback?: (blocked: boolean) => void\n  ): void {\n    blocked = false;\n    originalPush(location, state);\n    callback?.(blocked);\n  }\n\n  function replace(\n    location: LocationDescriptor<NextHistoryState>,\n    state?: NextHistoryState,\n    callback?: (blocked: boolean) => void\n  ): void {\n    blocked = false;\n    originalReplace(location, state);\n    callback?.(blocked);\n  }\n\n  function updateQueryFactory(method: \"push\" | \"replace\"): UpdateQueryFunction {\n    return function updateQuery(query, options = {}, callback?): void {\n      const { extraQuery, clear, keepHash, ...state } = options;\n      const urlSearchParams = new URLSearchParams(\n        clear ? \"\" : browserHistory.location.search\n      );\n      const params: Record<string, string | string[]> = {};\n      Object.assign(params, query, extraQuery);\n      for (const [key, value] of Object.entries(params)) {\n        if (Array.isArray(value)) {\n          urlSearchParams.delete(key);\n          for (const item of value) {\n            urlSearchParams.append(key, item);\n          }\n        } else if (value === undefined || value === null || value === \"\") {\n          urlSearchParams.delete(key);\n        } else {\n          urlSearchParams.set(key, value);\n        }\n      }\n      (method === \"push\" ? push : replace)(\n        `?${urlSearchParams.toString()}${\n          keepHash ? browserHistory.location.hash : \"\"\n        }`,\n        state,\n        callback\n      );\n    };\n  }\n\n  function pushAnchor(\n    hash: string,\n    state?: NextHistoryState,\n    callback?: (blocked: boolean) => void\n  ): void {\n    push(\n      {\n        ...browserHistory.location,\n        key: undefined,\n        hash,\n        state: {\n          // The default notify is false\n          notify: false,\n          ...state,\n        },\n      },\n      undefined,\n      callback\n    );\n  }\n\n  function reload(callback?: (blocked: boolean) => void): void {\n    replace(\n      {\n        ...browserHistory.location,\n        state: {\n          ...browserHistory.location.state,\n          // Always notify\n          notify: true,\n        },\n      },\n      undefined,\n      callback\n    );\n  }\n\n  let blockMessage: string | undefined;\n\n  function setBlockMessage(message: string | undefined): void {\n    blockMessage = message;\n  }\n\n  function getBlockMessage(): string | undefined {\n    return blockMessage;\n  }\n\n  function unblock(): void {\n    blockMessage = undefined;\n  }\n\n  return {\n    pushQuery: updateQueryFactory(\"push\"),\n    replaceQuery: updateQueryFactory(\"replace\"),\n    pushAnchor: pushAnchor,\n    reload,\n    setBlockMessage,\n    getBlockMessage,\n    unblock,\n    ...historyOverridden({ ...browserHistory, push, replace }),\n  };\n}\n\n/**\n * Override history for standalone micro apps.\n *\n * when `push` or `replace` to other apps, force page refresh.\n */\nfunction historyOverridden(\n  browserHistory: History<NextHistoryState> &\n    Pick<ExtendedHistory, \"push\" | \"replace\">\n): Pick<ExtendedHistory, \"push\" | \"replace\"> {\n  const { push: originalPush, replace: originalReplace } = browserHistory;\n  function updateFactory(method: \"push\" | \"replace\"): ExtendedHistory[\"push\"] {\n    return function update(path, state?, callback?) {\n      let pathname: string | undefined;\n      const pathIsString = typeof path === \"string\";\n      if (pathIsString) {\n        pathname = parsePath(path).pathname;\n      } else {\n        pathname = path.pathname;\n      }\n\n      // When history.push or history.replace is performing with an absolute pathname,\n      // force load the target page when it is a page of an outside app.\n      if (\n        typeof pathname === \"string\" &&\n        pathname.startsWith(\"/\") &&\n        isOutsideApp(_internalApiMatchStoryboard(pathname))\n      ) {\n        // Going to outside apps.\n        return location[method === \"push\" ? \"assign\" : \"replace\"](\n          pathIsString\n            ? getBasePath() + path.substring(1)\n            : browserHistory.createHref(\n                path as LocationDescriptorObject<NextHistoryState>\n              )\n        );\n      }\n\n      return (method === \"push\" ? originalPush : originalReplace)(\n        path as string,\n        state,\n        callback\n      );\n    };\n  }\n  return {\n    push: updateFactory(\"push\"),\n    replace: updateFactory(\"replace\"),\n  };\n}\n\nexport interface NextHistoryState {\n  notify?: boolean;\n  from?: LocationDescriptor<NextHistoryState>;\n}\n\n/**\n * 扩展的系统会话对象。\n */\nexport interface ExtendedHistory {\n  /**\n   * 更新指定的 query 参数，会保留当前其它 query 参数，往浏览器会话历史栈中推入一条新记录。\n   */\n  pushQuery: UpdateQueryFunction;\n\n  /**\n   * 更新指定的 query 参数，会保留当前其它 query 参数，替换浏览器会话历史栈中最新的一条记录。\n   */\n  replaceQuery: UpdateQueryFunction;\n\n  /** {@inheritDoc UpdateAnchorFunction} */\n  pushAnchor: UpdateAnchorFunction;\n\n  /** 重载当前会话，即触发页面重新渲染。与 location.reload() 不同，它不会触发浏览器页面的重载。 */\n  reload: (callback?: (blocked: boolean) => void) => void;\n\n  /** @internal */\n  setBlockMessage: (message: string | undefined) => void;\n\n  /** @internal */\n  getBlockMessage: () => string | undefined;\n\n  /** 取消之前设置的阻止页面离开信息的设置。 */\n  unblock: () => void;\n\n  /** 推入一条记录。*/\n  push: (\n    location: LocationDescriptor<NextHistoryState>,\n    state?: NextHistoryState,\n    callback?: (blocked: boolean) => void\n  ) => void;\n\n  /** 替换一条记录。*/\n  replace: (\n    location: LocationDescriptor<NextHistoryState>,\n    state?: NextHistoryState,\n    callback?: (blocked: boolean) => void\n  ) => void;\n}\n\n/**\n * 更新指定的 query 参数。\n *\n * @param query - 要更新的 query 参数。\n * @param options - 选项。\n */\nexport type UpdateQueryFunction = (\n  query: Record<string, unknown>,\n  options?: UpdateQueryOptions,\n  callback?: (blocked: boolean) => void\n) => void;\n\n/** 更新 query 参数时的选项 */\nexport interface UpdateQueryOptions extends NextHistoryState {\n  /** 额外要更新的 query 参数。 */\n  extraQuery?: Record<string, unknown>;\n  /** 是否同时清除当前的所有其它 query 参数。 */\n  clear?: boolean;\n  /** 是否保留当前 hash 参数。 */\n  keepHash?: boolean;\n}\n\n/**\n * 设置指定的 anchor （URL hash）地址，此方法默认不会触发页面重新渲染。\n * 往浏览器会话历史栈中推入一条新记录。\n *\n * @param hash - Hash 地址。\n * @param state - 会话状态设置。\n */\nexport type UpdateAnchorFunction = (\n  hash: string,\n  state?: NextHistoryState,\n  callback?: (blocked: boolean) => void\n) => void;\n","import type {\n  RuntimeStoryboard,\n  BootstrapSettings,\n  FeatureFlags,\n  BootstrapData,\n  Contract,\n  Storyboard,\n  BrickConf,\n  RouteConf,\n  ResolveConf,\n} from \"@next-core/types\";\nimport { i18n, initializeI18n } from \"@next-core/i18n\";\nimport { loadBricksImperatively } from \"@next-core/loader\";\nimport { deepFreeze, isObject } from \"@next-core/utils/general\";\nimport type { PermissionApi_validatePermissions } from \"@next-api-sdk/micro-app-sdk\";\nimport moment from \"moment\";\nimport \"moment/locale/zh-cn.js\";\nimport { createHistory } from \"../history.js\";\nimport { matchStoryboard } from \"./matchStoryboard.js\";\nimport { Router } from \"./Router.js\";\nimport { NS, locales } from \"./i18n.js\";\nimport { loadNotificationService } from \"../Notification.js\";\nimport { loadDialogService } from \"../Dialog.js\";\nimport { injectedBrickPackages } from \"./injected.js\";\nimport type { AppForCheck } from \"./hasInstalledApp.js\";\nimport type { RuntimeContext } from \"./interfaces.js\";\n\nlet runtime: Runtime;\n\n// Allow inject bootstrap data in a runtime other than Brick Next.\nlet bootstrapData: BootstrapData | undefined;\nlet router: Router | undefined;\n\nexport interface RuntimeOptions {\n  hooks?: RuntimeHooks;\n}\n\nexport interface RuntimeHooks {\n  auth?: {\n    getAuth(): object;\n    isLoggedIn(): boolean;\n    authenticate?(...args: unknown[]): unknown;\n    logout?(...args: unknown[]): unknown;\n  };\n  fulfilStoryboard?: (storyboard: RuntimeStoryboard) => Promise<void>;\n  validatePermissions?: typeof PermissionApi_validatePermissions;\n  checkPermissions?: {\n    checkPermissions(...actions: string[]): boolean;\n    preCheckPermissions(storyboard: Storyboard): Promise<void> | undefined;\n    preCheckPermissionsForBrickOrRoute(\n      container: BrickConf | RouteConf,\n      asyncComputeRealValue: (value: unknown) => Promise<unknown>\n    ): Promise<void> | undefined;\n  };\n  checkInstalledApps?: {\n    preCheckInstalledApps(\n      storyboard: Storyboard,\n      hasAppInBootstrap: (appId: string) => boolean\n    ): void;\n    waitForCheckingApps(appIds: string[]): Promise<void>;\n    getCheckedApp(appId: string): AppForCheck | undefined;\n  };\n  flowApi?: {\n    FLOW_API_PROVIDER: string;\n    registerFlowApiProvider(): void;\n    isFlowApiProvider(provider: string): boolean;\n    getArgsOfFlowApi(\n      provider: string,\n      originalArgs: unknown[],\n      method?: string\n    ): Promise<unknown[]>;\n    collectContract(contracts: Contract[] | undefined): void;\n    collectWidgetContract(contracts: Contract[] | undefined): void;\n    clearCollectWidgetContract(): void;\n  };\n  menu?: {\n    getMenuById(menuId: string): unknown;\n    fetchMenuById(\n      menuId: string,\n      runtimeContext: RuntimeContext,\n      runtimeHelpers: RuntimeHooksMenuHelpers\n    ): Promise<unknown>;\n  };\n}\n\nexport interface RuntimeHooksMenuHelpers {\n  getStoryboardByAppId(appId: string): Storyboard | undefined;\n  resolveData(\n    resolveConf: ResolveConf,\n    runtimeContext: RuntimeContext\n  ): Promise<unknown>;\n  asyncComputeRealValue(\n    value: unknown,\n    runtimeContext: RuntimeContext,\n    options?: { ignoreSymbols?: boolean; noInject?: boolean }\n  ): Promise<unknown>;\n}\n\nexport let hooks: RuntimeHooks | undefined;\n\nexport function createRuntime(options?: RuntimeOptions) {\n  if (runtime) {\n    throw new Error(\"Cannot create multiple runtimes\");\n  }\n  hooks = options?.hooks;\n  initializeI18n(NS, locales);\n  moment.locale(i18n.language);\n  i18n.on(\"languageChanged\", () => {\n    moment.locale(i18n.language);\n  });\n  createHistory();\n  runtime = new Runtime();\n  return runtime;\n}\n\nexport function getRuntime() {\n  return runtime;\n}\n\nexport class Runtime {\n  #initialized = false;\n  #bootstrapped = false;\n\n  initialize(data: BootstrapData) {\n    if (this.#initialized) {\n      throw new Error(\"The runtime cannot be initialized more than once\");\n    }\n    this.#initialized = true;\n    normalizeBootstrapData(data);\n    bootstrapData = data;\n    const { notification, dialog } = (data.settings?.presetBricks ?? {}) as {\n      notification?: string | false;\n      dialog?: string | false;\n    };\n    if (notification !== false) {\n      loadNotificationService(\n        notification ?? \"shoelace.show-notification\",\n        this.loadBricks\n      );\n    }\n    if (dialog !== false) {\n      loadDialogService(dialog ?? \"shoelace.show-dialog\", this.loadBricks);\n    }\n  }\n\n  async bootstrap(data?: BootstrapData) {\n    if (data) {\n      this.initialize(data);\n    }\n    if (this.#bootstrapped) {\n      throw new Error(\"The runtime cannot be bootstrapped more than once\");\n    }\n    this.#bootstrapped = true;\n    router = new Router(bootstrapData!.storyboards!);\n    await router.bootstrap();\n  }\n\n  getRecentApps() {\n    return router?.getRecentApps() ?? {};\n  }\n\n  getCurrentApp() {\n    return router?.getRecentApps().currentApp;\n  }\n\n  getFeatureFlags(): FeatureFlags {\n    return {\n      ...bootstrapData?.settings?.featureFlags,\n      ...(\n        router?.getRecentApps().currentApp?.config\n          ?.settings as BootstrapSettings\n      )?.featureFlags,\n      \"migrate-to-brick-next-v3\": true,\n    };\n  }\n\n  getMiscSettings() {\n    return {\n      ...bootstrapData?.settings?.misc,\n      ...(\n        router?.getRecentApps().currentApp?.config\n          ?.settings as BootstrapSettings\n      )?.misc,\n    };\n  }\n\n  getBrandSettings(): Record<string, string> {\n    return {\n      base_title: \"DevOps 管理专家\",\n      ...(bootstrapData?.settings?.brand as Record<string, string>),\n    };\n  }\n\n  getLaunchpadSettings() {\n    return {\n      columns: 7,\n      rows: 4,\n      ...bootstrapData?.settings?.launchpad,\n    };\n  }\n\n  getDesktops(): unknown[] {\n    return bootstrapData?.desktops ?? [];\n  }\n\n  getLaunchpadSiteMap(): unknown[] {\n    return bootstrapData?.siteSort ?? [];\n  }\n\n  toggleLaunchpadEffect(open: boolean): void {\n    document.body.classList.toggle(\"launchpad-open\", open);\n  }\n\n  applyPageTitle(pageTitle: string): void {\n    const baseTitle = this.getBrandSettings().base_title;\n    document.title = pageTitle ? `${pageTitle} - ${baseTitle}` : baseTitle;\n  }\n\n  getNavConfig() {\n    return router?.getNavConfig();\n  }\n\n  loadBricks(bricks: string[] | Set<string>) {\n    return loadBricksImperatively(bricks, getBrickPackages());\n  }\n}\n\nfunction normalizeBootstrapData(data: BootstrapData) {\n  if (Array.isArray(data.storyboards)) {\n    for (const { app } of data.storyboards) {\n      if (app.locales) {\n        // Prefix to avoid conflict between brick package's i18n namespace.\n        const ns = `tmp/${app.id}`;\n        // Support any languages in `app.locales`.\n        Object.entries(app.locales).forEach(([lang, resources]) => {\n          i18n.addResourceBundle(lang, ns, resources);\n        });\n        // Use `app.name` as the fallback `app.localeName`.\n        app.localeName = i18n.getFixedT(null, ns)(\"name\", app.name) as string;\n        // Remove the temporary i18n resource bundles.\n        Object.keys(app.locales).forEach((lang) => {\n          i18n.removeResourceBundle(lang, ns);\n        });\n      } else {\n        app.localeName = app.name;\n      }\n    }\n  }\n  if (isObject(data.settings)) {\n    deepFreeze(data.settings);\n  }\n  if (data.brickPackages) {\n    deepFreeze(data.brickPackages);\n  }\n}\n\nexport function getBrickPackages() {\n  return bootstrapData?.brickPackages ?? injectedBrickPackages;\n}\n\nexport function _internalApiLoadBricks(bricks: string[] | Set<string>) {\n  return loadBricksImperatively(bricks, getBrickPackages());\n}\n\nexport function _internalApiGetRenderId(): string | undefined {\n  return router?.getRenderId();\n}\n\nexport function _internalApiMatchStoryboard(\n  pathname: string\n): RuntimeStoryboard | undefined {\n  return matchStoryboard(bootstrapData?.storyboards ?? [], pathname);\n}\n\nexport function _internalApiGetRuntimeContext() {\n  return router?.getRuntimeContext();\n}\n\nexport function _internalApiGetStoryboardInBootstrapData(appId: string) {\n  return bootstrapData?.storyboards?.find(\n    (storyboard) => storyboard.app.id === appId\n  );\n}\n\nexport function _internalApiGetAppInBootstrapData(appId: string) {\n  return _internalApiGetStoryboardInBootstrapData(appId)?.app;\n}\n\nexport let _test_only_setBootstrapData: (data: BootstrapData) => void;\n\n// istanbul ignore next\nif (process.env.NODE_ENV === \"test\") {\n  _test_only_setBootstrapData = (data) => {\n    bootstrapData = data as BootstrapData;\n  };\n}\n","class CustomProcessorRegistry {\n  readonly #registry = new Map<string, Map<string, Function>>();\n\n  define(processorFullName: string, processorFunc: Function) {\n    // `namespace` should be the camelCase of the package name.\n    const [namespace, processorName] = processorFullName.split(\".\");\n    let pkg = this.#registry.get(namespace);\n    if (!pkg) {\n      pkg = new Map();\n      this.#registry.set(namespace, pkg);\n    }\n    if (pkg.has(processorName)) {\n      // eslint-disable-next-line no-console\n      throw new Error(\n        `Custom processor of \"${processorFullName}\" already registered`\n      );\n    }\n    pkg.set(processorName, processorFunc);\n  }\n\n  get(namespace: string) {\n    return this.#registry.get(namespace);\n  }\n}\n\nexport const customProcessors = new CustomProcessorRegistry();\n","import { i18n } from \"@next-core/i18n\";\nimport { Storyboard } from \"@next-core/types\";\n\nexport function registerAppI18n({ app, meta }: Storyboard) {\n  if (meta?.i18n) {\n    // Prefix to avoid conflict between brick package's i18n namespace.\n    const i18nNamespace = getI18nNamespace(\"app\", app.id);\n    // Support any language in `meta.i18n`.\n    const languages: string[] = [];\n    Object.entries(meta.i18n).forEach(([lang, resources]) => {\n      i18n.addResourceBundle(lang, i18nNamespace, resources);\n      languages.push(lang);\n    });\n    return () => {\n      for (const lang of languages) {\n        i18n.removeResourceBundle(lang, i18nNamespace);\n      }\n    };\n  }\n}\n\nexport function getI18nNamespace(\n  type: \"app\" | \"widget\" | \"menu\",\n  id: string\n): string {\n  return `${type}/${id}`;\n}\n","// import i18next, { getFixedT, TFunction } from \"i18next\";\nimport { i18n } from \"@next-core/i18n\";\nimport type { MetaI18n } from \"@next-core/types\";\nimport { getI18nNamespace } from \"../registerAppI18n.js\";\n\nexport function registerWidgetI18n(widgetId: string, i18nData: MetaI18n): void {\n  const ns = getI18nNamespace(\"widget\", widgetId);\n  Object.entries(i18nData).forEach(([lang, resources]) => {\n    i18n.addResourceBundle(lang, ns, resources);\n  });\n}\n\nexport function widgetI18nFactory(widgetId: string) {\n  return i18n.getFixedT(null, getI18nNamespace(\"widget\", widgetId));\n}\n","import { escapeRegExp } from \"lodash\";\nimport { getBasePath } from \"../../getBasePath.js\";\n\nexport interface ImagesFactory {\n  get(name: string): string;\n}\n\nexport function imagesFactory(\n  appId: string,\n  isBuildPush?: boolean,\n  version?: string\n): ImagesFactory {\n  return {\n    get(name) {\n      if (isBuildPush) {\n        return `${getBasePath()}api/gateway/object_store.object_store.GetObject/api/v1/objectStore/bucket/next-builder/object/${name}`;\n      }\n\n      let suffix = window.APP_ROOT ? `${window.APP_ROOT}-/` : \"\";\n\n      // In injecting menus, the current app ID maybe not the same as the\n      // target app of the icon, try to replace the app ID as well as its\n      // version in the suffix.\n      if (window.APP_ID && window.APP_ID !== appId) {\n        suffix = suffix\n          .replace(\n            new RegExp(`(^|/)${escapeRegExp(window.APP_ID)}/`),\n            `$1${appId}/`\n          )\n          .replace(/\\/\\d+\\.\\d+\\.\\d+\\//, `/${version}/`);\n      }\n      if (!suffix.startsWith(\"/\")) {\n        suffix = getBasePath() + suffix;\n      }\n      return `${suffix}micro-apps/${appId}/images/${name}`;\n    },\n  };\n}\n\nexport function widgetImagesFactory(\n  widgetId: string,\n  widgetVersion?: string\n): ImagesFactory {\n  return {\n    get(name) {\n      return `${window.PUBLIC_ROOT ?? \"\"}bricks/${widgetId}/${\n        window.PUBLIC_ROOT_WITH_VERSION && widgetVersion\n          ? `${widgetVersion}/`\n          : \"\"\n      }dist/assets/${name}`;\n    },\n  };\n}\n","interface DevtoolsHookContainer {\n  __BRICK_NEXT_DEVTOOLS_HOOK__?: DevtoolsHook;\n}\n\ninterface DevtoolsHook {\n  emit: (message: unknown) => void;\n  restoreDehydrated: (value: unknown) => unknown;\n}\n\nexport function getDevHook(): DevtoolsHook | undefined {\n  return (window as DevtoolsHookContainer).__BRICK_NEXT_DEVTOOLS_HOOK__;\n}\n","import { getDevHook } from \"./devtools.js\";\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst THROW = (): any => {\n  throw new Error(\"Can't modify read-only proxy object\");\n};\n\nconst readOnlyHandler: ProxyHandler<object> = {\n  set: THROW,\n  defineProperty: THROW,\n  deleteProperty: THROW,\n  setPrototypeOf: THROW,\n};\n\nexport function getReadOnlyProxy<T extends object>(object: T): T {\n  return new Proxy<T>(object, readOnlyHandler);\n}\n\n// First, we want to make accessing property of globals lazy,\n// So we use *Proxy* to make a dynamic accessor for each of these globals.\n// But we also want to keep them working in devtools.\nexport function getDynamicReadOnlyProxy({\n  get,\n  ownKeys,\n}: Required<Pick<ProxyHandler<object>, \"get\" | \"ownKeys\">>): unknown {\n  if (getDevHook()) {\n    // In devtools, we extract them at beginning.\n    const target = Object.fromEntries(\n      (ownKeys(null!) as string[]).map((key) => [key, get(null!, key, null)])\n    );\n    return getReadOnlyProxy(target);\n  }\n  return new Proxy(Object.freeze({}), { get });\n}\n","import type { SiteMode, SiteTheme } from \"@next-core/types\";\nimport { JsonStorage } from \"@next-core/utils/general\";\n\ninterface AppThemes {\n  [appId: string]: SiteTheme;\n}\n\n// Themes.\nlet theme: SiteTheme = \"light\";\nconst storage = new JsonStorage<Record<string, AppThemes>>(localStorage);\nconst LOCAL_STORAGE_APPS_THEME_KEY = \"apps-theme\";\n\nexport function setTheme(value: SiteTheme): void {\n  if (value !== \"dark\" && value !== \"light\" && value !== \"dark-v2\") {\n    throw new Error(`Unsupported theme: ${value}`);\n  }\n  theme = value;\n}\n\nexport function getTheme(): SiteTheme {\n  return theme;\n}\n\nexport function getCurrentTheme(): SiteTheme {\n  return document.documentElement.dataset.theme as SiteTheme;\n}\n\nexport function applyTheme(value?: SiteTheme): void {\n  if (value) {\n    setTheme(value);\n  } else {\n    value = getTheme();\n  }\n  if (value !== getCurrentTheme()) {\n    document.documentElement.dataset.theme = value;\n    window.dispatchEvent(\n      new CustomEvent<SiteTheme>(\"theme.change\", {\n        detail: value,\n      })\n    );\n  }\n}\n\nexport function batchSetAppsLocalTheme(appsTheme: AppThemes): void {\n  storage.setItem(LOCAL_STORAGE_APPS_THEME_KEY, {\n    ...getLocalAppsTheme(),\n    ...appsTheme,\n  });\n}\n\nexport function getLocalAppsTheme(): AppThemes {\n  let result: AppThemes | undefined;\n  try {\n    result = storage.getItem(LOCAL_STORAGE_APPS_THEME_KEY);\n  } catch {\n    // eslint-disable-next-line no-console\n    console.error(\"JSON parse error inside `getLocalAppsTheme()`\");\n  }\n\n  return result ?? {};\n}\n\n// Modes.\nlet mode: SiteMode = \"default\";\n\nexport function setMode(value: SiteMode): void {\n  if (value !== \"dashboard\" && value !== \"default\") {\n    throw new Error(`Unsupported mode: ${value}`);\n  }\n  mode = value;\n}\n\nexport function getMode(): SiteMode {\n  return mode;\n}\n\nexport function getCurrentMode(): SiteMode {\n  return document.documentElement.dataset.mode as SiteMode;\n}\n\nexport function applyMode(value?: SiteMode): void {\n  if (value) {\n    setMode(value);\n  } else {\n    value = getMode();\n  }\n  if (value !== getCurrentMode()) {\n    document.documentElement.dataset.mode = value;\n    window.dispatchEvent(\n      new CustomEvent<SiteMode>(\"mode.change\", {\n        detail: value,\n      })\n    );\n  }\n}\n\nexport function getCssPropertyValue(\n  name: string,\n  el = document.documentElement\n): string {\n  if (!el) return \"\";\n  return window.getComputedStyle(el)?.getPropertyValue(name) || \"\";\n}\n","import { identity } from \"lodash\";\nimport type { MicroApp } from \"@next-core/types\";\nimport { i18n, i18nText } from \"@next-core/i18n\";\nimport { widgetI18nFactory } from \"./WidgetI18n.js\";\nimport { ImagesFactory, imagesFactory, widgetImagesFactory } from \"./images.js\";\nimport { getReadOnlyProxy } from \"../proxyFactories.js\";\nimport { getTheme } from \"../../themeAndMode.js\";\nimport { getBasePath } from \"../../getBasePath.js\";\nimport { getI18nNamespace } from \"../registerAppI18n.js\";\nimport { hooks } from \"../Runtime.js\";\n\nexport interface GeneralGlobalsOptions {\n  collectCoverage?: unknown;\n  widgetId?: string;\n  widgetVersion?: string;\n  app?: PartialMicroApp;\n  appendI18nNamespace?: string;\n  storyboardFunctions?: unknown;\n  isStoryboardFunction?: boolean;\n}\n\nexport type PartialMicroApp = Pick<MicroApp, \"id\" | \"isBuildPush\">;\n\n// `GeneralGlobals` are globals which are page-state-agnostic,\n// thus they can be used both in storyboard expressions and functions.\nexport function getGeneralGlobals(\n  attemptToVisitGlobals: Set<string>,\n  options: GeneralGlobalsOptions\n): Record<string, unknown> {\n  const globalVariables: Record<string, unknown> = {};\n  for (const variableName of attemptToVisitGlobals) {\n    const variable = getIndividualGlobal(variableName, options);\n    if (variable !== undefined) {\n      globalVariables[variableName] = variable;\n    }\n  }\n  return globalVariables;\n}\n\nfunction getIndividualGlobal(\n  variableName: string,\n  {\n    collectCoverage,\n    widgetId,\n    widgetVersion,\n    app,\n    appendI18nNamespace,\n    storyboardFunctions,\n    isStoryboardFunction,\n  }: GeneralGlobalsOptions\n): unknown {\n  switch (variableName) {\n    case \"BASE_URL\":\n      return collectCoverage ? \"/next\" : getBasePath().replace(/\\/$/, \"\");\n    case \"FN\":\n      return storyboardFunctions;\n    case \"IMG\":\n      return collectCoverage\n        ? fakeImageFactory()\n        : widgetId\n        ? widgetImagesFactory(widgetId, widgetVersion)\n        : imagesFactory(\n            app!.id,\n            app!.isBuildPush,\n            (app as { currentVersion?: string }).currentVersion\n          );\n    case \"I18N\":\n      return collectCoverage\n        ? identity\n        : widgetId\n        ? widgetI18nFactory(widgetId)\n        : i18n.getFixedT(\n            null,\n            [appendI18nNamespace, getI18nNamespace(\"app\", app!.id)].filter(\n              Boolean\n            ) as string[]\n          );\n    case \"I18N_TEXT\":\n      return collectCoverage ? fakeI18nText : i18nText;\n    case \"PERMISSIONS\":\n      return getReadOnlyProxy({\n        check: collectCoverage\n          ? fakeCheckPermissions\n          : hooks?.checkPermissions?.checkPermissions,\n      });\n    case \"THEME\":\n      return getReadOnlyProxy({\n        getTheme: collectCoverage ? () => \"light\" : getTheme,\n        // getCssPropertyValue: collectCoverage ? () => \"\" : getCssPropertyValue,\n      });\n    case \"console\":\n      return isStoryboardFunction ? getReadOnlyProxy(console) : undefined;\n    case \"location\":\n      return collectCoverage\n        ? {\n            href: \"http://localhost:3000/functions/test\",\n            origin: \"http://localhost:3000\",\n            host: \"localhost:3000\",\n            hostname: \"localhost\",\n          }\n        : {\n            href: location.href,\n            origin: location.origin,\n            host: location.host,\n            hostname: location.hostname,\n          };\n  }\n}\n\nfunction fakeI18nText(data: Record<string, string>): string {\n  return data?.en;\n}\n\nfunction fakeImageFactory(): ImagesFactory {\n  return {\n    get(name: string) {\n      return `mock/images/${name}`;\n    },\n  };\n}\n\nfunction fakeCheckPermissions(): boolean {\n  return true;\n}\n","import type { MicroApp, StoryboardFunction } from \"@next-core/types\";\nimport { cook, precookFunction, EstreeNode } from \"@next-core/cook\";\nimport { supply } from \"@next-core/supply\";\nimport { strictCollectMemberUsageInFunction } from \"@next-core/utils/storyboard\";\nimport { getGeneralGlobals } from \"./internal/compute/getGeneralGlobals.js\";\n\n/** @internal */\nexport type ReadonlyStoryboardFunctions = Readonly<Record<string, Function>>;\n\n/** @internal */\nexport type StoryboardFunctionPatch = Pick<\n  StoryboardFunction,\n  \"source\" | \"typescript\"\n>;\n\n/** @internal */\nexport interface StoryboardFunctionRegistry {\n  /** A readonly proxy for accessing cooked storyboard functions. */\n  storyboardFunctions: ReadonlyStoryboardFunctions;\n\n  /** Register storyboard functions. */\n  registerStoryboardFunctions(\n    functions: StoryboardFunction[] | undefined,\n    app?: PartialMicroApp\n  ): void;\n\n  /** Update a storyboard function during debugging. */\n  updateStoryboardFunction(name: string, data: StoryboardFunctionPatch): void;\n\n  checkPermissionsUsage(functionNames: string[]): boolean;\n}\n\n/** @internal */\nexport interface RuntimeStoryboardFunction {\n  source: string;\n  typescript?: boolean;\n  processed?: boolean;\n  cooked?: Function;\n  deps: Set<string>;\n  hasPermissionsCheck: boolean;\n}\n\n/** @internal */\nexport interface FunctionCoverageCollector {\n  beforeVisit(node: EstreeNode): void;\n  beforeEvaluate(node: EstreeNode): void;\n  beforeCall(node: EstreeNode): void;\n  beforeBranch(node: EstreeNode, branch: string): void;\n}\n\n/** @internal */\nexport interface FunctionCoverageSettings {\n  createCollector(name: string): FunctionCoverageCollector;\n}\n\n/** @internal */\nexport type PartialMicroApp = Pick<MicroApp, \"id\" | \"isBuildPush\">;\n\n/** @internal */\nexport function StoryboardFunctionRegistryFactory({\n  widgetId,\n  widgetVersion,\n  collectCoverage,\n}: {\n  widgetId?: string;\n  widgetVersion?: string;\n  collectCoverage?: FunctionCoverageSettings;\n} = {}): StoryboardFunctionRegistry {\n  const registeredFunctions = new Map<string, RuntimeStoryboardFunction>();\n\n  // Use `Proxy` with a frozen target, to make a readonly function registry.\n  const storyboardFunctions = new Proxy(Object.freeze({}), {\n    get(target, key) {\n      return getStoryboardFunction(key as string);\n    },\n  }) as ReadonlyStoryboardFunctions;\n\n  let currentApp: PartialMicroApp | undefined;\n\n  function registerStoryboardFunctions(\n    functions: StoryboardFunction[],\n    app?: PartialMicroApp\n  ): void {\n    if (app) {\n      currentApp = app;\n    }\n    registeredFunctions.clear();\n    if (Array.isArray(functions)) {\n      for (const fn of functions) {\n        const deps = strictCollectMemberUsageInFunction(fn, \"FN\");\n        const hasPermissionsCheck = strictCollectMemberUsageInFunction(\n          fn,\n          \"PERMISSIONS\"\n        ).has(\"check\");\n        registeredFunctions.set(fn.name, {\n          source: fn.source,\n          typescript: fn.typescript,\n          deps,\n          hasPermissionsCheck,\n        });\n      }\n    }\n  }\n\n  function getStoryboardFunction(name: string): Function | undefined {\n    const fn = registeredFunctions.get(name);\n    if (!fn) {\n      return undefined;\n    }\n    if (fn.processed) {\n      return fn.cooked;\n    }\n    let collector: FunctionCoverageCollector | undefined;\n    if (collectCoverage) {\n      collector = collectCoverage.createCollector(name);\n    }\n    const precooked = precookFunction(fn.source, {\n      typescript: fn.typescript,\n      hooks: collector && {\n        beforeVisit: collector.beforeVisit,\n      },\n    });\n    fn.cooked = cook(precooked.function, fn.source, {\n      rules: {\n        noVar: true,\n      },\n      globalVariables: supply(\n        precooked.attemptToVisitGlobals,\n        getGeneralGlobals(precooked.attemptToVisitGlobals, {\n          collectCoverage,\n          widgetId,\n          widgetVersion,\n          app: currentApp,\n          storyboardFunctions,\n          isStoryboardFunction: true,\n        }),\n        !!collectCoverage\n      ),\n      hooks: collector && {\n        beforeEvaluate: collector.beforeEvaluate,\n        beforeCall: collector.beforeCall,\n        beforeBranch: collector.beforeBranch,\n      },\n    }) as Function;\n    fn.processed = true;\n    return fn.cooked;\n  }\n\n  return {\n    storyboardFunctions,\n    registerStoryboardFunctions,\n    updateStoryboardFunction(\n      name: string,\n      data: StoryboardFunctionPatch\n    ): void {\n      const newFn = {\n        ...data,\n        name,\n      };\n      const deps = strictCollectMemberUsageInFunction(newFn, \"FN\");\n      const hasPermissionsCheck = strictCollectMemberUsageInFunction(\n        newFn,\n        \"PERMISSIONS\"\n      ).has(\"check\");\n      registeredFunctions.set(name, {\n        source: data.source,\n        typescript: data.typescript,\n        deps,\n        hasPermissionsCheck,\n      });\n    },\n    /**\n     * Check whether listed functions attempt to call `PERMISSIONS.check()`,\n     * includes in nested `FN.*()` calls.\n     */\n    checkPermissionsUsage(functionNames) {\n      const checkedFunctions = new Set<string>();\n      const hasPermissionsCheck = (name: string): boolean => {\n        if (!checkedFunctions.has(name)) {\n          checkedFunctions.add(name);\n          const fn = registeredFunctions.get(name);\n          return (\n            !!fn &&\n            (fn.hasPermissionsCheck || [...fn.deps].some(hasPermissionsCheck))\n          );\n        }\n        return false;\n      };\n      return functionNames.some(hasPermissionsCheck);\n    },\n  };\n}\n","import { StoryboardFunctionRegistryFactory } from \"../../StoryboardFunctionRegistry.js\";\n\nexport const {\n  storyboardFunctions,\n  registerStoryboardFunctions,\n  checkPermissionsUsage,\n} = StoryboardFunctionRegistryFactory();\n","import EventTarget from \"@ungap/event-target\";\n\nexport interface Media {\n  breakpoint?: MediaBreakpoint;\n}\n\nexport enum MediaBreakpoint {\n  xLarge = \"xLarge\",\n  large = \"large\",\n  medium = \"medium\",\n  small = \"small\",\n  xSmall = \"xSmall\",\n}\n\nexport const mediaBreakpointMinWidthMap = new Map<\n  MediaBreakpoint,\n  string | number\n>([\n  [MediaBreakpoint.xLarge, \"1920px\"],\n  [MediaBreakpoint.large, \"1600px\"],\n  [MediaBreakpoint.medium, \"1280px\"],\n  [MediaBreakpoint.small, \"1024px\"],\n  [MediaBreakpoint.xSmall, 0],\n]);\nexport const mediaEventTarget = new EventTarget();\n\nconst breakpointMatchesMap: Partial<Record<MediaBreakpoint, boolean>> = {};\nconst MEDIA: Media = {};\n\nfunction handleMatchesChange(\n  data: { readonly matches: boolean; readonly media: string },\n  breakpoint: MediaBreakpoint\n): void {\n  let changed = false;\n  breakpointMatchesMap[breakpoint] = data.matches;\n\n  for (const [breakpoint] of mediaBreakpointMinWidthMap) {\n    if (breakpointMatchesMap[breakpoint] && MEDIA.breakpoint !== breakpoint) {\n      MEDIA.breakpoint = breakpoint;\n      changed = true;\n      break;\n    }\n  }\n\n  if (changed) {\n    mediaEventTarget.dispatchEvent(\n      new CustomEvent(\"change\", { detail: MEDIA })\n    );\n  }\n}\n\nmediaBreakpointMinWidthMap.forEach((minWidth, breakpoint) => {\n  const mediaQueryList = window.matchMedia(`(min-width: ${minWidth})`);\n\n  handleMatchesChange(mediaQueryList, breakpoint);\n\n  if (mediaQueryList.addEventListener) {\n    mediaQueryList.addEventListener(\"change\", (event) => {\n      handleMatchesChange(event, breakpoint);\n    });\n  } else {\n    mediaQueryList.addListener((event) => {\n      handleMatchesChange(event, breakpoint);\n    });\n  }\n});\n\nexport const getMedia = (): Media => MEDIA;\n","export function getStorageItem(storageType: \"local\" | \"session\") {\n  return function (name: string) {\n    const storage = storageType === \"local\" ? localStorage : sessionStorage;\n    return JSON.parse(storage.getItem(name) ?? \"null\");\n  };\n}\n","import { getRuntime } from \"./index.js\";\nimport type { RuntimeContext } from \"./internal/interfaces.js\";\n\nexport function isStrictMode(runtimeContext?: RuntimeContext) {\n  return !!(\n    runtimeContext ? runtimeContext.flags : getRuntime()?.getFeatureFlags()\n  )?.[\"brick-next-v3-strict-mode\"];\n}\n\nexport function warnAboutStrictMode(\n  strict: boolean,\n  message: string,\n  ...extraLogs: unknown[]\n) {\n  const punctuation = extraLogs.length === 0 ? \"\" : \",\";\n  if (strict) {\n    // eslint-disable-next-line no-console\n    console.error(\n      `${message} is dropped in v3 strict mode${punctuation}`,\n      ...extraLogs\n    );\n  } else {\n    // eslint-disable-next-line no-console\n    console.warn(\n      `${message} is deprecated in v3 and will be dropped in strict mode${punctuation}`,\n      ...extraLogs\n    );\n  }\n}\n","import type {\n  ContextConf,\n  CustomTemplate,\n  CustomTemplateConstructor,\n  CustomTemplateProxyBasicProperty,\n} from \"@next-core/types\";\nimport { uniq } from \"lodash\";\nimport type { RuntimeBrickElement } from \"./internal/interfaces.js\";\nimport { isStrictMode, warnAboutStrictMode } from \"./isStrictMode.js\";\n\n// Note: `prefix` is a native prop on Element, but it's only used in XML documents.\nconst allowedNativeProps = new Set([\"prefix\"]);\n\ninterface LegacyTplPropProxy extends CustomTemplateProxyBasicProperty {\n  asVariable?: boolean;\n  mergeProperty?: unknown;\n  refTransform?: unknown;\n}\n\nclass CustomTemplateRegistry {\n  readonly #registry = new Map<string, CustomTemplate>();\n\n  define(tagName: string, constructor: CustomTemplateConstructor): void {\n    let registered = this.#registry.has(tagName);\n    if (registered) {\n      // When open launchpad, the storyboard will be updated.\n      // However, we can't *undefine* a custom element.\n      // Just ignore re-registering custom templates.\n      // eslint-disable-next-line no-console\n      console.warn(`Custom template of \"${tagName}\" already registered.`);\n    } else {\n      registered = !!customElements.get(tagName);\n      if (registered) {\n        // eslint-disable-next-line no-console\n        console.warn(\n          `Custom template of \"${tagName}\" already defined by customElements.`\n        );\n      }\n    }\n\n    // Transform legacy `proxy.properties[].asVariable` as states.\n    const strict = isStrictMode();\n    const proxyProperties = (constructor.proxy?.properties ?? {}) as {\n      [name: string]: LegacyTplPropProxy;\n    };\n    const validProxyProps: [string, CustomTemplateProxyBasicProperty][] = [];\n    const legacyTplVariables: string[] = [];\n    for (const [key, value] of Object.entries(proxyProperties)) {\n      if (value.asVariable) {\n        warnAboutStrictMode(strict, \"Template `asVariable`\", tagName, key);\n        // istanbul ignore next\n        if (!strict) {\n          // For existed TPL usage, treat it as a STATE.\n          legacyTplVariables.push(key);\n        }\n      } else if (value.mergeProperty || value.refTransform) {\n        // eslint-disable-next-line no-console\n        console.error(\n          \"Template `mergeProperty` and `refTransform` are dropped in v3:\",\n          tagName,\n          key\n        );\n      } else if (value.ref) {\n        validProxyProps.push([key, value]);\n      }\n      // Else: documentation only, for exposed states.\n    }\n\n    const compatibleConstructor = {\n      ...constructor,\n      proxy: {\n        ...constructor.proxy,\n        properties: Object.fromEntries(validProxyProps),\n      },\n      state: (constructor.state\n        ? strict\n          ? constructor.state\n          : constructor.state.map((item) => ({\n              // Make `expose` defaults to true in non-strict mode.\n              expose: true,\n              ...item,\n            }))\n        : []\n      ).concat(legacyTplVariables.map((tpl) => ({ name: tpl, expose: true }))),\n    };\n\n    // Now we allow re-register custom template\n    this.#registry.set(tagName, {\n      ...compatibleConstructor,\n      name: tagName,\n    });\n\n    const exposedStates = getExposedStates(compatibleConstructor.state);\n    const proxyMethods = Object.entries(\n      compatibleConstructor.proxy?.methods ?? {}\n    );\n\n    const props = exposedStates.concat(\n      validProxyProps.map((entry) => entry[0])\n    );\n    const methods = proxyMethods.map((entry) => entry[0]);\n\n    const nativeProps = props\n      .concat(methods)\n      .filter(\n        (prop) => prop in HTMLElement.prototype && !allowedNativeProps.has(prop)\n      );\n    if (nativeProps.length > 0) {\n      warnAboutStrictMode(\n        strict,\n        \"Using native HTMLElement properties as template properties or methods\",\n        tagName,\n        ...nativeProps\n      );\n      // istanbul ignore next\n      if (strict) {\n        throw new Error(\n          `In custom template \"${tagName}\", ${nativeProps\n            .map((p) => `\"${p}\"`)\n            .join(\n              \", \"\n            )} are native HTMLElement properties, and should be avoid to be used as brick properties or methods.`\n        );\n      }\n    }\n\n    if (registered) {\n      return;\n    }\n\n    class TplElement extends HTMLElement {\n      get $$typeof() {\n        return \"custom-template\" as const;\n      }\n\n      static get _dev_only_definedProperties(): string[] {\n        return props;\n      }\n\n      static get _dev_only_definedMethods(): string[] {\n        return methods;\n      }\n\n      $$getElementByRef(this: RuntimeBrickElement, ref: string) {\n        return this.$$tplStateStore?.hostBrick?.tplHostMetadata?.internalBricksByRef.get(\n          ref\n        )?.element;\n      }\n\n      connectedCallback() {\n        let shadowRoot = this.shadowRoot;\n        if (!shadowRoot) {\n          shadowRoot = this.attachShadow({ mode: \"open\" });\n        }\n        const fragment = document.createDocumentFragment();\n        const style = document.createElement(\"style\");\n        style.textContent = \":host{display:block}:host([hidden]){display:none}\";\n        const slot = document.createElement(\"slot\");\n        fragment.appendChild(style);\n        fragment.appendChild(slot);\n        shadowRoot.appendChild(fragment);\n      }\n\n      disconnectedCallback() {\n        if (this.shadowRoot) {\n          this.shadowRoot.textContent = \"\";\n        }\n      }\n    }\n\n    for (const propName of exposedStates) {\n      if (validProxyProps.some((entry) => entry[0] === propName)) {\n        // eslint-disable-next-line no-console\n        console.error(\n          `Cannot define an exposed state that is also a proxy property: \"${propName}\" in ${tagName}`\n        );\n        continue;\n      }\n      Object.defineProperty(TplElement.prototype, propName, {\n        get(this: RuntimeBrickElement) {\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          return this.$$tplStateStore!.getValue(propName);\n        },\n        set(this: RuntimeBrickElement, value: unknown) {\n          // 在 mount 过程中，先设置属性，再设置 `$$tplStateStore`，这样，当触发属性设置时，\n          // 避免初始化的一次 state update 操作及其 onChange 事件。\n          this.$$tplStateStore?.updateValue(propName, value, \"replace\");\n        },\n        enumerable: true,\n      });\n    }\n\n    for (const [from, to] of validProxyProps) {\n      Object.defineProperty(TplElement.prototype, from, {\n        get(this: TplElement) {\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          const element = this.$$getElementByRef!(to.ref) as unknown as Record<\n            string,\n            unknown\n          >;\n          return element[to.refProperty ?? from];\n        },\n        set(this: TplElement, value: unknown) {\n          // 同上 exposedState.set\n          const element = this.$$getElementByRef?.(to.ref) as unknown as Record<\n            string,\n            unknown\n          >;\n          if (element) {\n            element[to.refProperty ?? from] = value;\n          }\n        },\n        enumerable: true,\n      });\n    }\n\n    for (const [from, to] of proxyMethods) {\n      Object.defineProperty(TplElement.prototype, from, {\n        value(this: TplElement, ...args: unknown[]) {\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          const element = this.$$getElementByRef!(to.ref) as unknown as Record<\n            string,\n            Function\n          >;\n          element[to.refMethod ?? from](...args);\n        },\n        enumerable: true,\n      });\n    }\n\n    customElements.define(tagName, TplElement);\n  }\n\n  get(tagName: string) {\n    return this.#registry.get(tagName);\n  }\n}\n\nexport const customTemplates = new CustomTemplateRegistry();\n\nfunction getExposedStates(state: ContextConf[] | undefined): string[] {\n  // Allow duplicated state names which maybe mutually exclusive.\n  return uniq(\n    state?.filter((item) => item.expose).map((item) => item.name) ?? []\n  );\n}\n","import type { DataStore } from \"../data/DataStore.js\";\nimport type { RuntimeBrickElement, RuntimeContext } from \"../interfaces.js\";\nimport { customTemplates } from \"../../CustomTemplates.js\";\n\ntype MinimalTplStateStoreContext = Pick<\n  RuntimeContext,\n  \"tplStateStoreId\" | \"tplStateStoreMap\"\n>;\n\nexport function getTplStateStore(\n  { tplStateStoreId, tplStateStoreMap }: MinimalTplStateStoreContext,\n  using: string,\n  extraInfo?: string\n): DataStore<\"STATE\"> {\n  if (!tplStateStoreId) {\n    throw new Error(\n      `Using \"${using}\" outside of a custom template${extraInfo ?? \"\"}`\n    );\n  }\n  const store = tplStateStoreMap.get(tplStateStoreId);\n  if (!store) {\n    throw new Error(\n      `Template state store is not found when using \"${using}\"${\n        extraInfo ?? \"\"\n      }.\\nThis is a bug of Brick Next, please report it.`\n    );\n  }\n  return store;\n}\n\nexport function getTplHostElement(\n  runtimeContext: MinimalTplStateStoreContext,\n  using: string,\n  extraInfo?: string\n): RuntimeBrickElement {\n  const store = getTplStateStore(runtimeContext, using, extraInfo);\n  const hostElement = store.hostBrick!.element;\n  if (!hostElement) {\n    throw new Error(\n      `Template host element is gone when using \"${using}\"${\n        extraInfo ?? \"\"\n      }.\\nThis is a bug of Brick Next, please report it.`\n    );\n  }\n  return hostElement;\n}\n\nexport function getTagNameOfCustomTemplate(\n  brick: string,\n  appId?: string\n): false | string {\n  // When a template is registered by an app, it's namespace maybe missed.\n  if (!brick.includes(\".\") && brick.startsWith(\"tpl-\") && appId) {\n    const tagName = `${appId}.${brick}`;\n    if (customTemplates.get(tagName)) {\n      return tagName;\n    }\n  }\n  if (customTemplates.get(brick)) {\n    return brick;\n  }\n  return false;\n}\n","import { StoryboardFunction } from \"@next-core/types\";\nimport {\n  ReadonlyStoryboardFunctions,\n  StoryboardFunctionRegistryFactory,\n} from \"../../StoryboardFunctionRegistry.js\";\n\nconst widgetFunctionRegistry = new Map<string, ReadonlyStoryboardFunctions>();\n\nexport const widgetFunctions = new Proxy(Object.freeze({}), {\n  get(target, key: string) {\n    return widgetFunctionRegistry.get(key);\n  },\n}) as Readonly<Record<string, ReadonlyStoryboardFunctions>>;\n\nexport function registerWidgetFunctions(\n  widgetId: string,\n  functions: StoryboardFunction[],\n  widgetVersion?: string\n): void {\n  if (widgetFunctionRegistry.has(widgetId)) {\n    // eslint-disable-next-line no-console\n    throw new Error(`Widget functions of \"${widgetId}\" already registered`);\n  }\n  const { storyboardFunctions, registerStoryboardFunctions } =\n    StoryboardFunctionRegistryFactory({ widgetId, widgetVersion });\n  widgetFunctionRegistry.set(widgetId, storyboardFunctions);\n  registerStoryboardFunctions(functions);\n}\n","import type { MicroApp } from \"@next-core/types\";\nimport { type CompareOperator, compare } from \"compare-versions\";\nimport { _internalApiGetAppInBootstrapData, hooks } from \"./Runtime.js\";\n\nexport type AppForCheck = Pick<\n  MicroApp,\n  \"id\" | \"currentVersion\" | \"installStatus\"\n>;\n\nexport function hasInstalledApp(appId: string, matchVersion?: string): boolean {\n  // First, check whether the app is in bootstrap already.\n  let app = _internalApiGetAppInBootstrapData(appId) as AppForCheck | undefined;\n  if (!app && hooks?.checkInstalledApps) {\n    app = hooks.checkInstalledApps.getCheckedApp(appId);\n  }\n  if (!app || app.installStatus === \"running\") {\n    return false;\n  }\n  // Todo: `currentVersion` maybe `\"\"`\n  if (!matchVersion || !app.currentVersion) {\n    return true;\n  }\n  // Valid `matchVersion`:\n  //   >=1.2.3\n  //   >1.2.3\n  //   =1.2.3\n  //   <=1.2.3\n  //   <1.2.3\n  const matches = matchVersion.match(/^([><]=?|=)(.*)$/);\n  try {\n    if (!matches) {\n      throw new TypeError(`Invalid match version: ${matchVersion}`);\n    }\n    return compare(\n      app.currentVersion,\n      matches[2],\n      matches[1] as CompareOperator\n    );\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error(error);\n  }\n  return false;\n}\n","import type { DataStore } from \"../data/DataStore.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\n\ntype MinimalTplStateStoreContext = Pick<\n  RuntimeContext,\n  \"formStateStoreId\" | \"formStateStoreMap\"\n>;\n\nexport function getFormStateStore(\n  { formStateStoreId, formStateStoreMap }: MinimalTplStateStoreContext,\n  using: string,\n  extraInfo?: string\n): DataStore<\"FORM_STATE\"> {\n  if (!formStateStoreId) {\n    throw new Error(\n      `Using \"${using}\" outside of form renderer${extraInfo ?? \"\"}`\n    );\n  }\n  const store = formStateStoreMap.get(formStateStoreId);\n  if (!store) {\n    throw new Error(\n      `Form state store is not found when using \"${using}\"${\n        extraInfo ?? \"\"\n      }.\\nThis is a bug of Brick Next, please report it.`\n    );\n  }\n  return store;\n}\n","import { loadBricksImperatively } from \"@next-core/loader\";\nimport { getBrickPackages, hooks } from \"../Runtime.js\";\n\nconst pool = new Map<string, HTMLElement>();\nexport async function getProviderBrick(provider: string): Promise<HTMLElement> {\n  const isFlowApi = hooks?.flowApi?.isFlowApiProvider(provider);\n  if (isFlowApi) {\n    provider = hooks!.flowApi!.FLOW_API_PROVIDER;\n  }\n\n  let brick = pool.get(provider);\n  if (brick) {\n    return brick;\n  }\n\n  if (provider.includes(\"-\") && !customElements.get(provider)) {\n    if (isFlowApi) {\n      hooks!.flowApi!.registerFlowApiProvider();\n    } else {\n      await loadBricksImperatively([provider], getBrickPackages());\n\n      if (!customElements.get(provider)) {\n        throw new Error(`Provider not defined: \"${provider}\".`);\n      }\n    }\n  }\n\n  brick = document.createElement(provider);\n  pool.set(provider, brick);\n  return brick;\n}\n","import type {\n  HandleReject,\n  HandleRejectByTransform,\n  ResolveConf,\n} from \"@next-core/types\";\nimport { asyncComputeRealValue } from \"../compute/computeRealValue.js\";\nimport { getProviderBrick } from \"./getProviderBrick.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\nimport { hooks } from \"../Runtime.js\";\n\nconst cache = new Map<string, Promise<unknown>>();\n\nexport interface ResolveOptions {\n  /**\n   * Cache mode of resolve.\n   *\n   * See https://developer.mozilla.org/en-US/docs/Web/API/Request/cache\n   *\n   * - `default`: Looks for a matching cache.\n   * - `reload`: Without looking for a matching cache.\n   */\n  cache?: \"default\" | \"reload\";\n}\n\nexport async function resolveData(\n  resolveConf: ResolveConf,\n  runtimeContext: RuntimeContext,\n  options?: ResolveOptions\n) {\n  const { useProvider, method = \"resolve\", args = [], onReject } = resolveConf;\n\n  const legacyProvider = (resolveConf as { provider?: string }).provider;\n  if (legacyProvider && !useProvider) {\n    throw new Error(\n      `You're using \"provider: ${legacyProvider}\" which is dropped in v3, please use \"useProvider\" instead`\n    );\n  }\n\n  const [providerBrick, actualArgs] = await Promise.all([\n    getProviderBrick(useProvider) as unknown as Promise<\n      Record<string, Function>\n    >,\n    asyncComputeRealValue(args, runtimeContext) as Promise<unknown[]>,\n  ]);\n\n  const promise = resolveByProvider(\n    providerBrick,\n    useProvider,\n    method,\n    actualArgs,\n    options,\n    args\n  );\n\n  let { transform } = resolveConf;\n  let data: unknown;\n\n  try {\n    data = await promise;\n    // The fetched data and its inner objects should never be *injected* again.\n    // recursiveMarkAsInjected(data);\n  } catch (error) {\n    if (isHandleRejectByTransform(onReject)) {\n      transform = onReject.transform;\n      data = error;\n    } else {\n      throw error;\n    }\n  }\n\n  if (!transform) {\n    return data;\n  }\n\n  // Keep backward compatibility of string transform.\n  if (typeof transform === \"string\") {\n    return { [transform]: data };\n  }\n\n  return asyncComputeRealValue(transform, { ...runtimeContext, data });\n}\n\nexport function clearResolveCache() {\n  cache.clear();\n}\n\nexport async function resolveByProvider(\n  brick: Record<string, Function>,\n  useProvider: string,\n  method: string,\n  args: unknown[],\n  options?: ResolveOptions,\n  originalArgs?: unknown[]\n) {\n  let cacheKey: string;\n  try {\n    // `args` may contain circular references, which makes\n    // JSON stringify failed, thus we fallback to original args.\n    cacheKey = JSON.stringify({\n      useProvider,\n      method,\n      args,\n    });\n  } catch (e) {\n    if (!originalArgs) {\n      throw e;\n    }\n    cacheKey = JSON.stringify({\n      useProvider,\n      method,\n      originalArgs,\n    });\n  }\n\n  let promise: Promise<unknown> | undefined;\n  if (options?.cache !== \"reload\") {\n    promise = cache.get(cacheKey);\n  }\n  if (!promise) {\n    promise = (async () => {\n      const finalArgs = hooks?.flowApi?.isFlowApiProvider(useProvider)\n        ? await hooks.flowApi.getArgsOfFlowApi(useProvider, args, method)\n        : args;\n      return brick.resolve(...finalArgs);\n    })();\n\n    cache.set(cacheKey, promise);\n  }\n\n  return promise;\n}\n\nfunction isHandleRejectByTransform(\n  onReject: HandleReject | undefined\n): onReject is HandleRejectByTransform {\n  return !!(onReject as HandleRejectByTransform)?.transform;\n}\n","import {\n  cook,\n  preevaluate,\n  PreevaluateResult,\n  shouldAllowRecursiveEvaluations,\n} from \"@next-core/cook\";\nimport { loadProcessorsImperatively } from \"@next-core/loader\";\nimport { supply } from \"@next-core/supply\";\nimport { hasOwnProperty } from \"@next-core/utils/general\";\nimport {\n  strictCollectMemberUsage,\n  collectAppGetMenuUsage,\n  collectInstalledAppsHasUsage,\n  MemberCallUsage,\n} from \"@next-core/utils/storyboard\";\nimport type { RuntimeContext } from \"../interfaces.js\";\nimport { cloneDeep, omit } from \"lodash\";\nimport { customProcessors } from \"../../CustomProcessors.js\";\nimport {\n  checkPermissionsUsage,\n  storyboardFunctions,\n} from \"./StoryboardFunctions.js\";\nimport { getGeneralGlobals } from \"./getGeneralGlobals.js\";\nimport {\n  getDynamicReadOnlyProxy,\n  getReadOnlyProxy,\n} from \"../proxyFactories.js\";\nimport { getDevHook } from \"../devtools.js\";\nimport { getMedia } from \"../mediaQuery.js\";\nimport { getStorageItem } from \"./getStorageItem.js\";\nimport {\n  _internalApiGetStoryboardInBootstrapData,\n  getBrickPackages,\n  getRuntime,\n  hooks,\n} from \"../Runtime.js\";\nimport type { DataStore } from \"../data/DataStore.js\";\nimport { getTplStateStore } from \"../CustomTemplates/utils.js\";\nimport { widgetFunctions } from \"./WidgetFunctions.js\";\nimport { widgetI18nFactory } from \"./WidgetI18n.js\";\nimport { widgetImagesFactory } from \"./images.js\";\nimport { hasInstalledApp } from \"../hasInstalledApp.js\";\nimport { isStrictMode, warnAboutStrictMode } from \"../../isStrictMode.js\";\nimport { getFormStateStore } from \"../FormRenderer/utils.js\";\nimport { resolveData } from \"../data/resolveData.js\";\nimport { asyncComputeRealValue } from \"./computeRealValue.js\";\n\nconst symbolForRaw = Symbol.for(\"pre.evaluated.raw\");\nconst symbolForContext = Symbol.for(\"pre.evaluated.context\");\n\nexport interface PreEvaluated {\n  [symbolForRaw]: string;\n  [symbolForContext]: RuntimeContext;\n}\n\nexport interface EvaluateOptions {\n  lazy?: boolean;\n  isReEvaluation?: boolean;\n  evaluationId?: number;\n}\n\nexport function isPreEvaluated(raw: unknown): raw is PreEvaluated {\n  return !!(raw as PreEvaluated)?.[symbolForRaw];\n}\n\nexport function getPreEvaluatedRaw(pre: PreEvaluated): string {\n  return pre[symbolForRaw];\n}\n\nexport function shouldDismissMarkingComputed(\n  raw: string | PreEvaluated\n): boolean {\n  if (typeof raw === \"string\") {\n    return shouldAllowRecursiveEvaluations(raw);\n  }\n  return shouldAllowRecursiveEvaluations(raw[symbolForRaw]);\n}\n\nconst possibleErrorConstructs = new WeakSet<ErrorConstructor>([\n  SyntaxError,\n  TypeError,\n  ReferenceError,\n]);\n\nexport function getCookErrorConstructor(error: any): ErrorConstructor {\n  return possibleErrorConstructs.has(error.constructor)\n    ? error.constructor\n    : TypeError;\n}\n\nexport async function asyncEvaluate(\n  raw: string | PreEvaluated, // string or pre-evaluated object.\n  runtimeContext: RuntimeContext,\n  options?: EvaluateOptions\n): Promise<unknown> {\n  const { blockingList, run } = lowLevelEvaluate(\n    raw,\n    runtimeContext,\n    options,\n    true\n  );\n  await Promise.all(blockingList);\n  return run();\n}\n\nexport function evaluate(\n  raw: string | PreEvaluated, // string or pre-evaluated object.\n  runtimeContext: RuntimeContext,\n  options?: EvaluateOptions\n): Promise<unknown> {\n  const { run } = lowLevelEvaluate(raw, runtimeContext, options, false);\n  return run();\n}\n\nfunction lowLevelEvaluate(\n  raw: string | PreEvaluated, // string or pre-evaluated object.\n  runtimeContext: RuntimeContext,\n  options: EvaluateOptions = {},\n  isAsync?: boolean\n): {\n  blockingList: (Promise<unknown> | undefined)[];\n  run: Function;\n} {\n  const blockingList: (Promise<unknown> | undefined)[] = [];\n  if (typeof raw !== \"string\") {\n    // If the `raw` is not a string, it must be a pre-evaluated object.\n    // Then fulfil the context, and restore the original `raw`.\n\n    const passByRuntimeContext = omit(runtimeContext, [\n      \"pendingPermissionsPreCheck\",\n      \"tplStateStoreMap\",\n      \"tplStateStoreScope\",\n      \"formStateStoreMap\",\n      \"formStateStoreScope\",\n    ]);\n\n    runtimeContext = {\n      ...raw[symbolForContext],\n      ...passByRuntimeContext,\n    };\n    raw = raw[symbolForRaw];\n  }\n\n  // Collect `APP.getMenu(...)` usage before evaluating.\n  const menuUsage: MemberCallUsage = {\n    usedArgs: new Set(),\n  };\n  const hasAppUsage: MemberCallUsage = {\n    usedArgs: new Set(),\n  };\n\n  // A `SyntaxError` maybe thrown.\n  let precooked: PreevaluateResult;\n  try {\n    precooked = preevaluate(raw, {\n      withParent: true,\n      hooks: {\n        beforeVisitGlobal(node, parent) {\n          collectAppGetMenuUsage(menuUsage, node, parent!);\n          collectInstalledAppsHasUsage(hasAppUsage, node, parent!);\n        },\n      },\n    });\n  } catch (error: any) {\n    const message = `${error.message}, in \"${raw}\"`;\n    // if (options.isReEvaluation) {\n    //   devtoolsHookEmit(\"re-evaluation\", {\n    //     id: options.evaluationId,\n    //     detail: { raw, context: {} },\n    //     error: message,\n    //   });\n    //   return;\n    // } else {\n    const errorConstructor = getCookErrorConstructor(error);\n    throw new errorConstructor(message);\n    // }\n  }\n\n  if (menuUsage.hasNonStaticUsage) {\n    throw new Error(\n      `Non-static usage of \"APP.getMenu\" is prohibited in v3, check your expression: \"${raw}\"`\n    );\n  }\n\n  if (hasAppUsage.hasNonStaticUsage) {\n    throw new Error(\n      `Non-static usage of \"INSTALLED_APPS.has\" is prohibited in v3, check your expression: \"${raw}\"`\n    );\n  }\n\n  const globalVariables: Record<string, unknown> = {};\n  const { attemptToVisitGlobals } = precooked;\n\n  // Ignore evaluating if required `event/DATA` is missing in\n  // context. Since they are are provided in different context, whenever\n  // missing one of them, memorize the current context for later consuming.\n  if (\n    options.lazy ||\n    (attemptToVisitGlobals.has(\"EVENT\") &&\n      !hasOwnProperty(runtimeContext, \"event\")) ||\n    (attemptToVisitGlobals.has(\"DATA\") &&\n      !hasOwnProperty(runtimeContext, \"data\"))\n  ) {\n    return {\n      blockingList,\n      run() {\n        return Object.keys(runtimeContext).length > 0\n          ? ({\n              [symbolForRaw]: raw,\n              [symbolForContext]: runtimeContext,\n            } as PreEvaluated)\n          : raw;\n      },\n    };\n  }\n\n  let usedCtx: Set<string>;\n  let usedProcessors: Set<string>;\n  let usedStates: Set<string>;\n  let tplStateStore: DataStore<\"STATE\"> | undefined;\n  const strict = isStrictMode(runtimeContext);\n\n  // For existed TPL usage, treat it as a STATE.\n  if (\n    attemptToVisitGlobals.has(\"STATE\") ||\n    (!strict && attemptToVisitGlobals.has(\"TPL\"))\n  ) {\n    tplStateStore = getTplStateStore(runtimeContext, \"STATE\", `: \"${raw}\"`);\n  }\n\n  let usedFormStates: Set<string>;\n  let formStateStore: DataStore<\"FORM_STATE\"> | undefined;\n  if (attemptToVisitGlobals.has(\"FORM_STATE\")) {\n    formStateStore = getFormStateStore(\n      runtimeContext,\n      \"FORM_STATE\",\n      `: \"${raw}\"`\n    );\n  }\n\n  const devHook = getDevHook();\n  if (isAsync || devHook) {\n    if (attemptToVisitGlobals.has(\"CTX\")) {\n      usedCtx = strictCollectMemberUsage(raw, \"CTX\");\n      isAsync && blockingList.push(runtimeContext.ctxStore.waitFor(usedCtx));\n    }\n\n    if (tplStateStore) {\n      usedStates = strictCollectMemberUsage(raw, \"STATE\");\n      // istanbul ignore if\n      if (!strict) {\n        const usedTpls = strictCollectMemberUsage(raw, \"TPL\");\n        for (const tpl of usedTpls) {\n          usedStates.add(tpl);\n        }\n      }\n      isAsync && blockingList.push(tplStateStore.waitFor(usedStates));\n    }\n\n    if (formStateStore) {\n      usedFormStates = strictCollectMemberUsage(raw, \"FORM_STATE\");\n      isAsync && blockingList.push(formStateStore.waitFor(usedFormStates));\n    }\n\n    if (attemptToVisitGlobals.has(\"PROCESSORS\")) {\n      usedProcessors = strictCollectMemberUsage(raw, \"PROCESSORS\", 2);\n      isAsync &&\n        blockingList.push(\n          loadProcessorsImperatively(usedProcessors, getBrickPackages())\n        );\n    }\n  }\n\n  if (isAsync) {\n    let attemptToCheckPermissions = attemptToVisitGlobals.has(\"PERMISSIONS\");\n    // There maybe `PERMISSIONS.check()` usage in functions\n    if (!attemptToCheckPermissions && attemptToVisitGlobals.has(\"FN\")) {\n      const usedFunctions = [...strictCollectMemberUsage(raw, \"FN\")];\n      attemptToCheckPermissions = checkPermissionsUsage(usedFunctions);\n    }\n\n    if (attemptToCheckPermissions) {\n      blockingList.push(...runtimeContext.pendingPermissionsPreCheck);\n    }\n\n    if (menuUsage.usedArgs.size > 0 && hooks?.menu) {\n      // Block evaluating if has `APP.getMenu(...)` usage.\n      const usedMenuIds = [...menuUsage.usedArgs];\n      blockingList.push(\n        Promise.all(\n          usedMenuIds.map((menuId) =>\n            hooks!.menu!.fetchMenuById(menuId, runtimeContext, {\n              getStoryboardByAppId: _internalApiGetStoryboardInBootstrapData,\n              resolveData,\n              asyncComputeRealValue,\n            })\n          )\n        )\n      );\n    }\n\n    if (hasAppUsage.usedArgs.size > 0) {\n      // Only wait for specific apps\n      blockingList.push(\n        hooks?.checkInstalledApps?.waitForCheckingApps([\n          ...hasAppUsage.usedArgs,\n        ])\n      );\n    }\n  }\n\n  return {\n    blockingList,\n    run() {\n      const {\n        app: currentApp,\n        location,\n        query,\n        match,\n        flags,\n        sys,\n        ctxStore,\n        data,\n        event,\n      } = runtimeContext;\n      const app = runtimeContext.overrideApp ?? currentApp;\n\n      for (const variableName of attemptToVisitGlobals) {\n        switch (variableName) {\n          // case \"ALIAS\":\n          case \"ANCHOR\":\n            globalVariables[variableName] = location.hash\n              ? location.hash.substring(1)\n              : null;\n            break;\n          case \"APP\":\n            globalVariables[variableName] = {\n              ...cloneDeep(app),\n              getMenu: hooks?.menu?.getMenuById,\n            };\n            break;\n          case \"CTX\":\n            globalVariables[variableName] = getDynamicReadOnlyProxy({\n              get(target, key) {\n                return ctxStore.getValue(key as string);\n              },\n              ownKeys() {\n                return Array.from(usedCtx);\n              },\n            });\n            break;\n          case \"DATA\":\n            globalVariables[variableName] = data;\n            break;\n          case \"EVENT\":\n            globalVariables[variableName] = event;\n            break;\n          case \"FLAGS\":\n            globalVariables[variableName] = getReadOnlyProxy(flags);\n            break;\n          case \"FORM_STATE\":\n            globalVariables[variableName] = getDynamicReadOnlyProxy({\n              get(target, key) {\n                return formStateStore!.getValue(key as string);\n              },\n              ownKeys() {\n                return Array.from(usedFormStates);\n              },\n            });\n            break;\n          case \"HASH\":\n            globalVariables[variableName] = location.hash;\n            break;\n          case \"INSTALLED_APPS\":\n            globalVariables[variableName] = getReadOnlyProxy({\n              has: hasInstalledApp,\n            });\n            break;\n          case \"ITEM\":\n            if (!hasOwnProperty(runtimeContext, \"forEachItem\")) {\n              // eslint-disable-next-line no-console\n              console.error(\n                `Using \\`ITEM\\` but no \\`:forEach\\` is found, check your expression: \"${raw}\"`\n              );\n            } else {\n              globalVariables[variableName] = runtimeContext.forEachItem;\n            }\n            break;\n          case \"LOCAL_STORAGE\":\n            globalVariables[variableName] = getReadOnlyProxy({\n              getItem: getStorageItem(\"local\"),\n            });\n            break;\n          case \"MEDIA\":\n            globalVariables[variableName] = getReadOnlyProxy(getMedia());\n            break;\n          case \"MISC\":\n            globalVariables[variableName] = getRuntime().getMiscSettings();\n            break;\n          case \"PARAMS\":\n            globalVariables[variableName] = new URLSearchParams(query);\n            break;\n          case \"PATH\":\n            globalVariables[variableName] = getReadOnlyProxy(\n              match?.params ?? {}\n            );\n            break;\n          case \"PATH_NAME\":\n            globalVariables[variableName] = location.pathname;\n            break;\n          case \"PROCESSORS\":\n            globalVariables[variableName] = getDynamicReadOnlyProxy({\n              get(target, key) {\n                const pkg = customProcessors.get(key as string);\n                if (!pkg) {\n                  throw new Error(\n                    `'PROCESSORS.${\n                      key as string\n                    }' is not registered! Have you installed the relevant brick package?`\n                  );\n                }\n                return getDynamicReadOnlyProxy({\n                  get(t, k) {\n                    return pkg.get(k as string);\n                  },\n                  ownKeys() {\n                    return Array.from(pkg.keys());\n                  },\n                });\n              },\n              ownKeys() {\n                return Array.from(usedProcessors);\n              },\n            });\n            break;\n          case \"QUERY\":\n            globalVariables[variableName] = Object.fromEntries(\n              Array.from(query.keys()).map((key) => [key, query.get(key)])\n            );\n            break;\n          case \"QUERY_ARRAY\":\n            globalVariables[variableName] = Object.fromEntries(\n              Array.from(query.keys()).map((key) => [key, query.getAll(key)])\n            );\n            // case \"SEGUE\":\n            break;\n          case \"SESSION_STORAGE\":\n            globalVariables[variableName] = getReadOnlyProxy({\n              getItem: getStorageItem(\"session\"),\n            });\n            break;\n          // istanbul ignore next\n          case \"TPL\":\n            warnAboutStrictMode(\n              strict,\n              'Using \"TPL\" in expression',\n              `check your expression: \"${raw}\"`\n            );\n            if (strict) {\n              break;\n            }\n          // eslint-disable-next-line no-fallthrough\n          case \"STATE\":\n            globalVariables[variableName] = getDynamicReadOnlyProxy({\n              get(target, key) {\n                return tplStateStore!.getValue(key as string);\n              },\n              ownKeys() {\n                return Array.from(usedStates);\n              },\n            });\n            break;\n          case \"SYS\":\n            globalVariables[variableName] = getReadOnlyProxy(sys ?? {});\n            break;\n          case \"__WIDGET_FN__\":\n            globalVariables[variableName] = widgetFunctions;\n            break;\n          case \"__WIDGET_IMG__\":\n            globalVariables[variableName] = widgetImagesFactory;\n            break;\n          case \"__WIDGET_I18N__\":\n            globalVariables[variableName] = widgetI18nFactory;\n            break;\n        }\n      }\n\n      Object.assign(\n        globalVariables,\n        getGeneralGlobals(precooked.attemptToVisitGlobals, {\n          storyboardFunctions,\n          app: runtimeContext.app,\n          appendI18nNamespace: runtimeContext.appendI18nNamespace,\n        })\n      );\n\n      try {\n        const result = cook(precooked.expression, precooked.source, {\n          globalVariables: supply(\n            precooked.attemptToVisitGlobals,\n            globalVariables\n          ),\n        });\n        // const detail = { raw, context: globalVariables, result };\n        // if (options.isReEvaluation) {\n        //   devtoolsHookEmit(\"re-evaluation\", {\n        //     id: options.evaluationId,\n        //     detail,\n        //   });\n        // } else {\n        //   devtoolsHookEmit(\"evaluation\", detail);\n        // }\n        return result;\n      } catch (error: any) {\n        const message = `${error.message}, in \"${raw}\"`;\n        // if (options.isReEvaluation) {\n        //   devtoolsHookEmit(\"re-evaluation\", {\n        //     id: options.evaluationId,\n        //     detail: { raw, context: globalVariables },\n        //     error: message,\n        //   });\n        // } else {\n        const errorConstructor = getCookErrorConstructor(error);\n        throw new errorConstructor(message);\n        // }\n      }\n    },\n  };\n}\n","export enum StateOfUseBrick {\n  INITIAL,\n  USE_BRICK,\n  USE_BRICK_ITEM,\n  USE_BRICK_PROPERTIES,\n  // Compatible mode\n  USE_BRICK_TRANSFORM,\n  USE_BRICK_EVENTS,\n  USE_BRICK_IF,\n  USE_BRICK_SLOTS,\n  USE_BRICK_SLOTS_ITEM,\n  USE_BRICK_SLOTS_ITEM_BRICKS,\n  USE_BRICK_SLOTS_ITEM_BRICKS_ITEM,\n  USE_BRICK_LIFECYCLE,\n  USE_BRICK_DATA_SOURCE,\n}\n\nexport function isLazyContentInUseBrick(\n  state: StateOfUseBrick | undefined\n): boolean {\n  switch (state) {\n    case StateOfUseBrick.USE_BRICK_PROPERTIES:\n    case StateOfUseBrick.USE_BRICK_TRANSFORM:\n    case StateOfUseBrick.USE_BRICK_EVENTS:\n    case StateOfUseBrick.USE_BRICK_IF:\n    case StateOfUseBrick.USE_BRICK_LIFECYCLE:\n    case StateOfUseBrick.USE_BRICK_DATA_SOURCE:\n      return true;\n  }\n  return false;\n}\n\nexport function getNextStateOfUseBrick(\n  state: StateOfUseBrick | undefined,\n  isArray?: boolean,\n  key?: string\n): StateOfUseBrick | undefined {\n  if (isLazyContentInUseBrick(state)) {\n    return state;\n  }\n  if (isArray) {\n    switch (state) {\n      case StateOfUseBrick.USE_BRICK:\n        return StateOfUseBrick.USE_BRICK_ITEM;\n      case StateOfUseBrick.USE_BRICK_SLOTS_ITEM_BRICKS:\n        return StateOfUseBrick.USE_BRICK_SLOTS_ITEM_BRICKS_ITEM;\n    }\n  } else {\n    switch (state) {\n      case StateOfUseBrick.INITIAL:\n        if (key === \"useBrick\") {\n          return StateOfUseBrick.USE_BRICK;\n        }\n        break;\n      case StateOfUseBrick.USE_BRICK:\n      case StateOfUseBrick.USE_BRICK_ITEM:\n      case StateOfUseBrick.USE_BRICK_SLOTS_ITEM_BRICKS_ITEM: {\n        switch (key) {\n          case \"properties\":\n            return StateOfUseBrick.USE_BRICK_PROPERTIES;\n          case \"transform\":\n            return StateOfUseBrick.USE_BRICK_TRANSFORM;\n          case \"dataSource\":\n            return StateOfUseBrick.USE_BRICK_DATA_SOURCE;\n          case \"events\":\n            return StateOfUseBrick.USE_BRICK_EVENTS;\n          case \"slots\":\n            return StateOfUseBrick.USE_BRICK_SLOTS;\n          case \"children\":\n            return StateOfUseBrick.USE_BRICK_SLOTS_ITEM_BRICKS;\n          case \"if\":\n            return StateOfUseBrick.USE_BRICK_IF;\n          case \"lifeCycle\":\n            return StateOfUseBrick.USE_BRICK_LIFECYCLE;\n        }\n        break;\n      }\n      case StateOfUseBrick.USE_BRICK_SLOTS:\n        return StateOfUseBrick.USE_BRICK_SLOTS_ITEM;\n      case StateOfUseBrick.USE_BRICK_SLOTS_ITEM:\n        if (key === \"bricks\") {\n          return StateOfUseBrick.USE_BRICK_SLOTS_ITEM_BRICKS;\n        }\n        break;\n    }\n  }\n  return StateOfUseBrick.INITIAL;\n}\n","import { isObject } from \"@next-core/utils/general\";\n\nlet computed = new WeakSet();\n\n// The computed (or transformed) result should never be *computed* again.\n// So does the fetched data from a remote api.\nexport function markAsComputed(value: unknown): void {\n  if (isObject(value)) {\n    if (!hasBeenComputed(value)) {\n      computed.add(value);\n      if (Array.isArray(value)) {\n        value.forEach(markAsComputed);\n      } else {\n        // Only mark pure objects.\n        const proto = Object.getPrototypeOf(value);\n        if (!proto || proto.constructor === Object) {\n          Object.values(value).forEach(markAsComputed);\n        }\n      }\n    }\n  }\n}\n\nexport function hasBeenComputed(object: unknown): boolean {\n  return computed.has(object as object);\n}\n\nexport function resetAllComputedMarks(): void {\n  computed = new WeakSet();\n}\n","import { isEvaluable } from \"@next-core/cook\";\nimport { hasOwnProperty, isObject } from \"@next-core/utils/general\";\nimport { transformAndInject, transform, inject } from \"@next-core/inject\";\nimport {\n  asyncEvaluate,\n  isPreEvaluated,\n  evaluate,\n  shouldDismissMarkingComputed,\n} from \"./evaluate.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\nimport {\n  StateOfUseBrick,\n  getNextStateOfUseBrick,\n  isLazyContentInUseBrick,\n} from \"./getNextStateOfUseBrick.js\";\nimport { hasBeenComputed, markAsComputed } from \"./markAsComputed.js\";\n\nexport interface ComputeOptions {\n  $$lazyForUseBrick?: boolean;\n  $$stateOfUseBrick?: StateOfUseBrick;\n  ignoreSymbols?: boolean;\n  noInject?: boolean;\n}\n\nexport async function asyncComputeRealValue(\n  value: unknown,\n  runtimeContext: RuntimeContext,\n  internalOptions: ComputeOptions = {}\n): Promise<unknown> {\n  const preEvaluated = isPreEvaluated(value);\n\n  if (preEvaluated || typeof value === \"string\") {\n    // For `useBrick`, some fields such as `properties`/`transform`/`events`/`if`,\n    // are kept and to be evaluated later.\n    const lazy =\n      internalOptions.$$lazyForUseBrick &&\n      isLazyContentInUseBrick(internalOptions.$$stateOfUseBrick);\n\n    let result: unknown;\n    let dismissMarkingComputed = lazy;\n\n    if (preEvaluated || isEvaluable(value as string)) {\n      result = await asyncEvaluate(value, runtimeContext, { lazy });\n      dismissMarkingComputed = shouldDismissMarkingComputed(value);\n    } else {\n      result = lazy\n        ? value\n        : (hasOwnProperty(runtimeContext, \"data\")\n            ? internalOptions.noInject\n              ? transform\n              : transformAndInject\n            : internalOptions.noInject\n            ? identity\n            : inject)(value, runtimeContext);\n    }\n\n    if (!dismissMarkingComputed) {\n      markAsComputed(result);\n    }\n\n    return result;\n  }\n\n  if (!isObject(value) || hasBeenComputed(value)) {\n    return value;\n  }\n\n  if (Array.isArray(value)) {\n    const nextOptions = getNextComputeOptions(internalOptions, true);\n    return Promise.all(\n      value.map((v) => asyncComputeRealValue(v, runtimeContext, nextOptions))\n    );\n  }\n\n  return Object.fromEntries(\n    (\n      await Promise.all(\n        Object.entries(value).map(([k, v]) =>\n          Promise.all([\n            asyncComputeRealValue(k, runtimeContext),\n            asyncComputeRealValue(\n              v,\n              runtimeContext,\n              getNextComputeOptions(internalOptions, false, k)\n            ),\n          ])\n        )\n      )\n    ).concat(\n      internalOptions.ignoreSymbols\n        ? []\n        : Object.getOwnPropertySymbols(value).map((k) => [\n            k,\n            (value as Record<string | symbol, unknown>)[k],\n          ])\n    )\n  );\n}\n\nexport function computeRealValue(\n  value: unknown,\n  runtimeContext: RuntimeContext,\n  internalOptions: ComputeOptions = {}\n): unknown {\n  const preEvaluated = isPreEvaluated(value);\n\n  if (preEvaluated || typeof value === \"string\") {\n    // For `useBrick`, some fields such as `properties`/`transform`/`events`/`if`,\n    // are kept and to be evaluated later.\n    const lazy =\n      internalOptions.$$lazyForUseBrick &&\n      isLazyContentInUseBrick(internalOptions.$$stateOfUseBrick);\n\n    let result: unknown;\n    let dismissMarkingComputed = lazy;\n\n    if (preEvaluated || isEvaluable(value as string)) {\n      result = evaluate(value, runtimeContext);\n      dismissMarkingComputed = shouldDismissMarkingComputed(value);\n    } else {\n      result = lazy\n        ? value\n        : (hasOwnProperty(runtimeContext, \"data\")\n            ? internalOptions.noInject\n              ? transform\n              : transformAndInject\n            : internalOptions.noInject\n            ? identity\n            : inject)(value, runtimeContext);\n    }\n\n    if (!dismissMarkingComputed) {\n      markAsComputed(result);\n    }\n\n    return result;\n  }\n\n  if (!isObject(value) || hasBeenComputed(value)) {\n    return value;\n  }\n\n  if (Array.isArray(value)) {\n    const nextOptions = getNextComputeOptions(internalOptions, true);\n    return value.map((v) => computeRealValue(v, runtimeContext, nextOptions));\n  }\n\n  return Object.fromEntries(\n    Object.entries(value)\n      .map(([k, v]) => [\n        computeRealValue(k, runtimeContext),\n        computeRealValue(\n          v,\n          runtimeContext,\n          getNextComputeOptions(internalOptions, false, k)\n        ),\n      ])\n      .concat(\n        internalOptions.ignoreSymbols\n          ? []\n          : Object.getOwnPropertySymbols(value).map((k) => [\n              k,\n              (value as Record<string | symbol, unknown>)[k],\n            ])\n      )\n  );\n}\n\nfunction getNextComputeOptions(\n  internalOptions: ComputeOptions,\n  isArray: boolean,\n  key?: string\n): ComputeOptions {\n  return internalOptions.$$lazyForUseBrick\n    ? {\n        ...internalOptions,\n        $$stateOfUseBrick: getNextStateOfUseBrick(\n          internalOptions.$$stateOfUseBrick,\n          isArray,\n          key\n        ),\n      }\n    : internalOptions;\n}\n\nfunction identity<T>(value: T): T {\n  return value;\n}\n","import { hasOwnProperty, isObject } from \"@next-core/utils/general\";\nimport type { BrickConf, ResolveConf } from \"@next-core/types\";\nimport { asyncComputeRealValue, computeRealValue } from \"./computeRealValue.js\";\nimport { isPreEvaluated } from \"./evaluate.js\";\nimport { resolveData } from \"../data/resolveData.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\n\n/**\n * 包含 `if` 条件判断的对象。\n */\nexport interface IfContainer {\n  /**\n   * 条件判断，可以为表达式字符串。\n   *\n   * @example\n   *\n   * ```yaml\n   * - brick: your.any-brick\n   *   if: '<% FLAGS[\"your-feature-flag\"] %>'\n   * ```\n   */\n  if?: unknown;\n}\n\nexport async function asyncCheckIf(\n  ifContainer: IfContainer,\n  runtimeContext: RuntimeContext\n): Promise<boolean> {\n  return (\n    !hasOwnProperty(ifContainer, \"if\") ||\n    !!(typeof ifContainer.if === \"string\" || isPreEvaluated(ifContainer.if)\n      ? await asyncComputeRealValue(ifContainer.if, runtimeContext)\n      : ifContainer.if)\n  );\n}\n\nexport function checkIf(\n  ifContainer: IfContainer,\n  runtimeContext: RuntimeContext\n): boolean {\n  return (\n    !hasOwnProperty(ifContainer, \"if\") ||\n    !!(typeof ifContainer.if === \"string\" || isPreEvaluated(ifContainer.if)\n      ? computeRealValue(ifContainer.if, runtimeContext)\n      : ifContainer.if)\n  );\n}\n\nexport function checkIfOfComputed(ifContainer: IfContainer): boolean {\n  return !hasOwnProperty(ifContainer, \"if\") || !!ifContainer.if;\n}\n\nexport async function asyncCheckBrickIf(\n  brickConf: BrickConf,\n  runtimeContext: RuntimeContext\n): Promise<boolean> {\n  if (isObject(brickConf.if) && !isPreEvaluated(brickConf.if)) {\n    const resolved = (await resolveData(\n      brickConf.if as ResolveConf,\n      runtimeContext\n    )) as { if?: unknown };\n    return checkIfOfComputed(resolved);\n  }\n  return asyncCheckIf(brickConf, runtimeContext);\n}\n\nexport function checkIfByTransform(ifContainer: IfContainer, data: unknown) {\n  return checkIf(ifContainer, { data } as RuntimeContext);\n}\n","import { isEvaluable, isTrackAll } from \"@next-core/cook\";\nimport { track, trackAll } from \"@next-core/utils/storyboard\";\nimport {\n  PreEvaluated,\n  getPreEvaluatedRaw,\n  isPreEvaluated,\n} from \"./evaluate.js\";\n\nexport function getTracks(value: unknown) {\n  let contextNames: string[] | Set<string> | false = false;\n  let stateNames: string[] | Set<string> | false = false;\n  let formStateNames: string[] | Set<string> | false = false;\n  if (typeof value === \"string\" ? isEvaluable(value) : isPreEvaluated(value)) {\n    const raw =\n      typeof value === \"string\"\n        ? value\n        : getPreEvaluatedRaw(value as PreEvaluated);\n    if (isTrackAll(raw)) {\n      const result = trackAll(raw);\n      if (result) {\n        contextNames = result.context;\n        stateNames = result.state;\n        formStateNames = result.formState;\n      }\n    } else {\n      contextNames = track(raw, \"track context\", \"CTX\");\n      stateNames = track(raw, \"track state\", \"STATE\");\n      formStateNames = track(raw, \"track formstate\", \"FORM_STATE\");\n    }\n  }\n\n  return { contextNames, stateNames, formStateNames };\n}\n","import { isObject } from \"@next-core/utils/general\";\nimport { asyncComputeRealValue, computeRealValue } from \"./computeRealValue.js\";\nimport { TrackingContextItem } from \"./listenOnTrackingContext.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\nimport { StateOfUseBrick } from \"./getNextStateOfUseBrick.js\";\nimport { getTracks } from \"./getTracks.js\";\n\nexport async function asyncComputeRealProperties(\n  properties: Record<string, unknown> | undefined,\n  runtimeContext: RuntimeContext,\n  trackingContextList?: TrackingContextItem[]\n): Promise<Record<string, unknown>> {\n  if (isObject(properties)) {\n    return Object.fromEntries(\n      (\n        await Promise.all(\n          Object.entries(properties).map<\n            Promise<[string, unknown] | undefined>\n          >(async ([propName, propValue]) => {\n            if (Array.isArray(trackingContextList)) {\n              const { contextNames, stateNames, formStateNames } =\n                getTracks(propValue);\n              if (contextNames || stateNames || formStateNames) {\n                trackingContextList.push({\n                  contextNames,\n                  stateNames,\n                  formStateNames,\n                  propName,\n                  propValue,\n                });\n              }\n            }\n            // Related: https://github.com/facebook/react/issues/11347\n            const realValue = await asyncComputeRealValue(\n              propValue,\n              runtimeContext,\n              {\n                $$lazyForUseBrick: true,\n                $$stateOfUseBrick:\n                  propName === \"useBrick\"\n                    ? StateOfUseBrick.USE_BRICK\n                    : StateOfUseBrick.INITIAL,\n              }\n            );\n            // For `style` and `dataset`, only object is acceptable.\n            if (\n              (propName !== \"style\" && propName !== \"dataset\") ||\n              isObject(realValue)\n            ) {\n              return [propName, realValue];\n            }\n          })\n        )\n      ).filter(Boolean) as [string, unknown][]\n    );\n  }\n\n  return {};\n}\n\nexport function computeRealProperties(\n  properties: Record<string, unknown> | undefined,\n  runtimeContext: RuntimeContext,\n  trackingContextList?: TrackingContextItem[]\n): Record<string, unknown> {\n  if (isObject(properties)) {\n    return Object.fromEntries(\n      Object.entries(properties)\n        .map<[string, unknown] | undefined>(([propName, propValue]) => {\n          if (Array.isArray(trackingContextList)) {\n            const { contextNames, stateNames, formStateNames } =\n              getTracks(propValue);\n            if (contextNames || stateNames || formStateNames) {\n              trackingContextList.push({\n                contextNames,\n                stateNames,\n                formStateNames,\n                propName,\n                propValue,\n              });\n            }\n          }\n          // Related: https://github.com/facebook/react/issues/11347\n          const realValue = computeRealValue(propValue, runtimeContext, {\n            $$lazyForUseBrick: true,\n            $$stateOfUseBrick:\n              propName === \"useBrick\"\n                ? StateOfUseBrick.USE_BRICK\n                : StateOfUseBrick.INITIAL,\n          });\n          // For `style` and `dataset`, only object is acceptable.\n          if (\n            (propName !== \"style\" && propName !== \"dataset\") ||\n            isObject(realValue)\n          ) {\n            return [propName, realValue];\n          }\n        })\n        .filter(Boolean) as [string, unknown][]\n    );\n  }\n\n  return {};\n}\n","export function setRealProperties(\n  brick: HTMLElement,\n  realProps: Record<string, unknown> | undefined\n): void {\n  if (!realProps) {\n    return;\n  }\n  for (const [propName, propValue] of Object.entries(realProps)) {\n    switch (propName) {\n      case \"style\":\n      case \"dataset\":\n        for (const [k, v] of Object.entries(\n          propValue as Record<string, unknown>\n        )) {\n          (brick[propName] as unknown as Record<string, unknown>)[k] = v;\n        }\n        break;\n      case \"constructor\":\n      case \"__proto__\":\n      case \"innerHTML\":\n        // `innerHTML` is dangerous, use `textContent` instead.\n        throw new Error(`set \\`${propName}\\` is prohibited`);\n      default:\n        (brick as unknown as Record<string, unknown>)[propName] = propValue;\n    }\n  }\n}\n","import { computeRealProperties } from \"./computeRealProperties.js\";\nimport { setRealProperties } from \"./setRealProperties.js\";\nimport type { RuntimeContext } from \"../interfaces.js\";\n\nexport function setProperties(\n  bricks: HTMLElement | HTMLElement[],\n  properties: Record<string, unknown>,\n  runtimeContext: RuntimeContext\n): void {\n  const realProps = computeRealProperties(properties, runtimeContext);\n  if (!Array.isArray(bricks)) {\n    bricks = [bricks];\n  }\n  bricks.forEach((brick) => {\n    setRealProperties(brick, realProps);\n  });\n}\n","// Ref https://github.com/ReactTraining/react-router/blob/master/packages/react-router/modules/matchPath.js\nimport type { LegacyCompatibleRuntimeContext } from \"@next-core/inject\";\nimport { pathToRegexp, Key, compile } from \"path-to-regexp\";\n\nconst cache: Map<string, Map<string, CompileResult>> = new Map();\nconst cacheLimit = 10000;\nlet cacheCount = 0;\n\nfunction compilePath(path: string, options: CompileOptions): CompileResult {\n  const cacheKey = `${options.end}${options.strict}${options.sensitive}`;\n  let pathCache = cache.get(cacheKey);\n  if (!pathCache) {\n    cache.set(cacheKey, (pathCache = new Map()));\n  }\n\n  const cacheResult = pathCache.get(path);\n  if (cacheResult) {\n    return cacheResult;\n  }\n\n  const keys: Key[] = [];\n  const regexp = pathToRegexp(path, keys, options);\n  const result = { regexp, keys };\n\n  if (cacheCount < cacheLimit) {\n    pathCache.set(path, result);\n    cacheCount++;\n  }\n\n  return result;\n}\n\n/**\n * Public API for matching a URL pathname to a path.\n */\nexport function matchPath(\n  pathname: string,\n  options: MatchPathOptions\n): MatchResult | null {\n  const { path: p, exact = false, strict = false, sensitive = true } = options;\n\n  const paths = Array.isArray(p) ? p : [p];\n\n  return paths.reduce<MatchResult | null>((matched, path) => {\n    if (matched) {\n      return matched;\n    }\n    const { regexp, keys } = compilePath(path, {\n      end: exact,\n      strict,\n      sensitive,\n    });\n    const match = regexp.exec(pathname);\n\n    if (!match) {\n      return null;\n    }\n\n    const [url, ...values] = match;\n    const isExact = pathname === url;\n\n    if (exact && !isExact) {\n      return null;\n    }\n\n    const initialParams: MatchResult[\"params\"] = {};\n    const result = {\n      path, // the path used to match\n      url: path === \"/\" && url === \"\" ? \"/\" : url, // the matched portion of the URL\n      isExact, // whether or not we matched exactly\n      params: keys.reduce((memo, key, index) => {\n        memo[key.name] = values[index];\n        return memo;\n      }, initialParams),\n    };\n\n    return result;\n  }, null);\n}\n\nexport function toPath(\n  path: string,\n  pathParams?: Record<string, unknown>\n): string {\n  return compile(path)(pathParams);\n}\n\ninterface CompileOptions {\n  end?: boolean;\n  strict?: boolean;\n  sensitive?: boolean;\n}\n\ninterface CompileResult {\n  regexp: RegExp;\n  keys: Key[];\n}\n\ninterface MatchOptions {\n  path: string | string[];\n  exact?: boolean;\n}\n\nexport type MatchPathOptions = MatchOptions & CompileOptions;\n\nexport type MatchResult = Exclude<\n  LegacyCompatibleRuntimeContext[\"match\"],\n  undefined\n>;\n","import type { RouteConf } from \"@next-core/types\";\nimport { MatchResult, matchPath } from \"./matchPath.js\";\nimport { asyncCheckIf } from \"./compute/checkIf.js\";\nimport type { RuntimeContext } from \"./interfaces.js\";\nimport { hooks } from \"./Runtime.js\";\n\ntype MatchRoutesResult =\n  | {\n      match: MatchResult;\n      route: RouteConf;\n    }\n  | \"missed\"\n  | \"unauthenticated\";\n\nexport async function matchRoutes(\n  routes: RouteConf[],\n  runtimeContext: RuntimeContext\n): Promise<MatchRoutesResult> {\n  for (const route of routes) {\n    if (typeof route.path !== \"string\") {\n      // eslint-disable-next-line no-console\n      console.error(\"Invalid route with invalid path:\", route);\n      throw new Error(\n        `Invalid route with invalid type of path: ${typeof route.path}`\n      );\n    }\n    const routePath = route.path.replace(\n      /^\\$\\{APP.homepage\\}/,\n      runtimeContext.app.homepage\n    );\n    const match = matchPath(runtimeContext.location.pathname, {\n      path: routePath,\n      exact: route.exact,\n    });\n    if (match && (await asyncCheckIf(route, runtimeContext))) {\n      if (\n        runtimeContext.app.noAuthGuard ||\n        route.public ||\n        !hooks?.auth ||\n        hooks.auth.isLoggedIn()\n      ) {\n        return { match, route };\n      }\n      return \"unauthenticated\";\n    }\n  }\n  return \"missed\";\n}\n","import type { BrickConf } from \"@next-core/types\";\nimport type { AsyncProperties } from \"../interfaces.js\";\n\nexport const symbolForAsyncComputedPropsFromHost = Symbol.for(\n  \"tpl.asyncComputedPropsFromHost\"\n);\nexport const symbolForTplStateStoreId = Symbol.for(\"tpl.stateStoreId\");\nexport const symbolForTPlExternalForEachItem = Symbol.for(\n  \"tpl.externalForEachItem\"\n);\n\nexport type RuntimeBrickConfWithTplSymbols = BrickConf &\n  RuntimeBrickConfOfTplSymbols;\n\nexport interface RuntimeBrickConfOfTplSymbols {\n  [symbolForAsyncComputedPropsFromHost]?: AsyncProperties;\n  [symbolForTplStateStoreId]?: string;\n  [symbolForTPlExternalForEachItem]?: unknown;\n}\n","let brick: {\n  resolve(options: DialogOptions): Promise<void>;\n};\n\nfunction show(options: DialogOptions): Promise<void> {\n  if (brick) {\n    return brick.resolve(options);\n  } else {\n    if (options.type === \"confirm\") {\n      if (confirm(options.content)) {\n        return new Promise((resolve) =>\n          setTimeout(() => {\n            resolve();\n          }, 1)\n        );\n      } else {\n        return new Promise((resolve, reject) =>\n          setTimeout(() => {\n            reject();\n          }, 1)\n        );\n      }\n    } else {\n      alert(options.content);\n      return new Promise((resolve) =>\n        setTimeout(() => {\n          resolve();\n        }, 1000)\n      );\n    }\n  }\n}\n\nexport function loadDialogService(\n  tagName: string,\n  loader: (bricks: string[]) => Promise<void>\n) {\n  loader([tagName]).then(\n    () => {\n      brick = document.createElement(tagName) as any;\n    },\n    (error: unknown) => {\n      // eslint-disable-next-line no-console\n      console.error(\"Load dialog service failed:\", error);\n    }\n  );\n}\n\nexport interface DialogOptions {\n  type?: \"success\" | \"error\" | \"warn\" | \"info\" | \"confirm\";\n  title?: string | null;\n  content: string;\n  contentStyle?: object;\n}\n\nexport const Dialog = Object.freeze({\n  show,\n});\n","import type { ProviderPollOptions } from \"@next-core/types\";\nimport { _internalApiGetRenderId } from \"./Runtime.js\";\n\nexport type PollableCallbackFunction = (result?: unknown) => unknown;\n\nexport interface PollableCallback {\n  progress?: PollableCallbackFunction;\n  success?: PollableCallbackFunction;\n  error?: PollableCallbackFunction;\n  finally?: PollableCallbackFunction;\n}\n\nconst timeoutIdList = new Set<number>();\n\nexport function startPoll(\n  task: () => unknown,\n  { progress, success, error, finally: finallyCallback }: PollableCallback,\n  {\n    interval,\n    leadingRequestDelay,\n    continueOnError,\n    delegateLoadingBar,\n    expectPollEnd,\n    expectPollStopImmediately,\n  }: ProviderPollOptions\n): void {\n  const currentRenderId = _internalApiGetRenderId();\n  let currentTimeoutId: number;\n  async function poll(): Promise<void> {\n    timeoutIdList.delete(currentTimeoutId);\n    let shouldStop: boolean | undefined;\n    try {\n      shouldStop = expectPollStopImmediately?.();\n      // Stop polling immediately when the expectation is match before task.\n      if (!shouldStop) {\n        const result = await task();\n        // Stop polling immediately when the expectation is match or a different router\n        // is rendering after the task processed.\n        shouldStop =\n          expectPollStopImmediately?.() ||\n          currentRenderId !== _internalApiGetRenderId();\n        if (!shouldStop) {\n          progress?.(result);\n          if (expectPollEnd?.(result)) {\n            if (delegateLoadingBar) {\n              window.dispatchEvent(new Event(\"request.end\"));\n            }\n            success?.(result);\n            finallyCallback?.();\n          } else {\n            delayedPoll(interval ?? 3000);\n          }\n        }\n      }\n    } catch (e) {\n      // Stop polling immediately when the expectation is match or a different router\n      // is rendering after the task processed.\n      shouldStop =\n        expectPollStopImmediately?.() ||\n        currentRenderId !== _internalApiGetRenderId();\n      if (!shouldStop) {\n        error?.(e);\n        if (continueOnError) {\n          delayedPoll(interval ?? 3000);\n        } else {\n          finallyCallback?.();\n        }\n      }\n    } finally {\n      // Manually dispatch an event of `request.end` when the polling is stopped immediately.\n      if (delegateLoadingBar && shouldStop) {\n        window.dispatchEvent(new Event(\"request.end\"));\n      }\n    }\n  }\n\n  function delayedPoll(delay: number): void {\n    currentTimeoutId = setTimeout(poll, delay) as unknown as number;\n    timeoutIdList.add(currentTimeoutId);\n  }\n\n  delayedPoll(leadingRequestDelay ?? 0);\n\n  if (delegateLoadingBar) {\n    window.dispatchEvent(new Event(\"request.start\"));\n  }\n}\n\nexport function clearPollTimeout(): void {\n  for (const timeoutId of timeoutIdList) {\n    clearTimeout(timeoutId);\n  }\n  timeoutIdList.clear();\n}\n","export enum K {\n  REQUEST_FAILED = \"REQUEST_FAILED\",\n  SOMETHING_WENT_WRONG = \"SOMETHING_WENT_WRONG\",\n  LOGIN_TIMEOUT_MESSAGE = \"LOGIN_TIMEOUT_MESSAGE\",\n  NETWORK_ERROR = \"NETWORK_ERROR\",\n}\n\nconst en: Locale = {\n  [K.REQUEST_FAILED]: \"Request Failed\",\n  [K.SOMETHING_WENT_WRONG]: \"Something went wrong!\",\n  [K.LOGIN_TIMEOUT_MESSAGE]:\n    \"You haven't logged in or your login session has expired. Login right now?\",\n  [K.NETWORK_ERROR]: \"Network error, please check your network.\",\n};\n\nconst zh: Locale = {\n  [K.REQUEST_FAILED]: \"请求失败\",\n  [K.SOMETHING_WENT_WRONG]: \"出现了一些问题！\",\n  [K.LOGIN_TIMEOUT_MESSAGE]: \"您还未登录或登录信息已过期，现在重新登录？\",\n  [K.NETWORK_ERROR]: \"网络错误，请检查您的网络连接。\",\n};\n\nexport const NS = \"core/runtime\";\n\nexport const locales = { en, zh };\n\ntype Locale = { [key in K]: string };\n","import {\n  HttpAbortError,\n  HttpFetchError,\n  HttpResponseError,\n} from \"@next-core/http\";\nimport { i18n } from \"@next-core/i18n\";\nimport { getRuntime } from \"./internal/Runtime.js\";\nimport { getHistory } from \"./history.js\";\nimport { K, NS } from \"./internal/i18n.js\";\nimport { Dialog } from \"./Dialog.js\";\n\n/**\n * 将 http 请求错误转换为可读的字符串。\n *\n * @remarks\n *\n * 将依次尝试读取返回的 JSON 格式数据的字符串类型的 `error` 和 `msg` 字段，如果没有找到则返回 `error.toString()` 的结果。\n *\n * @param error - 错误对象。\n *\n * @returns 转换为字符串的错误信息。\n */\nexport function httpErrorToString(error: unknown): string {\n  if (error instanceof Event && error.target instanceof HTMLScriptElement) {\n    return error.target.src;\n  }\n  if (error instanceof HttpFetchError) {\n    return i18n.t(`${NS}:${K.NETWORK_ERROR}`);\n  }\n  if (error instanceof HttpResponseError) {\n    if (error.responseJson) {\n      if (typeof error.responseJson.error === \"string\") {\n        return error.responseJson.error;\n      } else if (typeof error.responseJson.msg === \"string\") {\n        return error.responseJson.msg;\n      }\n    }\n  }\n  if (error == null) {\n    return \"Unknown error\";\n  }\n  return error.toString();\n}\n\nexport function isUnauthenticatedError(error: unknown): boolean {\n  return (\n    error instanceof HttpResponseError &&\n    error.response.status === 401 &&\n    !!error.responseJson &&\n    error.responseJson.code === 100003\n  );\n}\n\nlet unauthenticatedConfirming = false;\n\nlet lastErrorMessage: string | undefined;\n\n/**\n * 处理 http 请求错误（使用 AntDesign 模态框弹出错误信息）。\n *\n * @param error - 错误对象。\n */\nexport function handleHttpError(error: unknown) {\n  // Do nothing if aborted http requests\n  if (error instanceof HttpAbortError) {\n    return;\n  }\n\n  // Redirect to login page if not logged in.\n  if (isUnauthenticatedError(error) && !window.NO_AUTH_GUARD) {\n    if (unauthenticatedConfirming) {\n      return;\n    }\n    unauthenticatedConfirming = true;\n    Dialog.show({\n      type: \"confirm\",\n      content: i18n.t(`${NS}:${K.LOGIN_TIMEOUT_MESSAGE}`),\n    }).then(\n      () => {\n        redirectToLogin();\n        unauthenticatedConfirming = false;\n      },\n      () => {\n        unauthenticatedConfirming = false;\n      }\n    );\n    return;\n  }\n\n  // eslint-disable-next-line no-console\n  console.error(error);\n\n  const message = httpErrorToString(error);\n  if (message !== lastErrorMessage) {\n    lastErrorMessage = message;\n    Dialog.show({\n      type: \"error\",\n      title: i18n.t(`${NS}:${K.REQUEST_FAILED}`),\n      content: message,\n      contentStyle: {\n        whiteSpace: \"pre-wrap\",\n      },\n    }).then(() => {\n      lastErrorMessage = undefined;\n    });\n  }\n  return;\n}\n\nfunction redirectToLogin() {\n  const ssoEnabled = getRuntime().getFeatureFlags()[\"sso-enabled\"];\n  const history = getHistory();\n  history.push(ssoEnabled ? \"/sso-auth/login\" : \"/auth/login\", {\n    from: {\n      ...history.location,\n      state: undefined,\n    },\n  });\n}\n","let brick: {\n  resolve(options: NotificationOptions): void;\n};\n\nfunction show(options: NotificationOptions) {\n  if (brick) {\n    brick.resolve(options);\n  } else {\n    alert(options.message);\n  }\n}\n\nexport function loadNotificationService(\n  tagName: string,\n  loader: (bricks: string[]) => Promise<void>\n) {\n  loader([tagName]).then(\n    () => {\n      brick = document.createElement(tagName) as any;\n    },\n    (error: unknown) => {\n      // eslint-disable-next-line no-console\n      console.error(\"Load notification service failed:\", error);\n    }\n  );\n}\n\nexport interface NotificationOptions {\n  type?: \"success\" | \"error\" | \"warn\" | \"info\";\n  message: string;\n}\n\nexport const Notification = Object.freeze({\n  show,\n});\n","import type {\n  BrickEventHandler,\n  BrickEventHandlerCallback,\n  BrickEventsMap,\n  BuiltinBrickEventHandler,\n  CustomBrickEventHandler,\n  ExecuteCustomBrickEventHandler,\n  ProviderPollOptions,\n  SetPropsCustomBrickEventHandler,\n  SiteTheme,\n  UseProviderEventHandler,\n  ConditionalEventHandler,\n  BatchUpdateContextItem,\n} from \"@next-core/types\";\nimport { isEvaluable } from \"@next-core/cook\";\nimport { isObject } from \"@next-core/utils/general\";\nimport { checkIf } from \"./compute/checkIf.js\";\nimport { computeRealValue } from \"./compute/computeRealValue.js\";\nimport { getHistory } from \"../history.js\";\nimport { getProviderBrick } from \"./data/getProviderBrick.js\";\nimport { PollableCallback, startPoll } from \"./poll.js\";\nimport { isPreEvaluated } from \"./compute/evaluate.js\";\nimport { setProperties } from \"./compute/setProperties.js\";\nimport { applyMode, applyTheme } from \"../themeAndMode.js\";\nimport type {\n  ElementHolder,\n  RuntimeBrickElement,\n  RuntimeContext,\n} from \"./interfaces.js\";\nimport {\n  getTplHostElement,\n  getTplStateStore,\n} from \"./CustomTemplates/utils.js\";\nimport { handleHttpError, httpErrorToString } from \"../handleHttpError.js\";\nimport { Notification } from \"../Notification.js\";\nimport { getFormStateStore } from \"./FormRenderer/utils.js\";\nimport { DataStore } from \"./data/DataStore.js\";\nimport { hooks } from \"./Runtime.js\";\n\nexport function bindListeners(\n  brick: RuntimeBrickElement,\n  eventsMap: BrickEventsMap | undefined,\n  runtimeContext: RuntimeContext\n): void {\n  if (!eventsMap) {\n    return;\n  }\n  Object.entries(eventsMap).forEach(([eventType, handlers]) => {\n    const listener = listenerFactory(handlers, runtimeContext, {\n      element: brick,\n    });\n    brick.addEventListener(eventType, listener);\n\n    // Remember added listeners for unbinding.\n    if (!brick.$$listeners) {\n      brick.$$listeners = [];\n    }\n    brick.$$listeners.push([eventType, listener]);\n\n    // Remember added listeners for devtools.\n    if (!brick.$$eventListeners) {\n      brick.$$eventListeners = [];\n    }\n    for (const handler of ([] as BrickEventHandler[]).concat(handlers)) {\n      brick.$$eventListeners.push([eventType, null, handler]);\n    }\n  });\n}\n\nexport function unbindListeners(brick: RuntimeBrickElement): void {\n  if (brick.$$listeners) {\n    for (const [eventType, listener] of brick.$$listeners) {\n      brick.removeEventListener(eventType, listener);\n    }\n    brick.$$listeners.length = 0;\n  }\n}\n\nexport function isBuiltinHandler(\n  handler: BrickEventHandler\n): handler is BuiltinBrickEventHandler {\n  return typeof (handler as BuiltinBrickEventHandler).action === \"string\";\n}\n\nexport function isUseProviderHandler(\n  handler: BrickEventHandler\n): handler is UseProviderEventHandler {\n  return typeof (handler as UseProviderEventHandler).useProvider === \"string\";\n}\n\nexport function isCustomHandler(\n  handler: BrickEventHandler\n): handler is CustomBrickEventHandler {\n  return !!(\n    ((handler as CustomBrickEventHandler).target ||\n      (handler as CustomBrickEventHandler).targetRef) &&\n    ((handler as ExecuteCustomBrickEventHandler).method ||\n      (handler as SetPropsCustomBrickEventHandler).properties)\n  );\n}\n\nexport function isExecuteCustomHandler(\n  handler: CustomBrickEventHandler\n): handler is ExecuteCustomBrickEventHandler {\n  return !!(handler as ExecuteCustomBrickEventHandler).method;\n}\n\nexport function isSetPropsCustomHandler(\n  handler: CustomBrickEventHandler\n): handler is SetPropsCustomBrickEventHandler {\n  return !!(handler as SetPropsCustomBrickEventHandler).properties;\n}\n\nexport function isConditionalEventHandler(\n  handler: BrickEventHandler\n): handler is ConditionalEventHandler {\n  return !!(handler as ConditionalEventHandler).then;\n}\n\nexport function listenerFactory(\n  handlers: BrickEventHandler | BrickEventHandler[],\n  runtimeContext: RuntimeContext,\n  runtimeBrick?: ElementHolder\n) {\n  return function (event: Event): void {\n    for (const handler of ([] as BrickEventHandler[]).concat(handlers)) {\n      if (!checkIf(handler, { ...runtimeContext, event })) {\n        if (handler.else) {\n          listenerFactory(handler.else, runtimeContext, runtimeBrick)(event);\n        }\n        continue;\n      }\n\n      if (isConditionalEventHandler(handler)) {\n        listenerFactory(handler.then, runtimeContext, runtimeBrick)(event);\n      } else if (isBuiltinHandler(handler)) {\n        const [object, method] = handler.action.split(\".\") as any;\n        switch (handler.action) {\n          case \"history.push\":\n          case \"history.replace\":\n          case \"history.pushQuery\":\n          case \"history.replaceQuery\":\n          case \"history.pushAnchor\":\n          case \"history.block\":\n          case \"history.goBack\":\n          case \"history.goForward\":\n          case \"history.reload\":\n          case \"history.unblock\":\n            handleHistoryAction(\n              event,\n              method,\n              handler.args,\n              handler.callback,\n              runtimeContext\n            );\n            break;\n\n          // case \"segue.push\":\n          // case \"segue.replace\":\n          // case \"alias.push\":\n          // case \"alias.replace\":\n\n          case \"window.open\":\n            handleWindowAction(event, handler.args, runtimeContext);\n            break;\n\n          case \"location.reload\":\n          case \"location.assign\":\n            handleLocationAction(event, method, handler.args, runtimeContext);\n            break;\n\n          case \"localStorage.setItem\":\n          case \"localStorage.removeItem\":\n          case \"sessionStorage.setItem\":\n          case \"sessionStorage.removeItem\":\n            handleStorageAction(\n              event,\n              object,\n              method,\n              handler.args,\n              runtimeContext\n            );\n            break;\n\n          case \"event.preventDefault\":\n            event.preventDefault();\n            break;\n\n          case \"console.log\":\n          case \"console.error\":\n          case \"console.warn\":\n          case \"console.info\":\n            handleConsoleAction(event, method, handler.args, runtimeContext);\n            break;\n\n          case \"message.success\":\n          case \"message.error\":\n          case \"message.info\":\n          case \"message.warn\":\n            handleMessageAction(event, method, handler.args, runtimeContext);\n            break;\n\n          case \"handleHttpError\":\n            handleHttpError((event as CustomEvent).detail);\n            break;\n\n          case \"context.assign\":\n          case \"context.replace\":\n          case \"context.refresh\":\n          case \"context.load\":\n            handleContextAction(\n              event,\n              method,\n              handler.args,\n              handler.batch ?? true,\n              handler.callback,\n              runtimeContext\n            );\n            break;\n\n          case \"state.update\":\n          case \"state.refresh\":\n          case \"state.load\":\n            handleTplStateAction(\n              event,\n              method,\n              handler.args,\n              handler.batch ?? true,\n              handler.callback,\n              runtimeContext\n            );\n            break;\n\n          case \"tpl.dispatchEvent\": {\n            const [type, init] = argsFactory(\n              handler.args,\n              runtimeContext,\n              event\n            ) as [string, CustomEventInit];\n            const tplHostElement = getTplHostElement(\n              runtimeContext,\n              handler.action,\n              `: ${type}`\n            );\n            tplHostElement.dispatchEvent(new CustomEvent(type, init));\n            break;\n          }\n\n          case \"formstate.update\":\n            handleFormStateAction(\n              event,\n              handler.args,\n              handler.callback,\n              runtimeContext\n            );\n            break;\n\n          // case \"message.subscribe\":\n          // case \"message.unsubscribe\":\n\n          case \"theme.setDarkTheme\":\n          case \"theme.setLightTheme\":\n            applyTheme(\n              handler.action === \"theme.setDarkTheme\" ? \"dark\" : \"light\"\n            );\n            break;\n          case \"theme.setTheme\": {\n            const [theme] = argsFactory(handler.args, runtimeContext, event);\n            applyTheme(theme as SiteTheme);\n            break;\n          }\n          case \"mode.setDashboardMode\":\n          case \"mode.setDefaultMode\":\n            applyMode(\n              handler.action === \"mode.setDashboardMode\"\n                ? \"dashboard\"\n                : \"default\"\n            );\n            break;\n\n          // case \"menu.clearMenuTitleCache\":\n          // case \"menu.clearMenuCache\":\n\n          // case \"analytics.event\":\n\n          // case \"preview.debug\":\n\n          default:\n            // eslint-disable-next-line no-console\n            console.error(\"unknown event listener action:\", handler.action);\n        }\n      } else if (isUseProviderHandler(handler)) {\n        handleUseProviderAction(event, handler, runtimeContext, runtimeBrick);\n      } else if (isCustomHandler(handler)) {\n        handleCustomAction(event, handler, runtimeContext, runtimeBrick!);\n      } else {\n        // eslint-disable-next-line no-console\n        console.error(\"unknown event handler:\", handler);\n      }\n    }\n  };\n}\n\nasync function handleUseProviderAction(\n  event: Event,\n  handler: UseProviderEventHandler,\n  runtimeContext: RuntimeContext,\n  runtimeBrick?: ElementHolder\n) {\n  try {\n    const providerBrick = await getProviderBrick(handler.useProvider);\n    const method = handler.method !== \"saveAs\" ? \"resolve\" : \"saveAs\";\n    brickCallback(\n      event,\n      providerBrick,\n      handler,\n      method,\n      runtimeContext,\n      runtimeBrick\n    );\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error(httpErrorToString(error));\n  }\n}\n\nfunction handleCustomAction(\n  event: Event,\n  handler: CustomBrickEventHandler,\n  runtimeContext: RuntimeContext,\n  runtimeBrick: ElementHolder\n) {\n  let targets: HTMLElement[] = [];\n  const rawTarget = handler.target;\n  const rawTargetRef = handler.targetRef;\n  let computedTarget = rawTarget;\n  // Allow `target` to be set as evaluable string.\n  if (\n    typeof rawTarget === \"string\"\n      ? isEvaluable(rawTarget)\n      : isPreEvaluated(rawTarget)\n  ) {\n    computedTarget = computeRealValue(rawTarget, { ...runtimeContext, event });\n  }\n  if (typeof computedTarget === \"string\") {\n    if (computedTarget === \"_self\") {\n      targets.push(runtimeBrick.element!);\n    } else if (handler.multiple) {\n      targets = Array.from(document.querySelectorAll(computedTarget));\n    } else {\n      const found = document.querySelector(computedTarget) as HTMLElement;\n      if (found !== null) {\n        targets.push(found);\n      }\n    }\n  } else if (computedTarget) {\n    if (computedTarget instanceof HTMLElement) {\n      targets.push(computedTarget as HTMLElement);\n    } else {\n      // eslint-disable-next-line no-console\n      console.error(\"unexpected target:\", computedTarget);\n    }\n  } else if (rawTargetRef) {\n    let computedTargetRef = rawTargetRef;\n    // Allow `targetRef` to be set as evaluable string.\n    if (\n      typeof rawTargetRef === \"string\"\n        ? isEvaluable(rawTargetRef)\n        : isPreEvaluated(rawTargetRef)\n    ) {\n      computedTargetRef = computeRealValue(rawTargetRef, {\n        ...runtimeContext,\n        event,\n      }) as string | string[];\n    }\n    const targetRefs = ([] as string[]).concat(computedTargetRef);\n    const tplHostElement = getTplHostElement(\n      runtimeContext,\n      \"targetRef\",\n      `: ${targetRefs.join(\", \")}`\n    );\n    targets.push(\n      ...(targetRefs\n        .map((ref) => tplHostElement.$$getElementByRef?.(ref))\n        .filter(Boolean) as HTMLElement[])\n    );\n  }\n  if (targets.length === 0) {\n    // eslint-disable-next-line no-console\n    console.error(\"target not found:\", rawTarget || rawTargetRef);\n    return;\n  }\n  if (isExecuteCustomHandler(handler)) {\n    targets.forEach((target) => {\n      brickCallback(\n        event,\n        target,\n        handler,\n        handler.method,\n        runtimeContext,\n        runtimeBrick,\n        {\n          useEventAsDefault: true,\n        }\n      );\n    });\n  } else if (isSetPropsCustomHandler(handler)) {\n    setProperties(targets, handler.properties, {\n      ...runtimeContext,\n      event,\n    });\n  }\n}\n\nasync function brickCallback(\n  event: Event,\n  target: HTMLElement,\n  handler: ExecuteCustomBrickEventHandler | UseProviderEventHandler,\n  method: string,\n  runtimeContext: RuntimeContext,\n  runtimeBrick?: ElementHolder,\n  options?: ArgsFactoryOptions\n): Promise<void> {\n  if (typeof (target as any)[method] !== \"function\") {\n    // eslint-disable-next-line no-console\n    console.error(\"target has no method:\", {\n      target,\n      method: method,\n    });\n    return;\n  }\n\n  const task = async (): Promise<unknown> => {\n    let computedArgs = argsFactory(\n      handler.args,\n      runtimeContext,\n      event,\n      options\n    );\n    if (\n      isUseProviderHandler(handler) &&\n      hooks?.flowApi?.isFlowApiProvider(handler.useProvider)\n    ) {\n      computedArgs = await hooks.flowApi.getArgsOfFlowApi(\n        handler.useProvider,\n        computedArgs,\n        method\n      );\n    }\n    return (target as any)[method](...computedArgs);\n  };\n\n  if (!handler.callback) {\n    task();\n    return;\n  }\n\n  const callbackFactory = eventCallbackFactory(\n    handler.callback,\n    runtimeContext,\n    runtimeBrick\n  );\n\n  const pollableCallback: Required<PollableCallback> = {\n    progress: callbackFactory(\"progress\"),\n    success: callbackFactory(\"success\"),\n    error: callbackFactory(\"error\"),\n    finally: callbackFactory(\"finally\"),\n  };\n\n  let poll: ProviderPollOptions | undefined;\n  if (isUseProviderHandler(handler)) {\n    poll = computeRealValue(handler.poll, { ...runtimeContext, event }) as\n      | ProviderPollOptions\n      | undefined;\n  }\n\n  if (poll?.enabled) {\n    startPoll(task, pollableCallback, poll);\n  } else {\n    try {\n      // Try to catch synchronized tasks too.\n      const result = await task();\n      pollableCallback.success(result);\n    } catch (err) {\n      pollableCallback.error(err);\n    } finally {\n      pollableCallback[\"finally\"]();\n    }\n  }\n}\n\nfunction handleHistoryAction(\n  event: Event,\n  method:\n    | \"push\"\n    | \"replace\"\n    | \"pushQuery\"\n    | \"replaceQuery\"\n    | \"pushAnchor\"\n    | \"block\"\n    | \"goBack\"\n    | \"goForward\"\n    | \"reload\"\n    | \"unblock\",\n  args: unknown[] | undefined,\n  callback: BrickEventHandlerCallback | undefined,\n  runtimeContext: RuntimeContext\n) {\n  let baseArgsLength = 0;\n  let hasCallback = false;\n  let overrideMethod = method as \"setBlockMessage\";\n  switch (method) {\n    case \"push\":\n    case \"replace\":\n    case \"pushQuery\":\n    case \"replaceQuery\":\n    case \"pushAnchor\":\n      baseArgsLength = 2;\n      hasCallback = true;\n      break;\n    case \"reload\":\n      hasCallback = true;\n      break;\n    case \"block\":\n      baseArgsLength = 1;\n      overrideMethod = \"setBlockMessage\";\n      break;\n  }\n  let computedArgs: unknown[] = [];\n  if (baseArgsLength > 0) {\n    computedArgs = argsFactory(args, runtimeContext, event, {\n      useEventDetailAsDefault: true,\n    });\n    computedArgs.length = baseArgsLength;\n  }\n  if (hasCallback && callback) {\n    const callbackFactory = eventCallbackFactory(\n      callback,\n      runtimeContext,\n      undefined\n    );\n    computedArgs.push((blocked: boolean) => {\n      callbackFactory(blocked ? \"error\" : \"success\")({ blocked });\n      callbackFactory(\"finally\")({ blocked });\n    });\n  }\n  (getHistory()[overrideMethod] as (...args: unknown[]) => unknown)(\n    ...computedArgs\n  );\n}\n\nfunction handleWindowAction(\n  event: Event,\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const [url, target, features] = argsFactory(args, runtimeContext, event) as [\n    string,\n    string,\n    string\n  ];\n  window.open(url, target || \"_self\", features);\n}\n\nfunction batchUpdate(\n  args: unknown[],\n  batch: boolean,\n  method: \"replace\" | \"assign\",\n  store: DataStore,\n  runtimeContext: RuntimeContext,\n  event: CustomEvent | Event\n): void {\n  if (batch) {\n    store.updateValues(\n      args as BatchUpdateContextItem[],\n      method,\n      (arg: unknown[]) => {\n        return argsFactory(\n          arg,\n          runtimeContext,\n          event\n        )[0] as BatchUpdateContextItem;\n      }\n    );\n  } else {\n    args.forEach((arg) => {\n      const { name, value } = argsFactory(\n        [arg],\n        runtimeContext,\n        event\n      )[0] as BatchUpdateContextItem;\n      store.updateValue(name, value, method);\n    });\n  }\n}\n\nfunction handleContextAction(\n  event: Event,\n  method: \"assign\" | \"replace\",\n  args: unknown[] | undefined,\n  batch: boolean,\n  callback: BrickEventHandlerCallback | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const isBatch = Array.isArray(args) && args.every(isObject);\n  if (isBatch && (method === \"assign\" || method === \"replace\")) {\n    batchUpdate(\n      args,\n      batch,\n      method,\n      runtimeContext.ctxStore,\n      runtimeContext,\n      event\n    );\n  } else {\n    const [name, value] = argsFactory(args, runtimeContext, event);\n    runtimeContext.ctxStore.updateValue(\n      name as string,\n      value,\n      method,\n      callback,\n      runtimeContext\n    );\n  }\n}\n\nfunction handleTplStateAction(\n  event: Event,\n  method: \"update\" | \"refresh\" | \"load\",\n  args: unknown[] | undefined,\n  batch: boolean,\n  callback: BrickEventHandlerCallback | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const isBatch = Array.isArray(args) && args.every(isObject);\n  if (isBatch && method === \"update\") {\n    batchUpdate(\n      args,\n      batch,\n      \"replace\",\n      runtimeContext.ctxStore,\n      runtimeContext,\n      event\n    );\n  } else {\n    const [name, value] = argsFactory(args, runtimeContext, event);\n    const tplStateStore = getTplStateStore(\n      runtimeContext,\n      `state.${method}`,\n      `: ${name}`\n    );\n    tplStateStore.updateValue(\n      name as string,\n      value,\n      method === \"update\" ? \"replace\" : method,\n      callback,\n      runtimeContext\n    );\n  }\n}\n\nfunction handleFormStateAction(\n  event: Event,\n  args: unknown[] | undefined,\n  callback: BrickEventHandlerCallback | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const [name, value] = argsFactory(args, runtimeContext, event);\n  const formStateStore = getFormStateStore(\n    runtimeContext,\n    \"formstate.update\",\n    `: ${name}`\n  );\n  formStateStore.updateValue(\n    name as string,\n    value,\n    \"replace\",\n    callback,\n    runtimeContext\n  );\n}\n\nfunction handleLocationAction(\n  event: Event,\n  method: \"assign\" | \"reload\",\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext\n) {\n  if (method === \"assign\") {\n    const [url] = argsFactory(args, runtimeContext, event) as [string];\n    location.assign(url);\n  } else {\n    location[method]();\n  }\n}\n\nfunction handleStorageAction(\n  event: Event,\n  object: \"localStorage\" | \"sessionStorage\",\n  method: \"setItem\" | \"removeItem\",\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const storage = object === \"localStorage\" ? localStorage : sessionStorage;\n  const [name, value] = argsFactory(args, runtimeContext, event);\n  if (method === \"setItem\") {\n    if (value !== undefined) {\n      storage.setItem(name as string, JSON.stringify(value));\n    }\n  } else {\n    storage.removeItem(name as string);\n  }\n}\n\nfunction handleConsoleAction(\n  event: Event,\n  method: \"log\" | \"error\" | \"warn\" | \"info\",\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext\n) {\n  // eslint-disable-next-line no-console\n  console[method](\n    ...argsFactory(args, runtimeContext, event, {\n      useEventAsDefault: true,\n    })\n  );\n}\n\nfunction handleMessageAction(\n  event: Event,\n  method: \"success\" | \"error\" | \"info\" | \"warn\",\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext\n) {\n  const computedArgs = argsFactory(args, runtimeContext, event, {\n    useEventAsDefault: true,\n  });\n  Notification.show({\n    type: method,\n    message: computedArgs[0] as string,\n  });\n}\n\nexport function eventCallbackFactory(\n  callback: BrickEventHandlerCallback,\n  runtimeContext: RuntimeContext,\n  runtimeBrick?: ElementHolder\n) {\n  return function callbackFactory(\n    type: \"success\" | \"error\" | \"finally\" | \"progress\"\n  ) {\n    return function (result?: unknown) {\n      const handlers = callback?.[type];\n      if (handlers) {\n        try {\n          const event = new CustomEvent(`callback.${type}`, {\n            detail: result,\n          });\n          listenerFactory(handlers, runtimeContext, runtimeBrick)(event);\n        } catch (err) {\n          // Do not throw errors in `callback.success` or `callback.progress`,\n          // to avoid the following triggering of `callback.error`.\n          // eslint-disable-next-line\n          console.error(err);\n        }\n      } else if (type === \"error\") {\n        // eslint-disable-next-line\n        console.error(\"Unhandled callback error:\", result);\n      }\n    };\n  };\n}\n\ninterface ArgsFactoryOptions {\n  useEventAsDefault?: boolean;\n  useEventDetailAsDefault?: boolean;\n}\n\nfunction argsFactory(\n  args: unknown[] | undefined,\n  runtimeContext: RuntimeContext,\n  event: Event,\n  options: ArgsFactoryOptions = {}\n): unknown[] {\n  return Array.isArray(args)\n    ? (computeRealValue(args, {\n        ...runtimeContext,\n        event,\n      }) as unknown[])\n    : options.useEventAsDefault\n    ? [event]\n    : options.useEventDetailAsDefault\n    ? [(event as CustomEvent).detail]\n    : [];\n}\n","import type {\n  BatchUpdateContextItem,\n  BrickEventHandlerCallback,\n  ContextConf,\n} from \"@next-core/types\";\nimport { hasOwnProperty, isObject } from \"@next-core/utils/general\";\nimport { strictCollectMemberUsage } from \"@next-core/utils/storyboard\";\nimport { eventCallbackFactory, listenerFactory } from \"../bindListeners.js\";\nimport { asyncCheckIf } from \"../compute/checkIf.js\";\nimport {\n  asyncComputeRealValue,\n  computeRealValue,\n} from \"../compute/computeRealValue.js\";\nimport { ResolveOptions, resolveData } from \"./resolveData.js\";\nimport { resolveDataStore } from \"./resolveDataStore.js\";\nimport type {\n  AsyncProperties,\n  RuntimeBrick,\n  RuntimeContext,\n} from \"../interfaces.js\";\nimport { handleHttpError } from \"../../handleHttpError.js\";\n\nexport type DataStoreType = \"CTX\" | \"STATE\" | \"FORM_STATE\";\n\nexport interface DataStoreItem {\n  value: unknown;\n  eventTarget: EventTarget;\n  loaded?: boolean;\n  loading?: Promise<unknown>;\n  load?: (options?: ResolveOptions) => Promise<unknown>;\n  deps: string[];\n}\n\nexport class DataStore<T extends DataStoreType = \"CTX\"> {\n  private readonly type: T;\n  private readonly data = new Map<string, DataStoreItem>();\n  private readonly changeEventType: string;\n  private readonly pendingStack: Array<ReturnType<typeof resolveDataStore>> =\n    [];\n  public readonly hostBrick?: RuntimeBrick;\n  public batchUpdate = false;\n  public batchUpdateContextsNames: string[] = [];\n\n  constructor(type: T, hostBrick?: RuntimeBrick) {\n    this.type = type;\n    this.changeEventType =\n      this.type === \"FORM_STATE\"\n        ? \"formstate.change\"\n        : this.type === \"STATE\"\n        ? \"state.change\"\n        : \"context.change\";\n    this.hostBrick = hostBrick;\n  }\n\n  getValue(name: string): unknown {\n    return this.data.get(name)?.value;\n  }\n\n  getAffectListByContext(name: string): string[] {\n    const affectNames = [name];\n    this.data.forEach((value, key) => {\n      if (value.deps) {\n        const isInDeps = value.deps.some((item) => affectNames.includes(item));\n        isInDeps &&\n          affectNames.push(key) &&\n          affectNames.push(...this.getAffectListByContext(key));\n      }\n    });\n    affectNames.shift();\n    return [...new Set(affectNames)];\n  }\n\n  updateValues(\n    values: BatchUpdateContextItem[],\n    method: \"assign\" | \"replace\",\n    argsFactory: (arg: unknown[]) => BatchUpdateContextItem\n  ): void {\n    this.batchUpdate = true;\n    this.batchUpdateContextsNames = values.map((item) => item.name);\n    if (\n      [...new Set(this.batchUpdateContextsNames)].length !==\n      this.batchUpdateContextsNames.length\n    ) {\n      throw new Error(`Batch update not allow to update same item`);\n    }\n\n    const updateContexts: Record<string, DataStoreItem> = {};\n    const affectContexts: Record<string, DataStoreItem> = {};\n    const affectDepsContextNames: string[] = [];\n\n    values.forEach((arg) => {\n      const { name, value } = argsFactory([arg]);\n      const updateContextItem = this.data.get(name);\n      affectDepsContextNames.push(...this.getAffectListByContext(name));\n      updateContextItem && (updateContexts[name] = updateContextItem);\n      this.updateValue(name as string, value, method);\n    });\n\n    affectDepsContextNames\n      .filter((item) => !updateContexts[item])\n      .forEach((name) => {\n        const affectContextItem = this.data.get(name);\n        affectContextItem && (affectContexts[name] = affectContextItem);\n      });\n\n    const triggerEvent = (contexts: Record<string, DataStoreItem>): void => {\n      for (const key in contexts) {\n        const context = contexts[key];\n        context.eventTarget?.dispatchEvent(\n          new CustomEvent(this.changeEventType, {\n            detail: context.value,\n          })\n        );\n      }\n    };\n\n    triggerEvent(updateContexts);\n    triggerEvent(affectContexts);\n\n    this.batchUpdate = false;\n\n    return;\n  }\n\n  updateValue(\n    name: string,\n    value: unknown,\n    method: \"assign\" | \"replace\" | \"refresh\" | \"load\",\n    callback?: BrickEventHandlerCallback,\n    callbackRuntimeContext?: RuntimeContext\n  ): void {\n    const item = this.data.get(name);\n    if (!item) {\n      throw new Error(`${this.type} '${name}' is not defined`);\n    }\n\n    if (method === \"refresh\" || method === \"load\") {\n      if (!item.load) {\n        throw new Error(\n          `You can not ${method} \"${this.type}.${name}\" which has no resolve`\n        );\n      }\n\n      let promise: Promise<unknown> | undefined;\n      if (method === \"load\") {\n        // Try to reuse previous request when calling `load`.\n        if (item.loaded) {\n          promise = Promise.resolve(item.value);\n        } else if (item.loading) {\n          promise = item.loading;\n        }\n      }\n\n      if (!promise) {\n        promise = item.loading = item.load({\n          cache: method === \"load\" ? \"default\" : \"reload\",\n          ...(value as ResolveOptions),\n        });\n        // Do not use the chained promise, since the callbacks need the original promise.\n        promise.then(\n          (val) => {\n            item.loaded = true;\n            item.value = val;\n            item.eventTarget.dispatchEvent(\n              new CustomEvent(this.changeEventType, {\n                detail: item.value,\n              })\n            );\n          },\n          (err) => {\n            // Let users override error handling.\n            if (!callback?.error) {\n              handleHttpError(err);\n            }\n          }\n        );\n      }\n\n      if (callback) {\n        const callbackFactory = eventCallbackFactory(\n          callback,\n          callbackRuntimeContext!\n        );\n\n        promise.then(\n          (val) => {\n            callbackFactory(\"success\")({ value: val });\n            callbackFactory(\"finally\")();\n          },\n          (err) => {\n            callbackFactory(\"error\")(err);\n            callbackFactory(\"finally\")();\n          }\n        );\n      }\n\n      return;\n    }\n\n    if (method === \"replace\") {\n      item.value = value;\n    } else {\n      if (isObject(item.value)) {\n        Object.assign(item.value, value);\n      } else {\n        // eslint-disable-next-line no-console\n        console.warn(\n          `Non-object current value of \"${this.type}.${name}\" for \"context.assign\", try \"context.replace\" instead.`\n        );\n        item.value = value;\n      }\n    }\n\n    if (this.batchUpdate) return;\n\n    item.eventTarget.dispatchEvent(\n      new CustomEvent(this.changeEventType, {\n        detail: item.value,\n      })\n    );\n  }\n\n  define(\n    dataConfs: ContextConf[] | undefined,\n    runtimeContext: RuntimeContext,\n    asyncHostProperties?: AsyncProperties\n  ): void {\n    if (Array.isArray(dataConfs) && dataConfs.length > 0) {\n      const pending = resolveDataStore(\n        dataConfs,\n        (dataConf: ContextConf) =>\n          this.resolve(dataConf, runtimeContext, asyncHostProperties),\n        this.type\n      );\n      this.pendingStack.push(pending);\n    }\n  }\n\n  onChange(dataName: string, listener: EventListener): void {\n    this.data\n      .get(dataName)\n      ?.eventTarget.addEventListener(this.changeEventType, listener);\n  }\n\n  async waitFor(dataNames: string[] | Set<string>): Promise<void> {\n    for (const { pendingContexts } of this.pendingStack) {\n      await Promise.all(\n        [...dataNames].map((ctx) => {\n          const p = pendingContexts.get(ctx);\n          return p;\n        })\n      );\n    }\n  }\n\n  async waitForAll(): Promise<void> {\n    for (const { pendingResult } of this.pendingStack) {\n      await pendingResult;\n    }\n  }\n\n  private async resolve(\n    dataConf: ContextConf,\n    runtimeContext: RuntimeContext,\n    asyncHostProperties?: AsyncProperties\n  ): Promise<boolean> {\n    if (!(await asyncCheckIf(dataConf, runtimeContext))) {\n      return false;\n    }\n    let value: unknown;\n    if (\n      asyncHostProperties &&\n      (this.type === \"STATE\" ? dataConf.expose : this.type === \"FORM_STATE\")\n    ) {\n      const hostProps = await asyncHostProperties;\n      if (hasOwnProperty(hostProps, dataConf.name)) {\n        value = hostProps[dataConf.name];\n      }\n    }\n    let load: DataStoreItem[\"load\"];\n    let isLazyResolve: boolean | undefined = false;\n    if (value === undefined) {\n      if (dataConf.resolve) {\n        const resolveConf = {\n          transform: \"value\",\n          ...dataConf.resolve,\n        };\n        if (await asyncCheckIf(dataConf.resolve, runtimeContext)) {\n          load = async (options) =>\n            (\n              (await resolveData(resolveConf, runtimeContext, options)) as {\n                value: unknown;\n              }\n            ).value;\n          isLazyResolve = dataConf.resolve.lazy;\n          if (!isLazyResolve) {\n            value = await load();\n          }\n        } else if (!hasOwnProperty(dataConf, \"value\")) {\n          return false;\n        }\n      }\n      if ((!load || isLazyResolve) && dataConf.value !== undefined) {\n        // If the context has no resolve, just use its `value`.\n        // Or if the resolve is ignored or lazy, use its `value` as a fallback.\n        value = await asyncComputeRealValue(dataConf.value, runtimeContext);\n      }\n    }\n\n    const newData: DataStoreItem = {\n      value,\n      // This is required for tracking context, even if no `onChange` is specified.\n      eventTarget: new EventTarget(),\n      load,\n      loaded: !isLazyResolve,\n      deps: [],\n    };\n\n    if (dataConf.onChange) {\n      newData.eventTarget.addEventListener(\n        this.changeEventType,\n        listenerFactory(dataConf.onChange, runtimeContext)\n      );\n    }\n\n    if (dataConf.track) {\n      const deps = strictCollectMemberUsage(\n        load ? dataConf.resolve : dataConf.value,\n        this.type\n      );\n      !load && (newData.deps = [...deps]);\n      for (const dep of deps) {\n        this.onChange(\n          dep,\n          this.batchAddListener(() => {\n            if (load) {\n              this.updateValue(dataConf.name, { cache: \"default\" }, \"refresh\");\n            } else {\n              this.updateValue(\n                dataConf.name,\n                computeRealValue(dataConf.value, runtimeContext),\n                \"replace\"\n              );\n            }\n          }, dataConf)\n        );\n      }\n    }\n\n    if (this.data.has(dataConf.name)) {\n      throw new Error(\n        `${this.type} '${dataConf.name}' has already been declared`\n      );\n    }\n    this.data.set(dataConf.name, newData);\n\n    return true;\n  }\n\n  batchAddListener(\n    listener: EventListener,\n    contextConf: ContextConf\n  ): EventListener {\n    return (event: Event | CustomEvent): void => {\n      if (\n        this.batchUpdate &&\n        this.batchUpdateContextsNames.includes(contextConf.name)\n      ) {\n        return;\n      }\n      listener(event);\n    };\n  }\n}\n","import { ContextConf } from \"@next-core/types\";\nimport { collectMemberUsage, MemberUsage } from \"@next-core/utils/storyboard\";\n\nexport interface DeferredContext {\n  resolve(): void;\n  reject(e: unknown): void;\n}\n\nexport function resolveDataStore(\n  contextConfs: ContextConf[],\n  resolveContext: (contextConf: ContextConf) => Promise<boolean>,\n  keyword = \"CTX\"\n): {\n  pendingResult: Promise<void>;\n  pendingContexts: Map<string, Promise<void>>;\n} {\n  const dependencyMap = getDependencyMapOfContext(contextConfs, keyword);\n  // There maybe multiple context confs for a specific name, since there are conditional contexts.\n  // This is a map of how many pending context confs for each context name.\n  const pendingDeps = new Map<string, number>();\n  for (const contextName of Array.from(dependencyMap.keys()).map(\n    (contextConf) => contextConf.name\n  )) {\n    pendingDeps.set(contextName, (pendingDeps.get(contextName) ?? 0) + 1);\n  }\n  const hasNonStaticUsage = Array.from(dependencyMap.values()).some(\n    (stats) => stats.hasNonStaticUsage\n  );\n  const processed = new WeakSet<ContextConf>();\n\n  const deferredContexts = new Map<string, DeferredContext>();\n  const pendingContexts = new Map(\n    [...new Set(contextConfs.map((contextConf) => contextConf.name))].map(\n      (contextName) => [\n        contextName,\n        new Promise<void>((resolve, reject) => {\n          deferredContexts.set(contextName, { resolve, reject });\n        }),\n      ]\n    )\n  );\n\n  const wrapResolve = async (contextConf: ContextConf): Promise<void> => {\n    processed.add(contextConf);\n    const resolved = await resolveContext(contextConf);\n    dependencyMap.delete(contextConf);\n    const left = pendingDeps.get(contextConf.name) ?? 0;\n    if (resolved) {\n      // Assert: contextConf.name exists in deferredContexts\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      deferredContexts.get(contextConf.name)!.resolve();\n      pendingDeps.delete(contextConf.name);\n      if (left === 0) {\n        throw new Error(`Duplicated context defined: ${contextConf.name}`);\n      }\n    } else {\n      // Assert: left >= 1\n      if (left === 1) {\n        // Assert: contextConf.name exists in deferredContexts\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        deferredContexts.get(contextConf.name)!.resolve();\n        pendingDeps.delete(contextConf.name);\n      } else {\n        pendingDeps.set(contextConf.name, left - 1);\n      }\n    }\n    await scheduleNext();\n  };\n\n  let scheduleAsSerial = hasNonStaticUsage;\n\n  async function scheduleNext(): Promise<void> {\n    const readyContexts = Array.from(dependencyMap.entries())\n      .filter(predicateNextResolveFactory(pendingDeps, scheduleAsSerial))\n      .map((entry) => entry[0])\n      .filter((contextConf) => !processed.has(contextConf));\n    await Promise.all(readyContexts.map(wrapResolve));\n  }\n\n  const pendingResult = scheduleNext()\n    .then(async () => {\n      // If there are still contexts left, it implies one of these situations:\n      //   - Circular contexts.\n      //     Such as: a depends on b, while b depends on a.\n      //   - Related contexts are all ignored.\n      //     Such as: a depends on b,\n      //     while both them are ignore by a falsy result of `if`.\n      if (dependencyMap.size > 0) {\n        // This will throw if circular contexts detected.\n        detectCircularContexts(dependencyMap, keyword);\n        scheduleAsSerial = true;\n        await scheduleNext();\n      }\n      // There maybe ignored contexts which are still not fulfilled.\n      // We treat them as RESOLVED.\n      for (const deferred of deferredContexts.values()) {\n        deferred.resolve();\n      }\n    })\n    .catch((error) => {\n      // There maybe contexts left not fulfilled, when an error occurred.\n      // We treat them as REJECTED.\n      for (const deferred of deferredContexts.values()) {\n        deferred.reject(error);\n      }\n      throw error;\n    });\n  return { pendingResult, pendingContexts };\n}\n\nfunction predicateNextResolveFactory(\n  pendingDeps: Map<string, number>,\n  scheduleAsSerial: boolean\n): (entry: [ContextConf, MemberUsage], index: number) => boolean {\n  return (entry, index) =>\n    // When contexts contain computed CTX accesses, it implies a dynamic dependency map.\n    // So make them process sequentially, keep the same behavior as before.\n    scheduleAsSerial\n      ? index === 0\n      : // A context is ready when it has no pending dependencies.\n        ![...entry[1].usedProperties].some((dep) => pendingDeps.has(dep));\n}\n\nexport function getDependencyMapOfContext(\n  contextConfs: ContextConf[],\n  keyword = \"CTX\"\n): Map<ContextConf, MemberUsage> {\n  const depsMap = new Map<ContextConf, MemberUsage>();\n  for (const contextConf of contextConfs) {\n    const stats = collectMemberUsage(\n      [contextConf.if, contextConf.value, contextConf.resolve],\n      keyword\n    );\n    depsMap.set(contextConf, stats);\n  }\n  return depsMap;\n}\n\nfunction detectCircularContexts(\n  dependencyMap: Map<ContextConf, MemberUsage>,\n  keyword: string\n): void {\n  const duplicatedMap = new Map(dependencyMap);\n  const pendingDeps = new Set<string>(\n    Array.from(duplicatedMap.keys()).map((contextConf) => contextConf.name)\n  );\n  const next = (): void => {\n    let processedAtLeastOne = false;\n    for (const [contextConf, stats] of duplicatedMap.entries()) {\n      if (![...stats.usedProperties].some((dep) => pendingDeps.has(dep))) {\n        duplicatedMap.delete(contextConf);\n        pendingDeps.delete(contextConf.name);\n        processedAtLeastOne = true;\n      }\n    }\n    if (processedAtLeastOne) {\n      next();\n    }\n  };\n  next();\n\n  if (duplicatedMap.size > 0) {\n    throw new ReferenceError(\n      `Circular ${keyword} detected: ${Array.from(duplicatedMap.keys())\n        .map((contextConf) => contextConf.name)\n        .join(\", \")}`\n    );\n  }\n}\n","import type { BrickConf, RouteConf, SlotsConfOfBricks } from \"@next-core/types\";\nimport { hasOwnProperty } from \"@next-core/utils/general\";\nimport { clamp } from \"lodash\";\nimport {\n  symbolForAsyncComputedPropsFromHost,\n  symbolForTPlExternalForEachItem,\n  symbolForTplStateStoreId,\n} from \"./constants.js\";\nimport type { AsyncProperties, TemplateHostContext } from \"../interfaces.js\";\n\nexport function setupTemplateProxy(\n  hostContext: TemplateHostContext,\n  ref: string | undefined,\n  slots: SlotsConfOfBricks\n) {\n  const {\n    reversedProxies,\n    asyncHostProperties,\n    externalSlots,\n    tplStateStoreId,\n    hostBrick,\n  } = hostContext;\n\n  let asyncComputedProps: AsyncProperties | undefined;\n\n  if (ref && reversedProxies) {\n    const propertyProxies = reversedProxies.properties.get(ref);\n    if (propertyProxies) {\n      const getComputedProps = (hostProps: Record<string, unknown>) => {\n        const props: Record<string, unknown> = {};\n        for (const { from, to } of propertyProxies) {\n          const propValue = hostProps[from];\n          if (propValue !== undefined && to.refProperty) {\n            props[to.refProperty] = propValue;\n          }\n        }\n        return props;\n      };\n\n      asyncComputedProps = (asyncHostProperties as AsyncProperties).then(\n        getComputedProps\n      );\n    }\n\n    const slotProxies = reversedProxies.slots.get(ref);\n    if (slotProxies && externalSlots) {\n      // Use an approach like template-literal's quasis:\n      // `quasi0${0}quais1${1}quasi2...`\n      // Every quasi (indexed by `refPosition`) can be slotted with multiple bricks.\n      const quasisMap = new Map<string, BrickConf[][]>();\n\n      for (const { from, to } of slotProxies) {\n        const insertBricks = externalSlots[from]?.bricks ?? [];\n        if (!insertBricks.length) {\n          continue;\n        }\n        const refToSlot = to.refSlot ?? from;\n        let expandableSlot = quasisMap.get(refToSlot);\n        if (!expandableSlot) {\n          expandableSlot = [];\n          // The size of quasis should be the existed slotted bricks' size plus one.\n          const size = hasOwnProperty(slots, refToSlot)\n            ? slots[refToSlot].bricks.length + 1\n            : 1;\n          for (let i = 0; i < size; i += 1) {\n            expandableSlot.push([]);\n          }\n          quasisMap.set(refToSlot, expandableSlot);\n        }\n        const refPosition = to.refPosition ?? -1;\n        expandableSlot[\n          clamp(\n            refPosition < 0 ? expandableSlot.length + refPosition : refPosition,\n            0,\n            expandableSlot.length - 1\n          )\n        ].push(\n          ...(hasOwnProperty(hostBrick.runtimeContext, \"forEachItem\")\n            ? setupTemplateExternalBricks(\n                insertBricks,\n                hostBrick.runtimeContext.forEachItem\n              )\n            : insertBricks)\n        );\n      }\n\n      for (const [slotName, quasis] of quasisMap.entries()) {\n        if (!hasOwnProperty(slots, slotName)) {\n          slots[slotName] = {\n            type: \"bricks\",\n            bricks: [],\n          };\n        }\n        const slotConf = slots[slotName];\n        slotConf.bricks = quasis.flatMap((bricks, index) =>\n          index < slotConf.bricks.length\n            ? bricks.concat(slotConf.bricks[index])\n            : bricks\n        );\n\n        if (slotConf.bricks.length === 0) {\n          delete slots[slotName];\n        }\n      }\n    }\n  }\n\n  return {\n    [symbolForAsyncComputedPropsFromHost]: asyncComputedProps,\n    [symbolForTplStateStoreId]: tplStateStoreId,\n  };\n}\n\n// External bricks of a template, have the same forEachItem context as their host.\nfunction setupTemplateExternalBricks(\n  bricks: BrickConf[],\n  forEachItem: unknown\n): BrickConf[] {\n  return bricks.map((brick) => ({\n    ...brick,\n    [symbolForTPlExternalForEachItem]: forEachItem,\n    slots: Object.fromEntries(\n      Object.entries(brick.slots ?? {}).map(([slotName, slotConf]) => [\n        slotName,\n        slotConf.type === \"routes\"\n          ? {\n              type: \"routes\",\n              routes: setupTemplateExternalRoutes(slotConf.routes, forEachItem),\n            }\n          : {\n              type: \"bricks\",\n              bricks: setupTemplateExternalBricks(\n                slotConf.bricks ?? [],\n                forEachItem\n              ),\n            },\n      ])\n    ),\n  }));\n}\n\nfunction setupTemplateExternalRoutes(\n  routes: RouteConf[],\n  forEachItem: unknown\n): RouteConf[] {\n  return routes.map((route) =>\n    route.type && route.type !== \"bricks\"\n      ? route\n      : {\n          ...route,\n          bricks: setupTemplateExternalBricks(route.bricks, forEachItem),\n        }\n  );\n}\n","import type { UseBrickSlotsConf, UseSingleBrickConf } from \"@next-core/types\";\nimport { isObject } from \"@next-core/utils/general\";\nimport type { TemplateHostContext } from \"../interfaces.js\";\nimport { setupTemplateProxy } from \"./setupTemplateProxy.js\";\nimport { childrenToSlots } from \"../Renderer.js\";\n\nexport function setupUseBrickInTemplate<T>(\n  props: T,\n  hostContext: TemplateHostContext\n): T {\n  function walk<P>(props: P): P {\n    if (!isObject(props)) {\n      return props;\n    }\n\n    if (Array.isArray(props)) {\n      return props.map(walk) as P;\n    }\n\n    return Object.fromEntries(\n      Object.entries(props)\n        .map(([key, value]) =>\n          isObject(value) && key === \"useBrick\"\n            ? Array.isArray(value)\n              ? [key, value.map(setup)]\n              : [key, setup(value as UseSingleBrickConf)]\n            : [key, walk(value)]\n        )\n        .concat(\n          Object.getOwnPropertySymbols(props).map((k) => [\n            k,\n            (props as Record<string | symbol, unknown>)[k],\n          ])\n        )\n    ) as P;\n  }\n\n  function setup(item: UseSingleBrickConf): UseSingleBrickConf {\n    const { properties, slots: originalSlots, children, ...restConf } = item;\n\n    const transpiledSlots = childrenToSlots(children, originalSlots) as\n      | UseBrickSlotsConf\n      | undefined;\n\n    const slots = Object.fromEntries(\n      Object.entries(transpiledSlots ?? {}).map(([slotName, slotConf]) => [\n        slotName,\n        {\n          type: \"bricks\",\n          bricks: (slotConf.bricks ?? []).map(setup),\n        },\n      ])\n    ) as UseBrickSlotsConf;\n\n    return {\n      ...restConf,\n      properties: walk(properties),\n      slots,\n      ...setupTemplateProxy(hostContext, restConf.ref, slots),\n    };\n  }\n\n  return walk(props);\n}\n","import type {\n  BrickConf,\n  BrickConfInTemplate,\n  SlotsConfInTemplate,\n  SlotsConfOfBricks,\n  UseSingleBrickConf,\n} from \"@next-core/types\";\nimport { uniqueId } from \"lodash\";\nimport { customTemplates } from \"../../CustomTemplates.js\";\nimport { DataStore } from \"../data/DataStore.js\";\nimport { RuntimeBrickConfWithTplSymbols } from \"./constants.js\";\nimport { setupTemplateProxy } from \"./setupTemplateProxy.js\";\nimport type {\n  AsyncProperties,\n  RuntimeBrick,\n  TemplateHostBrick,\n  TemplateHostContext,\n} from \"../interfaces.js\";\nimport { setupUseBrickInTemplate } from \"./setupUseBrickInTemplate.js\";\nimport { childrenToSlots } from \"../Renderer.js\";\nimport { hooks } from \"../Runtime.js\";\n\nexport function expandCustomTemplate<T extends BrickConf | UseSingleBrickConf>(\n  tplTagName: string,\n  brickConf: T,\n  hostBrick: RuntimeBrick,\n  asyncHostProperties: AsyncProperties\n): T {\n  const tplStateStoreId = uniqueId(\"tpl-state-\");\n  const runtimeContext = {\n    ...hostBrick.runtimeContext,\n    tplStateStoreId,\n  };\n\n  // There is a boundary for `forEachItem` and `FORM_STATE` between template internals and externals.\n  delete runtimeContext.forEachItem;\n  delete runtimeContext.formStateStoreId;\n\n  const tplStateStore = new DataStore(\"STATE\", hostBrick);\n  runtimeContext.tplStateStoreMap.set(tplStateStoreId, tplStateStore);\n  if (runtimeContext.tplStateStoreScope) {\n    runtimeContext.tplStateStoreScope.push(tplStateStore);\n  }\n\n  const { bricks, proxy, state, contracts } = customTemplates.get(tplTagName)!;\n  hooks?.flowApi?.collectWidgetContract(contracts);\n  tplStateStore.define(state, runtimeContext, asyncHostProperties);\n\n  const {\n    slots: originalExternalSlots,\n    children: externalChildren,\n    ...restBrickConf\n  } = brickConf;\n\n  const newBrickConf = {\n    ...restBrickConf,\n    brick: tplTagName,\n  } as T;\n\n  hostBrick.tplHostMetadata = {\n    internalBricksByRef: new Map(),\n    tplStateStoreId,\n    proxy,\n  };\n\n  // Reversed proxies are used for expand storyboard before rendering page.\n  const reversedProxies: TemplateHostContext[\"reversedProxies\"] = {\n    properties: new Map(),\n    slots: new Map(),\n    // mergeBases: new Map(),\n  };\n\n  if (proxy?.properties) {\n    for (const [from, to] of Object.entries(proxy.properties)) {\n      let proxies = reversedProxies.properties.get(to.ref);\n      if (!proxies) {\n        proxies = [];\n        reversedProxies.properties.set(to.ref, proxies);\n      }\n      proxies.push({\n        from,\n        to,\n      });\n    }\n  }\n\n  if (proxy?.slots) {\n    for (const [from, to] of Object.entries(proxy.slots)) {\n      let proxies = reversedProxies.slots.get(to.ref);\n      if (!proxies) {\n        proxies = [];\n        reversedProxies.slots.set(to.ref, proxies);\n      }\n      proxies.push({\n        from,\n        to,\n      });\n    }\n  }\n\n  const hostContext: TemplateHostContext = {\n    reversedProxies,\n    asyncHostProperties,\n    externalSlots: childrenToSlots(externalChildren, originalExternalSlots) as\n      | SlotsConfOfBricks\n      | undefined,\n    tplStateStoreId,\n    hostBrick: hostBrick as TemplateHostBrick,\n  };\n\n  newBrickConf.slots = {\n    \"\": {\n      type: \"bricks\",\n      bricks: bricks.map((item) => expandBrickInTemplate(item, hostContext)),\n    },\n  };\n\n  return newBrickConf;\n}\n\nfunction expandBrickInTemplate(\n  brickConfInTemplate: BrickConfInTemplate,\n  hostContext: TemplateHostContext\n): RuntimeBrickConfWithTplSymbols {\n  // Ignore `if: null` to make `looseCheckIf` working.\n  if (brickConfInTemplate.if === null) {\n    delete brickConfInTemplate.if;\n  }\n  const {\n    properties,\n    slots: slotsInTemplate,\n    children: childrenInTemplate,\n    ...restBrickConfInTemplate\n  } = brickConfInTemplate;\n\n  const transpiledSlots = childrenToSlots(\n    childrenInTemplate,\n    slotsInTemplate\n  ) as SlotsConfInTemplate | undefined;\n\n  const slots: SlotsConfOfBricks = Object.fromEntries(\n    Object.entries(transpiledSlots ?? {}).map(([slotName, slotConf]) => [\n      slotName,\n      {\n        type: \"bricks\",\n        bricks: (slotConf.bricks ?? []).map((item) =>\n          expandBrickInTemplate(item, hostContext)\n        ),\n      },\n    ])\n  );\n\n  return {\n    ...restBrickConfInTemplate,\n    properties: setupUseBrickInTemplate(properties, hostContext),\n    slots,\n    ...setupTemplateProxy(hostContext, restBrickConfInTemplate.ref, slots),\n  };\n}\n","export enum RenderTag {\n  ROOT = 1,\n  BRICK = 2,\n}\n","import type { BrickConf } from \"@next-core/types\";\n\nexport const FORM_RENDERER = \"form-renderer.form-renderer\";\nexport const symbolForFormStateStoreId = Symbol.for(\"form.stateStoreId\");\n\nexport type RuntimeBrickConfWithFormSymbols = BrickConf &\n  RuntimeBrickConfOfFormSymbols;\n\nexport interface RuntimeBrickConfOfFormSymbols {\n  [symbolForFormStateStoreId]?: string;\n}\n","import type { BrickConf, BrickEventsMap } from \"@next-core/types\";\nimport { hasOwnProperty } from \"@next-core/utils/general\";\nimport { uniqueId } from \"lodash\";\nimport { DataStore } from \"../data/DataStore.js\";\nimport type { AsyncProperties, RuntimeBrick } from \"../interfaces.js\";\nimport type {\n  FieldProperties,\n  FormDataProperties,\n  FormSchemaProperties,\n} from \"./interfaces.js\";\nimport { getDefaultProperties } from \"./getDefaultProperties.js\";\nimport { symbolForFormStateStoreId } from \"./constants.js\";\n\nexport function expandFormRenderer(\n  formData: unknown,\n  hostBrickConf: BrickConf,\n  hostBrick: RuntimeBrick,\n  asyncHostProperties: AsyncProperties\n): BrickConf {\n  const normalizedFormData = (\n    typeof formData === \"string\" ? JSON.parse(formData) : formData\n  ) as FormDataProperties;\n\n  const formStateStoreId = uniqueId(\"form-state-\");\n  const runtimeContext = {\n    ...hostBrick.runtimeContext,\n    formStateStoreId,\n  };\n\n  // There is a boundary for `forEachItem` and `STATE` between form internals and externals.\n  delete runtimeContext.forEachItem;\n  delete runtimeContext.tplStateStoreId;\n\n  const formStateStore = new DataStore(\"FORM_STATE\");\n  runtimeContext.formStateStoreMap.set(formStateStoreId, formStateStore);\n  if (runtimeContext.formStateStoreScope) {\n    runtimeContext.formStateStoreScope.push(formStateStore);\n  }\n\n  // Always add a state of `params`.\n  const context = normalizedFormData.context ?? [];\n  if (!context.some((ctx) => ctx.name === \"params\")) {\n    context.push({ name: \"params\" });\n  }\n\n  formStateStore.define(context, runtimeContext, asyncHostProperties);\n\n  const formConf = formSchemaToBrick(\n    normalizedFormData.formSchema,\n    normalizedFormData.fields,\n    formStateStoreId\n  );\n\n  if (formConf.brick === \"forms.general-form\" && hostBrickConf.events) {\n    formConf.events = mergeEvents(formConf.events, hostBrickConf.events);\n  }\n\n  const renderRoot =\n    typeof hostBrickConf.properties?.renderRoot !== \"boolean\" ||\n    hostBrickConf.properties.renderRoot;\n\n  if (renderRoot) {\n    return {\n      ...hostBrickConf,\n      slots: undefined,\n      children: [\n        {\n          brick: \"basic-bricks.micro-view\",\n          properties: { style: { padding: \"12px\" } },\n          slots: {\n            content: { bricks: [formConf], type: \"bricks\" },\n          },\n        },\n      ],\n    };\n  }\n\n  return {\n    ...hostBrickConf,\n    slots: undefined,\n    children: [formConf],\n  };\n}\n\nfunction formSchemaToBrick(\n  schema: FormSchemaProperties,\n  fields: FieldProperties[],\n  formStateStoreId: string\n): BrickConf {\n  const { id, bricks, events, context, mountPoint, instanceId: iid } = schema;\n  let { brick, properties } = schema;\n\n  // 根据字段类型获取默认配置\n  const field = fields.find((item: FieldProperties) => item.fieldId === id);\n  if (field) {\n    const defaults = getDefaultProperties(field);\n    if (!brick) {\n      brick = defaults.brick;\n    }\n    properties = {\n      ...defaults.properties,\n      ...properties,\n    };\n  }\n\n  const brickConf = {\n    brick,\n    properties,\n    iid,\n    slot: mountPoint,\n    events,\n    context,\n    children: formSchemasToBricks(bricks, fields, formStateStoreId),\n    [symbolForFormStateStoreId]: formStateStoreId,\n  } as BrickConf;\n\n  if (hasOwnProperty(schema, \"if\")) {\n    brickConf.if = schema.if;\n  }\n\n  return brickConf;\n}\n\nfunction formSchemasToBricks(\n  schemas: FormSchemaProperties[] | undefined,\n  fields: FieldProperties[],\n  formStateStoreId: string\n): BrickConf[] | undefined {\n  if (Array.isArray(schemas)) {\n    return schemas.map((schema) =>\n      formSchemaToBrick(schema, fields, formStateStoreId)\n    );\n  }\n}\n\nfunction mergeEvents(\n  targetEvents: BrickEventsMap | undefined,\n  sourceEvents: BrickEventsMap\n): BrickEventsMap {\n  const events = targetEvents ?? {};\n\n  for (const [eventType, handlers] of Object.entries(sourceEvents)) {\n    events[eventType] = hasOwnProperty(events, eventType)\n      ? [events[eventType], handlers].flat()\n      : handlers;\n  }\n\n  return events;\n}\n","import type { DefaultFieldProperties, FieldProperties } from \"./interfaces.js\";\n\nexport function getDefaultProperties(\n  field: FieldProperties\n): DefaultFieldProperties {\n  let defaultValue: DefaultFieldProperties;\n  const commonProps = {\n    id: field.fieldId,\n    name: field.fieldId,\n    label: field.name,\n    dataset: {\n      testid: field.fieldId,\n    },\n  };\n  const getReadOnlyAndRequired = () => ({\n    readOnly: field.limit?.includes(\"READONLY\"),\n    required: field.limit?.includes(\"REQUIRED\"),\n  });\n  switch (field.fieldType) {\n    case \"INT\":\n      defaultValue = {\n        brick: \"forms.general-input-number\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          placeholder: field.description,\n          precision: 0,\n          inputBoxStyle: { width: \"100%\" },\n        },\n      };\n      break;\n    case \"BOOLEAN\":\n      defaultValue = {\n        brick: \"forms.general-switch\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n        },\n      };\n      break;\n    case \"FLOAT\":\n      defaultValue = {\n        brick: \"forms.general-input-number\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          placeholder: field.description,\n          inputBoxStyle: { width: \"100%\" },\n        },\n      };\n      break;\n    case \"ENUM\":\n      defaultValue = {\n        brick: \"forms.general-select\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          options: [\n            { label: \"选项一\", value: 1 },\n            { label: \"选项二\", value: 2 },\n          ],\n          placeholder: field.description,\n          inputBoxStyle: { width: \"100%\" },\n        },\n      };\n      break;\n    case \"ENUMS\":\n      defaultValue = {\n        brick: \"forms.general-select\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          mode: \"multiple\",\n          options: [\n            { label: \"选项一\", value: 1 },\n            { label: \"选项二\", value: 2 },\n          ],\n          placeholder: field.description,\n          inputBoxStyle: { width: \"100%\" },\n        },\n      };\n      break;\n    case \"DATE\":\n    case \"TIME\":\n      defaultValue = {\n        brick: \"forms.general-date-picker\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          placeholder: field.description,\n        },\n      };\n      break;\n    case \"IP\":\n      defaultValue = {\n        brick: \"forms.general-input\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          placeholder: field.description,\n          pattern:\n            \"((^s*((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]).){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]))s*$)|(^s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:)))(%.+)?s*$))\",\n          message: {\n            pattern: \"输入字符不匹配IP格式\",\n          },\n        },\n      };\n      break;\n    case \"JSON\":\n      defaultValue = {\n        brick: \"forms.general-textarea\",\n        properties: {\n          ...commonProps,\n        },\n      };\n      break;\n    case \"ARRAY\":\n      defaultValue = {\n        brick: \"forms.general-select\",\n        properties: {\n          ...commonProps,\n        },\n      };\n      break;\n    case \"STRUCTURE\":\n    case \"STRUCTURE_ARRAY\":\n      defaultValue = {\n        brick: \"forms.cmdb-instance-select-panel\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n        },\n      };\n      break;\n    default:\n      defaultValue = {\n        brick: \"forms.general-input\",\n        properties: {\n          ...commonProps,\n          ...getReadOnlyAndRequired(),\n          placeholder: field.description,\n        },\n      };\n  }\n  return defaultValue;\n}\n","import type {\n  BrickConf,\n  BrickConfInTemplate,\n  ContextConf,\n  MenuConf,\n  RouteConf,\n  SlotConfOfBricks,\n  SlotsConf,\n  StaticMenuConf,\n} from \"@next-core/types\";\nimport {\n  enqueueStableLoadBricks,\n  loadBricksImperatively,\n} from \"@next-core/loader\";\nimport { isTrackAll } from \"@next-core/cook\";\nimport { hasOwnProperty } from \"@next-core/utils/general\";\nimport { debounce } from \"lodash\";\nimport { asyncCheckBrickIf } from \"./compute/checkIf.js\";\nimport { asyncComputeRealProperties } from \"./compute/computeRealProperties.js\";\nimport { resolveData } from \"./data/resolveData.js\";\nimport { asyncComputeRealValue } from \"./compute/computeRealValue.js\";\nimport {\n  TrackingContextItem,\n  listenOnTrackingContext,\n} from \"./compute/listenOnTrackingContext.js\";\nimport { RendererContext } from \"./RendererContext.js\";\nimport { matchRoutes } from \"./matchRoutes.js\";\nimport {\n  symbolForAsyncComputedPropsFromHost,\n  symbolForTPlExternalForEachItem,\n  symbolForTplStateStoreId,\n} from \"./CustomTemplates/constants.js\";\nimport { expandCustomTemplate } from \"./CustomTemplates/expandCustomTemplate.js\";\nimport type {\n  RenderBrick,\n  RenderNode,\n  RuntimeBrickConfWithSymbols,\n  RuntimeContext,\n} from \"./interfaces.js\";\nimport {\n  getTagNameOfCustomTemplate,\n  getTplStateStore,\n} from \"./CustomTemplates/utils.js\";\nimport { customTemplates } from \"../CustomTemplates.js\";\nimport type { NextHistoryState } from \"./historyExtended.js\";\nimport { getBrickPackages, hooks } from \"./Runtime.js\";\nimport { RenderTag } from \"./enums.js\";\nimport { getTracks } from \"./compute/getTracks.js\";\nimport { isStrictMode, warnAboutStrictMode } from \"../isStrictMode.js\";\nimport {\n  FORM_RENDERER,\n  RuntimeBrickConfOfFormSymbols,\n  symbolForFormStateStoreId,\n} from \"./FormRenderer/constants.js\";\nimport { expandFormRenderer } from \"./FormRenderer/expandFormRenderer.js\";\nimport { isPreEvaluated } from \"./compute/evaluate.js\";\nimport { getPreEvaluatedRaw } from \"./compute/evaluate.js\";\nimport { RuntimeBrickConfOfTplSymbols } from \"./CustomTemplates/constants.js\";\n\nexport interface RenderOutput {\n  node?: RenderBrick;\n  unauthenticated?: boolean;\n  redirect?: {\n    path: string;\n    state?: NextHistoryState;\n  };\n  route?: RouteConf;\n  blockingList: (Promise<unknown> | undefined)[];\n  menuRequests: (Promise<StaticMenuConf | undefined> | undefined)[];\n  hasTrackingControls?: boolean;\n}\n\nexport async function renderRoutes(\n  returnNode: RenderNode,\n  routes: RouteConf[],\n  _runtimeContext: RuntimeContext,\n  rendererContext: RendererContext,\n  slotId?: string\n): Promise<RenderOutput> {\n  const matched = await matchRoutes(routes, _runtimeContext);\n  const output: RenderOutput = {\n    blockingList: [],\n    menuRequests: [],\n  };\n  switch (matched) {\n    case \"missed\":\n      break;\n    case \"unauthenticated\":\n      output.unauthenticated = true;\n      break;\n    default: {\n      const route = (output.route = matched.route);\n      const runtimeContext = {\n        ..._runtimeContext,\n        match: matched.match,\n      };\n      runtimeContext.ctxStore.define(route.context, runtimeContext);\n      runtimeContext.pendingPermissionsPreCheck.push(\n        hooks?.checkPermissions?.preCheckPermissionsForBrickOrRoute(\n          route,\n          (value) => asyncComputeRealValue(value, runtimeContext)\n        )\n      );\n\n      // Currently, this is only used for brick size-checking: these bricks\n      // will be loaded before page rendering, but they will NOT be rendered.\n      const { preLoadBricks } = route as { preLoadBricks?: string[] };\n      if (Array.isArray(preLoadBricks)) {\n        output.blockingList.push(\n          loadBricksImperatively(preLoadBricks, getBrickPackages())\n        );\n      }\n\n      switch (route.type) {\n        case \"redirect\": {\n          let redirectTo: unknown;\n          if (typeof route.redirect === \"string\") {\n            redirectTo = await asyncComputeRealValue(\n              route.redirect,\n              runtimeContext\n            );\n          } else {\n            const resolved = (await resolveData(\n              {\n                transform: \"redirect\",\n                ...route.redirect,\n              },\n              runtimeContext\n            )) as { redirect?: unknown };\n            redirectTo = resolved.redirect;\n          }\n          if (typeof redirectTo !== \"string\") {\n            // eslint-disable-next-line no-console\n            console.error(\"Unexpected redirect result:\", redirectTo);\n            throw new Error(\n              `Unexpected type of redirect result: ${typeof redirectTo}`\n            );\n          }\n          output.redirect = { path: redirectTo };\n          break;\n        }\n        case \"routes\": {\n          output.menuRequests.push(loadMenu(route.menu, runtimeContext));\n          const newOutput = await renderRoutes(\n            returnNode,\n            route.routes,\n            runtimeContext,\n            rendererContext,\n            slotId\n          );\n          mergeRenderOutput(output, newOutput);\n          break;\n        }\n        default: {\n          output.menuRequests.push(loadMenu(route.menu, runtimeContext));\n          const newOutput = await renderBricks(\n            returnNode,\n            route.bricks,\n            runtimeContext,\n            rendererContext,\n            slotId\n          );\n          mergeRenderOutput(output, newOutput);\n        }\n      }\n    }\n  }\n  return output;\n}\n\nexport async function renderBricks(\n  returnNode: RenderNode,\n  bricks: BrickConf[],\n  runtimeContext: RuntimeContext,\n  rendererContext: RendererContext,\n  slotId?: string,\n  tplStack?: Map<string, number>,\n  noMemoize?: boolean\n): Promise<RenderOutput> {\n  const output: RenderOutput = {\n    blockingList: [],\n    menuRequests: [],\n  };\n  // 多个构件并行异步转换，但转换的结果按原顺序串行合并。\n  const rendered = await Promise.all(\n    bricks.map((brickConf, index) =>\n      renderBrick(\n        returnNode,\n        brickConf,\n        runtimeContext,\n        rendererContext,\n        slotId,\n        index,\n        tplStack && new Map(tplStack)\n      )\n    )\n  );\n\n  rendered.forEach((item, index) => {\n    if (!noMemoize && item.hasTrackingControls) {\n      // Memoize a render node before it's been merged.\n      rendererContext.memoizeControlNode(slotId, index, item.node, returnNode);\n    }\n    mergeRenderOutput(output, item);\n  });\n\n  return output;\n}\n\nexport async function renderBrick(\n  returnNode: RenderNode,\n  brickConf: RuntimeBrickConfWithSymbols,\n  _runtimeContext: RuntimeContext,\n  rendererContext: RendererContext,\n  slotId?: string,\n  key?: number,\n  tplStack = new Map<string, number>()\n): Promise<RenderOutput> {\n  const output: RenderOutput = {\n    blockingList: [],\n    menuRequests: [],\n  };\n\n  if (!brickConf.brick) {\n    if ((brickConf as { template?: string }).template) {\n      // eslint-disable-next-line no-console\n      console.error(\"Legacy templates are dropped in v3:\", brickConf);\n    } else {\n      // eslint-disable-next-line no-console\n      console.error(\"Invalid brick:\", brickConf);\n    }\n    return output;\n  }\n\n  // Translate `if: \"<%= ... %>\"` to `brick: \":if\", dataSource: \"<%= ... %>\"`.\n  // In other words, translate tracking if expressions to tracking control nodes of `:if`.\n  const { if: brickIf, permissionsPreCheck, ...restBrickConf } = brickConf;\n  if (isGeneralizedTrackAll(brickIf)) {\n    return renderBrick(\n      returnNode,\n      {\n        brick: \":if\",\n        dataSource: brickIf,\n        // `permissionsPreCheck` maybe required before computing `if`.\n        permissionsPreCheck,\n        slots: {\n          \"\": {\n            type: \"bricks\",\n            bricks: [restBrickConf],\n          },\n        },\n        // These symbols have to be copied to the new brick conf.\n        ...Object.getOwnPropertySymbols(brickConf).reduce(\n          (acc, symbol) => ({\n            ...acc,\n            [symbol]: (brickConf as any)[symbol],\n          }),\n          {} as RuntimeBrickConfOfTplSymbols & RuntimeBrickConfOfFormSymbols\n        ),\n      },\n      _runtimeContext,\n      rendererContext,\n      slotId,\n      key,\n      tplStack\n    );\n  }\n\n  const tplStateStoreId = brickConf[symbolForTplStateStoreId];\n  const formStateStoreId = brickConf[symbolForFormStateStoreId];\n  const runtimeContext = {\n    ..._runtimeContext,\n    tplStateStoreId,\n    formStateStoreId,\n  };\n\n  if (hasOwnProperty(brickConf, symbolForTPlExternalForEachItem)) {\n    // The external bricks of a template should restore their `forEachItem`\n    // from their host.\n    runtimeContext.forEachItem = brickConf[symbolForTPlExternalForEachItem];\n  }\n\n  const { context } = brickConf as { context?: ContextConf[] };\n  // istanbul ignore next\n  if (Array.isArray(context) && context.length > 0) {\n    const strict = isStrictMode(runtimeContext);\n    warnAboutStrictMode(\n      strict,\n      \"Defining context on bricks\",\n      \"check your brick:\",\n      brickConf\n    );\n    if (!strict) {\n      runtimeContext.ctxStore.define(context, runtimeContext);\n    }\n  }\n\n  runtimeContext.pendingPermissionsPreCheck.push(\n    hooks?.checkPermissions?.preCheckPermissionsForBrickOrRoute(\n      brickConf,\n      (value) => asyncComputeRealValue(value, runtimeContext)\n    )\n  );\n\n  if (!(await asyncCheckBrickIf(brickConf, runtimeContext))) {\n    return output;\n  }\n\n  const brickName = brickConf.brick;\n  if (brickName.startsWith(\":\")) {\n    ensureValidControlBrick(brickName);\n\n    const { dataSource } = brickConf;\n\n    const renderControlNode = async () => {\n      // First, compute the `dataSource`\n      const computedDataSource = await asyncComputeRealValue(\n        dataSource,\n        runtimeContext\n      );\n\n      // Then, get the matched slot.\n      const slot =\n        brickName === \":forEach\"\n          ? \"\"\n          : brickName === \":switch\"\n          ? String(computedDataSource)\n          : computedDataSource\n          ? \"\"\n          : \"else\";\n\n      // Don't forget to transpile children to slots.\n      const slots = childrenToSlots(brickConf.children, brickConf.slots);\n\n      // Then, get the bricks in that matched slot.\n      const bricks =\n        slots &&\n        hasOwnProperty(slots, slot) &&\n        (slots[slot] as SlotConfOfBricks)?.bricks;\n\n      if (!Array.isArray(bricks)) {\n        return output;\n      }\n\n      switch (brickName) {\n        case \":forEach\": {\n          if (!Array.isArray(computedDataSource)) {\n            return output;\n          }\n          return renderForEach(\n            returnNode,\n            computedDataSource,\n            bricks,\n            runtimeContext,\n            rendererContext,\n            slotId,\n            tplStack\n          );\n        }\n        case \":if\":\n        case \":switch\": {\n          return renderBricks(\n            returnNode,\n            bricks,\n            runtimeContext,\n            rendererContext,\n            slotId,\n            tplStack,\n            true\n          );\n        }\n      }\n    };\n\n    const controlledOutput = await renderControlNode();\n\n    const { contextNames, stateNames } = getTracks(dataSource);\n    if (contextNames || stateNames) {\n      controlledOutput.hasTrackingControls = true;\n      let renderId = 0;\n      const listener = async () => {\n        const currentRenderId = ++renderId;\n        const output = await renderControlNode();\n        output.blockingList.push(\n          ...[\n            ...runtimeContext.tplStateStoreMap.values(),\n            ...runtimeContext.formStateStoreMap.values(),\n          ].map((store) => store.waitForAll()),\n          ...runtimeContext.pendingPermissionsPreCheck\n        );\n        await Promise.all(output.blockingList);\n        // Ignore stale renders\n        if (renderId === currentRenderId) {\n          rendererContext.rerenderControlNode(\n            slotId,\n            key as number,\n            output.node,\n            returnNode\n          );\n        }\n      };\n      const debouncedListener = debounce(listener);\n      if (contextNames) {\n        for (const contextName of contextNames) {\n          runtimeContext.ctxStore.onChange(contextName, debouncedListener);\n        }\n      }\n      if (stateNames) {\n        for (const contextName of stateNames) {\n          const tplStateStore = getTplStateStore(\n            runtimeContext,\n            \"STATE\",\n            `: \"${dataSource}\"`\n          );\n          tplStateStore.onChange(contextName, debouncedListener);\n        }\n      }\n    }\n\n    return controlledOutput;\n  }\n\n  // Widgets need to be defined before rendering.\n  if (/\\.tpl-/.test(brickName) && !customTemplates.get(brickName)) {\n    await catchLoadBrick(\n      loadBricksImperatively([brickName], getBrickPackages()),\n      brickName,\n      rendererContext.unknownBricks\n    );\n  }\n\n  const tplTagName = getTagNameOfCustomTemplate(\n    brickName,\n    runtimeContext.app?.id\n  );\n\n  if (tplTagName) {\n    const tplCount = tplStack.get(tplTagName) ?? 0;\n    if (tplCount >= 10) {\n      throw new Error(\n        `Maximum custom template stack overflowed: \"${tplTagName}\"`\n      );\n    }\n    tplStack.set(tplTagName, tplCount + 1);\n  } else if (brickName.includes(\"-\") && !customElements.get(brickName)) {\n    if (brickName === FORM_RENDERER) {\n      customElements.define(\n        FORM_RENDERER,\n        class FormRendererElement extends HTMLElement {\n          get $$typeof(): string {\n            return \"form-renderer\";\n          }\n        }\n      );\n    } else {\n      output.blockingList.push(\n        catchLoadBrick(\n          enqueueStableLoadBricks([brickName], getBrickPackages()),\n          brickName,\n          rendererContext.unknownBricks\n        )\n      );\n    }\n  }\n\n  const brick: RenderBrick = {\n    tag: RenderTag.BRICK,\n    type: tplTagName || brickName,\n    return: returnNode,\n    slotId,\n    events: brickConf.events,\n    runtimeContext,\n    portal: brickConf.portal,\n    iid: brickConf.iid,\n    ref: (brickConf as BrickConfInTemplate).ref,\n  };\n\n  output.node = brick;\n\n  // const confProps = brickConf.properties;\n  let formData: unknown;\n  let confProps: Record<string, unknown> | undefined;\n  if (brickName === FORM_RENDERER) {\n    ({ formData, ...confProps } = brickConf.properties ?? {});\n  } else {\n    confProps = brickConf.properties;\n  }\n\n  // 加载构件属性和加载子构件等任务，可以并行。\n  const blockingList: Promise<unknown>[] = [];\n\n  const trackingContextList: TrackingContextItem[] = [];\n  const loadProperties = async () => {\n    brick.properties = await asyncComputeRealProperties(\n      confProps,\n      runtimeContext,\n      trackingContextList\n    );\n    const computedPropsFromHost =\n      brickConf[symbolForAsyncComputedPropsFromHost];\n    if (computedPropsFromHost) {\n      brick.properties ??= {};\n      const computed = await computedPropsFromHost;\n      for (const [propName, propValue] of Object.entries(computed)) {\n        brick.properties[propName] = propValue;\n      }\n    }\n    listenOnTrackingContext(brick, trackingContextList);\n    return brick.properties;\n  };\n  const asyncProperties = loadProperties();\n  blockingList.push(asyncProperties);\n\n  rendererContext.registerBrickLifeCycle(brick, brickConf.lifeCycle);\n\n  let expandedBrickConf = brickConf;\n  if (tplTagName) {\n    expandedBrickConf = expandCustomTemplate(\n      tplTagName,\n      brickConf,\n      brick,\n      asyncProperties\n    );\n  } else if (brickName === FORM_RENDERER) {\n    expandedBrickConf = expandFormRenderer(\n      formData,\n      brickConf,\n      brick,\n      asyncProperties\n    );\n  }\n\n  if (expandedBrickConf.portal) {\n    // A portal brick has no slotId.\n    brick.slotId = undefined;\n  }\n\n  let childRuntimeContext: RuntimeContext;\n  if (tplTagName) {\n    // There is a boundary for `forEachItem` between template internals and externals.\n    childRuntimeContext = {\n      ...runtimeContext,\n    };\n    delete childRuntimeContext.forEachItem;\n  } else {\n    childRuntimeContext = runtimeContext;\n  }\n\n  const loadChildren = async () => {\n    const slots = childrenToSlots(\n      expandedBrickConf.children,\n      expandedBrickConf.slots\n    );\n    if (!slots) {\n      return;\n    }\n    const rendered = await Promise.all(\n      Object.entries(slots).map(([childSlotId, slotConf]) =>\n        slotConf.type !== \"routes\"\n          ? renderBricks(\n              brick,\n              (slotConf as SlotConfOfBricks).bricks,\n              childRuntimeContext,\n              rendererContext,\n              childSlotId,\n              tplStack\n            )\n          : renderRoutes(\n              brick,\n              slotConf.routes,\n              childRuntimeContext,\n              rendererContext,\n              childSlotId\n            )\n      )\n    );\n\n    const childrenOutput: RenderOutput = {\n      ...output,\n      node: undefined,\n      blockingList: [],\n    };\n    for (const item of rendered) {\n      mergeRenderOutput(childrenOutput, item);\n    }\n    if (childrenOutput.node) {\n      brick.child = childrenOutput.node;\n    }\n    mergeRenderOutput(output, {\n      ...childrenOutput,\n      node: undefined,\n    });\n  };\n  blockingList.push(loadChildren());\n\n  await Promise.all(blockingList);\n\n  return output;\n}\n\nfunction isGeneralizedTrackAll(brickIf: unknown): boolean {\n  return typeof brickIf === \"string\"\n    ? isTrackAll(brickIf)\n    : isPreEvaluated(brickIf) &&\n        // istanbul ignore next: covered by e2e tests\n        isTrackAll(getPreEvaluatedRaw(brickIf));\n}\n\ntype ValidControlBrick = \":forEach\" | \":if\" | \":switch\";\n\nfunction ensureValidControlBrick(\n  brick: string\n): asserts brick is ValidControlBrick {\n  if (brick !== \":forEach\" && brick !== \":if\" && brick !== \":switch\") {\n    throw new Error(`Unknown storyboard control node: \"${brick}\"`);\n  }\n}\n\nasync function renderForEach(\n  returnNode: RenderNode,\n  dataSource: unknown[],\n  bricks: BrickConf[],\n  runtimeContext: RuntimeContext,\n  rendererContext: RendererContext,\n  slotId: string | undefined,\n  tplStack?: Map<string, number>\n): Promise<RenderOutput> {\n  const output: RenderOutput = {\n    blockingList: [],\n    menuRequests: [],\n  };\n\n  const rendered = await Promise.all(\n    dataSource.map((item, i) =>\n      Promise.all(\n        bricks.map((brickConf, j) =>\n          renderBrick(\n            returnNode,\n            brickConf,\n            {\n              ...runtimeContext,\n              forEachItem: item,\n            },\n            rendererContext,\n            slotId,\n            i * j,\n            tplStack && new Map(tplStack)\n          )\n        )\n      )\n    )\n  );\n\n  // 多层构件并行异步转换，但转换的结果按原顺序串行合并。\n  for (const item of rendered.flat()) {\n    mergeRenderOutput(output, item);\n  }\n  return output;\n}\n\nfunction loadMenu(\n  menuConf: MenuConf | undefined,\n  runtimeContext: RuntimeContext\n) {\n  if (!menuConf) {\n    return;\n  }\n\n  // istanbul ignore next\n  if ((menuConf as { type?: \"brick\" }).type === \"brick\") {\n    // eslint-disable-next-line no-console\n    console.error(\"Set menu with brick is dropped in v3:\", menuConf);\n    throw new Error(\"Set menu with brick is dropped in v3\");\n  }\n\n  // istanbul ignore next\n  if (menuConf.type === \"resolve\") {\n    // eslint-disable-next-line no-console\n    console.warn(\"Set menu with resolve is not supported in v3 yet:\", menuConf);\n    return;\n  }\n\n  return asyncComputeRealValue(\n    menuConf,\n    runtimeContext\n  ) as Promise<StaticMenuConf>;\n}\n\nfunction mergeRenderOutput(\n  output: RenderOutput,\n  newOutput: RenderOutput\n): void {\n  const { blockingList, node, menuRequests, hasTrackingControls, ...rest } =\n    newOutput;\n  output.blockingList.push(...blockingList);\n  output.menuRequests.push(...menuRequests);\n\n  if (node) {\n    if (output.node) {\n      let last = output.node;\n      while (last.sibling) {\n        last = last.sibling;\n      }\n      last.sibling = node;\n    } else {\n      output.node = node;\n    }\n  }\n\n  Object.assign(output, rest);\n}\n\nexport function childrenToSlots(\n  children: BrickConf[] | undefined,\n  originalSlots: SlotsConf | undefined\n) {\n  let newSlots = originalSlots;\n  // istanbul ignore next\n  if (\n    process.env.NODE_ENV === \"development\" &&\n    children &&\n    !Array.isArray(children)\n  ) {\n    // eslint-disable-next-line no-console\n    console.warn(\n      \"Specified brick children but not array:\",\n      `<${typeof children}>`,\n      children\n    );\n  }\n  if (Array.isArray(children) && !newSlots) {\n    newSlots = {};\n    for (const child of children) {\n      const slot = child.slot ?? \"\";\n      if (!hasOwnProperty(newSlots, slot)) {\n        newSlots[slot] = {\n          type: \"bricks\",\n          bricks: [],\n        };\n      }\n      (newSlots[slot] as SlotConfOfBricks).bricks.push(child);\n    }\n  }\n  return newSlots;\n}\n\nfunction catchLoadBrick(\n  promise: Promise<unknown>,\n  brickName: string,\n  unknownBricks: RendererContext[\"unknownBricks\"]\n) {\n  return unknownBricks === \"silent\"\n    ? promise.catch((e) => {\n        // eslint-disable-next-line no-console\n        console.error(`Load brick \"${brickName}\" failed:`, e);\n      })\n    : promise;\n}\n","import { setProperties } from \"./setProperties.js\";\nimport type { RuntimeBrick } from \"../interfaces.js\";\nimport { getTplStateStore } from \"../CustomTemplates/utils.js\";\nimport { getFormStateStore } from \"../FormRenderer/utils.js\";\n\nexport interface TrackingContextItem {\n  contextNames: string[] | Set<string> | false;\n  stateNames: string[] | Set<string> | false;\n  formStateNames: string[] | Set<string> | false;\n  propName: string;\n  propValue: unknown;\n}\n\nexport function listenOnTrackingContext(\n  brick: RuntimeBrick,\n  trackingContextList: TrackingContextItem[]\n): void {\n  for (const track of trackingContextList) {\n    const listener = (): void => {\n      if (brick.element) {\n        setProperties(\n          brick.element,\n          { [track.propName]: track.propValue },\n          brick.runtimeContext\n        );\n      }\n    };\n    if (track.contextNames) {\n      for (const contextName of track.contextNames) {\n        brick.runtimeContext.ctxStore.onChange(contextName, listener);\n      }\n    }\n    if (track.stateNames) {\n      const tplStateStore = getTplStateStore(\n        brick.runtimeContext,\n        \"STATE\",\n        `: \"${track.propValue}\"`\n      );\n      for (const stateName of track.stateNames) {\n        tplStateStore.onChange(stateName, listener);\n      }\n    }\n    if (track.formStateNames) {\n      const formStateStore = getFormStateStore(\n        brick.runtimeContext,\n        \"FORM_STATE\",\n        `: \"${track.propValue}\"`\n      );\n      for (const stateName of track.formStateNames) {\n        formStateStore.onChange(stateName, listener);\n      }\n    }\n  }\n}\n","import type { RuntimeBrick } from \"../interfaces.js\";\nimport { getTplStateStore } from \"./utils.js\";\n\nexport function bindTemplateProxy(brick: RuntimeBrick) {\n  const { ref, runtimeContext, element } = brick;\n\n  // Error recovering brick may have no runtimeContext.\n  if (!ref || !runtimeContext.tplStateStoreId) {\n    return;\n  }\n\n  const { hostBrick } = getTplStateStore(runtimeContext, \"bindTemplateProxy\");\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const tplHostMetadata = hostBrick!.tplHostMetadata!;\n\n  tplHostMetadata.internalBricksByRef.set(ref, brick);\n\n  const events = tplHostMetadata.proxy?.events;\n  if (events) {\n    for (const [from, to] of Object.entries(events)) {\n      if (to.ref === ref) {\n        const listener = (e: Event) => {\n          if (e.bubbles) {\n            e.stopPropagation();\n          }\n          hostBrick!.element!.dispatchEvent(\n            new CustomEvent(from, {\n              detail: (e as CustomEvent).detail,\n              bubbles: e.bubbles,\n              cancelable: e.cancelable,\n              composed: e.composed,\n            })\n          );\n        };\n        const eventType = to.refEvent ?? from;\n        element!.addEventListener(eventType, listener);\n        element!.$$proxyListeners ??= [];\n        element!.$$proxyListeners.push([eventType, listener]);\n      }\n    }\n  }\n}\n\nexport function unbindTemplateProxy(brick: RuntimeBrick) {\n  const { ref, runtimeContext, element } = brick;\n\n  if (!runtimeContext.tplStateStoreId || !ref) {\n    return;\n  }\n\n  const { hostBrick } = getTplStateStore(runtimeContext, \"unbindTemplateProxy\");\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const tplHostMetadata = hostBrick!.tplHostMetadata!;\n\n  tplHostMetadata.internalBricksByRef.delete(ref);\n\n  for (const [type, fn] of element!.$$proxyListeners ?? []) {\n    element!.removeEventListener(type, fn);\n  }\n  delete element!.$$proxyListeners;\n}\n","import { bindTemplateProxy } from \"./CustomTemplates/bindTemplateProxy.js\";\nimport { getTplStateStore } from \"./CustomTemplates/utils.js\";\nimport { bindListeners } from \"./bindListeners.js\";\nimport { setRealProperties } from \"./compute/setRealProperties.js\";\nimport { RenderTag } from \"./enums.js\";\nimport type {\n  RenderNode,\n  RenderRoot,\n  RuntimeBrickElement,\n} from \"./interfaces.js\";\n\nexport function unmountTree(mountPoint: HTMLElement) {\n  mountPoint.innerHTML = \"\";\n}\n\nexport function mountTree(\n  root: RenderRoot,\n  initializedElement?: RuntimeBrickElement\n): void {\n  let current = root.child;\n  const portalElements: RuntimeBrickElement[] = [];\n  while (current) {\n    const tagName = current.type;\n\n    if (tagName.includes(\"-\") && !customElements.get(tagName)) {\n      // eslint-disable-next-line no-console\n      console.error(`Undefined custom element: ${tagName}`);\n    }\n\n    // istanbul ignore if\n    if (tagName === \"basic-bricks.script-brick\") {\n      // eslint-disable-next-line no-console\n      console.warn(\n        \"`basic-bricks.script-brick` is deprecated, please take caution when using it\"\n      );\n    }\n\n    const element: RuntimeBrickElement =\n      initializedElement && current === root.child\n        ? initializedElement\n        : document.createElement(tagName);\n    current.element = element;\n\n    if (current.slotId) {\n      element.setAttribute(\"slot\", current.slotId);\n    }\n    if (current.iid) {\n      element.dataset.iid = current.iid;\n    }\n    setRealProperties(element, current.properties);\n    bindListeners(element, current.events, current.runtimeContext);\n    if (current.tplHostMetadata) {\n      // 先设置属性，再设置 `$$tplStateStore`，这样，当触发属性设置时，\n      // 避免初始化的一次 state update 操作及其 onChange 事件。\n      element.$$tplStateStore = getTplStateStore(\n        {\n          tplStateStoreId: current.tplHostMetadata.tplStateStoreId,\n          tplStateStoreMap: current.runtimeContext.tplStateStoreMap,\n        },\n        \"mount\"\n      );\n    }\n    bindTemplateProxy(current);\n\n    if (current.portal) {\n      portalElements.push(element);\n    } else if (current.return) {\n      if (!current.return.childElements) {\n        current.return.childElements = [];\n      }\n      current.return.childElements.push(element);\n    }\n\n    if (current.child) {\n      current = current.child;\n    } else if (current.sibling) {\n      current = current.sibling;\n    } else {\n      let currentReturn: RenderNode | null | undefined = current.return;\n      while (currentReturn) {\n        // Append elements inside out\n        if (currentReturn.childElements) {\n          if (currentReturn.tag === RenderTag.ROOT) {\n            currentReturn.container?.append(...currentReturn.childElements);\n          } else {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            currentReturn.element!.append(...currentReturn.childElements);\n          }\n          currentReturn.childElements = undefined;\n        }\n\n        if (currentReturn.tag === RenderTag.ROOT && portalElements.length > 0) {\n          const portal =\n            typeof currentReturn.createPortal === \"function\"\n              ? currentReturn.createPortal()\n              : currentReturn.createPortal;\n          portal.append(...portalElements);\n        }\n\n        if (currentReturn.sibling) {\n          break;\n        }\n        currentReturn = currentReturn.return;\n      }\n      current = currentReturn?.sibling;\n    }\n  }\n}\n","import type {\n  BrickEventHandler,\n  BrickLifeCycle,\n  ScrollIntoViewConf,\n  UseBrickLifeCycle,\n} from \"@next-core/types\";\nimport type { Action } from \"history\";\nimport { isEmpty, remove } from \"lodash\";\nimport { listenerFactory } from \"./bindListeners.js\";\nimport { NextLocation, getHistory } from \"../history.js\";\nimport { getReadOnlyProxy } from \"./proxyFactories.js\";\nimport { Media, mediaEventTarget } from \"./mediaQuery.js\";\nimport type { RenderBrick, RenderNode, RenderRoot } from \"./interfaces.js\";\nimport { mountTree } from \"./mount.js\";\nimport { RenderTag } from \"./enums.js\";\nimport { unbindTemplateProxy } from \"./CustomTemplates/bindTemplateProxy.js\";\n\ntype MemoizedLifeCycle<T> = {\n  [Key in keyof T]: {\n    brick: RenderBrick;\n    handlers: T[Key];\n  }[];\n};\n\nconst commonLifeCycles = [\n  \"onMount\",\n  \"onUnmount\",\n  \"onMediaChange\",\n  \"onScrollIntoView\",\n] as const;\n\nconst pageOnlyLifeCycles = [\n  \"onBeforePageLoad\",\n  \"onPageLoad\",\n  \"onPageLeave\",\n  \"onBeforePageLeave\",\n  \"onAnchorLoad\",\n  \"onAnchorUnload\",\n] as const;\n\nexport interface RendererContextOptions {\n  unknownBricks?: \"silent\" | \"throw\";\n}\n\nexport class RendererContext {\n  /**\n   * - page: render as whole page, triggering page life cycles.\n   * - fragment: render as fragment, not triggering page life cycles.\n   */\n  public readonly scope: \"page\" | \"fragment\";\n\n  public readonly unknownBricks: \"silent\" | \"throw\";\n\n  constructor(scope: \"page\" | \"fragment\", options?: RendererContextOptions) {\n    this.scope = scope;\n    this.unknownBricks = options?.unknownBricks ?? \"throw\";\n  }\n\n  #memoizedLifeCycle: MemoizedLifeCycle<\n    Required<\n      Pick<\n        BrickLifeCycle,\n        | \"onBeforePageLoad\"\n        | \"onPageLoad\"\n        | \"onPageLeave\"\n        | \"onBeforePageLeave\"\n        | \"onAnchorLoad\"\n        | \"onAnchorUnload\"\n        | \"onMediaChange\"\n        | \"onScrollIntoView\"\n        | \"onMount\"\n        | \"onUnmount\"\n        // Omitted:\n        // \"onMessage\"\n        // \"onMessageClose\"\n      >\n    >\n  > = {\n    onBeforePageLoad: [],\n    onPageLoad: [],\n    onPageLeave: [],\n    onBeforePageLeave: [],\n    onAnchorLoad: [],\n    onAnchorUnload: [],\n    onMediaChange: [],\n    onScrollIntoView: [],\n    onMount: [],\n    onUnmount: [],\n  };\n  // #observers: IntersectionObserver[] = [];\n  #observers = new Map<RenderBrick, IntersectionObserver[]>();\n  #mediaListener: EventListener | undefined;\n\n  #memoizedControlNodes?: WeakMap<\n    RenderNode,\n    Map<\n      string,\n      {\n        node?: RenderBrick;\n        last?: RenderBrick;\n        lastNormal?: RenderBrick | undefined;\n        lastPortal?: RenderBrick | undefined;\n      }\n    >\n  >;\n\n  registerBrickLifeCycle(\n    brick: RenderBrick,\n    lifeCycle: BrickLifeCycle | UseBrickLifeCycle | undefined\n  ): void {\n    if (!lifeCycle) {\n      return;\n    }\n    const lifeCycleTypes = [\n      ...commonLifeCycles,\n      ...(this.scope === \"page\" ? pageOnlyLifeCycles : []),\n    ];\n    for (const key of lifeCycleTypes) {\n      const handlers = (lifeCycle as BrickLifeCycle)[key as \"onPageLoad\"];\n      if (handlers) {\n        this.#memoizedLifeCycle[key as \"onPageLoad\"].push({\n          brick,\n          handlers: handlers as BrickEventHandler | BrickEventHandler[],\n        });\n      }\n    }\n    // istanbul ignore next\n    if (!isEmpty((lifeCycle as { useResolves?: unknown }).useResolves)) {\n      // eslint-disable-next-line no-console\n      console.error(\"`lifeCycle.useResolves` is dropped in v3:\", lifeCycle);\n    }\n  }\n\n  #unmountBricks(bricks: Set<RenderBrick>): void {\n    const lifeCycleTypes = [\n      ...commonLifeCycles,\n      ...(this.scope === \"page\" ? pageOnlyLifeCycles : []),\n    ];\n    const unmountList: {\n      brick: RenderBrick;\n      handlers: BrickEventHandler | BrickEventHandler[];\n    }[] = [];\n\n    // Clear life cycle handlers, record `onUnmount` at the same time\n    for (const key of lifeCycleTypes) {\n      const removed = remove(\n        this.#memoizedLifeCycle[key as \"onPageLoad\"],\n        (item) => bricks.has(item.brick)\n      );\n      if (key === \"onUnmount\") {\n        unmountList.push(...removed);\n      }\n    }\n\n    // Clear intersection observers\n    for (const brick of bricks) {\n      const observers = this.#observers.get(brick);\n      if (observers?.length) {\n        for (const observer of observers) {\n          observer.disconnect();\n        }\n        observers.length = 0;\n        this.#observers.delete(brick);\n      }\n\n      unbindTemplateProxy(brick);\n      delete brick.element?.$$tplStateStore;\n\n      // Also remove the element\n      brick.element?.remove();\n    }\n\n    // Dispatch unmount events\n    const unmountEvent = new CustomEvent(\"unmount\");\n    for (const { brick, handlers } of unmountList) {\n      listenerFactory(handlers, brick.runtimeContext, brick)(unmountEvent);\n    }\n  }\n\n  #initializeRerenderBricks(bricks: Set<RenderBrick>): void {\n    const mountEvent = new CustomEvent(\"mount\");\n    for (const { brick, handlers } of this.#memoizedLifeCycle.onMount) {\n      if (bricks.has(brick)) {\n        listenerFactory(handlers, brick.runtimeContext, brick)(mountEvent);\n      }\n    }\n\n    for (const { brick, handlers: conf } of this.#memoizedLifeCycle\n      .onScrollIntoView) {\n      if (bricks.has(brick)) {\n        this.#addObserver(brick, conf);\n      }\n    }\n  }\n\n  memoizeControlNode(\n    slotId: string | undefined,\n    key: number,\n    node: RenderBrick | undefined,\n    returnNode: RenderNode\n  ) {\n    if (!this.#memoizedControlNodes) {\n      this.#memoizedControlNodes = new WeakMap();\n    }\n    const memKey = `${slotId ?? \"\"}.${key}`;\n    let mem = this.#memoizedControlNodes.get(returnNode);\n    if (!mem) {\n      mem = new Map();\n      this.#memoizedControlNodes.set(returnNode, mem);\n    }\n\n    mem.set(memKey, {\n      node,\n      last: getLastNode(node),\n      lastNormal: getLastNormalNode(node),\n      lastPortal: getLastPortalNode(node),\n    });\n  }\n\n  rerenderControlNode(\n    slotId: string | undefined,\n    key: number,\n    node: RenderBrick | undefined,\n    returnNode: RenderNode\n  ) {\n    const memKey = `${slotId ?? \"\"}.${key}`;\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const memoized = this.#memoizedControlNodes!.get(returnNode)!.get(memKey)!;\n    const {\n      node: prevNode,\n      last: prevLast,\n      lastNormal: prevLastNormal,\n      lastPortal: prevLastPortal,\n    } = memoized;\n\n    const insertBeforeChild = prevLastNormal?.element?.nextSibling ?? null;\n    const insertPortalBeforeChild =\n      prevLastPortal?.element?.nextSibling ?? null;\n\n    const last = getLastNode(node);\n    memoized.node = node;\n    memoized.last = last;\n    memoized.lastNormal = getLastNormalNode(node);\n    memoized.lastPortal = getLastPortalNode(node);\n\n    // Figure out the unchanged prev sibling and next sibling\n    let prevSibling: RenderBrick | undefined;\n    let current = returnNode.child;\n    while (current && current !== prevLast) {\n      if (current.sibling === prevNode) {\n        prevSibling = current;\n        break;\n      }\n      current = current.sibling;\n    }\n\n    const fragment = document.createDocumentFragment();\n    const portalFragment = document.createDocumentFragment();\n    const renderRoot: RenderRoot = {\n      tag: RenderTag.ROOT,\n      container: fragment,\n      createPortal: portalFragment,\n      child: node,\n    };\n\n    // Override `return`\n    current = node;\n    while (current) {\n      current.return = renderRoot;\n      current = current.sibling;\n    }\n\n    // Unmount previous bricks, including their descendants\n    const removeBricks = getBrickRange(prevNode, prevLast);\n    this.#unmountBricks(removeBricks);\n\n    mountTree(renderRoot);\n\n    // Connect back\n    if (prevSibling) {\n      prevSibling.sibling = node;\n    } else {\n      returnNode.child = node;\n    }\n    if (last) {\n      last.sibling = prevLast?.sibling;\n    }\n\n    // Resume `return`\n    current = node;\n    while (current) {\n      current.return = returnNode;\n      current = current.sibling;\n    }\n\n    if (returnNode.tag === RenderTag.ROOT) {\n      returnNode.container?.insertBefore(fragment, insertBeforeChild);\n    } else {\n      returnNode.element?.insertBefore(fragment, insertBeforeChild);\n    }\n\n    if (portalFragment.childNodes.length > 0) {\n      let root: RenderNode | undefined = node;\n      while (root && root.return) {\n        root = root.return;\n      }\n      if (root?.tag !== RenderTag.ROOT) {\n        throw new Error(\"Cannot find render root node\");\n      }\n      const portal =\n        typeof root.createPortal === \"function\"\n          ? root.createPortal()\n          : root.createPortal;\n      portal.insertBefore(portalFragment, insertPortalBeforeChild);\n    }\n\n    const newBricks = getBrickRange(node, last);\n    this.#initializeRerenderBricks(newBricks);\n  }\n\n  dispose(): void {\n    for (const list of Object.values(this.#memoizedLifeCycle)) {\n      list.length = 0;\n    }\n    for (const list of this.#observers.values()) {\n      for (const observer of list) {\n        observer.disconnect();\n      }\n      list.length = 0;\n    }\n    this.#observers.clear();\n    if (this.#mediaListener) {\n      mediaEventTarget.removeEventListener(\"change\", this.#mediaListener);\n      this.#mediaListener = undefined;\n    }\n    this.#memoizedControlNodes = undefined;\n  }\n\n  // Note: no `onScrollIntoView`\n  #dispatchGeneralLifeCycle(\n    type:\n      | \"onBeforePageLoad\"\n      | \"onPageLoad\"\n      | \"onPageLeave\"\n      | \"onBeforePageLeave\"\n      | \"onAnchorLoad\"\n      | \"onAnchorUnload\"\n      | \"onMediaChange\"\n      | \"onMount\"\n      | \"onUnmount\",\n    event: CustomEvent\n  ): void {\n    // istanbul ignore next\n    if (\n      process.env.NODE_ENV === \"development\" &&\n      this.scope === \"fragment\" &&\n      pageOnlyLifeCycles.includes(type as \"onPageLoad\")\n    ) {\n      throw new Error(\n        `\\`lifeCycle.${type}\\` cannot be used in ${this.scope}.\\nThis is a bug of Brick Next, please report it.`\n      );\n    }\n    for (const { brick, handlers } of this.#memoizedLifeCycle[type]) {\n      listenerFactory(handlers, brick.runtimeContext, brick)(event);\n    }\n  }\n\n  dispatchBeforePageLoad(): void {\n    this.#dispatchGeneralLifeCycle(\n      \"onBeforePageLoad\",\n      new CustomEvent(\"page.beforeLoad\")\n    );\n  }\n\n  dispatchPageLoad(): void {\n    const event = new CustomEvent(\"page.load\");\n    this.#dispatchGeneralLifeCycle(\"onPageLoad\", event);\n    // Currently only for e2e testing\n    window.dispatchEvent(event);\n  }\n\n  dispatchBeforePageLeave(detail: {\n    location?: NextLocation;\n    action?: Action;\n  }): void {\n    this.#dispatchGeneralLifeCycle(\n      \"onBeforePageLeave\",\n      new CustomEvent(\"page.beforeLeave\", { detail })\n    );\n  }\n\n  dispatchPageLeave(): void {\n    this.#dispatchGeneralLifeCycle(\n      \"onPageLeave\",\n      new CustomEvent(\"page.leave\")\n    );\n  }\n\n  dispatchAnchorLoad(): void {\n    const { hash } = getHistory().location;\n    if (hash && hash !== \"#\") {\n      this.#dispatchGeneralLifeCycle(\n        \"onAnchorLoad\",\n        new CustomEvent(\"anchor.load\", {\n          detail: {\n            hash,\n            anchor: hash.substring(1),\n          },\n        })\n      );\n    } else {\n      this.#dispatchGeneralLifeCycle(\n        \"onAnchorUnload\",\n        new CustomEvent(\"anchor.unload\")\n      );\n    }\n  }\n\n  initializeScrollIntoView(): void {\n    for (const { brick, handlers: conf } of this.#memoizedLifeCycle\n      .onScrollIntoView) {\n      this.#addObserver(brick, conf);\n    }\n  }\n\n  #addObserver(brick: RenderBrick, conf: ScrollIntoViewConf) {\n    const threshold = conf.threshold ?? 0.1;\n    const observer = new IntersectionObserver(\n      (entries, observer) => {\n        entries.forEach((entry) => {\n          if (entry.isIntersecting) {\n            if (entry.intersectionRatio >= threshold) {\n              listenerFactory(\n                conf.handlers,\n                brick.runtimeContext,\n                brick\n              )(new CustomEvent(\"scroll.into.view\"));\n              observer.disconnect();\n            }\n          }\n        });\n      },\n      {\n        threshold,\n      }\n    );\n    observer.observe(brick.element!);\n    let list = this.#observers.get(brick);\n    if (!list) {\n      list = [];\n      this.#observers.set(brick, list);\n    }\n    list.push(observer);\n  }\n\n  initializeMediaChange(): void {\n    this.#mediaListener = (event) => {\n      this.#dispatchGeneralLifeCycle(\n        \"onMediaChange\",\n        new CustomEvent(\"media.change\", {\n          detail: getReadOnlyProxy((event as CustomEvent<Media>).detail),\n        })\n      );\n    };\n    mediaEventTarget.addEventListener(\"change\", this.#mediaListener);\n  }\n\n  dispatchOnMount(): void {\n    this.#dispatchGeneralLifeCycle(\"onMount\", new CustomEvent(\"mount\"));\n  }\n\n  dispatchOnUnmount(): void {\n    this.#dispatchGeneralLifeCycle(\"onUnmount\", new CustomEvent(\"unmount\"));\n  }\n}\n\nfunction getLastNode(node: RenderBrick | undefined): RenderBrick | undefined {\n  let last = node;\n  while (last?.sibling) {\n    last = last.sibling;\n  }\n  return last;\n}\n\nfunction getLastNormalNode(\n  node: RenderBrick | undefined\n): RenderBrick | undefined {\n  let last: RenderBrick | undefined;\n  let current = node;\n  while (current) {\n    if (!current.portal) {\n      last = current;\n    }\n    current = current.sibling;\n  }\n  return last;\n}\n\nfunction getLastPortalNode(\n  node: RenderBrick | undefined\n): RenderBrick | undefined {\n  let last: RenderBrick | undefined;\n  let current = node;\n  while (current) {\n    if (current.portal) {\n      last = current;\n    }\n    if (current.child) {\n      current = current.child;\n    } else if (current.sibling) {\n      current = current.sibling;\n    } else {\n      let currentReturn: RenderNode | null | undefined = current.return;\n      while (currentReturn) {\n        if (currentReturn.sibling) {\n          break;\n        }\n        currentReturn = currentReturn.return;\n      }\n      current = currentReturn?.sibling;\n    }\n  }\n  return last;\n}\n\nfunction getBrickRange(\n  from: RenderBrick | undefined,\n  to: RenderBrick | undefined\n): Set<RenderBrick> {\n  const range = new Set<RenderBrick>();\n  let current = from;\n  while (current) {\n    range.add(current);\n    if (current.child) {\n      current = current.child;\n    } else if (current === to) {\n      break;\n    } else if (current.sibling) {\n      current = current.sibling;\n    } else {\n      let currentReturn: RenderNode | null | undefined = current.return;\n      while (currentReturn && currentReturn !== to) {\n        if (currentReturn.sibling) {\n          break;\n        }\n        currentReturn = currentReturn.return;\n      }\n      if (currentReturn === to) {\n        break;\n      }\n      current = currentReturn?.sibling;\n    }\n  }\n  return range;\n}\n","import { getBasePath } from \"./getBasePath.js\";\n\nlet misc: PageInfo;\n\n/** 运行时页面信息。*/\nexport interface PageInfo {\n  /** 当前是否处于 iframe 模式。 */\n  isInIframe: boolean;\n\n  /** 当前是否处于同域的 iframe 模式。 */\n  isInIframeOfSameSite: boolean;\n\n  /** 当前是否处于新框架下的 iframe 模式。 */\n  isInIframeOfNext: boolean;\n\n  /** 当前是否处于 Visual Builder 预览的 iframe 模式。 */\n  isInIframeOfVisualBuilder: boolean;\n\n  /** 当前是否处于老 console 下的 iframe 模式。 */\n  isInIframeOfLegacyConsole: boolean;\n}\n\nexport function getPageInfo(): PageInfo {\n  if (!misc) {\n    misc = {\n      isInIframe: false,\n      isInIframeOfSameSite: false,\n      isInIframeOfNext: false,\n      isInIframeOfVisualBuilder: false,\n      isInIframeOfLegacyConsole: false,\n    };\n\n    if (window !== window.parent) {\n      misc.isInIframe = true;\n      try {\n        // Handle:\n        // - Previewing in visual builder by iframe.\n        // - Nesting next in next.\n        // - Nesting console in next.\n        if (window.origin === window.parent.origin) {\n          misc.isInIframeOfSameSite = true;\n          const selfIsNext = getBasePath() === \"/next/\";\n          const parentPathname = window.parent.location.pathname;\n          const parentIsNext = parentPathname.startsWith(\"/next/\");\n          misc.isInIframeOfNext =\n            (Number(selfIsNext) ^ Number(parentIsNext)) === 0;\n          misc.isInIframeOfVisualBuilder = parentPathname.startsWith(\n            `${parentIsNext ? \"/next\" : \"\"}/visual-builder/`\n          );\n          misc.isInIframeOfLegacyConsole = selfIsNext && !parentIsNext;\n        }\n      } catch (e) {\n        // do nothing\n      }\n    }\n\n    Object.freeze(misc);\n  }\n\n  return misc;\n}\n","import { http } from \"@next-core/http\";\n\nlet nativeController: AbortController;\n\nexport function initAbortController() {\n  if (!window.AbortController) {\n    return;\n  }\n\n  nativeController = new AbortController();\n\n  http.interceptors.request.use((config) => {\n    return {\n      ...config,\n      options: {\n        ...config.options,\n        signal: config.options?.noAbortOnRouteChange\n          ? null\n          : nativeController.signal,\n      },\n    };\n  });\n}\n\nexport function abortPendingRequest() {\n  if (nativeController) {\n    nativeController.abort();\n    nativeController = new AbortController();\n  }\n}\n","import { RuntimeStoryboard } from \"@next-core/types\";\nimport { customTemplates } from \"../CustomTemplates.js\";\n\nexport function registerCustomTemplates(storyboard: RuntimeStoryboard) {\n  if (storyboard.$$registerCustomTemplateProcessed) {\n    return;\n  }\n  storyboard.$$registerCustomTemplateProcessed = true;\n  const templates = storyboard.meta?.customTemplates;\n  if (Array.isArray(templates)) {\n    for (const tpl of templates) {\n      const tagName = tpl.name.includes(\".\")\n        ? tpl.name\n        : `${storyboard.app.id}.${tpl.name}`;\n      customTemplates.define(tagName, tpl);\n    }\n  }\n}\n","import type { RuntimeStoryboard } from \"@next-core/types\";\nimport { hooks } from \"./Runtime.js\";\nimport { registerAppI18n } from \"./registerAppI18n.js\";\n\nexport async function fulfilStoryboard(storyboard: RuntimeStoryboard) {\n  if (storyboard.$$fulfilled) {\n    return;\n  }\n  if (!storyboard.$$fulfilling) {\n    storyboard.$$fulfilling = doFulfilStoryboard(storyboard);\n  }\n  return storyboard.$$fulfilling;\n}\n\nasync function doFulfilStoryboard(storyboard: RuntimeStoryboard) {\n  await hooks?.fulfilStoryboard?.(storyboard);\n  registerAppI18n(storyboard);\n  Object.assign(storyboard, {\n    $$fulfilled: true,\n    $$fulfilling: null,\n  });\n}\n","import { Action, locationsAreEqual } from \"history\";\nimport { flushStableLoadBricks } from \"@next-core/loader\";\nimport type {\n  BreadcrumbItemConf,\n  MicroApp,\n  StaticMenuConf,\n  Storyboard,\n} from \"@next-core/types\";\nimport { HttpAbortError } from \"@next-core/http\";\nimport { uniqueId } from \"lodash\";\nimport { NextHistoryState, NextLocation, getHistory } from \"../history.js\";\nimport { RenderOutput, renderRoutes } from \"./Renderer.js\";\nimport { DataStore } from \"./data/DataStore.js\";\nimport { clearResolveCache } from \"./data/resolveData.js\";\nimport { mountTree, unmountTree } from \"./mount.js\";\nimport { isOutsideApp, matchStoryboard } from \"./matchStoryboard.js\";\nimport { registerStoryboardFunctions } from \"./compute/StoryboardFunctions.js\";\nimport { RendererContext } from \"./RendererContext.js\";\nimport {\n  applyMode,\n  applyTheme,\n  getLocalAppsTheme,\n  setMode,\n  setTheme,\n} from \"../themeAndMode.js\";\nimport {\n  _internalApiGetAppInBootstrapData,\n  getRuntime,\n  hooks,\n} from \"./Runtime.js\";\nimport { getPageInfo } from \"../getPageInfo.js\";\nimport type { RenderBrick, RenderRoot, RuntimeContext } from \"./interfaces.js\";\nimport { resetAllComputedMarks } from \"./compute/markAsComputed.js\";\nimport {\n  handleHttpError,\n  httpErrorToString,\n  isUnauthenticatedError,\n} from \"../handleHttpError.js\";\nimport { abortPendingRequest, initAbortController } from \"./abortController.js\";\nimport { registerCustomTemplates } from \"./registerCustomTemplates.js\";\nimport { fulfilStoryboard } from \"./fulfilStoryboard.js\";\nimport { RenderTag } from \"./enums.js\";\nimport { insertPreviewRoutes } from \"./insertPreviewRoutes.js\";\n\nexport class Router {\n  readonly #storyboards: Storyboard[];\n  #rendering = false;\n  #prevLocation!: NextLocation;\n  #nextLocation?: NextLocation;\n  #runtimeContext?: RuntimeContext;\n  #rendererContext?: RendererContext;\n  #rendererContextTrashCan = new Set<RendererContext | undefined>();\n  #redirectCount = 0;\n  #renderId?: string;\n  #currentApp?: MicroApp;\n  #previousApp?: MicroApp;\n  #navConfig?: {\n    breadcrumb?: BreadcrumbItemConf[];\n  };\n\n  constructor(storyboards: Storyboard[]) {\n    this.#storyboards = storyboards;\n\n    const history = getHistory();\n    window.addEventListener(\"beforeunload\", (event) => {\n      const message = this.#getBlockMessageBeforePageLave({});\n      // See examples in https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onbeforeunload\n      if (message) {\n        // Cancel the event\n        // If you prevent default behavior in Mozilla Firefox prompt will always be shown\n        event.preventDefault();\n        // Chrome requires returnValue to be set\n        event.returnValue = \"\";\n      } else {\n        // the absence of a returnValue property on the event will guarantee the browser unload happens\n        delete event.returnValue;\n      }\n    });\n\n    history.block((location, action) =>\n      this.#getBlockMessageBeforePageLave({ location, action })\n    );\n  }\n\n  getRenderId() {\n    return this.#renderId;\n  }\n\n  getRuntimeContext() {\n    return this.#runtimeContext;\n  }\n\n  getRecentApps() {\n    return {\n      currentApp: this.#currentApp,\n      previousApp: this.#previousApp,\n    };\n  }\n\n  getNavConfig() {\n    return this.#navConfig;\n  }\n\n  #getBlockMessageBeforePageLave(detail: {\n    location?: NextLocation;\n    action?: Action;\n  }): string | undefined {\n    const history = getHistory();\n    const previousMessage = history.getBlockMessage();\n    this.#rendererContext?.dispatchBeforePageLeave(detail);\n    const message = history.getBlockMessage();\n    if (!previousMessage && message) {\n      // Auto unblock only if new block was introduced by `onBeforePageLeave`.\n      history.unblock();\n    }\n    return message;\n  }\n\n  #safeRedirect(\n    to: string,\n    state: NextHistoryState | undefined,\n    from: NextLocation\n  ): void {\n    if (this.#redirectCount++ > 10) {\n      const message = `Infinite redirect detected: from \"${from.pathname}${from.search}${from.hash}\" to \"${to}\"`;\n      // istanbul ignore else: error cannot be caught in test\n      if (process.env.NODE_ENV === \"test\") {\n        // eslint-disable-next-line no-console\n        console.error(message);\n        return;\n      } else {\n        throw new Error(message);\n      }\n    }\n    getHistory().replace(to, state);\n  }\n\n  bootstrap() {\n    initAbortController();\n    const history = getHistory();\n    this.#prevLocation = history.location;\n    history.listen((location, action) => {\n      let ignoreRendering = false;\n      const omittedLocationProps: Partial<NextLocation> = {\n        hash: undefined,\n        state: undefined,\n      };\n      // Omit the \"key\" when checking whether locations are equal in certain situations.\n      if (\n        // When current location is triggered by browser action of hash link.\n        location.key === undefined ||\n        // When current location is triggered by browser action of non-push-or-replace,\n        // such as goBack or goForward,\n        (action === \"POP\" &&\n          // and the previous location was triggered by hash link,\n          (this.#prevLocation.key === undefined ||\n            // or the previous location specified notify false.\n            this.#prevLocation.state?.notify === false))\n      ) {\n        omittedLocationProps.key = undefined;\n      }\n      if (\n        locationsAreEqual(\n          { ...this.#prevLocation, ...omittedLocationProps },\n          { ...location, ...omittedLocationProps }\n        ) ||\n        (action !== \"POP\" && location.state?.notify === false)\n      ) {\n        // Ignore rendering if location not changed except hash, state and optional key.\n        // Ignore rendering if notify is `false`.\n        ignoreRendering = true;\n      }\n      if (ignoreRendering) {\n        this.#prevLocation = location;\n        return;\n      }\n      abortPendingRequest();\n      this.#prevLocation = location;\n      this.#rendererContext?.dispatchPageLeave();\n      // this.locationContext.messageDispatcher.reset();\n\n      if (action === \"POP\") {\n        const storyboard = matchStoryboard(\n          this.#storyboards,\n          location.pathname\n        );\n        // When a browser action of goBack or goForward is performing,\n        // force reload when the target page is a page of an outside app.\n        if (isOutsideApp(storyboard)) {\n          window.location.reload();\n          return;\n        }\n      }\n\n      if (this.#rendering) {\n        this.#nextLocation = location;\n      } else {\n        // devtoolsHookEmit(\"locationChange\");\n        this.#queuedRender(location).catch(handleHttpError);\n      }\n    });\n    return this.#queuedRender(history.location);\n  }\n\n  async #queuedRender(location: NextLocation): Promise<void> {\n    this.#rendering = true;\n    try {\n      await this.#render(location);\n    } finally {\n      this.#rendering = false;\n      if (this.#nextLocation) {\n        const nextLocation = this.#nextLocation;\n        this.#nextLocation = undefined;\n        await this.#queuedRender(nextLocation);\n      }\n    }\n  }\n\n  async #render(location: NextLocation): Promise<void> {\n    this.#renderId = uniqueId(\"render-id-1\");\n\n    resetAllComputedMarks();\n    clearResolveCache();\n    hooks?.flowApi?.clearCollectWidgetContract();\n\n    const history = getHistory();\n    history.unblock();\n\n    const storyboard = matchStoryboard(this.#storyboards, location.pathname);\n\n    const previousApp = this.#runtimeContext?.app;\n    if (storyboard?.app) {\n      await fulfilStoryboard(storyboard);\n    }\n    const currentApp = (this.#currentApp = storyboard?.app);\n\n    // Storyboard maybe re-assigned, e.g. when open launchpad.\n    const appChanged =\n      previousApp && currentApp\n        ? previousApp.id !== currentApp.id\n        : previousApp !== currentApp;\n\n    // TODO: handle favicon\n\n    // Set `Router::#currentApp` before calling `getFeatureFlags()`\n    const flags = getRuntime().getFeatureFlags();\n    const prevRendererContext = this.#rendererContext;\n\n    const redirectTo = (to: string, state?: NextHistoryState): void => {\n      this.#rendererContextTrashCan.add(prevRendererContext);\n      this.#safeRedirect(to, state, location);\n    };\n\n    const redirectToLogin = (): void => {\n      const to = flags[\"sso-enabled\"] ? \"/sso-auth/login\" : \"/auth/login\";\n      redirectTo(to, { from: location });\n    };\n\n    const main = document.querySelector(\"#main-mount-point\") as HTMLElement;\n    const portal = document.querySelector(\"#portal-mount-point\") as HTMLElement;\n\n    const renderRoot: RenderRoot = {\n      tag: RenderTag.ROOT,\n      container: main,\n      createPortal: portal,\n    };\n\n    const cleanUpPreviousRender = (): void => {\n      unmountTree(main);\n      unmountTree(portal);\n\n      // Note: redirects can lead to multiple trash renderer contexts.\n      this.#rendererContextTrashCan.add(prevRendererContext);\n      for (const item of this.#rendererContextTrashCan) {\n        if (item) {\n          item.dispatchOnUnmount();\n          item.dispose();\n        }\n      }\n      this.#rendererContextTrashCan.clear();\n\n      setTheme(\n        (currentApp &&\n          (getLocalAppsTheme()[currentApp.id] || currentApp.theme)) ||\n          \"light\"\n      );\n      setMode(\"default\");\n\n      if (appChanged) {\n        this.#previousApp = previousApp;\n        window.dispatchEvent(\n          new CustomEvent(\"app.change\", {\n            detail: {\n              previousApp,\n              currentApp,\n            },\n          })\n        );\n      }\n    };\n\n    if (currentApp) {\n      hooks?.checkInstalledApps?.preCheckInstalledApps(\n        storyboard,\n        (appId) => !!_internalApiGetAppInBootstrapData(appId)\n      );\n\n      const runtimeContext: RuntimeContext = (this.#runtimeContext = {\n        app: currentApp,\n        location,\n        query: new URLSearchParams(location.search),\n        flags,\n        sys: {\n          ...hooks?.auth?.getAuth(),\n          ...getPageInfo(),\n          settings: {\n            brand: getRuntime().getBrandSettings(),\n          },\n        },\n        ctxStore: new DataStore(\"CTX\"),\n        pendingPermissionsPreCheck: [\n          hooks?.checkPermissions?.preCheckPermissions(storyboard),\n        ],\n        tplStateStoreMap: new Map<string, DataStore<\"STATE\">>(),\n        formStateStoreMap: new Map<string, DataStore<\"FORM_STATE\">>(),\n      });\n\n      const rendererContext = (this.#rendererContext = new RendererContext(\n        \"page\"\n      ));\n      this.#navConfig = undefined;\n\n      registerCustomTemplates(storyboard);\n      registerStoryboardFunctions(storyboard.meta?.functions, currentApp);\n      hooks?.flowApi?.collectContract(storyboard.meta?.contracts);\n\n      let failed = false;\n      let output: RenderOutput;\n      try {\n        output = await renderRoutes(\n          renderRoot,\n          insertPreviewRoutes(storyboard.routes),\n          runtimeContext,\n          rendererContext\n        );\n        if (output.unauthenticated) {\n          redirectToLogin();\n          return;\n        }\n        if (output.redirect) {\n          redirectTo(output.redirect.path, output.redirect.state);\n          return;\n        }\n        // Reset redirect count if no redirect is set.\n        this.#redirectCount = 0;\n\n        flushStableLoadBricks();\n\n        await Promise.all([\n          ...output.blockingList,\n          ...[\n            runtimeContext.ctxStore,\n            ...runtimeContext.tplStateStoreMap.values(),\n            ...runtimeContext.formStateStoreMap.values(),\n          ].map((store) => store.waitForAll()),\n          // Todo: load processors only when they would used in current rendering.\n          // loadProcessorsImperatively(\n          //   strictCollectMemberUsage(\n          //     [storyboard.routes, storyboard.meta?.customTemplates],\n          //     \"PROCESSORS\",\n          //     2\n          //   ),\n          //   getBrickPackages()\n          // ),\n          ...runtimeContext.pendingPermissionsPreCheck,\n        ]);\n\n        const menuConfs = await Promise.all(output.menuRequests);\n        this.#navConfig = mergeMenuConfs(menuConfs);\n      } catch (error) {\n        // eslint-disable-next-line no-console\n        console.error(\"Router failed:\", error);\n\n        if (isUnauthenticatedError(error) && !window.NO_AUTH_GUARD) {\n          redirectToLogin();\n          return;\n        } else if (error instanceof HttpAbortError) {\n          this.#rendererContextTrashCan.add(prevRendererContext);\n          return;\n        } else {\n          failed = true;\n          output = {\n            node: {\n              tag: RenderTag.BRICK,\n              type: \"div\",\n              properties: {\n                textContent: httpErrorToString(error),\n              },\n              runtimeContext: null!,\n              return: renderRoot,\n            },\n            blockingList: [],\n            menuRequests: [],\n          };\n        }\n      }\n      renderRoot.child = output.node;\n\n      cleanUpPreviousRender();\n\n      if ((output.route && output.route.type !== \"routes\") || failed) {\n        if (!failed) {\n          // There is a window to set theme and mode by `lifeCycle.onBeforePageLoad`.\n          rendererContext.dispatchBeforePageLoad();\n        }\n        applyTheme();\n        applyMode();\n\n        mountTree(renderRoot);\n\n        // Scroll to top after each rendering.\n        // See https://github.com/ReactTraining/react-router/blob/master/packages/react-router-dom/docs/guides/scroll-restoration.md\n        window.scrollTo(0, 0);\n\n        if (!failed) {\n          rendererContext.dispatchPageLoad();\n          rendererContext.dispatchAnchorLoad();\n          rendererContext.dispatchOnMount();\n          rendererContext.initializeScrollIntoView();\n          rendererContext.initializeMediaChange();\n        }\n\n        return;\n      }\n    } else if (\n      !window.NO_AUTH_GUARD &&\n      hooks?.auth &&\n      !hooks.auth.isLoggedIn()\n    ) {\n      // Todo(steve): refine after api-gateway supports fetching storyboards before logged in.\n      // Redirect to login if no storyboard is matched.\n      redirectToLogin();\n      return;\n    } else {\n      cleanUpPreviousRender();\n    }\n\n    applyTheme();\n    applyMode();\n\n    const node: RenderBrick = {\n      tag: RenderTag.BRICK,\n      type: \"div\",\n      properties: {\n        textContent: \"Page not found\",\n      },\n      runtimeContext: null!,\n      return: renderRoot,\n    };\n    renderRoot.child = node;\n\n    mountTree(renderRoot);\n\n    // Scroll to top after each rendering.\n    window.scrollTo(0, 0);\n  }\n}\n\nfunction mergeMenuConfs(menuConfs: (StaticMenuConf | undefined)[]) {\n  const navConfig = {\n    breadcrumb: [] as BreadcrumbItemConf[],\n  };\n  for (const menuConf of menuConfs) {\n    if (menuConf) {\n      const { breadcrumb } = menuConf;\n      if (breadcrumb) {\n        if (breadcrumb.overwrite) {\n          navConfig.breadcrumb = breadcrumb.items;\n        } else {\n          navConfig.breadcrumb.push(...breadcrumb.items);\n        }\n      }\n    }\n  }\n  return navConfig;\n}\n","import { findLastIndex } from \"lodash\";\nimport type { RouteConf } from \"@next-core/types\";\n\nexport function insertPreviewRoutes(routes: RouteConf[]): RouteConf[] {\n  // Insert preview routes for iframe only.\n  if (window.parent === window) {\n    return routes;\n  }\n\n  let mergedRoutes = routes;\n\n  const specificTemplatePreviewIndex = findLastIndex(mergedRoutes, (route) =>\n    route.path.startsWith(\"${APP.homepage}/_dev_only_/template-preview/\")\n  );\n  mergedRoutes = [\n    ...mergedRoutes.slice(0, specificTemplatePreviewIndex + 1),\n    {\n      path: \"${APP.homepage}/_dev_only_/template-preview/:templateId\",\n      bricks: [{ brick: \"span\" }],\n      menu: false,\n      exact: true,\n    } as RouteConf,\n    ...mergedRoutes.slice(specificTemplatePreviewIndex + 1),\n  ];\n\n  const specificSnippetPreviewIndex = findLastIndex(mergedRoutes, (route) =>\n    route.path.startsWith(\"${APP.homepage}/_dev_only_/snippet-preview/\")\n  );\n  mergedRoutes = [\n    ...mergedRoutes.slice(0, specificSnippetPreviewIndex + 1),\n    {\n      path: \"${APP.homepage}/_dev_only_/snippet-preview/:snippetId\",\n      bricks: [{ brick: \"span\" }],\n      menu: false,\n      exact: true,\n    } as RouteConf,\n    ...mergedRoutes.slice(specificSnippetPreviewIndex + 1),\n  ];\n\n  return mergedRoutes;\n}\n","import type { BrickPackage } from \"@next-core/types\";\n\n// Allow inject brick packages in a runtime other than Brick Next.\nexport const injectedBrickPackages: BrickPackage[] =\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  typeof BRICK_PACKAGES !== \"undefined\" ? BRICK_PACKAGES : [];\n","// istanbul ignore file\n// Todo(steve): This file will be removed in the future.\nimport { hooks } from \"./internal/Runtime.js\";\n\n/** @deprecated import it from \"@next-core/easyops-runtime\" instead */\nexport function authenticate(...args: unknown[]): void {\n  hooks?.auth?.authenticate?.(...args);\n}\n\n/** @deprecated import it from \"@next-core/easyops-runtime\" instead */\nexport function getAuth() {\n  return hooks?.auth?.getAuth();\n}\n\n/** @deprecated import it from \"@next-core/easyops-runtime\" instead */\nexport function logout() {\n  return hooks?.auth?.logout?.();\n}\n\n/** @deprecated import it from \"@next-core/easyops-runtime\" instead */\nexport function isLoggedIn() {\n  return hooks?.auth?.isLoggedIn();\n}\n","import { getProviderBrick } from \"./internal/data/getProviderBrick.js\";\nimport {\n  ResolveOptions,\n  resolveByProvider,\n} from \"./internal/data/resolveData.js\";\n\nexport async function fetchByProvider(\n  provider: string,\n  args: unknown[],\n  options?: ResolveOptions\n) {\n  const providerBrick = (await getProviderBrick(provider)) as unknown as Record<\n    string,\n    Function\n  >;\n  return resolveByProvider(providerBrick, provider, \"resolve\", args, options);\n}\n","import type {\n  BrickConf,\n  ContextConf,\n  CustomTemplate,\n  MetaI18n,\n  MicroApp,\n  SiteTheme,\n  Storyboard,\n  StoryboardFunction,\n} from \"@next-core/types\";\nimport { flushStableLoadBricks } from \"@next-core/loader\";\nimport { RenderOutput, renderBricks } from \"./internal/Renderer.js\";\nimport { RendererContext } from \"./internal/RendererContext.js\";\nimport { DataStore } from \"./internal/data/DataStore.js\";\nimport type { RenderRoot, RuntimeContext } from \"./internal/interfaces.js\";\nimport { mountTree, unmountTree } from \"./internal/mount.js\";\nimport { httpErrorToString } from \"./handleHttpError.js\";\nimport { applyMode, applyTheme, setMode, setTheme } from \"./themeAndMode.js\";\nimport { RenderTag } from \"./internal/enums.js\";\nimport { registerStoryboardFunctions } from \"./internal/compute/StoryboardFunctions.js\";\nimport { registerAppI18n } from \"./internal/registerAppI18n.js\";\nimport { registerCustomTemplates } from \"./internal/registerCustomTemplates.js\";\n\nexport interface CreateRootOptions {\n  portal?: HTMLElement;\n  /**\n   * Defaults to \"fragment\", only set it to \"page\" when the root is in a standalone iframe.\n   * - page: render as whole page, triggering page life cycles, and enable register of functions/templates/i18n.\n   * - fragment: render as fragment, not triggering page life cycles, and disable register of functions/templates/i18n.\n   */\n  scope?: \"page\" | \"fragment\";\n\n  /**\n   * Whether to throw error when encountering unknown bricks.\n   *\n   * Defaults to \"throw\".\n   */\n  unknownBricks?: \"silent\" | \"throw\";\n}\n\nexport interface RenderOptions {\n  theme?: SiteTheme;\n  context?: ContextConf[];\n  functions?: StoryboardFunction[];\n  templates?: CustomTemplate[];\n  i18n?: MetaI18n;\n}\n\nexport function unstable_createRoot(\n  container: HTMLElement,\n  { portal: _portal, scope = \"fragment\", unknownBricks }: CreateRootOptions = {}\n) {\n  let portal = _portal;\n  let createPortal: RenderRoot[\"createPortal\"];\n  if (_portal) {\n    createPortal = _portal;\n  } else {\n    // Create portal container when necessary.\n    createPortal = () => {\n      portal = document.createElement(\"div\");\n      portal.style.position = \"absolute\";\n      portal.style.width = portal.style.height = \"0\";\n      document.body.append(portal);\n      return portal;\n    };\n  }\n  let unmounted = false;\n  let rendererContext: RendererContext | undefined;\n  let clearI18nBundles: Function | undefined;\n\n  return {\n    async render(\n      brick: BrickConf | BrickConf[],\n      {\n        theme,\n        context,\n        functions,\n        templates,\n        i18n: i18nData,\n      }: RenderOptions = {}\n    ) {\n      if (unmounted) {\n        throw new Error(\n          \"The root is unmounted and cannot be rendered any more\"\n        );\n      }\n      const bricks = ([] as BrickConf[]).concat(brick);\n      const runtimeContext = {\n        ctxStore: new DataStore(\"CTX\"),\n        pendingPermissionsPreCheck: [],\n        tplStateStoreMap: new Map<string, DataStore<\"STATE\">>(),\n        formStateStoreMap: new Map<string, DataStore<\"FORM_STATE\">>(),\n      } as Partial<RuntimeContext> as RuntimeContext;\n\n      const previousRendererContext = rendererContext;\n      rendererContext = new RendererContext(scope, { unknownBricks });\n\n      const renderRoot: RenderRoot = {\n        tag: RenderTag.ROOT,\n        container,\n        createPortal,\n      };\n\n      if (scope === \"page\") {\n        const demoApp = {\n          id: \"demo\",\n          homepage: \"/demo\",\n        } as MicroApp;\n        runtimeContext.app = demoApp;\n        const demoStoryboard = {\n          app: demoApp,\n          meta: {\n            i18n: i18nData,\n            customTemplates: templates,\n          },\n        } as Storyboard;\n\n        // Register i18n.\n        clearI18nBundles?.();\n        clearI18nBundles = registerAppI18n(demoStoryboard);\n\n        // Register custom templates.\n        registerCustomTemplates(demoStoryboard);\n\n        // Register functions.\n        registerStoryboardFunctions(functions, demoApp);\n      }\n\n      runtimeContext.ctxStore.define(context, runtimeContext);\n\n      let failed = false;\n      let output: RenderOutput;\n      try {\n        output = await renderBricks(\n          renderRoot,\n          bricks,\n          runtimeContext,\n          rendererContext\n        );\n\n        flushStableLoadBricks();\n\n        await Promise.all([\n          ...output.blockingList,\n          runtimeContext.ctxStore.waitForAll(),\n          ...[\n            ...runtimeContext.tplStateStoreMap.values(),\n            ...runtimeContext.formStateStoreMap.values(),\n          ].map((store) => store.waitForAll()),\n          ...runtimeContext.pendingPermissionsPreCheck,\n        ]);\n      } catch (error) {\n        failed = true;\n        output = {\n          node: {\n            tag: RenderTag.BRICK,\n            type: \"div\",\n            properties: {\n              textContent: httpErrorToString(error),\n            },\n            return: renderRoot,\n            runtimeContext: null!,\n          },\n          blockingList: [],\n          menuRequests: [],\n        };\n      }\n\n      renderRoot.child = output.node;\n\n      previousRendererContext?.dispatchOnUnmount();\n      previousRendererContext?.dispose();\n      unmountTree(container);\n      if (portal) {\n        unmountTree(portal);\n      }\n\n      if (scope === \"page\") {\n        setTheme(theme ?? \"light\");\n        setMode(\"default\");\n\n        if (!failed) {\n          rendererContext.dispatchBeforePageLoad();\n        }\n\n        applyTheme();\n        applyMode();\n      }\n\n      mountTree(renderRoot);\n\n      if (scope === \"page\") {\n        window.scrollTo(0, 0);\n      }\n\n      if (!failed) {\n        if (scope === \"page\") {\n          rendererContext.dispatchPageLoad();\n          // rendererContext.dispatchAnchorLoad();\n        }\n        rendererContext.dispatchOnMount();\n        rendererContext.initializeScrollIntoView();\n        rendererContext.initializeMediaChange();\n      }\n    },\n    unmount() {\n      if (unmounted) {\n        return;\n      }\n      unmounted = true;\n      unmountTree(container);\n      if (portal) {\n        unmountTree(portal);\n        // Only remove the portal from its parent when it's dynamic created.\n        if (!_portal) {\n          portal.remove();\n        }\n      }\n    },\n  };\n}\n","import type {\n  BrickConf,\n  CustomTemplate,\n  RouteConf,\n  Storyboard,\n  UseSingleBrickConf,\n} from \"@next-core/types\";\nimport { flushStableLoadBricks } from \"@next-core/loader\";\nimport { pick } from \"lodash\";\nimport {\n  _internalApiGetRuntimeContext,\n  _internalApiGetStoryboardInBootstrapData,\n} from \"./Runtime.js\";\nimport { renderBrick } from \"./Renderer.js\";\nimport { RendererContext } from \"./RendererContext.js\";\nimport type { DataStore } from \"./data/DataStore.js\";\nimport type { RenderRoot, RuntimeContext } from \"./interfaces.js\";\nimport { mountTree, unmountTree } from \"./mount.js\";\nimport { RenderTag } from \"./enums.js\";\nimport { computeRealValue } from \"./compute/computeRealValue.js\";\nimport { isStrictMode, warnAboutStrictMode } from \"../isStrictMode.js\";\nimport { customTemplates } from \"../CustomTemplates.js\";\nimport { registerAppI18n } from \"./registerAppI18n.js\";\n\nexport type { RuntimeContext } from \"./interfaces.js\";\n\nexport interface RenderUseBrickResult {\n  tagName: string | null;\n  renderRoot: RenderRoot;\n  rendererContext: RendererContext;\n}\n\nexport async function renderUseBrick(\n  useBrick: UseSingleBrickConf,\n  data: unknown\n): Promise<RenderUseBrickResult> {\n  const tplStateStoreScope: DataStore<\"STATE\">[] = [];\n  const formStateStoreScope: DataStore<\"FORM_STATE\">[] = [];\n  const runtimeContext: RuntimeContext = {\n    ..._internalApiGetRuntimeContext()!,\n    data,\n    pendingPermissionsPreCheck: [],\n    tplStateStoreScope,\n    formStateStoreScope,\n  };\n\n  runtimeContext.tplStateStoreMap ??= new Map();\n  runtimeContext.formStateStoreMap ??= new Map();\n\n  const rendererContext = new RendererContext(\"fragment\");\n\n  const renderRoot: RenderRoot = {\n    tag: RenderTag.ROOT,\n    // Will set during `mountUseBrick`\n    createPortal: null!,\n  };\n\n  const transform = (useBrick as { transform?: Record<string, unknown> })\n    .transform;\n  const strict = isStrictMode();\n  if (transform) {\n    warnAboutStrictMode(\n      strict,\n      \"`useBrick.transform`\",\n      'please use \"properties\" instead, check your useBrick:',\n      useBrick\n    );\n  }\n\n  const output = await renderBrick(\n    renderRoot,\n    strict\n      ? useBrick\n      : {\n          ...useBrick,\n          properties: {\n            ...useBrick.properties,\n            ...transform,\n          },\n        },\n    runtimeContext,\n    rendererContext\n  );\n\n  flushStableLoadBricks();\n\n  await Promise.all([\n    ...output.blockingList,\n    // Wait for local tpl state stores belong to current `useBrick` only.\n    ...[...tplStateStoreScope, ...formStateStoreScope].map((store) =>\n      store.waitForAll()\n    ),\n    ...runtimeContext.pendingPermissionsPreCheck,\n  ]);\n\n  if (output.node?.portal) {\n    throw new Error(\"The root brick of useBrick cannot be a portal brick\");\n  }\n\n  renderRoot.child = output.node;\n\n  const tagName = output.node ? output.node.type : null;\n\n  return { tagName, renderRoot, rendererContext };\n}\n\nexport interface MountUseBrickResult {\n  portal?: HTMLElement;\n}\n\nexport function mountUseBrick(\n  { renderRoot, rendererContext }: RenderUseBrickResult,\n  element: HTMLElement\n): MountUseBrickResult {\n  let portal: HTMLElement | undefined;\n  renderRoot.createPortal = () => {\n    const portalRoot = document.querySelector(\n      \"#portal-mount-point\"\n    ) as HTMLElement;\n    portal = document.createElement(\"div\");\n    portalRoot.appendChild(portal);\n    return portal;\n  };\n\n  mountTree(renderRoot, element);\n\n  rendererContext.dispatchOnMount();\n  rendererContext.initializeScrollIntoView();\n  rendererContext.initializeMediaChange();\n\n  return {\n    portal,\n  };\n}\n\nexport function unmountUseBrick(\n  { rendererContext }: RenderUseBrickResult,\n  mountResult: MountUseBrickResult\n): void {\n  // if (mountResult.mainBrick) {\n  //   mountResult.mainBrick.unmount();\n  // }\n  if (mountResult.portal) {\n    unmountTree(mountResult.portal);\n    mountResult.portal.remove();\n  }\n  rendererContext.dispatchOnUnmount();\n  rendererContext.dispose();\n}\n\n/** For v2 compatibility of `doTransform` from brick-kit. */\nexport function legacyDoTransform(\n  data: unknown,\n  to: unknown,\n  options?: unknown\n) {\n  if (options) {\n    throw new Error(\"Legacy doTransform does not support options in v3\");\n  }\n  return computeRealValue(\n    to,\n    {\n      ..._internalApiGetRuntimeContext()!,\n      data,\n    },\n    {\n      noInject: true,\n    }\n  );\n}\n\nexport function updateStoryboard(\n  appId: string,\n  storyboardPatch: Partial<Storyboard>\n): void {\n  const storyboard = _internalApiGetStoryboardInBootstrapData(appId)!;\n  Object.assign(storyboard, {\n    ...storyboardPatch,\n    $$fulfilling: null,\n    $$fulfilled: true,\n    $$registerCustomTemplateProcessed: false,\n  });\n  registerAppI18n(storyboard);\n}\n\nexport function updateStoryboardByRoute(appId: string, newRoute: RouteConf) {\n  const storyboard = _internalApiGetStoryboardInBootstrapData(appId)!;\n  let match = false;\n  const getKey = (route: RouteConf): string => `${route.path}.${route.exact}`;\n  const replaceRoute = (routes: RouteConf[], key: string): RouteConf[] => {\n    return routes.map((route) => {\n      const routeKey = getKey(route);\n      if (route.type === \"routes\") {\n        route.routes = replaceRoute(route.routes, key);\n        return route;\n      } else if (routeKey === key) {\n        match = true;\n        return newRoute;\n      } else {\n        return route;\n      }\n    });\n  };\n  storyboard.routes = replaceRoute(storyboard.routes, getKey(newRoute));\n  if (!match) {\n    storyboard.routes.unshift(newRoute);\n  }\n}\n\nexport function updateStoryboardByTemplate(\n  appId: string,\n  newTemplate: CustomTemplate,\n  settings: unknown\n): void {\n  const tplName = `${appId}.${newTemplate.name}`;\n  // customTemplateRegistry.delete(tplName);\n  customTemplates.define(tplName, {\n    bricks: newTemplate.bricks,\n    proxy: newTemplate.proxy,\n    state: newTemplate.state,\n  });\n  updateTemplatePreviewSettings(appId, newTemplate.name, settings);\n}\n\nexport function updateTemplatePreviewSettings(\n  appId: string,\n  templateId: string,\n  settings?: unknown\n): void {\n  _updatePreviewSettings(\n    appId,\n    `\\${APP.homepage}/_dev_only_/template-preview/${templateId}`,\n    [\n      {\n        brick: templateId,\n        ...pick(settings, \"properties\", \"events\", \"lifeCycle\", \"context\"),\n      },\n    ]\n  );\n}\n\nexport function updateStoryboardBySnippet(\n  appId: string,\n  snippetData: {\n    snippetId: string;\n    bricks?: BrickConf[];\n  }\n): void {\n  _updatePreviewSettings(\n    appId,\n    `\\${APP.homepage}/_dev_only_/snippet-preview/${snippetData.snippetId}`,\n    snippetData.bricks?.length ? snippetData.bricks : [{ brick: \"span\" }]\n  );\n}\n\nexport const updateSnippetPreviewSettings = updateStoryboardBySnippet;\n\nfunction _updatePreviewSettings(\n  appId: string,\n  path: string,\n  bricks: BrickConf[]\n) {\n  const { routes } = _internalApiGetStoryboardInBootstrapData(appId)!;\n  const previewRouteIndex = routes.findIndex((route) => route.path === path);\n  const newPreviewRoute: RouteConf = {\n    path,\n    bricks,\n    menu: false,\n    exact: true,\n  };\n  if (previewRouteIndex === -1) {\n    routes.unshift(newPreviewRoute);\n  } else {\n    routes.splice(previewRouteIndex, 1, newPreviewRoute);\n  }\n}\n","interface ProviderElement<T extends unknown[], U> extends HTMLElement {\n  resolve(...args: T): U;\n}\n\ninterface ProviderConstructor<T extends unknown[], U> {\n  new (): ProviderElement<T, U>;\n}\n\nexport function createProviderClass<T extends unknown[], U>(\n  api: (...args: T) => U\n): ProviderConstructor<T, U> {\n  return class extends HTMLElement {\n    get $$typeof(): string {\n      return \"provider\";\n    }\n\n    resolve(...args: T): U {\n      return api(...args);\n    }\n  };\n}\n","// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze\n\n/** @internal */\nexport function deepFreeze<T>(object: T): T {\n  // Retrieve the property names defined on object\n  const propNames = Object.getOwnPropertyNames(object);\n\n  // Freeze properties before freezing self\n\n  for (const name of propNames) {\n    const value = (object as Record<string, unknown>)[name];\n\n    if (value && typeof value === \"object\") {\n      deepFreeze(value);\n    }\n  }\n\n  return Object.freeze(object);\n}\n","export function hasOwnProperty(\n  object: object,\n  property: string | number | symbol\n): boolean {\n  return Object.prototype.hasOwnProperty.call(object, property);\n}\n","// Ref https://github.com/lodash/lodash/blob/4.17.11/lodash.js#L11744\nexport function isObject(value: unknown): value is Record<string, unknown> {\n  const type = typeof value;\n  return value != null && (type == \"object\" || type == \"function\");\n}\n","// This is copied from\n// [@next-libs/storage](https://github.com/easyops-cn/next-libs/tree/master/libs/storage),\n// and the types is refined.\n// The usage of JsonStorage from @next-libs/storage should be deprecated,\n// and migrated to from @next-core/brick-utils.\nexport class JsonStorage<U = Record<string, unknown>> {\n  constructor(\n    private storage: Storage,\n    private prefix: string = \"brick-next-\"\n  ) {}\n\n  setItem<T extends string & keyof U>(name: T, value: U[T]): void {\n    this.storage.setItem(this.prefix + name, JSON.stringify(value));\n  }\n\n  getItem<T extends string & keyof U>(name: T): U[T] {\n    return JSON.parse(\n      this.storage.getItem(this.prefix + name) ?? \"null\"\n    ) as U[T];\n  }\n\n  removeItem<T extends string & keyof U>(name: T): void {\n    return this.storage.removeItem(this.prefix + name);\n  }\n\n  clear(): void {\n    return this.storage.clear();\n  }\n}\n","const pool = new Map<string, HTMLElement>();\n\nfunction getProviderBrick(provider: string) {\n  let brick = pool.get(provider);\n  if (brick) {\n    return brick;\n  }\n  brick = document.createElement(provider);\n  pool.set(provider, brick);\n  return brick;\n}\n\nexport function unwrapProvider<T extends (...args: any[]) => any>(\n  provider: string\n): (...args: Parameters<T>) => ReturnType<T> {\n  return function (...args: Parameters<T>): ReturnType<T> {\n    const brick = getProviderBrick(provider) as unknown as {\n      resolve(...args: Parameters<T>): ReturnType<T>;\n    };\n    return brick.resolve(...args);\n  };\n}\n","import type { Identifier } from \"@babel/types\";\nimport type { EstreeParent } from \"@next-core/cook\";\n\nexport interface MemberUsage {\n  usedProperties: Set<string>;\n  hasNonStaticUsage: boolean;\n}\n\nexport type BeforeVisitGlobal = (\n  node: Identifier,\n  parent: EstreeParent\n) => void;\n\nexport function beforeVisitGlobalMember(\n  usage: MemberUsage,\n  objectName: string | string[],\n  level: 1 | 2 = 1,\n  rememberObjectName = false\n): BeforeVisitGlobal {\n  return function beforeVisitGlobal(node, parent): void {\n    if (\n      typeof objectName === \"string\"\n        ? node.name === objectName\n        : objectName.includes(node.name)\n    ) {\n      const segments: string[] = [];\n      for (let i = 1; i <= level; i++) {\n        const memberParent = parent[parent.length - i];\n        if (\n          memberParent?.node.type === \"MemberExpression\" &&\n          memberParent.key === \"object\"\n        ) {\n          const memberNode = memberParent.node;\n          if (\n            !memberNode.computed &&\n            memberNode.property.type === \"Identifier\"\n          ) {\n            segments.push(\n              rememberObjectName\n                ? `${node.name}.${memberNode.property.name}`\n                : memberNode.property.name\n            );\n          } else if (\n            memberNode.computed &&\n            (memberNode.property as any).type === \"Literal\" &&\n            typeof (memberNode.property as any).value === \"string\"\n          ) {\n            segments.push(\n              rememberObjectName\n                ? `${node.name}.${(memberNode.property as any).value}`\n                : (memberNode.property as any).value\n            );\n          } else {\n            usage.hasNonStaticUsage = true;\n          }\n        } else {\n          usage.hasNonStaticUsage = true;\n        }\n      }\n      if (segments.length === level) {\n        usage.usedProperties.add(segments.join(\".\"));\n      }\n    }\n  };\n}\n","import type { Identifier } from \"@babel/types\";\nimport type { EstreeLiteral, EstreeParent } from \"@next-core/cook\";\n\nexport interface MemberCallUsage {\n  usedArgs: Set<string>;\n  hasNonStaticUsage?: boolean;\n}\n\nfunction collectMemberCallUsageFactory(object: string, property: string) {\n  return function collectMemberCallUsage(\n    usage: MemberCallUsage,\n    node: Identifier,\n    parent: EstreeParent\n  ) {\n    if (node.name === object) {\n      const memberParent = parent[parent.length - 1];\n      const callParent = parent[parent.length - 2];\n      if (\n        callParent?.node.type === \"CallExpression\" &&\n        callParent?.key === \"callee\" &&\n        memberParent?.node.type === \"MemberExpression\" &&\n        memberParent.key === \"object\" &&\n        (memberParent.node.computed\n          ? (memberParent.node.property as any).type === \"Literal\" &&\n            (memberParent.node.property as any).value === property\n          : memberParent.node.property.type === \"Identifier\" &&\n            memberParent.node.property.name === property)\n      ) {\n        const args = callParent.node.arguments as unknown as EstreeLiteral[];\n        if (args.length > 0) {\n          const firstArg = args[0];\n          if (\n            firstArg.type === \"Literal\" &&\n            typeof firstArg.value === \"string\"\n          ) {\n            usage.usedArgs.add(firstArg.value);\n          } else {\n            usage.hasNonStaticUsage = true;\n          }\n        }\n      }\n    }\n  };\n}\n\nexport const collectAppGetMenuUsage = collectMemberCallUsageFactory(\n  \"APP\",\n  \"getMenu\"\n);\n\nexport const collectInstalledAppsHasUsage = collectMemberCallUsageFactory(\n  \"INSTALLED_APPS\",\n  \"has\"\n);\n","import { Identifier } from \"@babel/types\";\nimport { isEvaluable, preevaluate, type EstreeParent } from \"@next-core/cook\";\nimport { isObject } from \"@next-core/utils/general\";\n\nexport interface TraverseStoryboardExpressionsOptions {\n  matchExpressionString: (v: string) => boolean;\n  visitNotMatchedExpressionString?: (v: string) => unknown;\n  visitNonExpressionString?: (v: string) => unknown;\n  visitObject?: (v: unknown[] | Record<string, unknown>) => unknown;\n}\n\nexport type BeforeVisitGlobalWithExpr = (\n  node: Identifier,\n  parent: EstreeParent,\n  expr: string\n) => void;\n\nexport function traverseStoryboardExpressions(\n  data: unknown,\n  beforeVisitGlobal: BeforeVisitGlobalWithExpr,\n  // If `options` is a string, it means the *keyword*.\n  options: string | TraverseStoryboardExpressionsOptions\n): void {\n  const memo = new WeakSet();\n  const {\n    matchExpressionString,\n    visitNotMatchedExpressionString,\n    visitNonExpressionString,\n    visitObject,\n  } =\n    typeof options === \"string\"\n      ? ({\n          matchExpressionString: (v: string) => v.includes(options),\n        } as TraverseStoryboardExpressionsOptions)\n      : options;\n  function traverse(value: unknown): void {\n    if (typeof value === \"string\") {\n      if (isEvaluable(value)) {\n        if (matchExpressionString(value)) {\n          try {\n            preevaluate(value, {\n              withParent: true,\n              hooks: {\n                beforeVisitGlobal(node, parent) {\n                  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                  beforeVisitGlobal(node, parent!, value);\n                },\n              },\n            });\n          } catch (error) {\n            // eslint-disable-next-line no-console\n            console.error(\"Parse storyboard expression failed:\", error);\n          }\n        } else {\n          visitNotMatchedExpressionString?.(value);\n        }\n      } else {\n        visitNonExpressionString?.(value);\n      }\n    } else if (isObject(value)) {\n      // Avoid call stack overflow.\n      if (memo.has(value)) {\n        return;\n      }\n      memo.add(value);\n      visitObject?.(value);\n      for (const item of Array.isArray(value) ? value : Object.values(value)) {\n        traverse(item);\n      }\n    }\n  }\n  traverse(data);\n}\n","import {\n  MemberUsage,\n  beforeVisitGlobalMember,\n} from \"./beforeVisitGlobalMember.js\";\nimport { traverseStoryboardExpressions } from \"./traverse.js\";\n\nexport interface MemberUsageInExpressions extends MemberUsage {\n  nonStaticUsage?: string;\n}\n\nexport function strictCollectMemberUsage(\n  data: unknown,\n  objectName: string,\n  level: 1 | 2 = 1\n): Set<string> {\n  const { hasNonStaticUsage, nonStaticUsage, usedProperties } =\n    collectMemberUsage(data, objectName, level);\n  if (hasNonStaticUsage) {\n    throw new Error(\n      `Non-static usage of ${objectName} is prohibited, check your expression: \"${nonStaticUsage}\"`\n    );\n  }\n  return usedProperties;\n}\n\nexport function collectMemberUsage(\n  data: unknown,\n  objectName: string,\n  level: 1 | 2 = 1\n): MemberUsageInExpressions {\n  const usage: MemberUsageInExpressions = {\n    usedProperties: new Set(),\n    hasNonStaticUsage: false,\n  };\n  const beforeVisitGlobal = beforeVisitGlobalMember(usage, objectName, level);\n  traverseStoryboardExpressions(\n    data,\n    (node, parent, expr) => {\n      beforeVisitGlobal(node, parent);\n      if (usage.hasNonStaticUsage) {\n        usage.nonStaticUsage = expr;\n      }\n    },\n    objectName\n  );\n  return usage;\n}\n","import { preevaluate } from \"@next-core/cook\";\nimport {\n  MemberUsage,\n  beforeVisitGlobalMember,\n} from \"./beforeVisitGlobalMember.js\";\n\ninterface trackAllResult {\n  context: string[] | false;\n  state: string[] | false;\n  formState: string[] | false;\n}\n\nexport function track(\n  raw: string,\n  trackText: string,\n  variableName: string\n): Set<string> | false {\n  if (raw.includes(trackText)) {\n    const usage: MemberUsage = {\n      usedProperties: new Set(),\n      hasNonStaticUsage: false,\n    };\n    const { expression } = preevaluate(raw, {\n      withParent: true,\n      hooks: {\n        beforeVisitGlobal: beforeVisitGlobalMember(usage, variableName),\n      },\n    });\n    let trackCtxExp: any;\n    if (\n      expression.type === \"SequenceExpression\" &&\n      (trackCtxExp = expression.expressions[0] as unknown) &&\n      trackCtxExp.type === \"Literal\" &&\n      trackCtxExp.value === trackText\n    ) {\n      if (usage.usedProperties.size > 0) {\n        return usage.usedProperties;\n      } else {\n        // eslint-disable-next-line no-console\n        console.warn(\n          `You are using \"${trackText}\" but no \\`${variableName}\\` usage found in your expression: ${JSON.stringify(\n            raw\n          )}`\n        );\n      }\n    }\n  }\n  return false;\n}\n\nexport function trackAll(raw: string): trackAllResult | false {\n  if (raw) {\n    const usage: MemberUsage = {\n      usedProperties: new Set(),\n      hasNonStaticUsage: false,\n    };\n    preevaluate(raw, {\n      withParent: true,\n      hooks: {\n        beforeVisitGlobal: beforeVisitGlobalMember(\n          usage,\n          [\"CTX\", \"STATE\", \"FORM_STATE\"],\n          1,\n          true\n        ),\n      },\n    });\n    if (usage.usedProperties.size > 0) {\n      const usedProperites = [...usage.usedProperties];\n      const result: trackAllResult = {\n        context: false,\n        state: false,\n        formState: false,\n      };\n      const keyMap: Record<string, keyof trackAllResult> = {\n        CTX: \"context\",\n        STATE: \"state\",\n        FORM_STATE: \"formState\",\n      };\n      usedProperites.forEach((item) => {\n        const [key, name] = item.split(\".\");\n        if (!result[keyMap[key]]) {\n          result[keyMap[key]] = [];\n        }\n        (result[keyMap[key]] as string[]).push(name);\n      });\n      return result;\n    } else {\n      // eslint-disable-next-line no-console\n      console.warn(\n        `You are using track all but no \"CTX\" or \"STATE\" or \"FORM_STATE\" usage found in your expression: ${JSON.stringify(\n          raw\n        )}`\n      );\n    }\n  }\n  return false;\n}\n","import type { StoryboardFunction } from \"@next-core/types\";\nimport { precookFunction } from \"@next-core/cook\";\nimport { BeforeVisitGlobal } from \"../index.js\";\n\nexport function traverseStoryboardFunctions(\n  functions: StoryboardFunction[] | null | undefined,\n  beforeVisitGlobal: BeforeVisitGlobal\n): void {\n  if (Array.isArray(functions)) {\n    for (const fn of functions) {\n      traverseStoryboardFunction(fn, beforeVisitGlobal);\n    }\n  }\n}\n\nexport function traverseStoryboardFunction(\n  fn: StoryboardFunction,\n  beforeVisitGlobal: BeforeVisitGlobal\n): void {\n  try {\n    precookFunction(fn.source, {\n      typescript: fn.typescript,\n      withParent: true,\n      hooks: { beforeVisitGlobal },\n    });\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error(`Parse storyboard function \"${fn.name}\" failed:`, error);\n  }\n}\n","import type { StoryboardFunction } from \"@next-core/types\";\nimport {\n  MemberUsage,\n  beforeVisitGlobalMember,\n} from \"../expressions/beforeVisitGlobalMember.js\";\nimport { traverseStoryboardFunction } from \"./traverse.js\";\n\nexport function strictCollectMemberUsageInFunction(\n  fn: StoryboardFunction,\n  objectName: string,\n  level: 1 | 2 = 1\n): Set<string> {\n  const { hasNonStaticUsage, usedProperties } = collectMemberUsageInFunction(\n    fn,\n    objectName,\n    level\n  );\n  if (hasNonStaticUsage) {\n    throw new Error(\n      `Non-static usage of ${objectName} is prohibited, check your function: \"${fn.name}\"`\n    );\n  }\n  return usedProperties;\n}\n\nexport function collectMemberUsageInFunction(\n  fn: StoryboardFunction,\n  objectName: string,\n  level: 1 | 2 = 1\n): MemberUsage {\n  const usage: MemberUsage = {\n    usedProperties: new Set(),\n    hasNonStaticUsage: false,\n  };\n\n  traverseStoryboardFunction(\n    fn,\n    beforeVisitGlobalMember(usage, objectName, level)\n  );\n\n  usage.usedProperties.delete(fn.name);\n\n  return usage;\n}\n","import type { Storyboard } from \"@next-core/types\";\nimport type { EstreeLiteral } from \"@next-core/cook\";\nimport {\n  traverseStoryboardExpressions,\n  BeforeVisitGlobal,\n} from \"./expressions/index.js\";\nimport { traverseStoryboardFunctions } from \"./functions/index.js\";\n\nconst PERMISSIONS = \"PERMISSIONS\";\nconst check = \"check\";\n\nexport function scanPermissionActionsInStoryboard(\n  storyboard: Storyboard\n): string[] {\n  const collection = new Set<string>();\n  const beforeVisitPermissions = beforeVisitPermissionsFactory(collection);\n  const { customTemplates, functions } = storyboard.meta ?? {};\n  traverseStoryboardExpressions(\n    [storyboard.routes, customTemplates],\n    beforeVisitPermissions,\n    PERMISSIONS\n  );\n  traverseStoryboardFunctions(functions, beforeVisitPermissions);\n  return Array.from(collection);\n}\n\nexport function scanPermissionActionsInAny(data: unknown): string[] {\n  const collection = new Set<string>();\n  traverseStoryboardExpressions(\n    data,\n    beforeVisitPermissionsFactory(collection),\n    PERMISSIONS\n  );\n  return Array.from(collection);\n}\n\nfunction beforeVisitPermissionsFactory(\n  collection: Set<string>\n): BeforeVisitGlobal {\n  return function beforeVisitPermissions(node, parent): void {\n    if (node.name === PERMISSIONS) {\n      const memberParent = parent[parent.length - 1];\n      const callParent = parent[parent.length - 2];\n      if (\n        callParent?.node.type === \"CallExpression\" &&\n        callParent?.key === \"callee\" &&\n        memberParent?.node.type === \"MemberExpression\" &&\n        memberParent.key === \"object\" &&\n        (memberParent.node.computed\n          ? (memberParent.node.property as any).type === \"Literal\" &&\n            (memberParent.node.property as any).value === check\n          : memberParent.node.property.type === \"Identifier\" &&\n            memberParent.node.property.name === check)\n      ) {\n        for (const arg of callParent.node\n          .arguments as unknown as EstreeLiteral[]) {\n          if (arg.type === \"Literal\" && typeof arg.value === \"string\") {\n            collection.add(arg.value);\n          }\n        }\n      }\n    }\n  };\n}\n"],"names":["http","config","_config$options","_config$options$inter","options","interceptorParams","ignoreLoadingBar","window","dispatchEvent","Event","response","error","Promise","reject","loadingBar","document","querySelector","classList","add","loading","count","updateLoadingStatus","hasRemainingRequests","addEventListener","requestStart","requestEnd","nextRequest","runtime","createRuntime","container","portal","root","unstable_createRoot","scope","unknownBricks","bootstrap","BOOTSTRAP_FILE","responseType","then","data","initialize","rendering","queuedRender","_x","_queuedRender","apply","arguments","_asyncToGenerator","request","type","sources","_x2","_x3","_render","render","req","undefined","_preview_only_render","initialized","_ref","yaml","html","theme","context","functions","templates","i18n","styleText","templatesAreArrayOfYaml","length","body","applyTheme","remove","dom","DOMParser","parseFromString","bricks","Set","node","querySelectorAll","tagName","includes","lowerTagName","toLowerCase","loadBricks","replaceChildren","scripts","scriptTags","scriptTag","newScriptTag","createElement","text","push","append","childNodes","parsed","safeLoad","schema","JSON_SCHEMA","json","concat","brick","properties","textContent","parsedContext","loadYaml","parsedFunctions","parsedTemplates","parsedI18n","e","console","String","content","map","item","_objectSpread","name","ExecutionContext","constructor","_defineProperty","EnvironmentRecord","outer","Map","this","OuterEnv","HasBinding","bindingMap","has","CreateMutableBinding","deletable","set","mutable","NormalCompletion","CreateImmutableBinding","strict","InitializeBinding","value","binding","get","Object","assign","SetMutableBinding","ReferenceError","TypeError","GetBindingValue","DeclarativeEnvironment","FunctionEnvironment","SourceNode","Symbol","for","FormalParameters","ECMAScriptCode","Environment","IsConstructor","ReferenceRecord","base","referenceName","Base","ReferenceName","Strict","CompletionRecord","Type","Value","Empty","collectBoundNames","names","collect","Array","isArray","n","declarations","id","elements","left","argument","from","containsExpression","some","computed","collectScopedDeclarations","nextOptions","var","Number","topLevel","kind","consequent","alternate","init","cases","block","handler","finalizer","IsPropertyReference","V","InitializeReferencedBinding","W","CopyDataProperties","target","source","excludedItems","keys","getOwnPropertyNames","getOwnPropertySymbols","nextKey","desc","getOwnPropertyDescriptor","enumerable","ForDeclarationBindingInstantiation","forDeclaration","env","isConst","LoopContinues","completion","UpdateEmpty","GetValue","ToPropertyKey","arg","GetV","P","PutValue","CreateListIteratorRecord","args","cooked","iterator","RequireObjectCoercible","GetIdentifierReference","ApplyStringOrNumericBinaryOperator","leftValue","operator","rightValue","SyntaxError","reservedObjects","WeakSet","Function","prototype","self","global","Error","getGlobal","sanitize","allowedConstructors","URLSearchParams","WeakMap","RegExp","cook","rootAst","codeSource","_hooks$beforeEvaluate3","rules","globalVariables","hooks","expressionOnly","rootEnv","rootContext","VariableEnvironment","LexicalEnvironment","executionContextStack","key","entries","TemplateMap","Evaluate","optionalChainRef","_hooks$beforeEvaluate","_hooks$beforeBranch","_hooks$beforeBranch2","beforeEvaluate","call","array","element","spreadValues","ThrowIfFunctionIsInvalid","OrdinaryFunctionCreate","getRunningContext","rightRef","right","funcName","substring","start","end","thisValue","ref","callee","func","optional","skipped","EvaluateCall","expression","test","ResolveBinding","regex","raw","flags","_leftValue","baseValue","object","_result","propertyKey","EvaluatePropertyAccessWithExpressionKey","property","identifier","propertyNameString","EvaluatePropertyAccessWithIdentifierKey","constructExpr","argList","ArgumentListEvaluation","constructorName","Date","isAllowedConstructor","_constructorName","EvaluateNew","prop","propName","EvaluateComputedPropertyName","_result2","expr","expressions","chunks","quasis","index","_expr","val","join","tagRef","tag","tagFunc","quasi","ApplyUnaryOperator","_lref","_rval","_rval2","DestructuringAssignmentEvaluation","lref","lval","rval","r","substr","ApplyStringOrNumericAssignment","oldEnv","blockEnv","BlockDeclarationInstantiation","blockValue","EvaluateStatementList","EvaluateBreakableStatement","stmtResult","DoWhileLoopEvaluation","lhs","lhsKind","uninitializedBoundNames","iterationKind","keyResult","runningContext","newEnv","exprRef","exprValue","_iterator","_key","EnumerateObjectProperties","ForInOfHeadEvaluation","stmt","iteratorRecord","destructuring","done","nextValue","next","lhsRef","iterationEnv","lhsName","BindingInitialization","result","status","return","innerResult","ForInOfBodyEvaluation","ForInOfLoopEvaluation","_node$init","ForBodyEvaluation","update","loopEnv","boundNames","dn","perIterationLets","bodyResult","ForLoopEvaluation","functionExpression","funcEnv","closure","InstantiateOrdinaryFunctionExpression","beforeBranch","v","oldValue","newValue","prefix","switchValue","discriminant","_oldEnv","_blockEnv","R","input","defaultCaseIndex","findIndex","switchCase","hasDefaultCase","A","slice","found","C","CaseClauseIsSelected","_R2","foundInB","B","_C","_R3","_C2","_R4","CaseBlockEvaluation","_R","_hooks$beforeEvaluate2","thrownValue","param","catchEnv","argName","CatchClauseEvaluation","F","_result3","declarator","_lhs2","_value","_rval3","WhileLoopEvaluation","increment","perIterationBindings","CreatePerIterationEnvironment","lastIterationEnv","thisIterationEnv","bn","lastValue","pattern","excludedNames","valueTarget","KeyedDestructuringAssignmentEvaluation","RestDestructuringAssignmentEvaluation","PropertyDestructuringAssignmentEvaluation","assignmentTarget","isObjectOrArray","_value2","_done","_nextValue","IteratorDestructuringAssignmentEvaluation","propertyName","rhsValue","restProperty","code","d","IsConstantDeclaration","_fn","_fo","InstantiateFunctionObject","templateLiteral","memo","rawObj","template","freeze","defineProperty","writable","configurable","GetTemplateObject","statements","s","sourceNode","isConstructor","_hooks$beforeCall","beforeCall","calleeContext","localEnv","PrepareForOrdinaryCall","formals","parameterNames","hasParameterExpressions","varDeclarations","varNames","functionNames","functionsToInitialize","i","_fn2","unshift","noVar","varEnv","paramName","IteratorBindingInitialization","_n","initialValue","lexEnv","lexDeclarations","_d","f","_fn3","_fo2","FunctionDeclarationInstantiation","EvaluateFunctionBody","OrdinaryCallEvaluateBody","pop","CallFunction","defineProperties","params","environment","InitializeBoundName","RestBindingInitialization","KeyedBindingInitialization","PropertyBindingInitialization","restObj","_node","_value3","_A","_n2","_done2","_value4","bindingElement","_done3","_value5","_lhs3","_v","_done4","_value6","_v2","async","generator","fn","fo","AnalysisContext","AnalysisEnvironment","bindingSet","CreateBinding","precook","visitors","withParent","attemptToVisitGlobals","analysisContextStack","EvaluateChildren","parent","forEach","_hooks$beforeVisit","_hooks$beforeVisitUnk","beforeVisit","hasOwnProperty","visit","_hooks$beforeVisitGlo","beforeVisitGlobal","_runningContext","BoundNamesInstantiation","lexicalBinding","_runningContext2","_oldEnv2","_lexicalBinding","_runningContext3","_oldEnv3","_env","_runningContext4","_oldEnv4","beforeVisitUnknown","warn","precookFunction","typescript","restOptions","_objectWithoutProperties","_excluded","parse","plugins","filter","Boolean","strictMode","attachComment","program","jsNodes","startsWith","parseAsEstree","function","preevaluate","fixes","replace","m","parseExpression","proposal","parseAsEstreeExpression","suffix","isEvaluable","shouldAllowRecursiveEvaluations","isTrackAll","fetch","Request","credentials","HttpFetchError","message","super","captureStackTrace","HttpResponseError","responseJson","statusText","HttpParseError","HttpAbortError","InterceptorManager","use","onFulfilled","onRejected","handlers","fulfilled","rejected","eject","isNil","fullBaseHref","href","location","origin","isHttpAbortError","DOMException","createError","url","_ref2","resolve","toString","ok","headers","_x4","_x5","getUrlWithParams","parsedUrl","URL","searchParams","_ref3","getBodyAndHeaders","parsedHeaders","Headers","contentTypeHeader","FormData","JSON","stringify","defaultAdapter","method","simpleRequest","_ref4","observe","noAbortOnRouteChange","useCache","requestInit","requestWithBody","_ref5","_excluded2","_adapter","_fetch","Http","_config","_this","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","_ref6","_ref7","_excluded3","_classPrivateMethodGet","_fetch2","_x6","_x7","_x8","interceptors","adapter","_classPrivateFieldSet","delete","head","post","put","patch","chain","promise","interceptor","_classPrivateFieldGet","_response$config$opti","shift","createHttpInstance","initializedNamespaces","initializeI18n","NS","locales","LanguageDetector","fallbackLng","debug","process","supportedLngs","nonExplicitSupportedLngs","interpolation","escapeValue","react","useSuspense","compatibilityJSON","resources","lang","i18nText","_i18n$language","language","primaryLanguage","split","i18next","PipeRegistry","pipes","processPipes","pipe","registeredPipe","parameters","LexicalStatus","TokenType","JsonValueType","getRegExpOfPlaceholder","symbols","symbol","escapeRegExp","eatOptionalRawAndOptionalPlaceholderBegin","_subRaw$match","subRaw","getSubRaw","matchedPlaceholder","match","beginPlaceholder","subCursor","indexOf","charAt","nextCursor","cursor","tokens","Raw","BeginPlaceHolder","loc","ExpectField","eatWhitespace","eatField","Field","ExpectOptionalBeginDefault","eatOptionalDefault","BeginDefault","ExpectDefaultValue","ExpectOptionalBeginPipe","eatDefaultValue","eatJsonValueOrLiteralString","eatOptionalBeginPipe","BeginPipe","ExpectPipeIdentifier","ExpectPlaceholderEnd","eatPipeIdentifier","matches","PipeIdentifier","ExpectOptionalBeginPipeParameter","eatOptionalBeginPipeParameter","BeginPipeParameter","ExpectPipeParameter","eatPipeParameter","eatPlaceholderEnd","EndPlaceHolder","Initial","jsonLiteralMap","nextStatus","firstChar","valueType","Others","objectBracesToMatch","arrayBracketsToMatch","stringQuotesToClose","stringBackslashToEscape","matched","char","JsonValue","eatJsonValue","LiteralString","transform","compile","inject","transformAndInject","isInjectable","values","transformNode","field","defaultValue","injectNode","_context$overrideApp","_context$overrideApp2","namespace","subField","SimpleContextMap","SYS","FLAGS","query","getAll","event","overrideApp","app","hash","anchor","original","injectNodeFactory","token","tree","optionalToken","acceptToken","placeholder","parseTokens","tokenize","parseInjectableString","cache","loadScript","src","all","fixedSrc","cachedPromise","script","onload","onerror","firstScript","currentScript","getElementsByTagName","parentNode","insertBefore","resolveBasicPkg","loadSharedModule","_loadSharedModule","module","__webpack_init_sharing__","__webpack_share_scopes__","default","v2AdapterPromise","basicPkgWillBeResolved","waitBasicPkg","flushStableLoadBricks","enqueueStableLoadBricks","brickPackages","dispatchRequestStatus","enqueueStableLoad","enqueueStableLoadProcessors","processors","loadBricksImperatively","_loadBricksImperatively","loadProcessorsImperatively","V2_ADAPTER_LOAD_BRICKS","getItemsByPkg","list","brickPackagesMap","itemsByPkg","listToLoad","_pkg$dependencies","pkg","itemName","pkgId","toLocaleLowerCase","p","_p$elements","groupItems","deps","dependencies","dep","loadBrickModule","_loadBrickModule","moduleName","loadRestBricks","pkgs","itemsMap","_window$PUBLIC_ROOT","filePath","PUBLIC_ROOT","_x9","_enqueueStableLoad","_pkg$id","getPkgIdByFilePath","foundBasicPkg","maybeV2Adapter","v2Packages","v3PackagesOtherThanBasic","_pkg","basicPkgPromise","v2Adapter","basicPkg","_window$PUBLIC_ROOT2","tempPromise","pkgPromises","v2AdapterItemsByPkg","v2AdapterPackages","loadV2Adapter","pkgNamespace","dll","_x10","_dispatchRequestStatus","getBasePath","getAttribute","matchStoryboard","storyboards","pathname","sortedStoryboards","orderBy","storyboard","_storyboard$app$homep","_storyboard$app","_storyboard$app$homep2","homepage","isOutsideApp","_getRuntime$getCurren","getRuntime","getCurrentApp","STANDALONE_MICRO_APPS","standaloneMode","history","blocked","getUserConfirmation","callback","confirm","createHistory","browserHistory","createBrowserHistory","basename","blockMessage","originalPush","originalReplace","state","updateQueryFactory","extraQuery","clear","keepHash","urlSearchParams","search","pushQuery","replaceQuery","pushAnchor","notify","reload","setBlockMessage","getBlockMessage","unblock","updateFactory","path","pathIsString","parsePath","_bootstrapData$storyb","_bootstrapData8","bootstrapData","_internalApiMatchStoryboard","createHref","historyOverridden","historyExtended","getHistory","customProcessors","_registry","define","processorFullName","processorFunc","processorName","registerAppI18n","meta","i18nNamespace","getI18nNamespace","languages","registerWidgetI18n","widgetId","i18nData","ns","widgetI18nFactory","widgetImagesFactory","widgetVersion","PUBLIC_ROOT_WITH_VERSION","getDevHook","__BRICK_NEXT_DEVTOOLS_HOOK__","THROW","readOnlyHandler","deleteProperty","setPrototypeOf","getReadOnlyProxy","Proxy","getDynamicReadOnlyProxy","ownKeys","fromEntries","storage","JsonStorage","localStorage","LOCAL_STORAGE_APPS_THEME_KEY","setTheme","getTheme","getCurrentTheme","documentElement","dataset","CustomEvent","detail","batchSetAppsLocalTheme","appsTheme","setItem","getLocalAppsTheme","getItem","_unused","mode","setMode","getCurrentMode","applyMode","getCssPropertyValue","_window$getComputedSt","el","getComputedStyle","getPropertyValue","getGeneralGlobals","variableName","variable","getIndividualGlobal","_hooks$checkPermissio","appId","isBuildPush","version","collectCoverage","appendI18nNamespace","storyboardFunctions","isStoryboardFunction","currentVersion","APP_ROOT","APP_ID","identity","fakeI18nText","check","fakeCheckPermissions","checkPermissions","host","hostname","en","StoryboardFunctionRegistryFactory","currentApp","registeredFunctions","collector","processed","createCollector","precooked","supply","getStoryboardFunction","registerStoryboardFunctions","strictCollectMemberUsageInFunction","hasPermissionsCheck","updateStoryboardFunction","newFn","checkPermissionsUsage","checkedFunctions","MediaBreakpoint","mediaBreakpointMinWidthMap","xLarge","large","medium","small","xSmall","mediaEventTarget","EventTarget","breakpointMatchesMap","MEDIA","handleMatchesChange","breakpoint","changed","_breakpoint","minWidth","mediaQueryList","matchMedia","addListener","getMedia","getStorageItem","storageType","_storage$getItem","sessionStorage","isStrictMode","runtimeContext","_getRuntime","getFeatureFlags","warnAboutStrictMode","_len","extraLogs","punctuation","allowedNativeProps","customTemplates","_constructor$proxy$pr","_constructor$proxy","_compatibleConstructo","_compatibleConstructo2","registered","customElements","proxyProperties","proxy","validProxyProps","legacyTplVariables","asVariable","mergeProperty","refTransform","compatibleConstructor","expose","tpl","_state$filter$map","exposedStates","uniq","proxyMethods","methods","props","entry","nativeProps","HTMLElement","TplElement","$$typeof","_dev_only_definedProperties","_dev_only_definedMethods","$$getElementByRef","_this$$$tplStateStore","_this$$$tplStateStore2","_this$$$tplStateStore3","_this$$$tplStateStore4","$$tplStateStore","hostBrick","tplHostMetadata","internalBricksByRef","connectedCallback","shadowRoot","attachShadow","fragment","createDocumentFragment","style","slot","appendChild","disconnectedCallback","_loop","getValue","_this$$$tplStateStore5","updateValue","_loop2","to","_to$refProperty","refProperty","_this$$$getElementByR","_to$refProperty2","_loop3","_from","_to","_to$refMethod","refMethod","getTplStateStore","using","extraInfo","tplStateStoreId","tplStateStoreMap","store","getTplHostElement","hostElement","widgetFunctionRegistry","widgetFunctions","registerWidgetFunctions","hasInstalledApp","matchVersion","_internalApiGetAppInBootstrapData","checkInstalledApps","getCheckedApp","installStatus","compare","getFormStateStore","formStateStoreId","formStateStoreMap","pool","getProviderBrick","_getProviderBrick","provider","_hooks$flowApi","isFlowApi","isFlowApiProvider","getBrickPackages","resolveData","_resolveData","resolveConf","useProvider","onReject","legacyProvider","providerBrick","actualArgs","asyncComputeRealValue","resolveByProvider","isHandleRejectByTransform","_resolveByProvider","originalArgs","cacheKey","finalArgs","flowApi","getArgsOfFlowApi","symbolForRaw","symbolForContext","isPreEvaluated","getPreEvaluatedRaw","pre","shouldDismissMarkingComputed","possibleErrorConstructs","getCookErrorConstructor","_asyncEvaluate","blockingList","run","lowLevelEvaluate","isAsync","passByRuntimeContext","omit","menuUsage","usedArgs","hasAppUsage","collectAppGetMenuUsage","collectInstalledAppsHasUsage","hasNonStaticUsage","usedCtx","usedProcessors","usedStates","tplStateStore","lazy","usedFormStates","formStateStore","devHook","strictCollectMemberUsage","ctxStore","waitFor","usedTpls","_hooks$checkInstalled","attemptToCheckPermissions","usedFunctions","pendingPermissionsPreCheck","size","usedMenuIds","menuId","getStoryboardByAppId","_internalApiGetStoryboardInBootstrapData","waitForCheckingApps","_runtimeContext$overr","_hooks$menu","_match$params","sys","cloneDeep","getMenu","getMenuById","forEachItem","getMiscSettings","t","k","_message","StateOfUseBrick","isLazyContentInUseBrick","USE_BRICK_PROPERTIES","USE_BRICK_TRANSFORM","USE_BRICK_EVENTS","USE_BRICK_IF","USE_BRICK_LIFECYCLE","USE_BRICK_DATA_SOURCE","getNextStateOfUseBrick","USE_BRICK","USE_BRICK_ITEM","USE_BRICK_SLOTS_ITEM_BRICKS","USE_BRICK_SLOTS_ITEM_BRICKS_ITEM","INITIAL","USE_BRICK_SLOTS","USE_BRICK_SLOTS_ITEM","markAsComputed","isObject","hasBeenComputed","proto","getPrototypeOf","_asyncComputeRealValue","internalOptions","preEvaluated","$$lazyForUseBrick","$$stateOfUseBrick","dismissMarkingComputed","asyncEvaluate","noInject","getNextComputeOptions","ignoreSymbols","computeRealValue","evaluate","asyncCheckIf","_asyncCheckIf","ifContainer","if","checkIf","checkIfOfComputed","_asyncCheckBrickIf","brickConf","checkIfByTransform","getTracks","contextNames","stateNames","formStateNames","trackAll","formState","track","_asyncComputeRealProperties","trackingContextList","propValue","realValue","setRealProperties","realProps","setProperties","computeRealProperties","cacheLimit","cacheCount","matchPath","exact","sensitive","reduce","regexp","pathCache","cacheResult","pathToRegexp","compilePath","exec","isExact","_matchRoutes","routes","route","routePath","noAuthGuard","public","auth","isLoggedIn","symbolForAsyncComputedPropsFromHost","symbolForTplStateStoreId","symbolForTPlExternalForEachItem","timeoutIdList","K","REQUEST_FAILED","SOMETHING_WENT_WRONG","LOGIN_TIMEOUT_MESSAGE","NETWORK_ERROR","zh","Dialog","show","setTimeout","alert","httpErrorToString","HTMLScriptElement","msg","isUnauthenticatedError","lastErrorMessage","unauthenticatedConfirming","handleHttpError","NO_AUTH_GUARD","ssoEnabled","title","contentStyle","whiteSpace","Notification","bindListeners","eventsMap","eventType","listener","listenerFactory","$$listeners","$$eventListeners","isBuiltinHandler","action","isUseProviderHandler","isCustomHandler","targetRef","isConditionalEventHandler","runtimeBrick","_handler$batch","_handler$batch2","handleHistoryAction","handleWindowAction","handleLocationAction","handleStorageAction","preventDefault","handleConsoleAction","handleMessageAction","handleContextAction","batch","handleTplStateAction","argsFactory","handleFormStateAction","handleUseProviderAction","handleCustomAction","else","_handleUseProviderAction","brickCallback","targets","rawTarget","rawTargetRef","computedTarget","multiple","computedTargetRef","targetRefs","tplHostElement","_tplHostElement$$$get","isExecuteCustomHandler","useEventAsDefault","isSetPropsCustomHandler","_x11","_brickCallback","_poll","task","computedArgs","poll","callbackFactory","eventCallbackFactory","pollableCallback","progress","success","finally","enabled","currentTimeoutId","finallyCallback","interval","leadingRequestDelay","continueOnError","delegateLoadingBar","expectPollEnd","expectPollStopImmediately","currentRenderId","_internalApiGetRenderId","shouldStop","delayedPoll","delay","startPoll","err","baseArgsLength","hasCallback","overrideMethod","useEventDetailAsDefault","features","open","batchUpdate","updateValues","every","removeItem","DataStore","changeEventType","_this$data$get","getAffectListByContext","affectNames","batchUpdateContextsNames","updateContexts","affectContexts","affectDepsContextNames","updateContextItem","affectContextItem","triggerEvent","contexts","_context$eventTarget","eventTarget","callbackRuntimeContext","load","loaded","dataConfs","asyncHostProperties","pending","contextConfs","resolveContext","keyword","dependencyMap","depsMap","_contextConf","stats","collectMemberUsage","getDependencyMapOfContext","pendingDeps","contextName","contextConf","_pendingDeps$get","deferredContexts","pendingContexts","wrapResolve","_pendingDeps$get2","resolved","scheduleNext","scheduleAsSerial","_scheduleNext","readyContexts","usedProperties","predicateNextResolveFactory","pendingResult","deferred","duplicatedMap","processedAtLeastOne","_contextConf2","detectCircularContexts","catch","resolveDataStore","dataConf","pendingStack","onChange","dataName","_this$data$get2","dataNames","ctx","waitForAll","_this2","_this3","hostProps","isLazyResolve","newData","batchAddListener","setupTemplateProxy","hostContext","slots","asyncComputedProps","reversedProxies","externalSlots","propertyProxies","slotProxies","quasisMap","_externalSlots$from$b","_externalSlots$from","_to$refSlot","_to$refPosition","insertBricks","refToSlot","refSlot","expandableSlot","refPosition","clamp","setupTemplateExternalBricks","slotName","slotConf","flatMap","_brick$slots","_slotConf$bricks","setupTemplateExternalRoutes","setupUseBrickInTemplate","walk","setup","originalSlots","children","restConf","transpiledSlots","childrenToSlots","expandCustomTemplate","tplTagName","uniqueId","tplStateStoreScope","contracts","collectWidgetContract","originalExternalSlots","externalChildren","restBrickConf","newBrickConf","proxies","_proxies","expandBrickInTemplate","brickConfInTemplate","slotsInTemplate","childrenInTemplate","restBrickConfInTemplate","RenderTag","FORM_RENDERER","symbolForFormStateStoreId","formSchemaToBrick","fields","events","mountPoint","instanceId","iid","find","fieldId","defaults","commonProps","label","testid","getReadOnlyAndRequired","_field$limit","_field$limit2","readOnly","limit","required","fieldType","description","precision","inputBoxStyle","width","getDefaultProperties","formSchemasToBricks","schemas","renderRoutes","_renderRoutes","returnNode","_runtimeContext","rendererContext","slotId","matchRoutes","output","menuRequests","unauthenticated","preCheckPermissionsForBrickOrRoute","preLoadBricks","redirectTo","redirect","loadMenu","menu","mergeRenderOutput","renderBricks","_x12","_renderBricks","tplStack","noMemoize","renderBrick","hasTrackingControls","memoizeControlNode","_x13","_x14","_x15","_x16","_x17","_x18","_renderBrick","_hooks$checkPermissio2","_runtimeContext$app","brickIf","permissionsPreCheck","isGeneralizedTrackAll","dataSource","acc","asyncCheckBrickIf","brickName","ensureValidControlBrick","renderControlNode","_slots$slot","computedDataSource","_x19","_x20","_x21","_x22","_x23","_x24","_x25","_renderForEach","renderForEach","controlledOutput","renderId","rerenderControlNode","debouncedListener","debounce","_contextName","catchLoadBrick","getTagNameOfCustomTemplate","_tplStack$get","tplCount","formData","confProps","BRICK","_brickConf$properties","loadProperties","asyncComputeRealProperties","computedPropsFromHost","_brick$properties","stateName","_stateName","listenOnTrackingContext","asyncProperties","registerBrickLifeCycle","lifeCycle","childRuntimeContext","expandedBrickConf","hostBrickConf","_normalizedFormData$c","_hostBrickConf$proper","normalizedFormData","formStateStoreScope","formConf","formSchema","targetEvents","sourceEvents","flat","mergeEvents","renderRoot","padding","expandFormRenderer","loadChildren","rendered","childSlotId","childrenOutput","child","j","menuConf","newOutput","rest","last","sibling","newSlots","_child$slot","bindTemplateProxy","_tplHostMetadata$prox","_to$refEvent","_ref$$$proxyListeners","bubbles","stopPropagation","cancelable","composed","refEvent","$$proxyListeners","unbindTemplateProxy","_$$proxyListeners","removeEventListener","unmountTree","innerHTML","mountTree","initializedElement","current","portalElements","setAttribute","childElements","_currentReturn","currentReturn","_currentReturn$contai","ROOT","createPortal","misc","nativeController","commonLifeCycles","pageOnlyLifeCycles","_memoizedLifeCycle","_observers","_mediaListener","_memoizedControlNodes","_unmountBricks","_initializeRerenderBricks","_dispatchGeneralLifeCycle","_addObserver","RendererContext","_options$unknownBrick","onBeforePageLoad","onPageLoad","onPageLeave","onBeforePageLeave","onAnchorLoad","onAnchorUnload","onMediaChange","onScrollIntoView","onMount","onUnmount","lifeCycleTypes","isEmpty","useResolves","memKey","mem","getLastNode","lastNormal","getLastNormalNode","lastPortal","getLastPortalNode","_prevLastNormal$eleme","_prevLastNormal$eleme2","_prevLastPortal$eleme","_prevLastPortal$eleme2","prevSibling","memoized","prevNode","prevLast","prevLastNormal","prevLastPortal","insertBeforeChild","nextSibling","insertPortalBeforeChild","portalFragment","_returnNode$container","_returnNode$element","removeBricks","getBrickRange","_unmountBricks2","_root","newBricks","_initializeRerenderBricks2","dispose","_list","observer","disconnect","dispatchBeforePageLoad","_dispatchGeneralLifeCycle2","dispatchPageLoad","dispatchBeforePageLeave","dispatchPageLeave","dispatchAnchorLoad","initializeScrollIntoView","conf","_addObserver2","initializeMediaChange","dispatchOnMount","dispatchOnUnmount","unmountList","removed","_brick$element","_brick$element2","observers","unmountEvent","_brick","mountEvent","_brick2","_conf$threshold","threshold","IntersectionObserver","isIntersecting","intersectionRatio","_last","range","_currentReturn2","getPageInfo","isInIframe","isInIframeOfSameSite","isInIframeOfNext","isInIframeOfVisualBuilder","isInIframeOfLegacyConsole","selfIsNext","parentPathname","parentIsNext","registerCustomTemplates","_storyboard$meta","$$registerCustomTemplateProcessed","_fulfilStoryboard","$$fulfilled","$$fulfilling","_doFulfilStoryboard","doFulfilStoryboard","_hooks$fulfilStoryboa","_storyboards","_rendering","_prevLocation","_nextLocation","_rendererContext","_rendererContextTrashCan","_redirectCount","_renderId","_currentApp","_previousApp","_navConfig","_getBlockMessageBeforePageLave","_safeRedirect","Router","_history","_getBlockMessageBeforePageLave2","returnValue","getRenderId","getRuntimeContext","getRecentApps","previousApp","getNavConfig","AbortController","signal","listen","_classPrivateFieldGet2","_location$state","_classPrivateFieldGet3","ignoreRendering","omittedLocationProps","locationsAreEqual","abort","_queuedRender2","_classPrivateFieldGet4","previousMessage","_safeRedirect2","_this$redirectCount","_this$redirectCount2","_queuedRender3","_render2","nextLocation","_render3","_classPrivateFieldGet5","clearCollectWidgetContract","fulfilStoryboard","appChanged","prevRendererContext","redirectToLogin","main","cleanUpPreviousRender","_hooks$auth","_hooks$flowApi2","_storyboard$meta2","preCheckInstalledApps","getAuth","settings","brand","getBrandSettings","preCheckPermissions","collectContract","failed","mergedRoutes","specificTemplatePreviewIndex","findLastIndex","specificSnippetPreviewIndex","insertPreviewRoutes","menuConfs","navConfig","breadcrumb","overwrite","items","mergeMenuConfs","scrollTo","router","injectedBrickPackages","BRICK_PACKAGES","moment","Runtime","_initialized","_bootstrapped","_data$settings$preset","_data$settings","localeName","deepFreeze","normalizeBootstrapData","notification","dialog","presetBricks","loadNotificationService","loader","loadDialogService","_router$getRecentApps","_router","_router2","_bootstrapData","_bootstrapData$settin","_router3","_router3$getRecentApp","_router3$getRecentApp2","_router3$getRecentApp3","featureFlags","_bootstrapData2","_bootstrapData2$setti","_router4","_router4$getRecentApp","_router4$getRecentApp2","_router4$getRecentApp3","_bootstrapData3","_bootstrapData3$setti","base_title","getLaunchpadSettings","_bootstrapData4","_bootstrapData4$setti","columns","rows","launchpad","getDesktops","_bootstrapData$deskto","_bootstrapData5","desktops","getLaunchpadSiteMap","_bootstrapData$siteSo","_bootstrapData6","siteSort","toggleLaunchpadEffect","toggle","applyPageTitle","pageTitle","baseTitle","_router5","_bootstrapData$brickP","_bootstrapData7","_router6","_internalApiGetRuntimeContext","_router7","_bootstrapData9","_bootstrapData9$story","_internalApiGetStoryb","authenticate","_hooks$auth$authentic","_hooks$auth2","logout","_hooks$auth3","_hooks$auth3$logout","_hooks$auth4","fetchByProvider","_fetchByProvider","_portal","position","height","clearI18nBundles","unmounted","_arguments","previousRendererContext","_clearI18nBundles","demoApp","demoStoryboard","unmount","renderUseBrick","_renderUseBrick","useBrick","_runtimeContext$tplSt","_runtimeContext$formS","_output$node","mountUseBrick","portalRoot","unmountUseBrick","mountResult","legacyDoTransform","updateStoryboard","storyboardPatch","updateStoryboardByRoute","newRoute","getKey","replaceRoute","routeKey","updateStoryboardByTemplate","newTemplate","tplName","updateTemplatePreviewSettings","templateId","_updatePreviewSettings","pick","updateStoryboardBySnippet","snippetData","_snippetData$bricks","snippetId","updateSnippetPreviewSettings","previewRouteIndex","newPreviewRoute","splice","providedGlobalVariables","mock","supplyIndividual","shouldOmitInLodash","shouldOmitInMoment","allowedGlobalObjects","lodash","tagUrlFactory","ignoreSlashes","strings","_len2","partials","_key2","str","encodeURIComponent","createProviderClass","api","propNames","_this$storage$getItem","unwrapProvider","beforeVisitGlobalMember","usage","objectName","level","rememberObjectName","segments","memberParent","memberNode","collectMemberCallUsageFactory","callParent","firstArg","traverseStoryboardExpressions","matchExpressionString","visitNotMatchedExpressionString","visitNonExpressionString","visitObject","traverse","nonStaticUsage","trackText","trackCtxExp","usedProperites","keyMap","CTX","STATE","FORM_STATE","traverseStoryboardFunctions","traverseStoryboardFunction","collectMemberUsageInFunction","PERMISSIONS","scanPermissionActionsInStoryboard","collection","beforeVisitPermissions","beforeVisitPermissionsFactory","scanPermissionActionsInAny"],"sourceRoot":""}